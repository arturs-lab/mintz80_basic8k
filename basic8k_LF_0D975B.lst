0000                             ;Edits:
0000                             ;    30-Jun-08 KJL
0000                             ;       - Created from IMSAI 8K BASIC Version 1.4 manual
0000                             ;---------------------------------------------------------
0000                             ; BASIC30.ASM   1.4     05/19/77        JRB     8K BASIC
0000                             ; BASICS2.ASM   1.401   05/11/77        DK      8K BASIC
0000                             ; BASIC19.ASM   1.401   05/11/77        DH
0000                             ; BASIC18.ASM   1.401   05/10/77        JRB
0000                             ; BASIC16.ASM   1.401   05/09/77        DH
0000                             ; BASIC11.ASM   1.401   05/04/77        DH
0000                             ; BASIC10.ASM   1.401   05/03/77        DH
0000                             ; BASIC8.ASM    1.401   05/02/77        DH
0000                             ; 
0000                             ; IMSAI 8K-9K BASIC
0000                             ; 
0000                             ; COPYRIGHT (C) 1977
0000                             ; IMSAI MANUFACTURING CORPORATION
0000                             ; 14860 WICKS BLVD, SAN LEANDRO CALIFORNIA  94577
0000                             ; 
0000                             ; CORRECTION HISTORY:
0000                             ; 
0000                             ;   02/25/77 - FIXED BEGPR POINTERS
0000                             ;            - FIXED LOG(X) FOR 0.5 < X < 1.0
0000                             ;            - FIXED SQR(X) FOR 0.0 < X < 0.5
0000                             ;            - FIXED SCI NOTATION INPUT ROUTINE
0000                             ;            - FIXED EDIT ROUTINE WHEN PROGRAM ENDS ON
0000                             ;              00 BOUNDARY (SYSTEM USED TO GO AWAY)
0000                             ;            - ADDED XEQ COMMAND (LIKE RUN BUT KEEPS DATA)
0000                             ;            - SOFTWARE MEMORY PROTECT OF 1ST 9K IMPLIMENTED
0000                             ;            - FIXED TAB FOR BACKWARDS MOVEMENT
0000                             ;            - FIXED OV ERROR FOR SMALL X IN TRIG,LOG & EXP
0000                             ;            - ADDED PROGRAM CHAINING CAPABILITY.
0000                             ;            - FIXED EXP(X) ROUTINE FOR LARGE X.
0000                             ;            - ADDED PEEK(X) COMMAND
0000                             ;            - ADDED POKE A,X COMMAND
0000                             ;            - ADDED CALL A COMMAND
0000                             ;  04/02/77  - ADDED TARBEL CASSETTE SAVE AND LOAD
0000                             ;            - ADDED FIX LINE EDITOR
0000                             ;            - RENAMED NATURAL LOG TO LN(X)
0000                             ;            - ADDED BASE 10 LOG AS LOG(X)
0000                             ;            - ALLOWED FOR DAZZLER IN OUTPUT ROUTINE
0000                             ;            - ADDED LINE # SEARCH UTILITY (LOCAT EQU $)
0000                             ;            - ADDED TABLE SEARCH UTILITY (SEEK EQU $)
0000                             ;            - ARRAYS CAN NOW HAVE > 256 ELEMENTS PER DIM
0000                             ; 04/09/77   -ADDED CONDITIONAL ASSY PARAMS FOR 8 AND 9K
0000                             ;            -FIXED POWER ERROR. (X^B WHEN B=0 GAVE X^2.)
0000                             ;            -ADDED CONTROL H AS PHYSICAL RUBOUT OF CHAR
0000                             ; 04/27/77   -CHANGE RST'S TO RUN UNDER CP/M
0000                             ;            -ADDED EXPRESSION EVALUATER FIX
0000                             ;            -LOAD UNDER CP/M
0000                             ; 05/02/77   -ADD DDT, BYE COMMANDS, BIOS I/O
0000                             ; 05/03/77   -OPTIMIZE FUNCTION ITERATION LOOP (SIN5)
0000                             ;            -SO UNDERFLOW CAN BE MADE NON-FATAL
0000                             ; 05/04/77   -OPTIMIZE SIN(X) ROUTINE
0000                             ;            -ADD NON-FATAL ERRORS
0000                             ; 05/09/77   -SQUISH TO INCLUDE PEEK,POKE,CALL IN 8K
0000                             ; 05/11/77   -MAKE RND(X) USE X AS RANGE; X^0->1,0^X->0
0000                             ;            -TAB(N) GO TO NEXT LINE IF PAST POSITION
0000                             ; 5/12/77   - BUG IN NESTED FOR"S AND REENTERED FOR"S FIXED
0000                             ; 
0000                             ; ASSEMBLY PARAMETERS:
0000                             ;        LARGE   EQU     0       ;-1=9K ASSEMBLY, 0=8K
0000                             ;        CPM     EQU     0       ;-1=RUN UNDER CPM
0000                             ;        HUNTER  EQU     0       ;-1= INCLUDE BAUD COMMAND
0000                             ; 
0000                             ; SIO equates
0000                             ; 
0000                SIO_RX:   EQU   $18   
0000                SIO_TX:   EQU   $18   
0000                SIO_RX_STATUS:   EQU   $19   
0000                SIO_TX_STATUS:   EQU   $19   
0000                SIO_RX_FULL:   EQU   $01   
0000                SIO_TX_EMPTY:   EQU   $04   
0000                OFFSET:   EQU   $0000   
0000                RUBOUT:   EQU   0x08   
0000                             ; 
0000                             ; BASIC EQUATES
0000                             ; 
0000                FATAL:    EQU   0F7H   ;CODE FOR FATAL IS RST 6
0000                             ; 
0000                BASIC:    .ORG   0+OFFSET   
0000   21 00 28               LXI   H,RAM+1024   
0003   3E AE                  MVI   A,0AEH   ;START OF INIT SEQUENCE
0005   C3 81 00               JMP   INIT1   ;FINISH INIT
0008                             ; 
0008                             ; 
0008                             ;       ORG     8
0008                             ; 
0008                             ; SKIP CHARS POINTED BY H,L UNTIL NON-BLANK,
0008                             ; LEAVE IN REG A
0008                             ; 
0008   7E           RST1:     MOV   A,M   ;LOAD THE BYTE AT (H,L)
0009   FE 20                  CPI   " "   ;TEST IF BLANK
000B   C0                     RNZ      ;RETURN IF NOT
000C   23                     INX   H   ;POINT NEXT
000D   C3 08 00               JMP   RST1   ;LOOP
0010                             ; 
0010                             ; 
0010                             ;       ORG     16
0010                             ; 
0010                             ; COMPARE STRING AT (H,L) TO STRING AT (D,E)
0010                             ; RETURN IF EQUAL (THRU X"00" IN D,E) OR ON FIRST NOT EQUAL
0010                             ; ONLY THE FIRST THREE CHARS NEED BE EQUAL
0010                             ; IGNORE ALL SPACES
0010                             ; 
0010   C5           RST2:     PUSH   B   ;SAVE B,C
0011   06 00                  MVI   B,0   ;INIT COUNT
0013   CF           COMP1:    RST   1   ;SKIP SPACES
0014   1A                     LDAX   D   ;GET CHAR TO MATCH WITH
0015   C3 7F 1A               JMP   COMP2   ;CONTINUE ELSEWHERE
0018                             ; 
0018                             ; 
0018                             ;       ORG     24
0018                             ; 
0018                             ; STORE THE FLOATING POINT ACCUMULATOR AT (H,L)
0018                             ; 
0018   11 58 26     RST3:     LXI   D,FACC   ;POINT FLOAT ACC
001B   06 04                  MVI   B,4   ;BYTE COUNT
001D   C3 53 1C               JMP   COPYD   ;GO MOVE IT
0020                             ; 
0020                             ; 
0020                             ;       ORG     32
0020                             ; 
0020                             ; INCREMENT H,L BY BYTE AT (SP), RETURN TO (SP)+1
0020                             ; 
0020   E3           RST4:     XTHL      ;GET RETURN ADDRESS IN H,L
0021   7E                     MOV   A,M   ;GET THE INCREMENT
0022   23                     INX   H   ;POINT TRUE RETURN
0023   E3                     XTHL      ;PUT BACK TO STACK
0024   D5                     PUSH   D   ;SAVE D,E
0025   C3 3B 00               JMP   RST4A   ;CONTINUE
0028                             ; 
0028                             ; 
0028                             ;       ORG     40
0028                             ; 
0028                             ; LOAD THE FLOATING POINT ACCUM WITH THE 4 BYTES AT (H,L)
0028                             ; 
0028   11 58 26     RST5:     LXI   D,FACC   ;POINT FLOAT ACC
002B   06 04                  MVI   B,4   ;BYTE COUNT
002D   C3 5E 1C               JMP   COPYH   ;GO MOVE IT
0030                             ; 
0030                             ; 
0030                             ;       ORG     48
0030                             ; 
0030                             ; PRINT:  "XX ERR & NNN"
0030                             ; **** IF ERROR MESSAGE CHANGES TO A DIFFERENT RST,
0030                             ; **** ...CHANGE "FATAL" EQUATE
0030                             ; 
0030   E3           RST6:     XTHL      ;SAVE HL, GET ERROR CODE PTR
0031   F5                     PUSH   PSW   ;SAVE REGS
0032   D5                     PUSH   D   
0033   C5                     PUSH   B   
0034   C3 37 1C               JMP   ERROR   ;CONTINUE
0037                             ; 
003B                          .ORG   59+OFFSET   ;LEAVE 3 BYTES FOR DDT
003B                             ; 
003B   5F           RST4A:    MOV   E,A   ;PUT IN LOW
003C   B7                     ORA   A   ;TEST SIGN
003D   16 00                  MVI   D,0   ;DEFAULT POSITIVE
003F   F2 44 00               JP   RST4B   ;BRIF +
0042   16 FF                  MVI   D,0FFH   ;ELSE, NEG
0044   19           RST4B:    DAD   D   ;BUMP H,L
0045   D1                     POP   D   ;RESTORE D,E
0046   C9                     RET      ;RETURN
0047                             ;PAGE
0047   43 4F 50 59 52 49 47 48 54 20 28 43 29 20 31 39 37 37 20 DB   "COPYRIGHT (C) 1977 "   
005A   49 4D 53 41 49 20 4D 46 47 20 43 4F 52 50 20 DB   "IMSAI MFG CORP "   
0069   53 41 4E 20 4C 45 41 4E 44 52 4F 20 43 41 20 39 34 35 37 37 20 55 53 41 DB   "SAN LEANDRO CA 94577 USA"   
0081                             ; 
0081                             ; INITIALIZATION ROUTINE
0081                             ; DETERMINE MEMORY SIZE.
0081                             ;    (START AT 9K AND TRY 1K INCREMENTS TILL END)
0081                             ; SETUP POINTERS FOR STACK, DATA, AND PROGRAM
0081                             ; INIT SIO BOARD
0081                             ; 
0081   01 00 04     INIT1:    LXI   B,1024   ;1K INCR
0084   7C           INIT2:    MOV   A,H   ; check if we've reached A0
0085   FE A0                  CPI   0xA0   
0087   F2 97 00               JP   INIT3   ; if yes, then exit loop with HL=a000
008A   7E                     MOV   A,M   ;GET A BYTE FROM MEMORY
008B   2F                     CMA      ;COMPLEMENT
008C   77                     MOV   M,A   ;REPLACE
008D   BE                     CMP   M   ;TEST IF RAM/ROM/END
008E   C2 97 00               JNZ   INIT3   ;BRIF OUT OF RAM
0091   2F                     CMA      ;RE-COMPLEMENT
0092   77                     MOV   M,A   ;PUT ORIG BACK
0093   09                     DAD   B   ;POINT NEXT BLOCK
0094   D2 84 00               JNC   INIT2   ;LOOP
0097                             ; 
0097   F9           INIT3:    SPHL      ;SET STACK POINTER TO END OF MEMORY
0098   01 00 FF               LXI   B,-256   ;ALLOW 256 BYTES FOR STACK
009B   09                     DAD   B   ;ADD TO ADDRESS
009C   22 91 26               SHLD   DATAB   ;SAVE ADDR OF START OF DATA
009F   AF                     XRA   A   ;GET A ZERO IN A
00A0   F5                     PUSH   PSW   ;SET STACK 1 LEVEL DEEP WITHOUT A GOSUB
00A1   21 00 00               LXI   H,0   ;CLEAR H,L
00A4   39                     DAD   SP   ;SP TO H,L
00A5   22 8B 26               SHLD   STACK   ;SAVE BEG OF STACK
00A8   CD 49 01               CALL   IRAM   ;INIT RAM
00AB   11 79 1D               LXI   D,NRNDX   ;POINT TO RANDOM # SERIES
00AE   06 08                  MVI   B,8   ;LOAD COUNT
00B0   CD 53 1C               CALL   COPYD   ;COPY TO TRND<X> IN RAM TABLE
00B3   36 02                  MVI   M,2   ;SET RANDOM SWITCH
00B5   21 86 1D               LXI   H,VERS   ;POINT VERSION MESSAGE
00B8   CD C0 19     RDYM:     CALL   TERMM   ;WRITE IT
00BB                             ; 
00BB                RDY:      EQU   $   
00BB                             ; 
00BB                             ; PRINT "READY"
00BB                             ; 
00BB   21 3A 1E               LXI   H,READY   ;POINT READY MSG
00BE   CD C0 19               CALL   TERMM   ;GO PRINT IT
00C1                             ; 
00C1                GETCM:    EQU   $   
00C1                             ; 
00C1                             ; 
00C1                             ; COMMAND INPUT ROUTINE
00C1                             ; 
00C1                             ; READ A LINE FROM THE TTY
00C1                             ; IF STARTS WITH NUMERIC CH, ASSUME IT'S A BASIC STATEMENT
00C1                             ; IF NOT, IT IS EITHER AN IMMEDIATE STATMENT, OR A COMMAND
00C1                             ; 
00C1   3E 3A                  MVI   A,":"   ;PROMPT & ON SET FOR SW
00C3   32 76 24               STA   EDSW   ;SET MODE=EDIT
00C6   2A 8B 26               LHLD   STACK   ;GET STACK ADDRESS
00C9   F9                     SPHL      ;SET REG SP
00CA   CD FC 18               CALL   TERMI   ;GET A LINE
00CD   CD BB 1A               CALL   PACK   ;GO PACK THE NUMBER INTO B,C
00D0   78                     MOV   A,B   ;GET HI BYTE OF LINE NUMBER
00D1   B1                     ORA   C   ;PLUS LOW BYTE
00D2   CA 5C 01               JZ   EXEC   ;BRIF EXEC STATEMENT
00D5   C5                     PUSH   B   ;SAVE LINE NUMBER
00D6   11 7D 24               LXI   D,IMMED+1   ;POINT SAVE AREA
00D9   EB                     XCHG      ;FLIP/FLOP
00DA   70                     MOV   M,B   ;PUT LO LINE
00DB   23                     INX   H   ;POINT NEXT
00DC   71                     MOV   M,C   ;PUT LO LINE
00DD   23                     INX   H   ;POINT NEXT
00DE   06 03                  MVI   B,3   ;INIT COUNT
00E0   1A           EDIT1:    LDAX   D   ;GET A BYTE
00E1   77                     MOV   M,A   ;PUT IT DOWN
00E2   04                     INR   B   ;COUNT IT
00E3   23                     INX   H   ;POINT NEXT
00E4   13                     INX   D   ;DITTO
00E5   B7                     ORA   A   ;TEST BYTE JUST MOVED
00E6   C2 E0 00               JNZ   EDIT1   ;LOOP
00E9   78                     MOV   A,B   ;GET COUNT
00EA   32 7C 24               STA   IMMED   ;STORE THE COUNT
00ED   C1                     POP   B   ;GET LINE NUM
00EE   CD 89 1F               CALL   LOCAT   ;GO FIND REQUESTED LINE NUMBER
00F1   E5                     PUSH   H   ;SAVE H,L
00F2   DA 0C 01               JC   EDIT5   ;BRIF IF LINE NOT FOUND
00F5   54           EDIT2:    MOV   D,H   ;COPY ADDR
00F6   5D                     MOV   E,L   ;TO D,E
00F7   06 00                  MVI   B,0   ;GET A ZERO
00F9   4E                     MOV   C,M   ;GET LEN
00FA   09                     DAD   B   ;POINT NEXT STMT
00FB   7E           EDIT3:    MOV   A,M   ;GET LEN NEXT STMT
00FC   B7                     ORA   A   ;TEST IT
00FD   CA 07 01               JZ   EDIT8   ;BRIF END
0100   47                     MOV   B,A   ;SET LENGTH
0101   CD 5E 1C               CALL   COPYH   ;ELSE MOVE LINE
0104   C3 FB 00               JMP   EDIT3   ;LOOP
0107   EB           EDIT8:    XCHG      ;PUT NEW ADDR TO H,L
0108   77                     MOV   M,A   ;MARK END
0109   22 93 26               SHLD   PROGE   ;AND UPDATE ADDRESS
010C   3A 7C 24     EDIT5:    LDA   IMMED   ;GET LEN OF INSERT
010F   FE 04                  CPI   4   ;TEST IF DELETE
0111   CA C1 00               JZ   GETCM   ;BRIF IS
0114   4F                     MOV   C,A   ;SET LO LEN
0115   06 00                  MVI   B,0   ;ZERO HI LEN
0117   2A 93 26               LHLD   PROGE   ;GET END OF PROG
011A   54                     MOV   D,H   ;COPY TO
011B   5D                     MOV   E,L   ;D,E
011C   09                     DAD   B   ;DISP LEN OF INSERT
011D   22 93 26               SHLD   PROGE   ;UPDATE END POINT
0120   C1                     POP   B   ;GET ADDR
0121   1A           EDIT6:    LDAX   D   ;GET A BYTE
0122   77                     MOV   M,A   ;COPY IT
0123   1B                     DCX   D   ;POINT PRIOR
0124   2B                     DCX   H   ;DITTO
0125   7A                     MOV   A,D   ;GET HI ADDR
0126   B8                     CMP   B   ;COMPARE
0127   CA 2D 01               JZ   EDIT7   ;BRIF HI EQUAL
012A   D2 21 01               JNC   EDIT6   ;BRIF NOT LESS
012D   7B           EDIT7:    MOV   A,E   ;GET LO ADDR
012E   B9                     CMP   C   ;COMPARE
012F   D2 35 01               JNC   ED7A   ;MUST TEST FOR 00 BOUNDARY
0132   C3 3E 01               JMP   ED7B   ;GO AROUND BOUNDARY TEST CODE
0135   2F           ED7A:     CMA      ;COMPLIMENT LOW LINE NUMBER
0136   B9                     CMP   C   ;AND COMPARE TO START
0137   C2 21 01               JNZ   EDIT6   ;BRIF NOT =
013A   B7                     ORA   A   ;NOT TEST FOR 00
013B   C2 21 01               JNZ   EDIT6   ;THIS IS USUAL CASE
013E   13           ED7B:     INX   D   ;POINT FORWARD
013F   21 7C 24               LXI   H,IMMED   ;POINT INSERT
0142   46                     MOV   B,M   ;GET LENGTH
0143   CD 5E 1C               CALL   COPYH   ;GO MOVE IT
0146   C3 C1 00               JMP   GETCM   ;GO GET ANOTHER COMMAND
0149                             ; 
0149                             ; IRAM          INITIALIZE RAM
0149                             ;       ZEROES RAM FROM BZERO TO EZERO
0149                             ;       INITS RANDOM # CONSTANTS
0149                             ;       RETURNS H=PTR TO TRND
0149                             ; 
0149   21 00 24     IRAM:     LXI   H,BZERO   ;CLEAR BZERO->EZERO
014C   06 77                  MVI   B,EZERO-BZERO   
014E   CD 64 1C               CALL   ZEROM   
0151   11 79 1D               LXI   D,NRNDX   ;MOVE RANDOM # SERIES TO RNDX
0154   21 77 26               LXI   H,RNDX   
0157   06 08                  MVI   B,8   ;COUNT
0159   C3 53 1C               JMP   COPYD   ;MOVE IT & RETURN
015C                             ;PAGE
015C                EXEC:     EQU   $   
015C                             ; 
015C                             ; 
015C                             ; DECODE COMMAND IN IOBUFF
015C                             ; EXECUTE IF POSSIBLE
015C                             ; THEN GOTO GET NEXT COMMAND
015C                             ; 
015C                             ; 
015C   32 74 26               STA   MULTI   ;RESET MULTI SW
015F   32 88 26               STA   FNMOD   ;RESET FN TYPE
0162   3C                     INR   A   ;GET A ONE
0163   32 75 24               STA   RUNSW   ;SET IMMEDIATE MODE
0166   21 CF 24               LXI   H,IOBUF+1   ;POINT SMT
0169   11 7C 24               LXI   D,IMMED   ;POINT NEW AREA
016C   7E           EXEC1:    MOV   A,M   ;GET A BYTE
016D   12                     STAX   D   ;PUT TO (D,L)
016E   13                     INX   D   ;POINT NEXT
016F   23                     INX   H   ;DITTO
0170   B7                     ORA   A   ;TEST BYTE
0171   C2 6C 01               JNZ   EXEC1   ;CONTINUE
0174   21 00 1E               LXI   H,NULLI   ;POINT NO LINE NUM
0177   22 89 26               SHLD   LINE   ;SAVE ADDR
017A   21 7C 24               LXI   H,IMMED   ;POINT START OF CMMD
017D   C3 2F 02               JMP   RUN3   ;GO INTO RUN PROCESSOR
0180                             ; 
0180                NEW:      EQU   $   
0180                             ; 
0180                             ; NEW COMMAND
0180                             ; "NEW"==>CLEAR PROGRAM AND DATA
0180                             ; "NEW*"==>CLEAR PROGRAM ONLY
0180                             ; 
0180   E5                     PUSH   H   ;SAE PTR
0181   21 C1 00               LXI   H,GETCM   ;MAKE SUBROUTINE
0184   E3                     XTHL      ;RESTORE H
0185   CF                     RST   1   ;GET 1ST NON-BLANK CHAR AFTER "NEW"
0186   DE 2A                  SBI   "*"   ;TEST
0188   CA 90 01               JZ   NEW1   ;BRIF PROGRAM CLEAR ONLY
018B   AF           NEW0:     XRA   A   ;GET A ZERO
018C   2A 91 26               LHLD   DATAB   ;POINT DATA AREA
018F   77                     MOV   M,A   ;CLEAR IT
0190   21 96 26     NEW1:     LXI   H,BEGPR   ;POINT START
0193   22 93 26               SHLD   PROGE   ;RESET PROGRAM END
0196   77                     MOV   M,A   ;CLEAR IT
0197   C9                     RET      
0198                             ; 
0198                FREE:     EQU   $   
0198                             ; 
0198                             ; FREE COMMAND
0198                             ; COMPUTE AMOUNT OF AVAILABLE STORAGE (EXCLUDING DATA AREA)
0198                             ; 
0198   2A 91 26               LHLD   DATAB   ;GET DATA BEG ADDRESS
019B   EB                     XCHG      ;PUT IN D,E
019C   2A 93 26               LHLD   PROGE   ;GET PROGRAM END ADDRESS
019F   7B                     MOV   A,E   ;LO ADDR TO REG A
01A0   95                     SUB   L   ;SUBTRACT
01A1   5F                     MOV   E,A   ;SAVE IT
01A2   7A                     MOV   A,D   ;HI ADDR TO REG A
01A3   9C                     SBB   H   ;SUBTRACT
01A4   57                     MOV   D,A   ;SAVE IT
01A5   CD 8F 1C               CALL   BINFL   ;GO FLOAT D,E
01A8   21 CE 24               LXI   H,IOBUF   ;POINT BUFFER
01AB   CD E8 14               CALL   FOUT   ;GO CONVERT TO OUTPUT
01AE   36 00                  MVI   M,0   ;MARK END
01B0   CD B8 19               CALL   TERMO   ;GO WRITE IT
01B3   C3 C1 00               JMP   GETCM   ;CONTINUE
01B6                             ; 
01B6                TAPE:     EQU   $   
01B6                             ; 
01B6                             ; TAPE COMMAND. DON'T ECHO INPUT. CONTINUE UNTIL KEY
01B6                             ; COMMAND.
01B6                             ; 
01B6   3E 01                  MVI   A,1   ;SET TAPE INPUT SWITCH
01B8   32 71 24               STA   TAPES   ;STORE IT
01BB   3E 11                  MVI   A,11H   ;GET DC1 (=READER ON)
01BD   CD 4A 19               CALL   TESTO   ;WRITE IT
01C0   C3 C1 00               JMP   GETCM   ;GO PROCESS INPUT
01C3                             ; 
01C3                ENDIT:    EQU   $   
01C3                             ; 
01C3                             ; END COMMAND. IF TAPE PUNCH SWITCH IS ON, PUNCH "KEY" THEN
01C3                             ; CONTINUE
01C3                             ; 
01C3   3A 71 24               LDA   TAPES   ;GET PAPER TAPE SWITCH
01C6   FE 02                  CPI   2   ;TEST FOR SAVE
01C8   C2 BB 00               JNZ   RDY   ;BRIF NOT
01CB   21 8D 1E               LXI   H,KEYL   ;POINT "KEY"
01CE   CD C0 19               CALL   TERMM   ;WRITE IT
01D1   CD DE 01               CALL   HDRTL   ;GO PUT TRAILER
01D4                             ; 
01D4                             ; KEY COMMAND. RESET TAPE SWITCH. TURN READER OFF
01D4                             ; 
01D4   AF           KEY:      XRA   A   ;RESET TAPE SWITCH
01D5   32 71 24               STA   TAPES   
01D8   21 70 1D               LXI   H,PCHOF   ;POINT READER/PUNCH OFF
01DB   C3 B8 00               JMP   RDYM   ;PRINT POFF+READY MESSAGE
01DE                             ; 
01DE                HDRTL:    EQU   $   
01DE                             ; 
01DE                             ; PUNCH HEADER OR TRAILER ON PAPER TAPE.
01DE                             ; 
01DE   06 19                  MVI   B,25   ;LOAD COUNT
01E0   3E 08        HDR1:     MVI   A,RUBOUT   ;LOAD RUBOUT 0xff
01E2   CD 4A 19               CALL   TESTO   ;WRITE IT
01E5   05                     DCR   B   ;DECREMENT COUNT
01E6   AF                     XRA   A   ;ZERO A
01E7   B8                     CMP   B   ;TEST COUNT
01E8   C8                     RZ      ;RETURN ON ZERO
01E9   C3 E0 01               JMP   HDR1   ;CONTINUE
01EC                             ;PAGE
01EC                             ; 
01EC                             ; RUN PROCESSOR, GET NEXT STATMENT, AND EXECUTE IT
01EC                             ; IF IN IMMEDIATE MODE, THEN RETURN TO GETCMMD
01EC                             ; 
01EC   AF           RUNCM:    XRA   A   ;PUT A ZERO TO A
01ED   2A 91 26               LHLD   DATAB   ;GET ADDRESS OF DATA POOL
01F0   77                     MOV   M,A   ;INITIALIZE TO 0
01F1                XEQ:      EQU   $   ;START FOR EXECUTION WITH OLD DATA
01F1   CD 49 01               CALL   IRAM   ;INITALIZE START OF RAM
01F4   21 95 26               LXI   H,BEGPR-1   ;POINT 1 PRIOR TO BEGIN
01F7   22 8F 26               SHLD   DATAP   ;RESTORE DATA STMT POINTER
01FA   36 00                  MVI   M,0   ;RESET DATA STMT POINTER
01FC   23                     INX   H   ;POINT TO START
01FD   22 70 26               SHLD   STMT   ;SAVE IT
0200   C3 1D 02               JMP   RUN2   ;GO PROCESS IT
0203                             ; 
0203                             ; STATEMENTS RETURN HERE TO CONTINUE PROCESSING
0203   21 74 26     RUN:      LXI   H,MULTI   ;POINT MULTIPLE SWITCH
0206   7E                     MOV   A,M   ;GET SW
0207   B7                     ORA   A   ;TEST IT
0208   CA 13 02               JZ   RUN1   ;BRIF NOT ON
020B   36 00                  MVI   M,0   ;ELSE, RESET IT
020D   2A 72 26               LHLD   ENDLI   ;GET ADDRESS
0210   C3 2F 02               JMP   RUN3   ;GO PROCESS REMAIN
0213   2A 70 26     RUN1:     LHLD   STMT   ;ELSE, GET ADDR OF PREV STMT
0216   5E                     MOV   E,M   ;GET LEN CODE
0217   16 00                  MVI   D,0   ;CLEAR HIGH BYTE OF ADDR
0219   19                     DAD   D   ;INCR STMT POINTER
021A   22 70 26               SHLD   STMT   ;SAVE IT
021D   3A 75 24     RUN2:     LDA   RUNSW   ;GET RUN TYPE
0220   B7                     ORA   A   ;TEST IT
0221   C2 C1 00               JNZ   GETCM   ;BRIF IMMEDIATE MODE
0224   7E                     MOV   A,M   ;GET LEN CODE
0225   B7                     ORA   A   ;TEST IF END
0226   CA C3 01               JZ   ENDIT   ;BRIF IS
0229   23                     INX   H   ;POINT LINE NUMBER
022A   22 89 26               SHLD   LINE   ;SAVE ADDR
022D   23                     INX   H   ;POINT 2ND BYTE
022E   23                     INX   H   ;POINT 1ST PGM BYTE
022F                             ; 
022F                             ; ENTER HERE TO DO IMMEDIATE COMMAND
022F   CF           RUN3:     RST   1   ;SKIP BLANKS
0230   22 52 26     RUN4:     SHLD   ADDR1   ;SAVE ADDR
0233   CD 3D 1A               CALL   TSTCC   ;GO SEE IF CONTROL-C OR O
0236   11 60 1E               LXI   D,JMPTB   ;POINT TO TABLE
0239   CD B1 1F               CALL   SEEK1   ;GO SEARCH COMMAND TABLE
023C   CA 47 02               JZ   RUN7   ;BRIF COMMAND NOT FOUND
023F   E5                     PUSH   H   ;SAVE H,L
0240   1A                     LDAX   D   ;LOAD LOW BYTE
0241   6F                     MOV   L,A   ;LOW BYTE TO L
0242   13                     INX   D   ;POINT NEXT
0243   1A                     LDAX   D   ;LOAD HIGH BYTE
0244   67                     MOV   H,A   ;HIGH BYTE TO H
0245   E3                     XTHL      ;COMMAND ADDRESS TO STACK
0246   C9                     RET      ;JUMP TO ROUTINE
0247   2A 52 26     RUN7:     LHLD   ADDR1   ;RESTORE H,L POINTER
024A   C3 E9 05               JMP   LET   ;ASSUME IT'S LET STMT
024D                             ;PAGE
024D                             ; 
024D                             ; SAVE COMMAND. TURN THE PUNCH ON THEN LIST PROGRAM
024D                             ; 
024D   3E 02        SAVE:     MVI   A,2   ;SET PUNCH MODE
024F   32 71 24               STA   TAPES   
0252   3E 12                  MVI   A,12H   ;GET DC2 (=PUNCH ON)
0254   CD 4A 19               CALL   TESTO   ;WRITE IT
0257   CD DE 01               CALL   HDRTL   ;GP PUT HEADER
025A                             ; 
025A                LIST:     EQU   $   
025A                             ; 
025A                             ; 
025A                             ; LIST PROCESSOR
025A                             ; DUMP THE SOURCE PROGRAM TO TTY OR PAPER TAPE
025A                             ; 
025A                             ; 
025A   CF                     RST   1   ;SKIP TO NON BLANK
025B   11 00 00               LXI   D,0   ;GET A ZERO IN D
025E   EB                     XCHG      ;FLIP TO H,L
025F   22 4B 26               SHLD   LINEL   ;SAVE IT
0262   21 99 99               LXI   H,9999H   ;GET HIGH NUMBER IN H,L
0265   22 4D 26               SHLD   LINEH   ;SAVE IT
0268   EB                     XCHG      ;FLIP BACK
0269   B7                     ORA   A   ;TEST IF EOL
026A   CA 8A 02               JZ   LIST1   ;BRIF IT IS
026D   CD BB 1A               CALL   PACK   ;GO PACK THE NUMBER, IF ANY
0270   50                     MOV   D,B   ;COPY NUMBER TO D,L
0271   59                     MOV   E,C   ;SAME
0272   EB                     XCHG      ;FLIP TO H,L
0273   22 4B 26               SHLD   LINEL   ;SAVE IT
0276   22 4D 26               SHLD   LINEH   ;SAME
0279   EB                     XCHG      ;RESTORE H,L
027A   CF                     RST   1   ;SKIP TO NON BLANK
027B   FE 2C                  CPI   ","   ;TEST IF COMMA
027D   C2 8A 02               JNZ   LIST1   ;BRIF NOT
0280   23                     INX   H   ;POINT NEXT
0281   CF                     RST   1   ;SKIP TO NON-BLANK
0282   CD BB 1A               CALL   PACK   ;ELSE, GO GET THE NUMBER
0285   60                     MOV   H,B   ;COPY TO
0286   69                     MOV   L,C   ;D,L
0287   22 4D 26               SHLD   LINEH   ;SAVE IT
028A   21 96 26     LIST1:    LXI   H,BEGPR   ;POINT BEGINNING OF PROGRAM
028D   CD 3D 1A     LIST2:    CALL   TSTCC   ;GO SEE IF CONTROL-C OR CONTROL-O
0290   7E                     MOV   A,M   ;GET LEN CODE
0291   B7                     ORA   A   ;TEST IF END OF PROGRAM
0292   CA C3 01               JZ   ENDIT   ;BRIF END OF PGM
0295   D6 03                  SUI   3   ;SUBTRACT THREE
0297   47                     MOV   B,A   ;SAVE LEN
0298   23                     INX   H   ;POINT HIGH BYTE OF LINE#
0299   EB                     XCHG      ;FLIP H,L TO D,E
029A   2A 4B 26               LHLD   LINEL   ;GET LOW LINE TO TEST
029D   EB                     XCHG      ;RESTORE H,L
029E   7E                     MOV   A,M   ;GET LOW BYTE OF LINE NUMBER
029F   BA                     CMP   D   ;COMP WITH LINEL
02A0   DA DD 02               JC   LIST8   ;BRIF LESS
02A3   C2 AD 02               JNZ   LIST4   ;BRIF NOT EQUAL
02A6   23                     INX   H   ;POINT NEXT
02A7   7E                     MOV   A,M   ;GET NEXT BYTE OF LINE#
02A8   2B                     DCX   H   ;POINT BACK
02A9   BB                     CMP   E   ;COMP LOW BYTES
02AA   DA DD 02               JC   LIST8   ;BRIF LESS
02AD   EB           LIST4:    XCHG      ;SAVE H,L IN D,E
02AE   2A 4D 26               LHLD   LINEH   ;GET HIGH LINE FOR TEST
02B1   EB                     XCHG      ;RESTORE H,L
02B2   7E                     MOV   A,M   ;GET LINE BYTE
02B3   BA                     CMP   D   ;COMPARE HIGH BYTES
02B4   CA BD 02               JZ   LIST5   ;BRIF EQUAL
02B7   D2 C3 01               JNC   ENDIT   ;BRIF HIGHER
02BA   C3 C7 02               JMP   LIST6   ;GO AROUND
02BD   23           LIST5:    INX   H   ;POINT NEXT
02BE   7E                     MOV   A,M   ;GET NEXT BYTE
02BF   2B                     DCX   H   ;POINT BACK
02C0   BB                     CMP   E   ;COMPARE LOW BYTES
02C1   CA C7 02               JZ   LIST6   ;BRIF EQUAL
02C4   D2 C3 01               JNC   ENDIT   ;BRIF HIGHER
02C7   11 CE 24     LIST6:    LXI   D,IOBUF   ;POINT BUFFER AREA
02CA   CD 0C 1A               CALL   LINEO   ;CONVERT LINE NUMBER
02CD   7E           LIST7:    MOV   A,M   ;GET A BYTE
02CE   12                     STAX   D   ;PUT IT TO BUFFER
02CF   13                     INX   D   ;POINT NEXT BUFF
02D0   23                     INX   H   ;POINT NEXT PROG
02D1   05                     DCR   B   ;DECR CTR
02D2   C2 CD 02               JNZ   LIST7   ;LOOP
02D5   E5                     PUSH   H   ;SAVE HL ADDR
02D6   CD B8 19               CALL   TERMO   ;GO TYPE IT
02D9   E1                     POP   H   ;RETRIEVE H ADDR
02DA   C3 8D 02               JMP   LIST2   ;CONTINUE
02DD   58           LIST8:    MOV   E,B   ;PUT LEN  IN E
02DE   16 00                  MVI   D,0   ;CLEAR D
02E0   19                     DAD   D   ;POINT NEXT STMT
02E1   23                     INX   H   ;POINT NEXT
02E2   23                     INX   H   ;POINT LEN CODE
02E3   C3 8D 02               JMP   LIST2   ;GO LIST IT
02E6                             ; 
02E6                             ; 
02E6                CONTI:    EQU   $   
02E6                             ; 
02E6                             ; CONTINUE EXECUTION AT STATEMENT FOLLOWING STOP OR AT
02E6                             ; STATEMENT THAT WAS INTERRUPTED WHEN CONTROL-C WAS TYPED
02E6                             ; 
02E6                             ; 
02E6   21 77 24               LXI   H,LINEN   ;POINT LINE NUMBER OF LAST STOP/ERROR/
02E9   7E                     MOV   A,M   ;GET 1ST CHAR
02EA   B7                     ORA   A   ;TEST IF IMMED CMMD
02EB   CA E9 05               JZ   LET   ;BRIF IF IMMED CMMD
02EE                             ;PAGE
02EE                             ; 
02EE                             ; 
02EE                             ; STMT:  GOTO NNNN
02EE                             ; 
02EE                             ; 
02EE   AF           GOTO:     XRA   A   ;CLEAR REG A
02EF   32 76 24               STA   EDSW   ;RESET IMMED MODE (IF IT WAS SET)
02F2   32 75 24               STA   RUNSW   ;AND RUN TYPE
02F5   CD B3 1A               CALL   NOTEO   ;ERROR IF END-OF-LINE
02F8   CD BB 1A               CALL   PACK   ;GO GET LINE NUMBER IN B,C
02FB   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
02FE   CD 89 1F     GOTO2:    CALL   LOCAT   ;GO SEARCH FOR REQUESTED LINE #
0301   DA 09 1C               JC   ULERR   ;BRIF NOT FOUND
0304   22 70 26               SHLD   STMT   ;SAVE ADDR
0307   AF                     XRA   A   ;GET A ZERO
0308   32 74 26               STA   MULTI   ;TURN OFF MULTIPLE STMTS
030B   C3 1D 02               JMP   RUN2   ;GO PROCESS THE STATEMENT
030E                             ; 
030E                             ; 
030E                             ; STMT: RESTORE
030E                             ; 
030E   CD 9A 1A     RESTO:    CALL   EOL   ;ERROR IF NOT END-OF-LINE
0311   21 95 26               LXI   H,BEGPR-1   ;POINT 1 BEFORE START OF PROGRAM
0314   22 8F 26               SHLD   DATAP   ;FORCE NEXT DATA TO BE AT START
0317   C3 03 02               JMP   RUN   ;GO NEXT STMT
031A                             ; 
031A                             ; 
031A                             ; STMT:  RETURN
031A                             ; 
031A   CD 9A 1A     RETUR:    CALL   EOL   ;ERROR IF NOT END-OF-LINE
031D   F1                     POP   PSW   ;POP THE STACK
031E   FE FF                  CPI   0FFH   ;TEST IF GOSUB IN EFFECT
0320   C2 19 1C               JNZ   RTERR   ;BRIF ERROR
0323   E1                     POP   H   ;GET RETURNED STATMENT ADDRESS
0324   22 70 26               SHLD   STMT   ;RESTORE
0327   E1                     POP   H   ;GET ENDLINE VALUE
0328   22 72 26               SHLD   ENDLI   ;RESTORE
032B   F1                     POP   PSW   ;GET MULTI SW VALUE
032C   32 74 26               STA   MULTI   ;RESTORE
032F   C3 03 02               JMP   RUN   ;CONTINUE (AT STMT FOLLOWING GOSUB)
0332                             ; 
0332                             ; 
0332                             ; STMT:  GOSUB NNNN
0332                             ; 
0332   CD B3 1A     GOSUB:    CALL   NOTEO   ;ERROR IF END-OF-LINE
0335   CD BB 1A               CALL   PACK   ;GET LINE NUMBER
0338   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
033B   3A 74 26     GOSU1:    LDA   MULTI   ;GET SW SETTING
033E   F5                     PUSH   PSW   ;SAVE ON STACK
033F   2A 72 26               LHLD   ENDLI   ;GET ADDR OF END OF STMT
0342   E5                     PUSH   H   ;SAVE ONE STACK
0343   2A 70 26               LHLD   STMT   ;GET STATEMENT ADDRESS
0346   E5                     PUSH   H   ;SAVE RETURN ADDRESS IN STACK
0347   3E FF                  MVI   A,0FFH   ;MARK AS GOSUB
0349   F5                     PUSH   PSW   ;SAVE STATUS
034A   C3 FE 02               JMP   GOTO2   ;GO LOOKUP LINE AND BRANCH
034D                             ;PAGE
034D                             ; 
034D                PRINT:    EQU   $   
034D                             ; 
034D                             ; 
034D                             ; STMT: PRINT ....
034D                             ; 
034D                             ; 
034D   AF                     XRA   A   ;CLEAR REG A
034E   32 8D 26     PRIN4:    STA   PRSW   ;SET SW TO SAY CRLF AT END OF LINE
0351   11 CE 24               LXI   D,IOBUF   ;POINT BUFFER
0354   CF                     RST   1   ;SKIP TO NEXT FIELD
0355                             ; 
0355   CD AE 1A               CALL   TSTEL   ;TEST IF END OF STMT
0358   CA CB 03               JZ   PRINC   ;BRIF IT IS
035B   FE 2C                  CPI   ","   ;TEST IF COMMA
035D   CA A2 03               JZ   PRIN8   ;BRIF IT IS
0360   FE 3B                  CPI   ";"   ;TEST IF SEMI-COLON
0362   CA A5 03               JZ   PRIN9   ;BRIF IT IS
0365   D5                     PUSH   D   ;SAVE D,E
0366   E5                     PUSH   H   ;SAVE H,L
0367   11 9D 1D               LXI   D,TABLI   ;POINT LITERAL
036A   D7                     RST   2   ;GO SEE IF TAB(XX)
036B   CA AB 03               JZ   PRINA   ;BRIF IS
036E   E1                     POP   H   ;ELSE, RESTORE H,L
036F   CD 78 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
0372   D1                     POP   D   ;RESTORE D,E
0373   E5                     PUSH   H   ;SAVE H,L
0374   EB                     XCHG      ;FLIP/FLOP
0375   3A 8E 26               LDA   NS   ;GET TYPE OF RESULT
0378   FE E7                  CPI   0E7H   ;TEST IF STRING
037A   CA 8E 03               JZ   PRIN5   ;BRIF IS
037D   CD E8 14               CALL   FOUT   ;GO CONVERT OUTPUT
0380   23                     INX   H   ;POINT NEXT
0381   EB           PRIN7:    XCHG      ;FLIP/FLOP: END ADDR TO DE
0382   E1                     POP   H   ;RESTORE H,L
0383                             ;HERE AFTER SETTING UP VALUE TO PRINT IN BUFFER
0383   3E FE        PRIN2:    MVI   A,0FEH   ;SET END CODE=NO CRLF
0385   12                     STAX   D   ;PUT TO BUFFER
0386   E5                     PUSH   H   ;SAVE H,L
0387   CD B8 19               CALL   TERMO   ;GO PRINT BUFFER
038A   E1                     POP   H   ;RESTORE HL
038B   C3 4D 03               JMP   PRINT   ;REPEAT FOR NEXT FIELD
038E                             ; 
038E   11 20 25     PRIN5:    LXI   D,STRIN   ;POINT STRING
0391   1A                     LDAX   D   ;GET LEN
0392   B7                     ORA   A   ;TEST IT
0393   CA 81 03               JZ   PRIN7   ;BRIF NULL
0396   47                     MOV   B,A   ;SAVE LEN
0397   13           PRIN6:    INX   D   ;POINT NEXT
0398   1A                     LDAX   D   ;GET A BYTE
0399   77                     MOV   M,A   ;STORE IT
039A   23                     INX   H   ;POINT NEXT
039B   05                     DCR   B   ;DECR CTR
039C   C2 97 03               JNZ   PRIN6   ;LOOP
039F   C3 81 03               JMP   PRIN7   ;DIDDLE DE, HL AND CONTINUE
03A2                             ; 
03A2   CD E2 19     PRIN8:    CALL   TABST   ;GO POSITION NEXT TAB
03A5   23           PRIN9:    INX   H   ;PRINT NEXT
03A6   3E 01                  MVI   A,1   ;GET SETTTING FOR SW
03A8   C3 4E 03               JMP   PRIN4   ;GO STORE A IN PRSW & DO NEXT FIELD
03AB   D1           PRINA:    POP   D   ;GET RID OF STACK ENTRY
03AC   CD 78 0F               CALL   EXPR   ;GO EVALUATE
03AF   E5                     PUSH   H   ;SAVE H,L
03B0   CD 6C 1C               CALL   FBIN   ;CONVERT TO BINARY
03B3   F5                     PUSH   PSW   ;SAVE SPECIFIED COLUMN
03B4   21 76 26               LXI   H,COLUM   ;POINT CURRENT POSITION
03B7   96                     SUB   M   ;SUBTRACT (LEAVES NUMBER OF FILLS)
03B8   FC 5C 19               CM   CRLF   ;NEXT LINE IF ALREADY PAST
03BB   F1                     POP   PSW   ;RESTORE COL
03BC   96                     SUB   M   ;GET NUMBER FILLS
03BD   E1                     POP   H   
03BE   D1                     POP   D   
03BF   47                     MOV   B,A   ;SAVE COUNT
03C0   3E 20                  MVI   A," "   ;GET FILL
03C2   CA 83 03     PRINB:    JZ   PRIN2   ;BRIF COUNT ZERO
03C5   12                     STAX   D   ;PUT ONE SPACE
03C6   13                     INX   D   ;POINT NEXT
03C7   05                     DCR   B   ;DECR CTR
03C8   C3 C2 03               JMP   PRINB   ;LOOP
03CB                             ; 
03CB   CD 9A 1A     PRINC:    CALL   EOL   ;SAVE EOL POSITION
03CE                             ;HERE TO PRINT FINAL CR/LF (OR NOT) AND GO TO NEXT STATEMENT
03CE   3A 8D 26               LDA   PRSW   ;GET SWITCH
03D1   47                     MOV   B,A   ;SAVE ,; SWITCH
03D2   3A 73 24               LDA   OUTSW   ;GET CONTROL-O SWITCH
03D5   B7                     ORA   A   ;TEST IF ^O IN EFFECT
03D6   B0                     ORA   B   ;AND IF STATEMENT ENDED IN , OR ;
03D7   CC 5C 19               CZ   CRLF   ;CRLF IF NEITHER
03DA   C3 03 02               JMP   RUN   ;CONTINUE NEXT STATEMENT
03DD                             ;PAGE
03DD                             ; 
03DD                FOR:      EQU   $   
03DD                             ; 
03DD                             ; 
03DD                             ;  STMT:  FOR VAR = EXPR TO EXPR [STEP EXPR]
03DD                             ; 
03DD                             ; 
03DD                             ;  FIRST EVALUATE ARGUMENTS AND STORE POINTERS AND VALUES,
03DD                             ;  BUT DO NOT MAKE TABLE ENTRY YET
03DD   CD CF 1B               CALL   VAR   ;NEXT WORD MUST BE VARIABLE
03E0   EB                     XCHG      ;FLIP/FLOP
03E1   22 23 26               SHLD   INDX   ;SAVE VARIABLE NAME
03E4   EB                     XCHG      ;FLIP/FLOP AGAIN
03E5   FE 3D                  CPI   "="   ;TEST FOR EQUAL SIGN
03E7   C2 15 1C               JNZ   SNERR   ;BRIF NO EQUAL
03EA   23                     INX   H   ;POINT NEXT
03EB   CD 78 0F               CALL   EXPR   ;GO EVALUATE EXPR, IF ANY
03EE   EB                     XCHG      ;FLIP/FLOP AGAIN
03EF   2A 23 26               LHLD   INDX   ;GET INDEX NAME
03F2   EB                     XCHG      ;FLIP/FLOP
03F3   E5                     PUSH   H   ;SAVE H,L
03F4   CD 3A 1B               CALL   SEARC   ;GO LOCATE NAME
03F7   EB                     XCHG      ;PUT ADDR IN H,L
03F8   22 52 26               SHLD   ADDR1   ;SAVE ADDR
03FB   DF                     RST   3   ;GO STORE THE VALUE
03FC   E1                     POP   H   ;RESTORE POINTER TO STMT
03FD   11 E6 1E               LXI   D,TOLIT   ;GET LIT ADDR
0400   D7                     RST   2   ;GO COMPARE
0401   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
0404   CD 78 0F               CALL   EXPR   ;GO EVALUATE TO-EXPR
0407   E5                     PUSH   H   ;SAVE H,L
0408   21 27 26               LXI   H,TVAR1   ;POINT "TO" VALUE
040B   DF                     RST   3   ;SAVE IT
040C   21 FE 1D               LXI   H,ONE   ;POINT CONSTANT: 1
040F   EF                     RST   5   ;LOAD IT
0410   E1                     POP   H   ;GET H,L
0411   7E                     MOV   A,M   ;GET THE CHAR
0412   B7                     ORA   A   ;TEST FOR END OF STATEMENT
0413   CA 26 04               JZ   FOR2   ;BRIF NO STEP
0416   E5                     PUSH   H   ;RE-SAVE
0417   11 A1 1D               LXI   D,STEPL   ;TEST FOR LIT "STEP"
041A   D7                     RST   2   ;GO COMPARE
041B   CA 22 04               JZ   FOR1   ;BRIF STEP
041E   E1                     POP   H   ;RESTORE H,L
041F   C3 26 04               JMP   FOR2   ;GO NO STEP VALUE
0422   D1           FOR1:     POP   D   ;POP OFF THE STACK
0423   CD 78 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
0426   E5           FOR2:     PUSH   H   ;SAVE H,L TO END OF STATEMENT
0427   21 2B 26               LXI   H,TVAR2   ;POINT STEP VALUE
042A   DF                     RST   3   ;SAVE IT
042B   E1                     POP   H   ;RESTORE H,L
042C   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
042F                             ; DETERMINE WHETHER LOOP IS TO BE EXECUTED AT ALL
042F                             ; (IF VALUE > "TO" VALUE AND STEP POSITIVE,
042F                             ;    JUST SKIP TO NEXT, ETC)
042F   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0432   F5                     PUSH   PSW   ;SAVE A,STATUS
0433   21 27 26               LXI   H,TVAR1   ;GET END VALUE
0436   EF                     RST   5   ;LOAD IT
0437   F1                     POP   PSW   ;RESTORE STATUS
0438   F2 4A 04               JP   FOR4   ;BRIF FOR IS POSITIVE
043B   2A 52 26               LHLD   ADDR1   ;GET ADDRESS OF INDEX
043E   CD 04 17               CALL   FSUB   ;COMPARE THIS AGAINST END VALUE
0441   CA 56 04               JZ   FOR5   ;BRIF START = END
0444   FA 56 04               JM   FOR5   ;BRIF START > END
0447   C3 AA 04               JMP   FOR9   ;GO LOCATE MATCHING NEXT
044A   2A 52 26     FOR4:     LHLD   ADDR1   ;GET ADDRESS OF INDEX
044D   CD 04 17               CALL   FSUB   ;COMPARE
0450   CA 56 04               JZ   FOR5   ;BRIF START = END
0453   FA AA 04               JM   FOR9   ;BRIF START > END: SKIP TO "NEXT"
0456                             ; LOOP IS TO BE EXECUTED AT LEAST ONCE:
0456                             ; NEED AN ENTRY IN FOR-NEXT TABLE.
0456                             ; SEE IF THERE IS ALREADY ENTRY FOR THIS VARIABLE
0456                             ; (IE PROGRAM JUMPED OUT OF LOOP EARLIER)
0456   11 00 24     FOR5:     LXI   D,FORNE   ;POINT TABLE
0459   2A 23 26               LHLD   INDX   ;GET INDEX VARIABLE NAME
045C   EB                     XCHG      ;FLIP/FLOP
045D   7E                     MOV   A,M   ;GET COUNT OF ENTRIES NOW IN TABLE
045E   47                     MOV   B,A   ;STORE IT
045F   0E 01                  MVI   C,1   ;NEW CTR
0461   B7                     ORA   A   ;TEST IF ZERO
0462   23                     INX   H   ;POINT
0463   CA 79 04               JZ   FOR8   ;BRIF TABLE EMPTY
0466   7E           FOR6:     MOV   A,M   ;GET 1ST BYTE OF TABLE VARIABLE
0467   BA                     CMP   D   ;TEST IF EQUAL TO THIS FOR'S INDEX
0468   C2 72 04               JNZ   FOR7   ;BRIF NOT
046B   23                     INX   H   ;POINT NEXT
046C   7E                     MOV   A,M   ;GET NEXT BYTE
046D   2B                     DCX   H   ;POINT BACK
046E   BB                     CMP   E   ;TEST IF EQUAL
046F   CA 79 04               JZ   FOR8   ;BRIF EQUAL
0472   E7           FOR7:     RST   4   ;ADJUST H,L
0473   0E                     DB   14   
0474   0C                     INR   C   ;COUNT IT
0475   05                     DCR   B   ;DECR CTR
0476   C2 66 04               JNZ   FOR6   ;LOOP
0479                             ; ENTER THIS FOR IN TABLE (WHERE HL POINTS)
0479   79           FOR8:     MOV   A,C   ;GET UDPATE COUNT
047A   FE 09                  CPI   9   ;TEST IF TBL EXCEEDED
047C   D2 21 1C               JNC   NXERR   ;ERROR IF MORE THAN 8 OPEN FOR/NEXT
047F   32 00 24               STA   FORNE   ;PUT IN TABLE
0482   72                     MOV   M,D   ;HI BYTE INDEX VARIABLE NAME
0483   23                     INX   H   ;POINT NEXT
0484   73                     MOV   M,E   ;STORE LO BYTE
0485   23                     INX   H   ;POINT NEXT
0486   E5                     PUSH   H   ;SAVE H,L
0487   21 2B 26               LXI   H,TVAR2   ;POINT STEP VALUE
048A   EF                     RST   5   ;LOAD IT
048B   E1                     POP   H   ;RESTORE H,L
048C   DF                     RST   3   ;STORE IN STACK
048D   E5                     PUSH   H   ;SAVE H,L
048E   21 27 26               LXI   H,TVAR1   ;POINT "TO" VALUE
0491   EF                     RST   5   ;LOAD IT
0492   E1                     POP   H   ;RESTORE H,L
0493   DF                     RST   3   ;STORE IN STACK
0494   EB                     XCHG      ;FLIP/FLOP
0495   2A 72 26               LHLD   ENDLI   ;GET END ADDR
0498   2B                     DCX   H   ;POINT ONE PRIOR
0499   EB                     XCHG      ;FLIP BACK
049A   72                     MOV   M,D   ;STORE IT
049B   23                     INX   H   ;POINT NEXT
049C   73                     MOV   M,E   ;STORE IT
049D   23                     INX   H   ;POINT NEXT
049E   3A 71 26               LDA   STMT+1   ;GET HIGH STMT ADDR
04A1   77                     MOV   M,A   ;PUT IT
04A2   23                     INX   H   ;POINT NEXT
04A3   3A 70 26               LDA   STMT   ;GET LOW STMT ADDR
04A6   77                     MOV   M,A   ;PUT IT
04A7   C3 03 02               JMP   RUN   ;CONTINUE
04AA                             ; 
04AA                             ; IF HERE, THIS LOOP IS TO BE EXECUTED ZERO TIMES:
04AA                             ; SCAN THRU PROGRAM TO FIND MATCHING "NEXT".
04AA                             ; THIS CODE WILL FAIL IF USER'S PROGRAM IS TOO
04AA                             ; COMPLEX SINCE IT WON"T FOLLOW GOTO"S, IF'S, ETC.
04AA   2A 70 26     FOR9:     LHLD   STMT   ;GET ADDRESS OF STATMENT
04AD   5E                     MOV   E,M   ;GET LENGTH CODE
04AE   16 00                  MVI   D,0   ;INIT INCREMENT
04B0   19                     DAD   D   ;COMPUTE ADDR OF NEXT STATEMENT
04B1   7E                     MOV   A,M   ;GET NEW LEN CODE
04B2   B7                     ORA   A   ;SEE IF END OF PGM
04B3   CA 21 1C               JZ   NXERR   ;BRIF IT IS
04B6   22 70 26               SHLD   STMT   ;SAVE ADDRESS
04B9   E7                     RST   4   ;ADJUST H,L
04BA   03                     DB   3   
04BB   CF                     RST   1   ;SKIP SPACES
04BC   11 BC 1E               LXI   D,NEXTL   ;POINT "NEXT"
04BF   D7                     RST   2   ;SEE IF IT IS A NEXT STMT
04C0   C2 AA 04               JNZ   FOR9   ;LOOP IF NOT
04C3   CF                     RST   1   ;SKIP SPACES
04C4   3A 24 26               LDA   INDX+1   ;GET FIRST CHAR
04C7   BE                     CMP   M   ;COMPARE
04C8   C2 AA 04               JNZ   FOR9   ;BRIF NOT MATCH NEXT
04CB   3A 23 26               LDA   INDX   ;GET 2ND CHAR
04CE   23                     INX   H   ;DITTO
04CF   FE 20                  CPI   " "   ;SEE IF SINGLE CHAR
04D1   CA D8 04               JZ   FORA   ;BRIF IT IS
04D4   BE                     CMP   M   ;COMPARE THE TWO
04D5   C2 AA 04               JNZ   FOR9   ;BRIF NOT EQUAL
04D8   CF           FORA:     RST   1   ;SKIP TO END (HOPEFULLY)
04D9   7E                     MOV   A,M   ;GET THE NON BLANK
04DA   B7                     ORA   A   ;SEE IF END
04DB   C2 AA 04               JNZ   FOR9   ;BRIF END
04DE   C3 03 02               JMP   RUN   ;ELSE, GO NEXT STMT
04E1                             ;PAGE
04E1                             ; 
04E1                IFSTM:    EQU   $   
04E1                             ; 
04E1                             ; 
04E1                             ; STMT: IF EXPR RELATION EXPR THEN STMT#
04E1                             ; 
04E1                             ; 
04E1   CD 78 0F               CALL   EXPR   ;GO EVALUATE LEFT EXPR
04E4   E5                     PUSH   H   ;SAVE H,L
04E5   3A 8E 26               LDA   NS   ;GET TYPE CODE
04E8   32 26 26               STA   IFTYP   ;SAVE IT
04EB   FE E7                  CPI   0E7H   ;TEST IF STRING
04ED   C2 FF 04               JNZ   IF1   ;BRIF NOT
04F0   21 CE 24               LXI   H,IOBUF   ;POINT BUFFER
04F3   11 20 25               LXI   D,STRIN   ;POINT RESULT
04F6   1A                     LDAX   D   ;GET LEN
04F7   3C                     INR   A   ;PLUS ONE
04F8   47                     MOV   B,A   ;SAVE IT
04F9   CD 53 1C               CALL   COPYD   ;GO MOVE IT
04FC   C3 03 05               JMP   IF2   ;GO AROUND
04FF   21 27 26     IF1:      LXI   H,TVAR1   ;GET ADDR OF TEMP STORAGE
0502   DF                     RST   3   ;SAVE IT
0503   E1           IF2:      POP   H   ;RESTORE H,L
0504   AF                     XRA   A   ;CLEAR A
0505   4F                     MOV   C,A   ;SAVE IN REG C
0506   47                     MOV   B,A   ;INIT REG
0507   7E           IF3:      MOV   A,M   ;GET OPERATOR
0508   04                     INR   B   ;COUNT
0509   FE 3D                  CPI   "="   ;TEST FOR EQUAL
050B   C2 10 05               JNZ   IF4   ;BRIF IT IS
050E   0C                     INR   C   ;ADD 1 TO C
050F   23                     INX   H   ;POINT NEXT
0510   FE 3E        IF4:      CPI   ">"   ;TEST FOR GREATER THAN
0512   C2 18 05               JNZ   IF5   ;BRIF IT IS
0515   0C                     INR   C   ;ADD TWO
0516   0C                     INR   C   ;TO REL CODE
0517   23                     INX   H   ;POINT NEXT
0518   FE 3C        IF5:      CPI   "<"   ;TEST FOR LESS THAN
051A   C2 22 05               JNZ   IF6   ;BRIF IT IS
051D   79                     MOV   A,C   ;GET REL CODE
051E   C6 04                  ADI   4   ;PLUS FOUR
0520   4F                     MOV   C,A   ;PUT BACK
0521   23                     INX   H   ;POINT NEXT
0522   79           IF6:      MOV   A,C   ;GET REL CODE
0523   B7                     ORA   A   ;TEST IT
0524   C5                     PUSH   B   ;SAVE B,C
0525   CA 15 1C               JZ   SNERR   ;BRIF SOME ERROR
0528   C1                     POP   B   ;RESTORE B,C
0529   32 25 26               STA   REL   ;SAVE CODE
052C   78                     MOV   A,B   ;GET COUNT
052D   FE 02                  CPI   2   ;TEST FOR TWO
052F   C2 07 05               JNZ   IF3   ;SEE IF MULTIPLE RELATION
0532   CD 78 0F               CALL   EXPR   ;GO EVALUATE RIGHT SIDE
0535   22 52 26               SHLD   ADDR1   ;SAVE LOCATION OF THEN (IF ANY)
0538   3A 8E 26               LDA   NS   ;GET TYPE CODE
053B   21 26 26               LXI   H,IFTYP   ;POINT LEFT TYPE
053E   BE                     CMP   M   ;COMPARE
053F   C2 15 1C               JNZ   SNERR   ;BRIF MIXED
0542   FE E7                  CPI   0E7H   ;TEST IF STRING
0544   CA A0 05               JZ   IFF   ;BRIF IS
0547   21 27 26               LXI   H,TVAR1   ;POINT LEFT
054A   CD 04 17               CALL   FSUB   ;SUBTRACT LEFT FROM RIGHT
054D   3A 25 26               LDA   REL   ;GET RELATION
0550   1F                     RAR      ;TEST BIT D0
0551   D2 5A 05               JNC   IF8   ;BRIF NO EQUAL TEST
0554   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0557   CA 79 05               JZ   TRUE   ;BRIF LEFT=RIGHT
055A   3A 25 26     IF8:      LDA   REL   ;LOAD RELATION
055D   E6 02                  ANI   02H   ;MASK IT
055F   CA 68 05               JZ   IF9   ;BRIF NO >
0562   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0565   FA 79 05               JM   TRUE   ;BRIF GT
0568   3A 25 26     IF9:      LDA   REL   ;LOAD RELATION
056B   E6 04                  ANI   04H   ;MASK IT
056D   CA 03 02               JZ   FALSE   ;BRIF NO <
0570   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0573   FA 03 02               JM   FALSE   ;BRIF GT
0576   CA 03 02               JZ   FALSE   ;BRIF ZERO (NOT EQUAL)
0579   2A 52 26     TRUE:     LHLD   ADDR1   ;GET POINTER TO STATEMENT
057C   11 E4 1E               LXI   D,GOTOL   ;POINT "GO TO"
057F   D7                     RST   2   ;GO COMPARE
0580   CA EE 02               JZ   GOTO   ;BRIF IF ... GOTO NN
0583   2A 52 26               LHLD   ADDR1   ;GET POINTER TO STATEMENT
0586   11 C3 1E               LXI   D,GOSBL   ;POINT LITERAL
0589   D7                     RST   2   ;GO COMAPRE
058A   CA 32 03               JZ   GOSUB   ;BRIF IF ... GOSUB NN
058D   2A 52 26               LHLD   ADDR1   ;GET POINTER TO STATEMENT
0590   11 A6 1D               LXI   D,THENL   ;GET ADDR "THEN"
0593   D7                     RST   2   ;GO COMPARE
0594   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
0597   CD 30 1B               CALL   NUMER   ;TEST IF NUMERIC
059A   CA EE 02               JZ   GOTO   ;BRIF IT IS
059D   C3 30 02               JMP   RUN4   ;ELSE, MAY BE ANY STMT
05A0                FALSE:    EQU   RUN   
05A0   21 CE 24     IFF:      LXI   H,IOBUF   ;POINT PRIOR
05A3   46                     MOV   B,M   ;GET LEN
05A4   11 20 25               LXI   D,STRIN   ;POINT THIS
05A7   1A                     LDAX   D   ;GET LEN
05A8   4F                     MOV   C,A   ;SAVE IT
05A9   13           IFG:      INX   D   ;POINT NEXT
05AA   23                     INX   H   ;DITTO
05AB   78                     MOV   A,B   ;GET LEFT LEN
05AC   B7                     ORA   A   ;TEST IT
05AD   C2 B2 05               JNZ   IFH   ;BRIF NOT ZERO
05B0   36 20                  MVI   M," "   ;EXTEND WITH SPACE
05B2   79           IFH:      MOV   A,C   ;GET RIGHT LEN
05B3   B7                     ORA   A   ;TEST IT
05B4   C2 BA 05               JNZ   IFI   ;BRIF NOT ZERO
05B7   3E 20                  MVI   A," "   ;GET SPACE
05B9   12                     STAX   D   ;EXTEND
05BA   1A           IFI:      LDAX   D   ;GET RIGHT CHAR
05BB   BE                     CMP   M   ;TEST WITH LEFT
05BC   DA DF 05               JC   IFM   ;BRIF LEFT>RIGHT
05BF   C2 E4 05               JNZ   IFN   ;BRIF LEFT<RIGHT
05C2   78                     MOV   A,B   ;GET LEFT COUNT
05C3   3D                     DCR   A   ;SUBT ONE
05C4   FA C8 05               JM   IFJ   ;BRIF WAS ZERO
05C7   47                     MOV   B,A   ;UPDATE CTR
05C8   79           IFJ:      MOV   A,C   ;GET RIGHT LEN
05C9   3D                     DCR   A   ;SUBT ONE
05CA   FA CE 05               JM   IFK   ;BRIF WAS ZERO
05CD   4F                     MOV   C,A   ;UPDT CTR
05CE   78           IFK:      MOV   A,B   ;GET LEFT LEN
05CF   B1                     ORA   C   ;COMPARE TO RIGHT
05D0   C2 A9 05               JNZ   IFG   ;BRIF BOTH NOT ZERO
05D3   06 01                  MVI   B,1   ;SET SW= EQUAL
05D5   3A 25 26     IFL:      LDA   REL   ;GET RELATION
05D8   A0                     ANA   B   ;AND WITH RESULT
05D9   CA 03 02               JZ   FALSE   ;BRIF FALSE
05DC   C3 79 05               JMP   TRUE   ;ELSE, TRUE
05DF   06 02        IFM:      MVI   B,2   ;SET CODE
05E1   C3 D5 05               JMP   IFL   ;JUMP
05E4   06 04        IFN:      MVI   B,4   ;SET CODE
05E6   C3 D5 05               JMP   IFL   ;JUMP
05E9                             ;PAGE
05E9                             ; 
05E9                LET:      EQU   $   
05E9                             ; 
05E9                             ; 
05E9                             ; STMT: [LET] VAR = EXPR
05E9                             ; 
05E9                             ; 
05E9   CD 47 18               CALL   GETS8   ;GO GET ADDRESS OF VARIABLE
05EC   C5                     PUSH   B   ;SAVE NAME
05ED   D5                     PUSH   D   ;SAVE ADDRESS
05EE   CF                     RST   1   ;GET NEXT CHAR
05EF   FE 3D                  CPI   "="   ;TEST FOR EQUAL SIGN
05F1   CA 04 06               JZ   LET1   ;BRIF IS
05F4   3A 76 24               LDA   EDSW   ;GET MODE SW
05F7   B7                     ORA   A   ;TEST IT
05F8   CA 15 1C               JZ   SNERR   ;BRIF LET ERROR
05FB   21 81 1D               LXI   H,WHATL   ;POINT LITERAL
05FE   CD C0 19               CALL   TERMM   ;GO PRINT IT
0601   C3 C1 00               JMP   GETCM   ;GO TO COMMAND
0604   23           LET1:     INX   H   ;POINT NEXT
0605   CD 78 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
0608   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
060B   E1                     POP   H   ;RESTORE ADDRESSS
060C   D1                     POP   D   ;RESTORE NAME
060D   7B                     MOV   A,E   ;GET TYPE
060E   B7                     ORA   A   ;TEST IT
060F   3A 8E 26               LDA   NS   ;GET RESULT TYPE
0612   FA 1E 06               JM   LET2   ;BRIF STRING
0615   FE E3                  CPI   0E3H   ;TEST IF NUMERIC
0617   C2 15 1C               JNZ   SNERR   ;BRIF MIXED MODE
061A   DF                     RST   3   ;GO STORE VARIABLE
061B   C3 03 02               JMP   RUN   ;CONTINUE
061E   FE E7        LET2:     CPI   0E7H   ;TEST IF STRING
0620   C2 15 1C               JNZ   SNERR   ;BRIF MIXED MODE
0623   CD 29 06               CALL   LET2A   ;GO STORE IT
0626   C3 03 02               JMP   RUN   ;CONTINUE
0629                             ; 
0629   11 20 25     LET2A:    LXI   D,STRIN   ;POINT STRING BUFFER
062C   1A                     LDAX   D   ;GET NEW LEN
062D   96                     SUB   M   ;MINUS OLD LEN
062E   CA 7E 06               JZ   LET8   ;BRIF SAME LENGTH
0631   54                     MOV   D,H   ;COPY H,L
0632   5D                     MOV   E,L   ;TO D,E
0633   7E                     MOV   A,M   ;GET LEN
0634   3C                     INR   A   ;TRUE LEN
0635   13           LET3:     INX   D   ;POINT NEXT
0636   3D                     DCR   A   ;DECR CTR
0637   C2 35 06               JNZ   LET3   ;LOOP
063A   13                     INX   D   ;SKIP
063B   13                     INX   D   ;AGAIN
063C   1A                     LDAX   D   ;GET LO NAM
063D   4F                     MOV   C,A   ;SAVE
063E   13                     INX   D   ;GET HI NAME
063F   1A                     LDAX   D   ;LOAD IT
0640   47                     MOV   B,A   ;SAVE
0641   C5                     PUSH   B   ;SAVE NAME
0642   2B                     DCX   H   ;POINT NEXT ENTRY
0643   7E           LET4:     MOV   A,M   ;GET NEXT
0644   B7                     ORA   A   ;TEST IF END
0645   CA 5C 06               JZ   LET6   ;BRIF IS
0648   E5                     PUSH   H   ;SAVE H,L
0649   2B                     DCX   H   ;SKIP NEXT
064A   2B                     DCX   H   ;POINT LEN
064B   46                     MOV   B,M   ;GET HI LEN
064C   2B                     DCX   H   ;POINT LO
064D   4E                     MOV   C,M   ;GET LO LEN
064E   E1                     POP   H   ;RESTORE H,L
064F   7E           LET5:     MOV   A,M   ;GET A BYTE
0650   12                     STAX   D   ;COPY
0651   2B                     DCX   H   ;POINT NEXT
0652   1B                     DCX   D   ;DITTO
0653   03                     INX   B   ;ADD TO CTR
0654   78                     MOV   A,B   ;GET HI
0655   B1                     ORA   C   ;TEST IF ZERO
0656   C2 4F 06               JNZ   LET5   ;LOOP
0659   C3 43 06               JMP   LET4   ;CONTINUE
065C   EB           LET6:     XCHG      ;PUT NEW ADDR TO H,L
065D   C1                     POP   B   ;GET NAME
065E   70                     MOV   M,B   ;STORE HI BYTE
065F   2B                     DCX   H   ;POINT NEXT
0660   71                     MOV   M,C   ;STORE LO
0661   11 20 25               LXI   D,STRIN   ;GET NEW LEN
0664   1A                     LDAX   D   ;LOAD IT
0665   06 FF                  MVI   B,0FFH   ;INIT HI COMPLEMENT
0667   C6 05                  ADI   5   ;COMPUTE ENTRY LENGTH
0669   CA 71 06               JZ   LET7   ;BRIF 256 BYTES
066C   D2 71 06               JNC   LET7   ;BRIF LESS 256
066F   06 FE                  MVI   B,0FEH   ;SET BIT OFF
0671   2F           LET7:     CMA      ;1'S COMPLEMENT
0672   3C                     INR   A   ;THEN 2'S
0673   4F                     MOV   C,A   ;SAVE LO LEN
0674   2B                     DCX   H   ;POINT NEXT
0675   70                     MOV   M,B   ;STORE HI LEN
0676   2B                     DCX   H   ;POINT NEXT
0677   71                     MOV   M,C   ;STORE LO LEN
0678   E7                     RST   4   ;ADJUST H,L
0679   03                     DB   3   
067A   09                     DAD   B   ;COMPUTE END OF ENTRY
067B   36 00                  MVI   M,0   ;MARK NEW END
067D   23                     INX   H   ;POINT 1ST BYTE
067E   1A           LET8:     LDAX   D   ;GET LEN
067F   3C                     INR   A   ;TRUE LEN
0680   47                     MOV   B,A   ;SAVE LEN
0681   1A           LET9:     LDAX   D   ;GET A BYTE
0682   77                     MOV   M,A   ;COPY IT
0683   23                     INX   H   ;POINT NEXT
0684   13                     INX   D   ;DITTO
0685   05                     DCR   B   ;SUBT CTR
0686   C2 81 06               JNZ   LET9   ;LOOP
0689   C9                     RET      ;RETURN
068A                             ;PAGE
068A                             ; 
068A                             ;NEXT   EQQU    $
068A                             ; 
068A                             ; 
068A                             ; STMT:  NEXT VAR
068A                             ; 
068A                             ; 
068A   CD CF 1B     NEXT:     CALL   VAR   ;GET VARIABLE NAME
068D   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LNE
0690   EB                     XCHG      ;FLIP/FLOP
0691   22 23 26               SHLD   INDX   ;SAVE VAR NAME
0694   E5                     PUSH   H   ;SAVE VAR NAME
0695   21 00 24               LXI   H,FORNE   ;POINT FOR/NEXT TABLE
0698   46                     MOV   B,M   ;GET SIZE
0699   78                     MOV   A,B   ;LOAD IT
069A   B7                     ORA   A   ;TEST IT
069B   CA 21 1C               JZ   NXERR   ;BRIF TABLE EMPTY
069E   23                     INX   H   ;POINT NEXT
069F   D1                     POP   D   ;RESTORE VAR NAME
06A0   7E           NEXT1:    MOV   A,M   ;GET 1ST BYTE
06A1   23                     INX   H   ;POINT NEXT
06A2   BA                     CMP   D   ;COMPARE
06A3   C2 AB 06               JNZ   NEXT2   ;BRIF NOT EQUAL
06A6   7E                     MOV   A,M   ;GET 2ND BYTE
06A7   BB                     CMP   E   ;COMPARE
06A8   CA B4 06               JZ   NEXT3   ;BRIF EQUAL
06AB   E7           NEXT2:    RST   4   ;ADJUST H,L
06AC   0D                     DB   13   
06AD   05                     DCR   B   ;DECR COUNT
06AE   C2 A0 06               JNZ   NEXT1   ;LOOP
06B1   C3 21 1C               JMP   NXERR   ;GO PUT ERROR MSG
06B4   3A 00 24     NEXT3:    LDA   FORNE   ;GET ORIG COUNT
06B7   90                     SUB   B   ;MINUS REMAIN
06B8   3C                     INR   A   ;PLUS ONE
06B9   32 00 24               STA   FORNE   ;STORE NEW COUNT
06BC   23                     INX   H   ;POINT ADDR
06BD   E5                     PUSH   H   ;SAVE H,L ADDR
06BE   CD 3A 1B               CALL   SEARC   ;GO GET ADDR OF INDEX
06C1   EB                     XCHG      ;PUT TO H,L
06C2   22 52 26               SHLD   ADDR1   ;SAVR IT
06C5   EF                     RST   5   ;LOAD INDEX
06C6   E1                     POP   H   ;GET H,L (TBL)
06C7   E5                     PUSH   H   ;RE-SAVE
06C8   CD 2F 16               CALL   FADD   ;ADD STEP VALUE
06CB   21 27 26               LXI   H,TVAR1   ;POINT TEMP AREA
06CE   DF                     RST   3   ;SAVE NEW INDEX
06CF   E1                     POP   H   ;GET H,L (TBL)
06D0   E5                     PUSH   H   ;RE-SAVE
06D1   E7                     RST   4   ;GET LEN TO NEXT
06D2   04                     DB   4   
06D3   CD 04 17               CALL   FSUB   ;SUBTRACT TO VALUE
06D6   CA F3 06               JZ   NEXT6   ;BRIF ZERO
06D9   E1                     POP   H   ;GET H,L (PTR TO STEP)
06DA   E5                     PUSH   H   ;RE-SAVE
06DB   7E                     MOV   A,M   ;GET SIGN&EXPONENT OF STEP
06DC   B7                     ORA   A   ;TEST IT
06DD   3A 58 26               LDA   FACC   ;GET SIGN & EXPON OF DIFF
06E0   FA EF 06               JM   NEXT5   ;BRIF NEGATIVE
06E3   B7                     ORA   A   ;TEST SIGN OF DIFF
06E4   FA F3 06               JM   NEXT6   ;BRIF LESS THAN TO-EXPR
06E7   21 00 24     NEXT7:    LXI   H,FORNE   ;GET ADDR TABLE
06EA   35                     DCR   M   ;SUBTRACT ONE FROM COUNT
06EB   D1                     POP   D   ;ADJUST STACK
06EC   C3 03 02               JMP   RUN   ;GO STMT AFTER NEXT
06EF   B7           NEXT5:    ORA   A   ;TEST SIGN OF DIFFERENCE
06F0   FA E7 06               JM   NEXT7   ;BRIF END OF LOOP
06F3   E1           NEXT6:    POP   H   ;GET PTR TO TBL
06F4   E7                     RST   4   ;ADJUST H,L
06F5   08                     DB   8   
06F6   56                     MOV   D,M   ;GET HI BYTE
06F7   23                     INX   H   ;POINT NEXT
06F8   5E                     MOV   E,M   ;GET LOW BYTE
06F9   23                     INX   H   ;POINT NEXT
06FA   7E                     MOV   A,M   ;GET HI BYTE
06FB   32 71 26               STA   STMT+1   ;SAVE
06FE   23                     INX   H   ;POINT NEXT
06FF   7E                     MOV   A,M   ;GET LOW BYTE
0700   32 70 26               STA   STMT   ;SAVE
0703   EB                     XCHG      ;H,L = ADDR OF STMT AFTR FOR
0704   CD 9A 1A               CALL   EOL   ;SETUP MULTI PTP
0707   2A 70 26               LHLD   STMT   ;GET ADDR OF FOR STMT
070A   23                     INX   H   ;POINT LINE NUM
070B   22 89 26               SHLD   LINE   ;SAVE ADDR LINE
070E   21 27 26               LXI   H,TVAR1   ;POINT UPDTED VALUE
0711   EF                     RST   5   ;GO LOAD IT
0712   2A 52 26               LHLD   ADDR1   ;GET ADDR OF INDEX
0715   DF                     RST   3   ;GO STORE IT
0716   C3 03 02               JMP   RUN   ;CONTINUE WITH STMT AFTER FOR
0719                             ;PAGE
0719                INPUT:    EQU   $   
0719                             ; 
0719                             ; 
0719                             ; STMT:  INPUT VAR [, VAR, VAR]
0719                             ; 
0719                             ; 
0719   11 98 1D               LXI   D,LLINE   ;POINT "LINE"
071C   E5                     PUSH   H   ;SAVE H,L ADDR
071D   D7                     RST   2   ;GO COMPARE
071E   CA 9D 07               JZ   INPL   ;BRIF EQUAL
0721   D1                     POP   D   ;ELSE, RESTORE H,L ADDR
0722   21 CE 24               LXI   H,IOBUF   ;GET ADDR OF BUFFER
0725   22 52 26               SHLD   ADDR1   ;SAVE ADDR
0728   36 00                  MVI   M,0   ;MARK BUFFER EMPTY
072A   EB                     XCHG      ;FLIP/BACK
072B   CF           INPU1:    RST   1   ;SKIP SPACES
072C   FE 27                  CPI   27H   ;TEST IF QUOTE
072E   CA 36 07               JZ   INPU2   ;BRIF IS
0731   FE 22                  CPI   0x22   ;"""     ;TEST IF INPUT LITERAL
0733   C2 59 07               JNZ   INPU6   ;BRIF NOT
0736   4F           INPU2:    MOV   C,A   ;SAVE DELIM
0737   11 CE 24               LXI   D,IOBUF   ;POINT BUFFER
073A   23           INPU3:    INX   H   ;POINT NEXT
073B   7E                     MOV   A,M   ;LOAD IT
073C   B9                     CMP   C   ;TEST IF END
073D   CA 45 07               JZ   INPU4   ;BRIF IS
0740   12                     STAX   D   ;PUT TO BUFF
0741   13                     INX   D   ;POINT NEXT
0742   C3 3A 07               JMP   INPU3   ;LOOP
0745   23           INPU4:    INX   H   ;SKIP TRAILING QUOTE
0746   EB                     XCHG      ;PUT ADDR TO H,L
0747   36 FE                  MVI   M,0FEH   ;MARK END
0749   CD B8 19               CALL   TERMO   ;GO PRINT PROMPT
074C   EB                     XCHG      ;GET H,L
074D   CF                     RST   1   ;SKIP TO NON BLANK
074E   FE 2C                  CPI   ","   ;TEST IF COMMA
0750   CA 58 07               JZ   INPU5   ;BRIF IS
0753   FE 3B                  CPI   ";"   ;TEST IF COMMA
0755   C2 59 07               JNZ   INPU6   ;BRIF NOT
0758   23           INPU5:    INX   H   ;SKIP IT
0759   CD 47 18     INPU6:    CALL   GETS8   ;GO GET VAR ADDR
075C   E5                     PUSH   H   ;SAVE H ADDR
075D   D5                     PUSH   D   ;SAVE VAR ADDR
075E   2A 52 26               LHLD   ADDR1   ;GET ADDR PREV BUFFER
0761   7E                     MOV   A,M   ;LOAD CHAR
0762   FE 2C                  CPI   ","   ;TEST IF COMMA
0764   23                     INX   H   ;POINT NEXT
0765   CA 6D 07               JZ   INPU7   ;BRIF CONTINUE FROM PREV
0768   3E 3F                  MVI   A,"?"   ;LOAD PROMPT
076A   CD FC 18               CALL   TERMI   ;GO READ FROM TTY
076D   CF           INPU7:    RST   1   ;SKIP SPACES
076E   79                     MOV   A,C   ;GET LO NAME
076F   B7                     ORA   A   ;TEST IT
0770   FA 94 07               JM   INPUA   ;BRIF STRING
0773   CD 26 14               CALL   FIN   ;GO CONVERT TO FLOATING
0776   CF                     RST   1   ;SKIP SPACES
0777   FE 2C                  CPI   ","   ;TEST IF COMMA
0779   CA 80 07               JZ   INPU8   ;BRIF IS
077C   B7                     ORA   A   ;TEST IF END OF LINE
077D   C2 25 1C               JNZ   CVERR   ;BRIF ERROR
0780   22 52 26     INPU8:    SHLD   ADDR1   ;SAVE ADDRESS
0783   E1                     POP   H   ;GET VAR ADDR
0784   DF                     RST   3   ;GO STORE THE NUMBER
0785   E1           INPU9:    POP   H   ;RESTORE STMT POINTER
0786   7E                     MOV   A,M   ;GET CHAR
0787   FE 2C                  CPI   ","   ;TEST FOR COMMA
0789   23                     INX   H   ;POINT NEXT
078A   CA 2B 07               JZ   INPU1   ;RECDURSIVE IF COMMA
078D   2B                     DCX   H   ;POINT BACK
078E   CD 9A 1A     INPUB:    CALL   EOL   ;ERROR IF NOT END OF LINE
0791   C3 03 02               JMP   RUN   ;CONTINUE NEXT STMT
0794   CD 05 18     INPUA:    CALL   GETST   ;GO GET THE STRING
0797   22 52 26               SHLD   ADDR1   ;SAVE ADDRESS
079A   C3 85 07               JMP   INPU9   ;CONTINUE
079D                             ; 
079D                INPL:     EQU   $   
079D                             ; 
079D                             ; 
079D                             ; STMT: INPUT LINE A$
079D                             ; 
079D                             ; 
079D   D1                     POP   D   ;DUMMY POP TO ADJUST STACK
079E   CD CF 1B               CALL   VAR   ;GET STRING NAME
07A1   7B                     MOV   A,E   ;LOAD LO BYTE
07A2   B7                     ORA   A   ;TEST IT
07A3   F2 15 1C               JP   SNERR   ;BRIF NOT STRING VARIABLE
07A6   CD 3A 1B               CALL   SEARC   ;ELSE, GET ADDRESS
07A9   D5                     PUSH   D   ;SAVE ON STACK
07AA   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
07AD   3E 01                  MVI   A,1   ;GET ON SETTING
07AF   32 74 24               STA   ILSW   ;SET INPUT LINE SWITCH
07B2   3E 3F                  MVI   A,"?"   ;LOAD PROMPT
07B4   CD FC 18               CALL   TERMI   ;GO READ A LINE
07B7   06 00                  MVI   B,0   ;INIT COUNT
07B9   11 21 25               LXI   D,STRIN+1   ;POINT STRING BUFFER
07BC   21 CF 24               LXI   H,IOBUF+1   ;POINT INPUT BUFFER
07BF   7E           INPL1:    MOV   A,M   ;GET NEXT BYTE
07C0   B7                     ORA   A   ;TEST IT
07C1   CA CB 07               JZ   INPL2   ;BRIF END
07C4   04                     INR   B   ;ADD TO COUNT
07C5   12                     STAX   D   ;PUT TO STRING BUFF
07C6   13                     INX   D   ;POINT NEXT
07C7   23                     INX   H   ;DITTO
07C8   C3 BF 07               JMP   INPL1   ;LOOP
07CB   32 74 24     INPL2:    STA   ILSW   ;RESET SWITCH
07CE   78                     MOV   A,B   ;GET COUNT
07CF   32 20 25               STA   STRIN   ;SET STRING LENGTH
07D2   E1                     POP   H   ;GET ADDRESS OF VARIABLE
07D3   CD 29 06               CALL   LET2A   ;GO STORE THE STRING
07D6   C3 03 02               JMP   RUN   ;GO NEXT STMT
07D9                             ;PAGE
07D9                             ; 
07D9                READ:     EQU   $   
07D9                             ; 
07D9                             ; STMT: READ VAR [,VAR ...]
07D9                             ; 
07D9   CF                     RST   1   ;SKIP BLANKS
07DA   CD 47 18               CALL   GETS8   ;GET VAR ADDR
07DD   E5                     PUSH   H   ;SAVE H,L
07DE   D5                     PUSH   D   ;SAVE D,E
07DF   2A 8F 26               LHLD   DATAP   ;GET DATA STMT POINTER
07E2   7E                     MOV   A,M   ;LOAD THE CHAR
07E3   B7                     ORA   A   ;TEST IF END OF STMT
07E4   C2 03 08               JNZ   READ2   ;BRIF NOT END OF STMT
07E7   23                     INX   H   ;POINT START NEXT STMT
07E8   7E           READ1:    MOV   A,M   ;LOAD LEN
07E9   22 8F 26               SHLD   DATAP   ;SAVE ADDR
07EC   B7                     ORA   A   ;TEST IF END OF PGM
07ED   CA 1D 1C               JZ   DAERR   ;BRIF OUT OF DATA
07F0   E7                     RST   4   ;ADJUST H,L
07F1   03                     DB   3   
07F2   11 AF 1E               LXI   D,DATAL   ;POINT "DATA"
07F5   D7                     RST   2   ;COMPARE
07F6   CA 03 08               JZ   READ2   ;BRIF IT IS DATA STMT
07F9   2A 8F 26               LHLD   DATAP   ;GET ADDR START
07FC   5E                     MOV   E,M   ;GET LEN CODE
07FD   16 00                  MVI   D,0   ;CLEAR D
07FF   19                     DAD   D   ;POINT NEXT STMT
0800   C3 E8 07               JMP   READ1   ;LOOP NEXT STMT
0803   CF           READ2:    RST   1   ;SKIP SPACES
0804   79                     MOV   A,C   ;LOAD LO NAME
0805   B7                     ORA   A   ;TEST IT
0806   FA 2B 08               JM   READ6   ;BRIF STRING
0809   CD 26 14               CALL   FIN   ;GO CONVERT VALUE
080C   7E                     MOV   A,M   ;GET CHAR WHICH STOPPED US
080D   FE 2C                  CPI   ","   ;TEST IF COMMA
080F   C2 24 08               JNZ   READ5   ;BRIF NOT
0812   23                     INX   H   ;POINT NEXT
0813   22 8F 26     READ3:    SHLD   DATAP   ;SAVE ADDRESS
0816   E1                     POP   H   ;RESTORE ADDR OF VAR
0817   DF                     RST   3   ;STORE THE VALUE
0818   E1           READ4:    POP   H   ;RESTORE POINTER TO STM
0819   7E                     MOV   A,M   ;GET THE CHAR
081A   FE 2C                  CPI   ","   ;TEST IF COMMA
081C   23                     INX   H   ;POINT NEXT
081D   CA D9 07               JZ   READ   ;RECURSIVE IF IT IS
0820   2B                     DCX   H   ;RESET
0821   C3 8E 07               JMP   INPUB   ;CONTINUE
0824   B7           READ5:    ORA   A   ;TEST IF END OF STMT
0825   CA 13 08               JZ   READ3   ;BRIF OK
0828   C3 25 1C               JMP   CVERR   ;GO PROCESS ERROR
082B   CD 05 18     READ6:    CALL   GETST   ;GO GET STRING
082E   7E                     MOV   A,M   ;GET CHAR
082F   FE 2C                  CPI   ","   ;TEST IF COMMA
0831   CA 3B 08               JZ   READ7   ;BRIF IS
0834   B7                     ORA   A   ;TEST IF END
0835   C2 24 08               JNZ   READ5   ;BRIF NOT
0838   C3 3C 08               JMP   READ8   ;GO AROUND
083B   23           READ7:    INX   H   ;POINT PAST
083C   22 8F 26     READ8:    SHLD   DATAP   ;SAVE ADDRESS
083F   C3 18 08               JMP   READ4   ;CONTINUE
0842                             ; 
0842                OUTP:     EQU   $   
0842                             ; 
0842                             ; STMT; OUT ADDR,VALUE
0842                             ; 
0842                             ; 
0842   CD 78 0F               CALL   EXPR   ;GO EVALUATE ADDRESS
0845   7E                     MOV   A,M   ;GET DELIM
0846   FE 2C                  CPI   ","   ;TEST IF COMMA
0848   C2 15 1C               JNZ   SNERR   ;BRIF NOT
084B   23                     INX   H   ;SKIP OVER COMMA
084C   CD 6C 1C               CALL   FBIN   ;CONVERT TO BINARY IN A-REG
084F   11 20 26               LXI   D,OUTA   ;POINT INSTR
0852   EB                     XCHG      ;PUT TO H,L
0853   36 D3                  MVI   M,0D3H   ;OUT INSTR
0855   23                     INX   H   ;POINT NEXT
0856   77                     MOV   M,A   ;PUT ADDR
0857   23                     INX   H   ;POINT NEXT
0858   36 C9                  MVI   M,0C9H   ;RET INSTR
085A   EB                     XCHG      ;RESTORE ORIG H,L
085B   CD 78 0F               CALL   EXPR   ;GO EVAL DATA BYTE
085E   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END OF STATEMENT
0861   CD 6C 1C               CALL   FBIN   ;CONVERT TO BINARY
0864   CD 20 26               CALL   OUTA   ;GO PUT THE BYTE
0867   C3 03 02               JMP   RUN   ;GO NEXT STMT
086A                             ;PAGE
086A                             ; 
086A                STOP:     EQU   $   
086A                             ; 
086A                             ; STMT: STOP
086A                             ; 
086A                             ; 
086A   CD 9A 1A               CALL   EOL   ;POINT END OF LINE
086D   21 41 1E               LXI   H,STOPM   ;POINT MESSAGE: "STOP AT LINE "
0870   CD C0 19               CALL   TERMM   ;GO WRITE IT
0873   CD F7 1B               CALL   PRLIN   ;GO PRINT LINE NUMBER
0876   3A 75 24               LDA   RUNSW   ;GET RUN TYPE
0879   B7                     ORA   A   ;TEST IT
087A   C2 BB 00               JNZ   RDY   ;BRIF IMMED
087D   32 74 26               STA   MULTI   ;CLEAR MULTI SW
0880   2A 70 26               LHLD   STMT   ;GET ADDR OF PREV STMT
0883   5E                     MOV   E,M   ;GET LEN
0884   16 00                  MVI   D,0   ;CLEAR HI BYTE
0886   19                     DAD   D   ;POINT NEXT
0887   23                     INX   H   ;POINT LINE NUMBER
0888   22 89 26               SHLD   LINE   ;SAVE ADDR
088B   11 77 24               LXI   D,LINEN   ;POINT AREA
088E   CD 0C 1A               CALL   LINEO   ;GO CONVERT LINE NUMBER
0891   EB                     XCHG      ;FLIP TO H,L
0892   36 00                  MVI   M,0   ;MARK END
0894   C3 BB 00               JMP   RDY   ;GO TO READY MSG
0897                             ; 
0897                RANDO:    EQU   $   
0897                             ; 
0897                             ; 
0897                             ; STMT: RANDOMIZE
0897                             ; 
0897                             ; 
0897   CD 9A 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
089A   3E 01                  MVI   A,1   ;LOAD A ONE
089C   32 87 26               STA   RNDSW   ;SET SWITCH = TRUE RANDOM
089F   11 7F 26               LXI   D,TRNDX   ;POINT "TRUE" RANDOM NUMBERS
08A2   21 77 26               LXI   H,RNDX   ;POINT RECEIVE
08A5   06 08                  MVI   B,8   ;LOOP CTR
08A7   CD 53 1C               CALL   COPYD   ;GO MOVE IT
08AA   C3 03 02               JMP   RUN   ;CONTINUE
08AD                             ; 
08AD                ON:       EQU   $   
08AD                             ; 
08AD                             ; 
08AD                             ; STMT: ON EXPR GOTO NNN NNNN NNNN
08AD                             ;               GOSUB
08AD                             ; 
08AD                             ; 
08AD   CD 78 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
08B0   CD 6C 1C               CALL   FBIN   ;GET BINARY NUMBER IN ACC
08B3   B7                     ORA   A   ;TEST RESULT
08B4   CA 15 1C               JZ   SNERR   ;BRIF ZERO (ERROR)
08B7   4F                     MOV   C,A   ;SAVE VALUE
08B8   0D                     DCR   C   ;LESS ONE
08B9   AF                     XRA   A   ;GET A ZERO
08BA   32 25 26               STA   REL   ;TURN OFF SWITCH
08BD   11 E4 1E               LXI   D,GOTOL   ;POINT LITERAL
08C0   E5                     PUSH   H   ;SAVE H,L ADDRESS
08C1   D7                     RST   2   ;GO COMPARE
08C2   CA D3 08               JZ   ON3   ;BRIF ON...GOTO
08C5   E1                     POP   H   ;ELSE, RESTORE H,L
08C6   11 C3 1E               LXI   D,GOSBL   ;POINT LITERAL
08C9   D7                     RST   2   ;GO COMPARE
08CA   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
08CD   3E 01                  MVI   A,1   ;GET ON SETTING
08CF   32 25 26               STA   REL   ;SET SWITCH
08D2   E5                     PUSH   H   ;DUMMY PUSH
08D3   D1           ON3:      POP   D   ;ADJUST STACK
08D4   79           ON3A:     MOV   A,C   ;GET COUNT
08D5   B7                     ORA   A   ;TEST IT
08D6   CA F5 08               JZ   ON6   ;BRIF VALUE 1
08D9   CF                     RST   1   ;ELSE, SKIP BLANKS
08DA   B7                     ORA   A   ;TEST IF END OF LINE
08DB   CA 15 1C               JZ   SNERR   ;BRIF IS
08DE   FE 2C                  CPI   ","   ;TEST IS COMMA
08E0   C2 E7 08               JNZ   ON4   ;BRIF NOT
08E3   23                     INX   H   ;SKIP COMMA
08E4   C3 D4 08               JMP   ON3A   ;CONTINUE
08E7   CD 30 1B     ON4:      CALL   NUMER   ;GO TEST IF NUMERIC
08EA   C2 F1 08               JNZ   ON5   ;BRIF NOT
08ED   23                     INX   H   ;POINT NEXT
08EE   C3 E7 08               JMP   ON4   ;LOOP
08F1   0D           ON5:      DCR   C   ;SUB ONE FROM COUNT
08F2   C2 D4 08               JNZ   ON3A   ;LOOP TILL JUST BEFORE STMT#
08F5   CD B3 1A     ON6:      CALL   NOTEO   ;ERROR IF NOT END-OF-LINE
08F8   FE 2C                  CPI   ","   ;TEST IF COMMA
08FA   C2 01 09               JNZ   ON7   ;BRIF NOT
08FD   23                     INX   H   ;POINT NEXT
08FE   C3 F5 08               JMP   ON6   ;LOOP
0901   CD 30 1B     ON7:      CALL   NUMER   ;TEST IF NUMERIC
0904   C2 15 1C               JNZ   SNERR   ;BRIF NOT
0907   CD BB 1A               CALL   PACK   ;GET THE LINE NUMBER
090A   7E           ON8:      MOV   A,M   ;GET NEXT CHAR
090B   CD AE 1A               CALL   TSTEL   ;TEST IF END STMT
090E   CA 15 09               JZ   ON9   ;BRIF END
0911   23                     INX   H   ;POINT NEXT
0912   C3 0A 09               JMP   ON8   ;LOOP
0915   CD 9A 1A     ON9:      CALL   EOL   ;SET END OF LINE POINTERS
0918   3A 25 26               LDA   REL   ;GET TYPE (GOTO OR GOSUB)
091B   B7                     ORA   A   ;TEST IT
091C   C2 3B 03               JNZ   GOSU1   ;BRIF GOSUB
091F   C3 FE 02               JMP   GOTO2   ;BR TO GOTO LOOKUP
0922                             ;PAGE
0922                             ; 
0922                CHANG:    EQU   $   
0922                             ; 
0922                             ; STATEMENT: CHANGE A$ TO X     - OR -
0922                             ; 
0922                             ;            CHANGE X TO A$
0922                             ; 
0922   CD CF 1B               CALL   VAR   ;NEXT WORD MUST BE VAR
0925   7B                     MOV   A,E   ;TEST TYPE
0926   B7                     ORA   A   ;SET FLAGS
0927   F2 60 09               JP   CHA2   ;BRIF NOT-STRING
092A   CD 3A 1B               CALL   SEARC   ;GET ADDR
092D   D5                     PUSH   D   ;SAVE IT
092E   11 E6 1E               LXI   D,TOLIT   ;POINT "TO"
0931   D7                     RST   2   ;COMPARE
0932   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
0935   CD CF 1B               CALL   VAR   ;GET NEXT VARIABLE
0938   7A                     MOV   A,D   ;GET HI NAME
0939   F6 80                  ORI   80H   ;SET MASK FOR ARRAY
093B   57                     MOV   D,A   ;REPLACE
093C   CD 3A 1B               CALL   SEARC   ;GET ADDRESS
093F   E7                     RST   4   ;POINT START OF ELEMENT 0,0
0940   F5                     DB   -11   ; AND 0FFH
0941   D1                     POP   D   ;GET PTR TO STMT
0942   EB                     XCHG      ;FLIP
0943   CD 9A 1A               CALL   EOL   ;NEXT MUST BE E-O-L
0946   EB                     XCHG      ;FLIP AGAIN
0947   D1                     POP   D   ;GET ADDR STRING
0948   1A                     LDAX   D   ;GET COUNT
0949   47                     MOV   B,A   ;SAVE IT
094A   04                     INR   B   ;BUMP
094B   C5           CHA1:     PUSH   B   ;SAVE CTR
094C   D5                     PUSH   D   ;SAVE ADDR STRING
094D   E5                     PUSH   H   ;SAVE ADDR NUM
094E   CD 12 0D               CALL   FDEC   ;CONVERT TO F.P.
0951   E1                     POP   H   ;GET ADDR
0952   DF                     RST   3   ;STORE IT
0953   E7                     RST   4   ;POINT TO NEXT
0954   F8                     DB   -8   ; AND 0FFH
0955   D1                     POP   D   ;RESTORE STRING
0956   C1                     POP   B   ;AND CTR
0957   13                     INX   D   ;POINT NEXT CHAR
0958   1A                     LDAX   D   ;LOAD IT
0959   05                     DCR   B   ;DECR CTR
095A   C2 4B 09               JNZ   CHA1   ;LOOP
095D   C3 03 02               JMP   RUN   
0960                             ; 
0960                             ; 
0960   7A           CHA2:     MOV   A,D   ;GET HI NAME
0961   F6 80                  ORI   80H   ;MAKE ARRAY NAME
0963   57                     MOV   D,A   ;SAVE
0964   CD 3A 1B               CALL   SEARC   ;GET ADDR
0967   E7                     RST   4   ;POINT ELEMENT 0,0
0968   F5                     DB   -11   ; AND 0FFH
0969   E3                     XTHL      ;SAVE ON STACK
096A   11 E6 1E               LXI   D,TOLIT   ;POINT "TO"
096D   D7                     RST   2   ;COMPARE
096E   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
0971   CD CF 1B               CALL   VAR   ;GET NAME
0974   7B                     MOV   A,E   ;GET TYPE
0975   B7                     ORA   A   ;SET FLAGS
0976   F2 15 1C               JP   SNERR   ;BRIF NOT STRING
0979   CD 9A 1A               CALL   EOL   ;BRIF NOT E-O-L
097C   CD 3A 1B               CALL   SEARC   ;GET ADDR
097F   E1                     POP   H   ;GET ADDR VAR
0980   D5                     PUSH   D   ;SAVE D,E
0981   11 20 25               LXI   D,STRIN   ;POINT STRING BUFFER
0984   D5                     PUSH   D   ;SAVE IT
0985   EF                     RST   5   ;LOAD IT
0986   E7                     RST   4   ;POINT NEXT
0987   F8                     DB   -8   ; AND 0FFH
0988   E5                     PUSH   H   ;SAVE H,L
0989   CD 6C 1C               CALL   FBIN   ;CONVERT
098C   E1                     POP   H   ;RESTORE
098D   D1                     POP   D   ;DITTO
098E   47                     MOV   B,A   ;SAVE COUNT
098F   04                     INR   B   ;BUMP IT
0990   12           CHA3:     STAX   D   ;PUT TO STRING
0991   13                     INX   D   ;POINT NEXT STR LOC.
0992   C5                     PUSH   B   ;SAVE CTRS
0993   D5                     PUSH   D   ;AND AD^DR
0994   EF                     RST   5   ;LOAD NEXT
0995   E7                     RST   4   ;POINT NEXT
0996   F8                     DB   -8   ;  AND 0FFH
0997   E5                     PUSH   H   ;AND H ADDR
0998   CD 6C 1C               CALL   FBIN   ;CONVERT
099B   E1                     POP   H   ;RESTORE H,L
099C   D1                     POP   D   ;AND D,E
099D   C1                     POP   B   ;AND CTRS
099E   05                     DCR   B   ;DECR CTR
099F   C2 90 09               JNZ   CHA3   ;LOOP
09A2   E1                     POP   H   ;GET ADDR OF VAR (STRING)
09A3   CD 29 06               CALL   LET2A   ;GO STORE IT
09A6   C3 03 02               JMP   RUN   ;CONTINUE
09A9                             ;PAGE
09A9                             ; 
09A9                DIM:      EQU   $   
09A9                             ; 
09A9                             ; STMT: DIM VAR(A,B),...
09A9                             ; 
09A9                             ; 
09A9   CD CF 1B               CALL   VAR   ;GO GET VAR NAME
09AC   F2 15 1C               JP   SNERR   ;BRIF NO (
09AF   CD 3A 1B               CALL   SEARC   ;GO LOCATE THE VAR
09B2   E3                     XTHL      ;PUT ADDR IN STACK, GET PTR TO (
09B3   F5                     PUSH   PSW   ;SAVE STATUS
09B4   3E FF                  MVI   A,0FFH   ;TURN ON SW
09B6   32 72 24               STA   DIMSW   ;SET IT
09B9   CD 78 0F               CALL   EXPR   ;GO EVALUATE
09BC   F1                     POP   PSW   ;GET STATUS
09BD   E3                     XTHL      ;SWAP PTRS
09BE   D5                     PUSH   D   ;SAVE ROW NUMBER
09BF   C5                     PUSH   B   ;SAVE COL NUMBER
09C0   03                     INX   B   ;INCREMENT COLUMNS
09C1   13                     INX   D   ;AND ROWS
09C2   E5                     PUSH   H   ;SAVE H,L
09C3   F5                     PUSH   PSW   ;RESAVE STATUS
09C4   21 00 00               LXI   H,0   ;GET A ZERO
09C7   19           DIM1:     DAD   D   ;TIMES ONE
09C8   0B                     DCX   B   ;DCR COLS
09C9   78                     MOV   A,B   ;GET HI
09CA   B1                     ORA   C   ;PLUS LO
09CB   C2 C7 09               JNZ   DIM1   ;LOOP
09CE   F1                     POP   PSW   ;GET STATUS
09CF   D1                     POP   D   ;GET ADDRESS
09D0   29                     DAD   H   ;TIMES TWO
09D1   29                     DAD   H   ;TIMES FOUR
09D2   01 08 00               LXI   B,8   ;PLUS 2 (NAME AND DISP)
09D5   FA 15 0A               JM   REDIM   ;GO RE-DIMENSION
09D8   E5                     PUSH   H   ;SAVE PRODUCT
09D9   09                     DAD   B   ;ADD IT
09DA   EB                     XCHG      ;FLIP/FLOP
09DB   2B                     DCX   H   ;POINT LO NAME
09DC   2B                     DCX   H   ;POINT HI DISP
09DD   7B                     MOV   A,E   ;GET LO
09DE   2F                     CMA      ;COMPLEMENT
09DF   C6 01                  ADI   1   ;PLUS ONE
09E1   5F                     MOV   E,A   ;RESTORE
09E2   7A                     MOV   A,D   ;GET HI
09E3   2F                     CMA      ;COMPLEMENT
09E4   CE 00                  ACI   0   ;PLUS CARRY
09E6   77                     MOV   M,A   ;STORE IT
09E7   2B                     DCX   H   ;POINT NEXT
09E8   73                     MOV   M,E   ;STORE LO
09E9   EB                     XCHG      ;SAVE IN D,E
09EA   E1                     POP   H   ;GET PRODUCT
09EB   44                     MOV   B,H   ;COPY H,L
09EC   4D                     MOV   C,L   ;TO B,C
09ED   EB                     XCHG      ;GET LOCAT
09EE   D1                     POP   D   ;GET COLUMNS
09EF   2B                     DCX   H   ;POINT NEXT
09F0   72                     MOV   M,D   ;MOVE LO COL
09F1   2B                     DCX   H   ;POINT NEXT
09F2   73                     MOV   M,E   ;MOVE HI COL
09F3   D1                     POP   D   ;GET ROWS
09F4   2B                     DCX   H   ;POINT NEXT
09F5   72                     MOV   M,D   ;MOVE HI ROW
09F6   2B                     DCX   H   ;POINT NEXT
09F7   73                     MOV   M,E   ;MOVE LO ROW
09F8   2B                     DCX   H   ;POINT NEXT
09F9   36 00        DIM2:     MVI   M,0   ;CLEAR ONE BYTE
09FB   2B                     DCX   H   ;POINT NEXT
09FC   0B                     DCX   B   ;DECR CTR
09FD   78                     MOV   A,B   ;GET HI
09FE   B1                     ORA   C   ;PLUS LO
09FF   C2 F9 09               JNZ   DIM2   ;LOOP
0A02   36 00                  MVI   M,0   ;MARK END
0A04   E1           DIM3:     POP   H   ;GET PTR TO STMT
0A05   7E                     MOV   A,M   ;LOAD CHAR
0A06   FE 2C                  CPI   ","   ;TEST IF COMMA
0A08   C2 0F 0A               JNZ   DIM4   ;BRIF NOT
0A0B   23                     INX   H   ;SKIP IT
0A0C   C3 A9 09               JMP   DIM   ;CONTINUE
0A0F   CD 9A 1A     DIM4:     CALL   EOL   ;TEST END OF LINE
0A12   C3 03 02               JMP   RUN   ;CONTINUE WITH PROGRAM
0A15   09           REDIM:    DAD   B   ;COMPUTE LEN TO NEXT
0A16   1B                     DCX   D   ;POINT LO NAME
0A17   1B                     DCX   D   ;POINT HI DISP
0A18   1A                     LDAX   D   ;GET IT
0A19   47                     MOV   B,A   ;SAVE
0A1A   1B                     DCX   D   ;POINT LO DISP
0A1B   1A                     LDAX   D   ;GET IT
0A1C   4F                     MOV   C,A   ;SAVE
0A1D   09                     DAD   B   ;COMPUTE DIFF OR PRIOR DIM AND THIS
0A1E   7C                     MOV   A,H   ;GET HI DIFF
0A1F   B7                     ORA   A   ;TEST IT
0A20   FA 2B 0A               JM   REDM1   ;BRIF PREV > NEW
0A23   C2 15 1C               JNZ   SNERR   ;BRIF PREV < NEW
0A26   7D                     MOV   A,L   ;GET LO DIFF
0A27   B7                     ORA   A   ;TEST IT
0A28   C2 15 1C               JNZ   SNERR   ;BRIF PREV < NEW
0A2B   EB           REDM1:    XCHG      ;PUT ADDR IN H,L
0A2C   2B                     DCX   H   ;POINT HI COL
0A2D   D1                     POP   D   ;GET COL
0A2E   72                     MOV   M,D   ;MOVE HI
0A2F   2B                     DCX   H   ;POINT LO COL
0A30   73                     MOV   M,E   ;MOVE LO
0A31   D1                     POP   D   ;GET ROW
0A32   2B                     DCX   H   ;POINT HI ROW
0A33   72                     MOV   M,D   ;MOVE HI
0A34   2B                     DCX   H   ;POINT LO ROW
0A35   73                     MOV   M,E   ;MOVE LO
0A36   C3 04 0A               JMP   DIM3   ;CONTINUE
0A39                             ;PAGE
0A39                             ; 
0A39                SIN:      EQU   $   
0A39                             ; 
0A39                             ; COMPUTE SINE OF X, (X IN RADIANS)
0A39                             ; 
0A39                             ; USES 4TH DEGREE POLYNOMIAL APPROXIMATION
0A39                             ; 
0A39                             ; 
0A39                             ; FIRST, REDUCE ANGLE TO RANGE: (-PI/2,PI/2)
0A39                             ; 
0A39   CD C6 18               CALL   FTEST   ;GET STATUS OF ANGLE
0A3C   C8                     RZ      ;SIN(0)=0
0A3D   F5                     PUSH   PSW   ;SAVE SIGN OF ANGLE
0A3E   CD BF 0B               CALL   ABS   
0A41   F1           SIN1:     POP   PSW   ;COMPLEMENT SIGN FOR EACH PI SUB'D
0A42   2F                     CMA      ;..
0A43   F5                     PUSH   PSW   ;..
0A44   21 B6 1D               LXI   H,PI   ;REDUCE TO -PI<X<0
0A47   CD 04 17               CALL   FSUB   
0A4A   F2 41 0A               JP   SIN1   
0A4D   21 EA 1D               LXI   H,HALFP   ;NOW ADD PI FOR -PI<X<-PI/2
0A50   E5                     PUSH   H   
0A51   CD 2F 16               CALL   FADD   
0A54   F4 72 0C               CP   NEG   ;AND JUST NEGATE FOR -PI/2<X<0
0A57   E1                     POP   H   
0A58   CD 2F 16               CALL   FADD   
0A5B   F1                     POP   PSW   ;RESTORE SIGN
0A5C   B7                     ORA   A   
0A5D   F4 72 0C               CP   NEG   
0A60                             ; 
0A60                             ; INIT REGISTERS
0A60                             ; 
0A60   21 2F 26               LXI   H,TEMP1   ;POINT IT
0A63   DF                     RST   3   ;SAVE IT
0A64   3A 58 26               LDA   FACC   ;GET SIGN&EXPONENT
0A67   CD D4 18               CALL   FEXP   ;EXPAND EXPON.
0A6A   F2 70 0A               JP   SIN3A   ;BRIF POSITIVE
0A6D   FE FD                  CPI   0FDH   ;TEST EXPONENT
0A6F   D8                     RC      ;RETURN IF VERY SMALL RADIAN
0A70                             ; 
0A70                             ; ABOVE ROUTINE WILL APPROX SIN(X) == X FOR X: (-.06,.06)
0A70                             ; 
0A70   21 EA 1D     SIN3A:    LXI   H,HALFP   ;POINT PI/2
0A73   CD 93 17               CALL   FDIV   ;COMPUTE X/PI/2
0A76   21 33 26               LXI   H,TEMP2   ;POINT T2
0A79   DF                     RST   3   ;STORE IT
0A7A   21 33 26               LXI   H,TEMP2   ;POINT BACK
0A7D   CD 10 17               CALL   FMUL   ;COMPUTE SQUARE
0A80   21 FA 1D               LXI   H,SINCO   ;POINT CONSTANTS
0A83                             ; 
0A83                             ; EVALUATE POWER SERIES
0A83                             ; 
0A83                             ; EVALUATE STARTING FROM HIGH ORDER COEFFICIENT:
0A83                             ;  F(X)=(...(CN*FACC+C(N-1))*FACC+...+C1)*FACC*TEMP2+TEMP1
0A83                             ; 
0A83                             ;ON ENTRY:
0A83                             ;       TEMP1=CONSTANT TERM
0A83                             ;       TEMP2=X OR 1
0A83                             ;       FACC=X^2 OR X
0A83                             ;       (HL)=COEFFICIENT OF LAST TERM
0A83                             ; 
0A83   E5           EVPS:     PUSH   H   ;SAVE POINTER TO COEFFICIENTS
0A84   21 37 26               LXI   H,TEMP3   ;SAVE FACC
0A87   DF                     RST   3   
0A88   E1                     POP   H   ;RESTORE H
0A89   E5                     PUSH   H   
0A8A   C3 94 0A               JMP   EVPS2   
0A8D   E5           EVPS1:    PUSH   H   ;SAVE PTR TO NEXT COEFFICIENT
0A8E   CD 2F 16               CALL   FADD   ;FACC+CN->FACC
0A91   21 37 26               LXI   H,TEMP3   ;POINTER TO X^N
0A94   CD 10 17     EVPS2:    CALL   FMUL   ;FACC*X^N->FACC
0A97   E1                     POP   H   ;COEFFICENT PTR
0A98   E7                     RST   4   ;MOVE TO NEXT COEFFICIENT
0A99   FC                     DB   -4   ; AND 0FFH
0A9A   7E                     MOV   A,M   ;GET EXPONENT
0A9B   3D                     DCR   A   ;TEST FOR 1
0A9C   C2 8D 0A               JNZ   EVPS1   ;BRIF NOT 1
0A9F   21 33 26               LXI   H,TEMP2   ;MUL BY TEMP2
0AA2   CD 10 17               CALL   FMUL   
0AA5   21 2F 26               LXI   H,TEMP1   ;POINT TO CONSTANT TERM
0AA8   C3 2F 16               JMP   FADD   ;ADD IT AND RETURN TO CALLER
0AAB                             ; 
0AAB                COS:      EQU   $   
0AAB                             ; 
0AAB                             ; 
0AAB                             ; COMPUTE COSINE OF ANGLE, X EXPRESSED IN RADIANS
0AAB                             ; USES THE TRANSFORMATION: Y = PI/2 +- X
0AAB                             ;     AND THEN COMPUTES SIN(Y).
0AAB                             ; 
0AAB                             ; 
0AAB   21 EA 1D               LXI   H,HALFP   ;COMPUTE PI/2 + X
0AAE   CD 2F 16               CALL   FADD   ;GO ADD
0AB1   C3 39 0A               JMP   SIN   ;GO COMPUTE SINE
0AB4                             ; 
0AB4                TAN:      EQU   $   
0AB4                             ; 
0AB4                             ; COMPUTE TANGENT OF X, IN RADIANS
0AB4                             ; USES THE RELATION:
0AB4                             ; 
0AB4                             ;          SIN(X)
0AB4                             ; TAN(X) = ------
0AB4                             ;          COS(X)
0AB4                             ; 
0AB4   21 3B 26               LXI   H,TEMP4   ;POINT SAVE AREA
0AB7   DF                     RST   3   ;SAVE ANGLE
0AB8   CD AB 0A               CALL   COS   ;COMPUTE COS(X)
0ABB   21 47 26               LXI   H,TEMP7   ;SAVE COS(X)->TEMP7
0ABE   DF                     RST   3   
0ABF   21 3B 26               LXI   H,TEMP4   ;MOVE X->FACC
0AC2   EF                     RST   5   
0AC3   CD 39 0A               CALL   SIN   ;COMPUTE SINE
0AC6   21 47 26               LXI   H,TEMP7   ;POINT COS
0AC9   C3 93 17               JMP   FDIV   ;DIVIDE AND RETURN TO CALLER
0ACC                             ; 
0ACC                ATN:      EQU   $   
0ACC                             ; 
0ACC                             ; COMPUTES THE ARCTANGENT OF X
0ACC                             ; USES A SEVENTH DEGREE POLYNOMIAL APPROXIMATION
0ACC                             ; 
0ACC   CD C6 18               CALL   FTEST   ;CHECK SIGN OF ARGUMENT
0ACF   F2 DB 0A               JP   ATN1   ;BRIF POSITIVE
0AD2   CD 72 0C               CALL   NEG   ;REVERSE SIGN
0AD5   CD DB 0A               CALL   ATN1   ;GET POSITIVE ATN
0AD8   C3 72 0C               JMP   NEG   ;MAKE NEG & RETURN
0ADB                             ; 
0ADB   21 FE 1D     ATN1:     LXI   H,ONE   ;POINT: 1
0ADE   CD 2F 16               CALL   FADD   ;GO ADD
0AE1   21 2F 26               LXI   H,TEMP1   ;POINT SAVE
0AE4   DF                     RST   3   ;STORE
0AE5   21 AE 1D               LXI   H,TWO   ;POINT: 2
0AE8   CD 04 17               CALL   FSUB   ;GO SUBTRACT
0AEB   21 2F 26               LXI   H,TEMP1   ;POINT SAVED
0AEE   CD 93 17               CALL   FDIV   ;DIVIDE
0AF1   21 33 26               LXI   H,TEMP2   ;POINT SAVE
0AF4   DF                     RST   3   ;SAVE X'=(X-1)/(X+1)
0AF5   21 BA 1D               LXI   H,QTRPI   ;X'+PI/4 -> TEMP1
0AF8   CD 2F 16               CALL   FADD   
0AFB   21 2F 26               LXI   H,TEMP1   
0AFE   DF                     RST   3   
0AFF   E5                     PUSH   H   ;SAVE PTR TO TEMP2
0B00   EF                     RST   5   ;LOAD IT
0B01   E1                     POP   H   
0B02   CD 10 17               CALL   FMUL   ;FACC=X"*X"
0B05   21 E6 1D               LXI   H,ATNCO   ;POINT LIST COEFFICIENTS
0B08   C3 83 0A               JMP   EVPS   ;GO COMPUTE & RETURN
0B0B                             ; 
0B0B                LN:       EQU   $   
0B0B                             ; 
0B0B                             ; 
0B0B                             ; COMPUTES THE NATRUAL LOGRITHM, LN(X)
0B0B                             ; USES A 7TH DEGREE POLYNOMIAL APPROXIMATION
0B0B                             ; 
0B0B   CD C6 18               CALL   FTEST   ;TEST THE ARGUMENT
0B0E   FA 0D 1C               JM   ZMERR   ;LN(-X)=NO NO
0B11   CA 0D 1C               JZ   ZMERR   ;LN(0)=NO NO ALSO
0B14   21 33 26               LXI   H,TEMP2   ;POINT SAVE AREA
0B17   DF                     RST   3   ;STORE IT
0B18   3A 58 26               LDA   FACC   ;GET EXPON
0B1B   CD D4 18               CALL   FEXP   ;EXPAND TO 8 BITS
0B1E   CA 24 0B               JZ   LN0   ;BRIF 0.5 < X < 1.0
0B21   F2 30 0B               JP   LN1   ;BRIF POSITIVE EXPONENT
0B24   2F           LN0:      CMA      ;ELSE COMPLIMENT
0B25   C6 02                  ADI   2   ;PLUS TWO
0B27   CD 12 0D               CALL   FDEC   ;CONVERT TO FLOAT POINT
0B2A   CD 72 0C               CALL   NEG   ;THEN NEGATE
0B2D   C3 35 0B               JMP   LN2   ;GO AROUND
0B30   DE 01        LN1:      SBI   1   ;MINUS ONE
0B32   CD 12 0D               CALL   FDEC   ;CONVERT TO FLOATING POINT
0B35   21 C2 1D     LN2:      LXI   H,LN2C   ;POINT LN(2)
0B38   CD 10 17               CALL   FMUL   ;MULTIPLY
0B3B   21 2F 26               LXI   H,TEMP1   ;POINT SAVE AREA
0B3E   DF                     RST   3   ;STORE IT
0B3F   EF                     RST   5   ;GET ORIG X
0B40   3E 01                  MVI   A,1   ;GET EXPONENT: 1
0B42   32 58 26               STA   FACC   ;ADJUST TO RANGE (1,2)
0B45   21 FE 1D               LXI   H,ONE   ;POINT 1
0B48   E5                     PUSH   H   ;SAVE PTR TO ONE
0B49   CD 04 17               CALL   FSUB   ;SUBTRACT ONE
0B4C   D1                     POP   D   ;SET TEMP2=1
0B4D   21 33 26               LXI   H,TEMP2   
0B50   CD 51 1C               CALL   CPY4D   
0B53   21 1A 1E               LXI   H,LNCO   ;POINT COEFFICIENTS
0B56   C3 83 0A               JMP   EVPS   ;APPROXIMATE & RETURN
0B59                             ; 
0B59                             ; X=LOG(X) --- THIS IS LOG BASE 10.
0B59                             ; 
0B59                LOG:      EQU   $   
0B59   CD 0B 0B               CALL   LN   ;COMPUTE NATURAL LOG
0B5C   21 36 1E               LXI   H,LNC   ;POINT LOG(E)
0B5F   C3 10 17               JMP   FMUL   ;MULTIPLY AND RETURN
0B62                             ; 
0B62                EXP:      EQU   $   
0B62                             ; 
0B62                             ;  COMPUTES EXP(X) USING ALGORITHM EXP(X)=(2^I)*(2^FP) WHERE
0B62                             ;  2^I=INT(X*LN BASE 2 OF E) AND,
0B62                             ;  2^FP=5TH DEGREE POLY. APPROXIMATION
0B62                             ;  FP=FRACTIONAL PART OF INT(X*LN2E)
0B62                             ; 
0B62   CD C6 18               CALL   FTEST   ;CHECK SIGN
0B65   F2 7C 0B               JP   EXP1   ;BRIF POSITIVE
0B68   CD 72 0C               CALL   NEG   ;ELSE, REVERSE SIGN
0B6B   CD 7C 0B               CALL   EXP1   ;COMPUTE POSITIVE EXP
0B6E   21 2F 26               LXI   H,TEMP1   ;POINT SAVE AREA
0B71   DF                     RST   3   ;STORE IT
0B72   21 FE 1D               LXI   H,ONE   ;POINT 1
0B75   EF                     RST   5   ;LOAD IT
0B76   21 2F 26               LXI   H,TEMP1   ;POINT PREV
0B79   C3 93 17               JMP   FDIV   ;RECIPRICAL AND RETURN
0B7C                             ; 
0B7C   21 1E 1E     EXP1:     LXI   H,LN2E   ;POINT LN BASE 2 OF E
0B7F   CD 10 17               CALL   FMUL   ;FACC=X*(LN2E)
0B82   21 37 26               LXI   H,TEMP3   ;POINT SAVE AREA
0B85   DF                     RST   3   ;TEMP3=X*LN2E
0B86   CD DA 0B               CALL   INT   ;FACC=INT(X*LN2E)
0B89   21 3B 26               LXI   H,TEMP4   ;POINT SAVE AREA
0B8C   DF                     RST   3   ;TEMP4=INT(X*LN2E)
0B8D   DF                     RST   3   ;DITTO FOR TEMP5
0B8E   3A 58 26               LDA   FACC   ;GET THE EXPONENT COUNT
0B91   47                     MOV   B,A   ;SAVE COUNT IN B
0B92   3A 59 26               LDA   FACC+1   ;GET MANTISSA
0B95   07           ELOOP:    RLC      ;ROTATE LEFT
0B96   05                     DCR   B   ;REDUCE COUNT
0B97   C2 95 0B               JNZ   ELOOP   ;CONTINUE SHIFTING
0B9A   3C                     INR   A   ;ADJUST EXPONENT
0B9B   32 3B 26               STA   TEMP4   ;STORE EXPONENT
0B9E   3E 80                  MVI   A,80H   ;LOAD CONSTANT
0BA0   32 3C 26               STA   TEMP4+1   ;STORE AS MANTISSA
0BA3   21 FE 1D               LXI   H,ONE   ;1 -> TEMP1, TEMP2
0BA6   EF                     RST   5   
0BA7   21 2F 26               LXI   H,TEMP1   
0BAA   DF                     RST   3   
0BAB   DF                     RST   3   
0BAC   EF                     RST   5   ;LOAD TEMP3=INT(X*LN2E)
0BAD   21 3F 26               LXI   H,TEMP5   ;GET FACC=FP(X*LN2E)
0BB0   CD 04 17               CALL   FSUB   
0BB3   21 32 1E               LXI   H,EXPCO   ;POINT CONSTANTS
0BB6   CD 83 0A               CALL   EVPS   ;COMPUTE POLYNOMIAL
0BB9   21 3B 26               LXI   H,TEMP4   ;POINT 2^(INT(X*LN2E))
0BBC   C3 10 17               JMP   FMUL   ;MULTIPLY,NORMALIZE AND RETURN
0BBF                             ; 
0BBF                             ; 
0BBF                ABS:      EQU   $   
0BBF                             ; 
0BBF                             ; 
0BBF                             ; RETURN THE ABSOLUTE VALUE OF THE FLOATING ACCUMULATOR
0BBF                             ; 
0BBF                             ; 
0BBF   3A 58 26               LDA   FACC   ;GET EXPONENT
0BC2   E6 7F                  ANI   7FH   ;STRIP NEGATIVE SIGN
0BC4   32 58 26               STA   FACC   ;REPLACE
0BC7   C9                     RET      ;RETURN
0BC8                             ; 
0BC8                SGN:      EQU   $   
0BC8                             ; 
0BC8                             ; 
0BC8                             ; RETURNS THE SIGN OF THE FLOATING ACCUMULATOR
0BC8                             ; THAT IS:
0BC8                             ;  1 IF FACC > 0
0BC8                             ;  0 IF FACC = 0
0BC8                             ; -1 IF FACC < 0
0BC8                             ; 
0BC8   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0BCB   C8                     RZ      ;RETURN IF ZERO
0BCC   E6 80                  ANI   80H   ;ISOLATE SIGN
0BCE   F6 01        SGN1:     ORI   1   ;CREATE EXPONENT
0BD0   F5                     PUSH   PSW   ;SAVE IT
0BD1   21 FE 1D               LXI   H,ONE   ;GET ADDRESS OF CONSTANT 1
0BD4   EF                     RST   5   ;GO LOAD IT
0BD5   F1                     POP   PSW   ;RESTORE SIGN
0BD6   32 58 26               STA   FACC   ;SET THE SIGN
0BD9   C9                     RET      ;RETURN
0BDA                             ; 
0BDA                INT:      EQU   $   
0BDA                             ; 
0BDA                             ; 
0BDA                             ; RETURNS THE GREATEST INTEGER NOT LARGER THAN VALUE IN FACC
0BDA                             ; E.G.:
0BDA                             ;    INT(3.14159) =  3
0BDA                             ;    INT(0)       =  0
0BDA                             ;    INT(-3.1415) = -4
0BDA                             ; 
0BDA                             ; 
0BDA   21 58 26               LXI   H,FACC   ;POINT FLOAT ACC
0BDD   7E                     MOV   A,M   ;GET EXPONENT
0BDE   E6 40                  ANI   40H   ;GET SIGN OF CHARACTERISTIC
0BE0   CA E8 0B               JZ   INT2   ;BRIF GE ZERO
0BE3   06 04                  MVI   B,4   ;LOOP CTR
0BE5   C3 64 1C               JMP   ZEROM   ;GO ZERO THE FACC
0BE8   7E           INT2:     MOV   A,M   ;GET EXPONENT AGAIN
0BE9   B7                     ORA   A   ;TEST SIGN
0BEA   F2 F7 0B               JP   INT3   ;BRIF POSITIVE OR ZERO
0BED   21 BE 1D               LXI   H,NEGON   ;POINT CONSTANT: -.9999999
0BF0   CD 2F 16               CALL   FADD   ;ADD TO FACC
0BF3   21 58 26               LXI   H,FACC   ;POINT EXPONTENT AGAIN
0BF6   7E                     MOV   A,M   ;LOAD IT
0BF7   E6 3F        INT3:     ANI   3FH   ;ISOLATE CHARACTERISTIC
0BF9   FE 18                  CPI   24   ;TEST IF ANY FRACTION
0BFB   F0                     RP      ;RETURN IF NOT
0BFC   47                     MOV   B,A   ;SAVE EXPONENT
0BFD   3E 18                  MVI   A,24   ;GET CONSTANT
0BFF   90                     SUB   B   ;MINUS EXPONENT = LOOP CTR
0C00   4F                     MOV   C,A   ;SAVE IT
0C01   21 59 26     INT4:     LXI   H,FACC+1   ;POINT MSB
0C04   AF                     XRA   A   ;CLEAR CY FLAG
0C05   06 03                  MVI   B,3   ;BYTE COUNT
0C07   7E           INT5:     MOV   A,M   ;LOAD A BYTE
0C08   1F                     RAR      ;SHIFT RIGHT
0C09   77                     MOV   M,A   ;REPLACE
0C0A   23                     INX   H   ;POINT NEXT
0C0B   05                     DCR   B   ;DECR BYTE CTR
0C0C   C2 07 0C               JNZ   INT5   ;LOOP
0C0F   0D                     DCR   C   ;DECR BIT CTR
0C10   C2 01 0C               JNZ   INT4   ;LOOP
0C13   21 58 26               LXI   H,FACC   ;POINT SIGN & EXP
0C16   7E                     MOV   A,M   ;LOAD IT
0C17   E6 80                  ANI   80H   ;ISOLATE SIGN
0C19   C6 18                  ADI   24   ;PLUS INTEGER
0C1B   77                     MOV   M,A   ;REPLACE IT
0C1C   C3 D5 16               JMP   FNORM   ;GO NORMALIZE & RETURN
0C1F                             ; 
0C1F                SQR:      EQU   $   
0C1F                             ; 
0C1F                             ; COMPUTE SQAURE ROOT OF ARG IN FACC, PUT RESULT IN FACC
0C1F                             ; 
0C1F                             ; USE HERON'S ITERATIVE PROCESS
0C1F                             ; 
0C1F   CD C6 18               CALL   FTEST   ;TEST THE ARGUMENT
0C22   C8                     RZ      ;RETURN IF ZERO
0C23   FA 0D 1C               JM   ZMERR   ;ERROR IF NEGATIVE
0C26   32 75 26               STA   DEXP   ;SAVE ORIG EXPONENT
0C29   AF                     XRA   A   ;GET A ZERO
0C2A   32 58 26               STA   FACC   ;PUT ARG IN RANGE [.5, 1]
0C2D   21 33 26               LXI   H,TEMP2   ;POINT SAVE AREA
0C30   DF                     RST   3   ;STORE IT
0C31                             ; 
0C31                             ; INITIAL APPROXIMATION 0.41730759 + 0.59016206 * MANTISSA
0C31                             ; 
0C31   21 C6 1D               LXI   H,SQC1   ;POINT .59016
0C34   CD 10 17               CALL   FMUL   ;GO MULTIPLY
0C37   21 CA 1D               LXI   H,SQC2   ;PINT .4173
0C3A   CD 2F 16               CALL   FADD   ;GO ADD
0C3D   21 2F 26               LXI   H,TEMP1   ;POINT SAVE AREA
0C40   DF                     RST   3   ;GO STORE IT
0C41                             ; 
0C41                             ; NEWTON'S METHOD OF ITERATION TO THE APPROXIMATE
0C41                             ; VALUE OF THE SQR OF MANTISSA
0C41                             ; 
0C41   CD 5C 0C               CALL   SQR1   ;FIRST ITERATION
0C44   21 2F 26               LXI   H,TEMP1   ;POINT SAVE AREA
0C47   DF                     RST   3   ;STORE IT
0C48   CD 5C 0C               CALL   SQR1   ;SECOND ITERATION
0C4B                             ; 
0C4B                             ; RESTORE RANGE TO OBTAIN THE FINAL RESULT
0C4B                             ; 
0C4B   3A 75 26               LDA   DEXP   ;GET SAVE EXPONENT
0C4E   CD D4 18               CALL   FEXP   ;EXPAND IT
0C51   1F                     RAR      ;DIVIDE BY 2
0C52   32 58 26               STA   FACC   ;STORE IT
0C55   D0                     RNC      ;RETURN IF EXPON EVEN
0C56   21 CE 1D               LXI   H,SQC3   ;ELSE, POINT SQR(2)
0C59   C3 10 17               JMP   FMUL   ;GO MULTIPLY AND RETURN
0C5C                             ; 
0C5C                             ; THIS ROUTINE PERFORMS ONE NEWTON ITERATION
0C5C                             ; TO THE SQUARE ROOT FUNCTION
0C5C                             ; 
0C5C   21 33 26     SQR1:     LXI   H,TEMP2   ;POINT MANTISSA
0C5F   EF                     RST   5   ;LOAD IT
0C60   21 2F 26               LXI   H,TEMP1   ;POINT PREV GUESS
0C63   CD 93 17               CALL   FDIV   ;FORM MANT/TEMP1
0C66   21 2F 26               LXI   H,TEMP1   ;POINT PREV
0C69   CD 2F 16               CALL   FADD   ;FORM TEMP1 + MANT/TEMP1
0C6C   D6 01                  SUI   1   ;DIVIDE BY 2
0C6E   32 58 26               STA   FACC   ;FORM (TEMP1 + MANT/TEMP1)/2
0C71   C9                     RET      ;RETURN
0C72                             ; 
0C72                NEG:      EQU   $   
0C72                             ; 
0C72                             ; 
0C72                             ; REVERSES THE SIGN OF THE FLOATING ACC
0C72                             ; 
0C72                             ; 
0C72   CD C6 18               CALL   FTEST   ;GET STATUS OF FACC
0C75   C8                     RZ      ;RETURN IF ZERO
0C76   EE 80                  XRI   80H   ;REVERSE SIGN
0C78   32 58 26               STA   FACC   ;RESTORE EXPONENT
0C7B   C9                     RET      ;CONTINUE EVALUATION
0C7C                             ; 
0C7C                RND:      EQU   $   
0C7C                             ; 
0C7C                             ; 
0C7C                             ; PSEUDO RANDOM NUMBER GENERATOR
0C7C                             ; 
0C7C                             ; 
0C7C   21 47 26               LXI   H,TEMP7   ;SAVE ARG
0C7F   DF                     RST   3   
0C80   06 04                  MVI   B,4   ;LOOP CTR
0C82   21 58 26               LXI   H,FACC   ;POINT FLOAT ACCUM
0C85   CD 64 1C               CALL   ZEROM   ;GO ZERO THE FACC
0C88   0E 03                  MVI   C,3   ;OUTTER LOP CTR
0C8A   21 59 26               LXI   H,FACC+1   ;POINT MSB
0C8D   E5                     PUSH   H   ;SAVE H,L
0C8E   21 7C 26     RND1:     LXI   H,RNDZ+1   ;POINT X,Y,Z
0C91   06 06                  MVI   B,6   ;LOOP CTR
0C93   B7                     ORA   A   ;TURN OFF CY
0C94   7E           RND2:     MOV   A,M   ;GET A BYTE
0C95   17                     RAL      ;SHIFT LEFT (MULT BY 2)
0C96   77                     MOV   M,A   ;REPLACE THE BYTE
0C97   2B                     DCX   H   ;POINT NEXT
0C98   05                     DCR   B   ;DECR CTR
0C99   C2 94 0C               JNZ   RND2   ;LOOP
0C9C   23                     INX   H   ;POINT MSD X,Y,Z
0C9D   11 73 1D               LXI   D,RNDP   ;POINT TO MODULO
0CA0   06 03                  MVI   B,3   ;LOOP CTR
0CA2   1A           FND3:     LDAX   D   ;GET BYTE OF P,Q,R
0CA3   BE                     CMP   M   ;COMPARE WITH X,Y,Z
0CA4   13                     INX   D   ;POINT NEXT
0CA5   23                     INX   H   ;DITTO
0CA6   DA B1 0C               JC   RND4   ;BRIF P<X
0CA9   C2 BD 0C               JNZ   RND5   ;BRIF P>X
0CAC   1A                     LDAX   D   ;GET LOW BYTE
0CAD   BE                     CMP   M   ;CMPARE
0CAE   D2 BD 0C               JNC   RND5   ;BRIF P>=X
0CB1   EB           RND4:     XCHG      ;FLIP D,E TO H,L
0CB2   1A                     LDAX   D   ;GET LOW X BYTE
0CB3   96                     SUB   M   ;SUBTRACT LOW P BYTE
0CB4   12                     STAX   D   ;STORE IT
0CB5   1B                     DCX   D   ;POINT HIGH
0CB6   2B                     DCX   H   ;DITTO
0CB7   1A                     LDAX   D   ;GET HIGH X BYTE
0CB8   9E                     SBB   M   ;SUB HIGH P BYTE
0CB9   12                     STAX   D   ;STORE IT
0CBA   13                     INX   D   ;POINT LOW
0CBB   23                     INX   H   ;DITTO
0CBC   EB                     XCHG      ;RESTORE ADDRS
0CBD   13           RND5:     INX   D   ;POINT NEXT
0CBE   23                     INX   H   ;DITTO
0CBF   05                     DCR   B   ;DECR CTR
0CC0   C2 A2 0C               JNZ   FND3   ;LOOP
0CC3   06 03                  MVI   B,3   ;LOOP CTR
0CC5   11 7E 26     RND6:     LXI   D,RNDS+1   ;POINT LOW S
0CC8   1A                     LDAX   D   ;GET LOW S
0CC9   86                     ADD   M   ;ADD LOW X,Y,Z
0CCA   12                     STAX   D   ;PUT S
0CCB   1B                     DCX   D   ;POINT HIGH
0CCC   2B                     DCX   H   ;DITTO
0CCD   1A                     LDAX   D   ;GET HIGH S
0CCE   8E                     ADC   M   ;ADD HIGH X,Y,Z
0CCF   E6 3F                  ANI   3FH   ;TURN OFF HIGH BITS
0CD1   12                     STAX   D   ;STORE IT
0CD2   2B                     DCX   H   ;POINT NEXT X,Y,Z
0CD3   05                     DCR   B   ;DECR CTR
0CD4   C2 C5 0C               JNZ   RND6   ;LOOP
0CD7   3E 08                  MVI   A,8   ;CONSTANT
0CD9   91                     SUB   C   ;LESS CTR
0CDA   1F                     RAR      ;DIVIDE BY TWO
0CDB   E1                     POP   H   ;GET H,L ADDR
0CDC   3A 7E 26               LDA   RNDS+1   ;GET LSB OF S
0CDF   77                     MOV   M,A   ;STORE IT
0CE0   23                     INX   H   ;POINT NEXT
0CE1   E5                     PUSH   H   ;SAVE H,L
0CE2   0D                     DCR   C   ;DECR CTR
0CE3   C2 8E 0C               JNZ   RND1   ;LOOP
0CE6   E1                     POP   H   ;RESTORE SP PTR
0CE7   3A 87 26               LDA   RNDSW   ;GET SWITCH
0CEA   B7                     ORA   A   ;TEST IT
0CEB   CA F9 0C               JZ   RND7   ;BRIF NO RANDOMIZE
0CEE   11 7F 26               LXI   D,TRNDX   ;POINT SAVED VALUES
0CF1   21 77 26               LXI   H,RNDX   ;POINT NEXT VALUES
0CF4   06 08                  MVI   B,8   ;LOOP CTR
0CF6   CD 5E 1C               CALL   COPYH   ;GO COPY
0CF9   CD D5 16     RND7:     CALL   FNORM   
0CFC   21 47 26               LXI   H,TEMP7   ;MULTIPLY BY RANGE
0CFF   C3 10 17               JMP   FMUL   
0D02                             ; 
0D02                INP:      EQU   $   
0D02                             ; 
0D02                             ; 
0D02                             ; INPUT A BYTE FROM THE DEVICE IN FACC
0D02                             ; 
0D02                             ; PUT THE RESULT IN THE FACC
0D02                             ; 
0D02   CD 6C 1C               CALL   FBIN   ;CONVERT FACC TO BINARY
0D05   21 20 26               LXI   H,OUTA   ;POINT INSTR BUFFER
0D08   36 DB                  MVI   M,0DBH   ;IN INSTR
0D0A   23                     INX   H   ;POINT NEXT
0D0B   77                     MOV   M,A   ;MOVE ADDR
0D0C   23                     INX   H   ;POINT NEXT
0D0D   36 C9                  MVI   M,0C9H   ;RET INSTR
0D0F   CD 20 26               CALL   OUTA   ;GO INPUT A BYTE
0D12   5F           FDEC:     MOV   E,A   ;MOVE BYTE TO LO D,E
0D13   16 00                  MVI   D,0   ;ZERO HI D,E
0D15   C3 8F 1C               JMP   BINFL   ;GO CONVERT TO DEC & RET
0D18                             ; 
0D18                POS:      EQU   $   
0D18                             ; 
0D18                             ; 
0D18                             ; RETURNS THE CURRENT POSITION OF THE TTY CURSOR
0D18                             ; 
0D18                             ; 
0D18   3A 76 26               LDA   COLUM   ;GET POSITION
0D1B   C3 12 0D               JMP   FDEC   ;CONVERT TO FLOAT AND RETURN
0D1E                             ; 
0D1E                CONCA:    EQU   $   
0D1E                             ; 
0D1E                             ; 
0D1E                             ; CONCATONATE TWO STRING TOGETHER
0D1E                             ; COMBINE LENGTH <= 255
0D1E                             ; 
0D1E   D1                     POP   D   ;ADJUST STACK
0D1F   11 20 25               LXI   D,STRIN   ;POINT STRING BUFFER
0D22   1A                     LDAX   D   ;GET CURRENT LENGTH
0D23   4F                     MOV   C,A   ;STORE IT
0D24   06 00                  MVI   B,0   ;CLEAR HI
0D26   EB                     XCHG      ;FLIP FLOP
0D27   09                     DAD   B   ;COMPUTE NEXT
0D28   EB                     XCHG      ;FLIP BACK
0D29   86                     ADD   M   ;COMPUTE COMBINE LENGTH
0D2A   46                     MOV   B,M   ;SAVE LEN2
0D2B   D2 34 0D               JNC   CONC2   ;BRIF NO OVFLW
0D2E   3E FF                  MVI   A,255   ;MAX LEN
0D30   91                     SUB   C   ;MINUS 1ST PART
0D31   47                     MOV   B,A   ;SAVE LEN
0D32   3E FF                  MVI   A,255   ;UPDATED LENGTH
0D34   32 20 25     CONC2:    STA   STRIN   ;STORE IT
0D37   78                     MOV   A,B   ;GET LEN TO MOVE
0D38   B7                     ORA   A   ;TEST IT
0D39   CA 44 0D               JZ   CONC4   ;BRIF NULL
0D3C   23           CONC3:    INX   H   ;POINT NEXT
0D3D   13                     INX   D   ;DITTO
0D3E   7E                     MOV   A,M   ;GET NEXT CHAR
0D3F   12                     STAX   D   ;PUT IT
0D40   05                     DCR   B   ;DECR COUNT
0D41   C2 3C 0D               JNZ   CONC3   ;LOOP
0D44   E1           CONC4:    POP   H   ;GET H,L
0D45   2B                     DCX   H   ;POINT BACK
0D46   3A 20 25               LDA   STRIN   ;GET LEN
0D49   1F                     RAR      ;DIVIDE BY TWO
0D4A   3C                     INR   A   ;PLUS ONE
0D4B   EB                     XCHG      ;SAVE H,L
0D4C   2A 69 26               LHLD   SPCTR   ;GET CTR
0D4F   4F                     MOV   C,A   ;SAVE CTR
0D50   06 00                  MVI   B,0   ;ZERO HI BYTE
0D52   09                     DAD   B   ;ADD LEN THIS STRING
0D53   22 69 26               SHLD   SPCTR   ;SAVE CTR
0D56   C1                     POP   B   
0D57   21 00 00               LXI   H,0   ;GET ADDR ZERO
0D5A   E5           CONC5:    PUSH   H   ;2 BYTE WORD
0D5B   3D                     DCR   A   ;DECR CTR
0D5C   C2 5A 0D               JNZ   CONC5   ;CONTINUE
0D5F   39                     DAD   SP   ;GET ADDRESS IN H,L
0D60   EB                     XCHG      ;PUT STACK PTR IN D,E
0D61   72                     MOV   M,D   ;MOVE HI ADDR
0D62   23                     INX   H   ;POINT NEXT
0D63   73                     MOV   M,E   ;MOVE LO ADDR
0D64   23                     INX   H   ;POINT NEXT
0D65   36 E7                  MVI   M,0E7H   ;TYPE=STRING
0D67   E5                     PUSH   H   ;SAVE H,L
0D68   21 20 25               LXI   H,STRIN   ;GET TEMP STR
0D6B   7E                     MOV   A,M   ;GET LENGTH
0D6C   3C                     INR   A   ;PLUS ONE
0D6D   4F                     MOV   C,A   ;SAVE IT
0D6E   7E           CONC6:    MOV   A,M   ;GET A BYTE
0D6F   12                     STAX   D   ;PUT IT DOWN
0D70   13                     INX   D   ;POINT NEXT
0D71   23                     INX   H   ;DITTO
0D72   0D                     DCR   C   ;SUBT CTR
0D73   C2 6E 0D               JNZ   CONC6   ;LOOP
0D76   E1                     POP   H   ;RESTORE H,L
0D77   E7                     RST   4   ;ADJUST H,L
0D78   F9                     DB   -7   ; AND 0FFH
0D79   3E 04                  MVI   A,4   ;DELETE 4 BYTES
0D7B   CD E8 1A               CALL   SQUIS   ;GO COMPRESS
0D7E   C3 B2 11               JMP   EVAL   ;CONTINUE EVALUATION
0D81                             ; 
0D81                LENFN:    EQU   $   
0D81                             ; 
0D81                             ; X=LEN(A$)
0D81                             ; 
0D81                             ; RETURN THE LENGTH OF THE STRING
0D81                             ; 
0D81   3A 20 25               LDA   STRIN   ;GET LEN IN ACC
0D84   C3 12 0D               JMP   FDEC   ;GO CONVERT TO DECIMAL & RETURN
0D87                             ; 
0D87                CHRFN:    EQU   $   
0D87                             ; 
0D87                             ; A$=CHR$(X)
0D87                             ; 
0D87                             ; RETURNS A ONE CHAR STRING HAVING THE ASCII VALUE - X
0D87                             ; 
0D87   CD 6C 1C               CALL   FBIN   ;CONVERT FACC TO BINARY
0D8A   21 20 25               LXI   H,STRIN   ;POINT OUT AREA
0D8D   36 01                  MVI   M,1   ;LEN=1
0D8F   23                     INX   H   ;POINT NEXT
0D90   77                     MOV   M,A   ;STORE THE CHAR
0D91   C9                     RET      ;RETURN
0D92                             ; 
0D92                ASCII:    EQU   $   
0D92                             ; 
0D92                             ; X=ASCII(A$)
0D92                             ; 
0D92                             ; RETURNS THE ASCII VALUE OF THE FIRST CHAR IN STRING
0D92                             ; 
0D92   21 20 25               LXI   H,STRIN   ;POINT STRING
0D95   7E                     MOV   A,M   ;GET LENGTH
0D96   B7                     ORA   A   ;TEST IF > ZERO
0D97   CA 12 0D               JZ   FDEC   ;BRIF ZERO & RETURN A ZERO
0D9A   23                     INX   H   ;POINT 1ST CHAR
0D9B   7E                     MOV   A,M   ;LOAD IT
0D9C   C3 12 0D               JMP   FDEC   ;GO CONVERT TO DECIMAL & RETURN
0D9F                             ; 
0D9F                NUMFN:    EQU   $   
0D9F                             ; 
0D9F                             ; A$=NUM$(X)
0D9F                             ; 
0D9F                             ; RETURNS A STRING REPRESENTING X AS IT WOULD HAVE
0D9F                             ; BEEN PRINTED (INCLUDING TRAILING SPACE)
0D9F                             ; 
0D9F   21 20 25               LXI   H,STRIN   ;POINT STRING AREA
0DA2   36 00                  MVI   M,0   ;INIT COUNT
0DA4   23                     INX   H   ;SKIP TO 1ST POSITION
0DA5   CD E8 14               CALL   FOUT   ;GO CONVERT TO EXTRN DEC
0DA8   AF                     XRA   A   ;GET A ZERO
0DA9   47                     MOV   B,A   ;INIT CTR
0DAA   2B           NUM1:     DCX   H   ;POINT PRIOR
0DAB   04                     INR   B   ;COUNT IT
0DAC   BE                     CMP   M   ;TEST IF ZERO
0DAD   C2 AA 0D               JNZ   NUM1   ;LOOP TILL AT START
0DB0   70                     MOV   M,B   ;SET LEN CODE
0DB1   C9                     RET      ;THEN RETURN
0DB2                             ; 
0DB2                VAL:      EQU   $   
0DB2                             ; 
0DB2                             ; X = VAL(A$)
0DB2                             ; 
0DB2                             ; RETURNS THE VALUE OF THE STRING OF NUMERIC CHARACTERS
0DB2                             ; 
0DB2   21 20 25               LXI   H,STRIN   ;POINT STRING AREA
0DB5   7E                     MOV   A,M   ;GET LEN
0DB6   B7                     ORA   A   ;TEST FOR NULL STRING
0DB7   47                     MOV   B,A   ;SAVE LEN
0DB8   CA 12 0D               JZ   FDEC   ;BRIF IS (RETURNS A 0.00)
0DBB   11 20 25               LXI   D,STRIN   ;POINT BUFFER
0DBE   23           VAL1:     INX   H   ;POINT NEXT
0DBF   7E                     MOV   A,M   ;GET A CHAR
0DC0   FE 20                  CPI   " "   ;TEST IF SPACE
0DC2   CA C7 0D               JZ   VAL2   ;BRIF IS
0DC5   12                     STAX   D   ;PUT THE CHAR
0DC6   13                     INX   D   ;INCR ADDR
0DC7   05           VAL2:     DCR   B   ;DECR CTR
0DC8   C2 BE 0D               JNZ   VAL1   ;LOOP
0DCB   AF                     XRA   A   ;GET A ZERO
0DCC   12                     STAX   D   ;PUT IN BUFF
0DCD   21 20 25               LXI   H,STRIN   ;POINT START OF BUFFER
0DD0   CD 26 14               CALL   FIN   ;GO CONVERT
0DD3   7E                     MOV   A,M   ;GET NON-NUMERIC
0DD4   B7                     ORA   A   ;TEST IT
0DD5   C2 25 1C               JNZ   CVERR   ;BRIF ERROR
0DD8   C9                     RET      ;ELSE, RETURN
0DD9                             ; 
0DD9                SPACE:    EQU   $   
0DD9                             ; 
0DD9                             ; A$=SPACE$(X)
0DD9                             ; 
0DD9                             ; CREATES A STRING FO SPACES LENGTH = X
0DD9                             ; 
0DD9   CD 6C 1C               CALL   FBIN   ;GET BINARY LENGTH
0DDC   21 20 25               LXI   H,STRIN   ;POINT TEMP STRING
0DDF   77                     MOV   M,A   ;PUT LEN
0DE0   B7                     ORA   A   ;TEST IT
0DE1   C8           SPAC1:    RZ      ;RETURN IF ZERO
0DE2   23                     INX   H   ;ELSE, POINT NEXT
0DE3   36 20                  MVI   M," "   ;MOVE 1 SPACE
0DE5   3D                     DCR   A   ;DECR CTR
0DE6   C3 E1 0D               JMP   SPAC1   ;LOOP
0DE9                             ; 
0DE9                STRFN:    EQU   $   
0DE9                             ; 
0DE9                             ; A$=STRING$(X,Y)
0DE9                             ; 
0DE9                             ; CREATES STRING OF LNGTH X CONTAINING REPETITION OF CHR$(Y)
0DE9                             ; 
0DE9   CD 6C 1C               CALL   FBIN   ;GET BINARY LENGTH
0DEC   32 20 25               STA   STRIN   ;PUT TO STRING
0DEF   CD 89 1C               CALL   ARGNU   ;GET NEXT ARGUMENT
0DF2   21 20 25               LXI   H,STRIN   ;POINT STRING
0DF5   46                     MOV   B,M   ;GET COUNT
0DF6   23           STR11:    INX   H   ;POINT NEXT
0DF7   77                     MOV   M,A   ;STORE THE CHAR
0DF8   05                     DCR   B   ;DECR CTR
0DF9   C2 F6 0D               JNZ   STR11   ;LOOP
0DFC   C9                     RET      ;RETURN
0DFD                             ; 
0DFD                LEFT:     EQU   $   
0DFD                             ; 
0DFD                             ; B$=LEFT$(A$,X)
0DFD                             ; 
0DFD                             ; SUBSTRING FROM THE LEFTMOST X CHARACTERS OF A$
0DFD                             ; 
0DFD   CD 89 1C               CALL   ARGNU   ;GET 2ND ARGUMENT
0E00   4F                     MOV   C,A   ;SAVE LEN
0E01   06 01                  MVI   B,1   ;INIT START
0E03   C3 19 0E               JMP   MID0   ;CONTINUE
0E06                             ; 
0E06                RIGHT:    EQU   $   
0E06                             ; 
0E06                             ; B$=RIGHT$(A$,X)
0E06                             ; 
0E06                             ; SUBSTRING STARTING AT POSITION X TO END OF STRING
0E06                             ; 
0E06   CD 89 1C               CALL   ARGNU   ;GET 2ND ARGUMENT
0E09   47                     MOV   B,A   ;SAVE START
0E0A   0E FF                  MVI   C,255   ;MAX LEN
0E0C   C3 19 0E               JMP   MID0   ;CONTINUE
0E0F                             ; 
0E0F                MIDFN:    EQU   $   
0E0F                             ; 
0E0F                             ; B$=MID$(A$,X,Y)
0E0F                             ; 
0E0F                             ; SUBSTRING OF THE STRING A$ STARTING WITH CHARACTER @ X
0E0F                             ; AND Y CHARACTERS LONG
0E0F                             ; 
0E0F   CD 89 1C               CALL   ARGNU   ;LOAD X
0E12   47                     MOV   B,A   ;SAVE START
0E13   C5                     PUSH   B   ;PUT ON STACK
0E14   CD 89 1C               CALL   ARGNU   ;GET 3RD ARG
0E17   C1                     POP   B   ;RETREIVE
0E18   4F                     MOV   C,A   ;SAVE LEN
0E19   78           MID0:     MOV   A,B   ;LOAD START
0E1A   21 20 25               LXI   H,STRIN   ;POINT STRING
0E1D   BE                     CMP   M   ;TEST IF X>L
0E1E   DA 27 0E               JC   MID1   ;BRIF X>L
0E21   CA 27 0E               JZ   MID1   ;OR EQUAL
0E24   36 00                  MVI   M,0   ;ELSE, RESULT IS NULL
0E26   C9                     RET      ;RETURN
0E27   81           MID1:     ADD   C   ;COMPUTE END POSITION
0E28   DA 34 0E               JC   MID2   ;BRIF OVERFLOW
0E2B   DE 01                  SBI   1   ;COMPUTE X+Y-1
0E2D   DA 34 0E               JC   MID2   ;BRIF OVERFLOW
0E30   BE                     CMP   M   ;COMPARE TO EXISTING LEN
0E31   DA 38 0E               JC   MID3   ;BRIF X+Y-1<LEN(A$)
0E34   7E           MID2:     MOV   A,M   ;ELSE GET ORIG LEN
0E35   90                     SUB   B   ;MINUS X
0E36   3C                     INR   A   ;PLUS ONE
0E37   4F                     MOV   C,A   ;SAVE (REPLACE Y)
0E38   71           MID3:     MOV   M,C   ;PUT NEW LEN
0E39   58                     MOV   E,B   ;PUT START IN LO
0E3A   16 00                  MVI   D,0   ;ZERO IN HI
0E3C   19                     DAD   D   ;COMPUTE START
0E3D   11 20 25               LXI   D,STRIN   ;GET BEGIN
0E40   7E           MID4:     MOV   A,M   ;GET A CHAR
0E41   13                     INX   D   ;POINT NEXT
0E42   23                     INX   H   ;DITTO
0E43   12                     STAX   D   ;PUT DOWN
0E44   0D                     DCR   C   ;DECR CTR
0E45   C2 40 0E               JNZ   MID4   ;LOOP
0E48   C9                     RET      ;THEN RETURN
0E49                             ; 
0E49                INSTR:    EQU   $   
0E49                             ; 
0E49                             ; X = INSTR(Y,A$,B$)
0E49                             ; 
0E49                             ; SEARCH FOR SUBSTRING B$ IN STRING A$ STARTING AT POS Y.
0E49                             ; RETURN 0 IF B$ IS NOT IN A$
0E49                             ; RETURN 1 IF B$ IS NULL
0E49                             ; ELSE RETURN THE CHARACTER POSITION
0E49                             ; 
0E49   CD 89 1C               CALL   ARGNU   ;GET A$
0E4C   21 20 25               LXI   H,STRIN   ;POINT A$
0E4F   B7                     ORA   A   ;TEST Y
0E50   C2 58 0E               JNZ   INST2   ;BRIF Y NOT ZERO
0E53   36 00        INST1:    MVI   M,0   ;ELSE A$ IS NULL
0E55   C3 5F 0E               JMP   INST3   ;GO AROUND
0E58   BE           INST2:    CMP   M   ;TEST Y TO LEN(A$)
0E59   CA 5F 0E               JZ   INST3   ;BRIF EQUAL
0E5C   D2 53 0E               JNC   INST1   ;BRIF Y > LEN(A$)
0E5F   4F           INST3:    MOV   C,A   ;SAVE Y
0E60   06 00                  MVI   B,0   ;ZERO HI INCR
0E62   7E                     MOV   A,M   ;GET LEN(A$)
0E63   91                     SUB   C   ;MINUS Y
0E64   3C                     INR   A   ;PLUS ONE
0E65   09                     DAD   B   ;COMPUTE START ADDR
0E66   47                     MOV   B,A   ;# CHARS REMAIN IN A$
0E67   E5                     PUSH   H   ;SAVE ADDR
0E68   2A 52 26               LHLD   ADDR1   ;GET ADDR OF ARG
0E6B   23                     INX   H   ;POINT NEXT
0E6C   56                     MOV   D,M   ;GET HI ADDR
0E6D   23                     INX   H   ;POINT NEXT
0E6E   5E                     MOV   E,M   ;GET LO ADDR
0E6F   23                     INX   H   ;POINT NEXT
0E70   22 52 26               SHLD   ADDR1   ;UPDATED PTR
0E73   E1                     POP   H   ;RESTORE ADDR
0E74   1A                     LDAX   D   ;GET LEN(B$)
0E75   B7                     ORA   A   ;TEST IF NULL
0E76   C2 7F 0E               JNZ   INST6   ;BRIF NOT
0E79   0E 01                  MVI   C,1   ;SET POSIT = 1
0E7B   79           INST5:    MOV   A,C   ;GET POSIT
0E7C   C3 12 0D               JMP   FDEC   ;CONVERT TO DECIMAL & RETURN
0E7F   EB           INST6:    XCHG      ;FLIP/FLOP
0E80   78                     MOV   A,B   ;GET LEN OF A$
0E81   BE                     CMP   M   ;COMPARE TO LEN B$
0E82   DA A4 0E               JC   INSTA   ;BRIF LEN(B$)< LEN(REM A$)
0E85   C5                     PUSH   B   ;SAVE CTR, POSIT
0E86   D5                     PUSH   D   ;SAVE ADDR A$
0E87   E5                     PUSH   H   ;SAVE ADDR B$
0E88   4E                     MOV   C,M   ;GET LEN B$
0E89   EB                     XCHG      ;FLIP/FLOP
0E8A   13           INST8:    INX   D   ;POINT NEXT B$
0E8B   1A                     LDAX   D   ;GET B$ CHAR
0E8C   BE                     CMP   M   ;COMPARE A$ CHAR
0E8D   C2 9B 0E               JNZ   INST9   ;BRIF NOT EQUAL
0E90   23                     INX   H   ;POINT NEXT A$
0E91   0D                     DCR   C   ;DECR CTR (LEN(B$))
0E92   C2 8A 0E               JNZ   INST8   ;LOOP
0E95   E1                     POP   H   ;DUMMY POP
0E96   E1                     POP   H   ;GET DUMMY STACK
0E97   C1                     POP   B   ;GET POSITION
0E98   C3 7B 0E               JMP   INST5   ;WE FOUND A MATCH
0E9B   D1           INST9:    POP   D   ;GET PTR B$
0E9C   E1                     POP   H   ;GET PTR A$
0E9D   C1                     POP   B   ;GET CTRS, POSIT
0E9E   0C                     INR   C   ;UP PTR NUM
0E9F   23                     INX   H   ;POINT NEXT A$
0EA0   05                     DCR   B   ;DECR B
0EA1   C2 7F 0E               JNZ   INST6   ;LOOP
0EA4   0E 00        INSTA:    MVI   C,0   ;ELSE B$ NOT IN A$
0EA6   C3 7B 0E               JMP   INST5   ;RETURN
0EA9                             ; 
0EA9                FN:       EQU   $   
0EA9                             ; 
0EA9                             ; STMT: DEF FNX(A)=EXPR
0EA9                             ; 
0EA9                             ; NOTE: ENTRY FROM EXPR ANALYZER (RECURSIVE)
0EA9                             ; 
0EA9   C5                     PUSH   B   ;SAVE B,C
0EAA   D5                     PUSH   D   ;SAVE D,E
0EAB   E5                     PUSH   H   ;SAVE H,L
0EAC   EB                     XCHG      ;PUT H,L TO D,E
0EAD   2A 56 26               LHLD   ADDR3   ;GET ADDR
0EB0   E5                     PUSH   H   ;SAVE IT
0EB1   EB                     XCHG      ;PUT D,E BACK TO H,L
0EB2   22 56 26               SHLD   ADDR3   ;UPDATE PTR
0EB5   2A 69 26               LHLD   SPCTR   ;GET SP COUNT
0EB8   E5                     PUSH   H   ;SAVE IT
0EB9   3A 68 26               LDA   PARCT   ;GET PAREN COUNT
0EBC   47                     MOV   B,A   ;PUT TO B
0EBD   3A 88 26               LDA   FNMOD   ;GET FN MODE
0EC0   4F                     MOV   C,A   ;PUT TO C
0EC1   C5                     PUSH   B   ;SAVE B,C
0EC2   3A 72 24               LDA   DIMSW   ;GET DIM SW
0EC5   F5                     PUSH   PSW   ;SAVE IT
0EC6   AF                     XRA   A   ;CLEAR A
0EC7   32 72 24               STA   DIMSW   ;RESET DIM SW
0ECA   2A 6C 26               LHLD   FNARG   ;GET OLD ARG NAME
0ECD   E5                     PUSH   H   ;SAVE
0ECE   2A 6E 26               LHLD   FNARG+2   ;GET OLD ARG ADDRESS
0ED1   E5                     PUSH   H   ;SAVE
0ED2   2A 93 26               LHLD   PROGE   ;GET END OF PROGRAM
0ED5   E5                     PUSH   H   ;SAVE IT
0ED6   2A 50 26               LHLD   EXPRS   ;GET END OF EXPR
0ED9   E5                     PUSH   H   ;SAVE IT
0EDA   22 93 26               SHLD   PROGE   ;SAVE NEW "END" OF PROGRAM
0EDD   3E 01                  MVI   A,1   ;GET ON SETTING
0EDF   32 88 26               STA   FNMOD   ;SET IN FUNCTION
0EE2   2A 56 26               LHLD   ADDR3   ;POINT TO EXPR
0EE5   4E                     MOV   C,M   ;GET FN CHAR
0EE6   2B                     DCX   H   ;POINT BACK
0EE7   46                     MOV   B,M   ;GET HI NAME
0EE8   21 96 26               LXI   H,BEGPR   ;POINT START OF PROGRAM
0EEB   7E           FN2:      MOV   A,M   ;LOAD LEN TO NEXT STMT
0EEC   B7                     ORA   A   ;TEST IF AT END
0EED   CA 15 1C               JZ   SNERR   ;BRIF FN NOT FOUND
0EF0   E5                     PUSH   H   ;SAVE PTR
0EF1   E7                     RST   4   ;ADJUST H,L
0EF2   03                     DB   3   
0EF3   11 32 1F               LXI   D,DEFLI   ;LITERAL
0EF6   D7                     RST   2   ;GO COMPARE
0EF7   C2 09 0F               JNZ   FN3   ;BRIF NOT EQUAL
0EFA   C5                     PUSH   B   ;SAVE TEST NAME
0EFB   CD CF 1B               CALL   VAR   ;GO GET NAME
0EFE   C1                     POP   B   ;RESTORE NAME
0EFF   7A                     MOV   A,D   ;GET HI NAME
0F00   B8                     CMP   B   ;COMPARE
0F01   C2 09 0F               JNZ   FN3   ;BRIF NOT EQUAL
0F04   7B                     MOV   A,E   ;GET LO
0F05   B9                     CMP   C   ;COMPARE
0F06   CA 11 0F               JZ   FN4   ;BRIF EQUAL
0F09   E1           FN3:      POP   H   ;GET OLD PTR
0F0A   5E                     MOV   E,M   ;GET LO LEN
0F0B   16 00                  MVI   D,0   ;ZERO HI LEN
0F0D   19                     DAD   D   ;POINT NEXT STMT
0F0E   C3 EB 0E               JMP   FN2   ;LOOP
0F11   D1           FN4:      POP   D   ;ADJUST STACK
0F12   CF                     RST   1   ;SKIP BLANKS
0F13   FE 28                  CPI   "("   ;TEST IF OPEN PAREN
0F15   C2 15 1C               JNZ   SNERR   ;BRIF NOT
0F18   23                     INX   H   ;SKIP IT
0F19   CD CF 1B               CALL   VAR   ;GO GET VAR NAME
0F1C   E5                     PUSH   H   ;SAVE HL ADDR
0F1D   21 6C 26               LXI   H,FNARG   ;POINT DUMMY ARG TBL
0F20   72                     MOV   M,D   ;STORE LETTER
0F21   23                     INX   H   ;POINT NEXT
0F22   73                     MOV   M,E   ;STORE DIGIT
0F23   23                     INX   H   ;POINT NEXT
0F24   EB                     XCHG      ;PUT H,L TO D,E
0F25   2A 56 26               LHLD   ADDR3   ;POINT TO EXPR STACK
0F28   23                     INX   H   ;POINT CODE
0F29   23                     INX   H   ;POINT HI ADR
0F2A   7E                     MOV   A,M   ;GET HI
0F2B   12                     STAX   D   ;PUT TO TABLE
0F2C   13                     INX   D   ;POINT NEXT
0F2D   23                     INX   H   ;DITTO
0F2E   7E                     MOV   A,M   ;GET LO ADDR
0F2F   12                     STAX   D   ;PUT TO TABLE
0F30   E1                     POP   H   ;RESTORE PTR TO STMT
0F31   CF                     RST   1   ;SKIP BLANKS
0F32   FE 29                  CPI   ")"   ;TEST IF CLOSE PAREN
0F34   C2 15 1C               JNZ   SNERR   ;BRIF NOT
0F37   23                     INX   H   ;SKIP IT
0F38   CF                     RST   1   ;SKIP BLANKS
0F39   FE 3D                  CPI   "="   ;TEST IF EQUAL SIGN
0F3B   C2 15 1C               JNZ   SNERR   ;BRIF NOT
0F3E   23                     INX   H   ;SKIP IT
0F3F   CD 78 0F               CALL   EXPR   ;GO EVAL FUNCTION
0F42   CD 9A 1A               CALL   EOL   ;MUST BE END OF LINE
0F45   E1                     POP   H   ;GET H,L
0F46   22 50 26               SHLD   EXPRS   ;RESTORE START OF EXPR
0F49   E1                     POP   H   ;GET H,L
0F4A   22 93 26               SHLD   PROGE   ;RESTORE "END" OF PROGRAM
0F4D   E1                     POP   H   ;GET H,L
0F4E   22 6E 26               SHLD   FNARG+2   ;STORE ADDR
0F51   E1                     POP   H   ;GET H,L
0F52   22 6C 26               SHLD   FNARG   ;STORE DUMMY ARG
0F55   F1                     POP   PSW   ;GET A,STATUS
0F56   32 72 24               STA   DIMSW   ;RESTORE DIM SW
0F59   C1                     POP   B   ;GET B,C
0F5A   79                     MOV   A,C   ;LOAD C
0F5B   32 88 26               STA   FNMOD   ;RESTORE MOE
0F5E   78                     MOV   A,B   ;LOAD B
0F5F   32 68 26               STA   PARCT   ;RESTORE PAREN COUNT
0F62   E1                     POP   H   ;GET H,L
0F63   22 69 26               SHLD   SPCTR   ;RESTORE SP COUNTER
0F66   E1                     POP   H   ;GET H,L
0F67   22 56 26               SHLD   ADDR3   ;RESTORE ADDR OF EVAL
0F6A   E1                     POP   H   ;GET H,L
0F6B   D1                     POP   D   ;GET D,E
0F6C   2B                     DCX   H   ;POINT 2ND BYTE FOLLOWING OP
0F6D   22 54 26               SHLD   ADDR2   ;SAVE IT
0F70   E7                     RST   4   ;POINT TO ARG TYPE
0F71   05                     DB   5   
0F72   22 52 26               SHLD   ADDR1   ;SAVE ADDR
0F75   C3 FF 11               JMP   EV3   ;GO WRAPUP
0F78                             ;PAGE
0F78                             ; 
0F78                EXPR:     EQU   $   
0F78                             ; 
0F78                             ; 
0F78                             ; EVALUATE EXPRESSION ROUTINE
0F78                             ; LEAVE RESULT IN FACC
0F78                             ; RETURN WHEN EXPRESSION ENDS (TYPICALLY AT END OF LINE)
0F78                             ; 
0F78                             ; 
0F78   AF                     XRA   A   ;CLEAR REG A
0F79   32 68 26               STA   PARCT   ;SET PAREN CTR
0F7C   EB                     XCHG      ;SAVE H,L
0F7D   21 00 00               LXI   H,0   ;GET A ZERO
0F80   22 69 26               SHLD   SPCTR   ;INIT CTR
0F83   2A 93 26               LHLD   PROGE   ;POINT END OF PROGRAM AREA
0F86   23                     INX   H   ;POINT ONE MORE
0F87   36 00                  MVI   M,0   ;INIT START OF STACK
0F89   22 50 26               SHLD   EXPRS   ;SAVE IT
0F8C   EB                     XCHG      ;RESTORE H,L
0F8D                             ; 
0F8D                LOOKD:    EQU   $   ;LOOK FOR CON, VAR, OR FUNCTION
0F8D   CF                     RST   1   ;SKIP TO NON-BLANK
0F8E   CD 30 1B               CALL   NUMER   ;GO TEST IF NUMERIC
0F91   C2 A7 0F               JNZ   LDALP   ;BRIF NOT
0F94   CD 26 14     LDNUM:    CALL   FIN   ;GO CONVERT NUMERIC (PUT TO FACC)
0F97   44           LDF:      MOV   B,H   ;COPY H,L TO B,C
0F98   4D                     MOV   C,L   ;SAME
0F99   2A 50 26               LHLD   EXPRS   ;GET ADDR OF EXPR AREA
0F9C   CD 06 1B               CALL   GTEMP   ;GO STORE THE FACC IN TEMP AREA
0F9F   22 50 26               SHLD   EXPRS   ;SAVE UPDATED ADDRESS
0FA2   60                     MOV   H,B   ;RESTORE H
0FA3   69                     MOV   L,C   ;RESTORE L
0FA4   C3 15 11               JMP   LOOKO   ;GO GET AN OPERATION CODE
0FA7   FE 2E        LDALP:    CPI   "."   ;SEE IF LEADING DECIMAL POINT
0FA9   CA 94 0F               JZ   LDNUM   ;BRIF IS
0FAC   CD 27 1B               CALL   ALPHA   ;GO SEE IF ALPHA
0FAF   C2 89 10               JNZ   LDDTN   ;BRIF NOT
0FB2   46                     MOV   B,M   ;SAVE 1ST CHAR
0FB3   23                     INX   H   ;POINT NEXT
0FB4   0E 20                  MVI   C," "   ;DEFAULT FOR 1 CHAR VAR
0FB6   CD 30 1B               CALL   NUMER   ;GO SEE IF 2ND IS NUMERIC
0FB9   C2 EC 0F               JNZ   LDFN   ;BRIF NOT
0FBC   23                     INX   H   ;POINT NEXT
0FBD   4F                     MOV   C,A   ;SAVE THE CHAR
0FBE   CF           LDV1:     RST   1   ;GET NEXT CHAR
0FBF   FE 24                  CPI   "$"   ;TEST IF STRING
0FC1   F5                     PUSH   PSW   ;SAVE STATUS
0FC2   C2 CB 0F               JNZ   LDV2   ;BRIF NOT
0FC5   79                     MOV   A,C   ;GET LOW CHAR
0FC6   F6 80                  ORI   80H   ;SET STRING
0FC8   4F                     MOV   C,A   ;SAVE IT
0FC9   23                     INX   H   ;SKIP $
0FCA   CF                     RST   1   ;SKIP SPACES
0FCB   FE 28        LDV2:     CPI   "("   ;TEST IF PAREN
0FCD   CA CF 13               JZ   LDV2A   ;BRIF IS
0FD0   E5                     PUSH   H   ;SAVE H,L
0FD1   50                     MOV   D,B   ;COPY B,C
0FD2   59                     MOV   E,C   ;TO D,E
0FD3   CD 3A 1B               CALL   SEARC   ;GO GET VAR ADDR IN D,E
0FD6   2A 50 26     LDV:      LHLD   EXPRS   ;GET EXPR ADDR
0FD9   CD 1F 1B               CALL   SADR   ;GO STORE ADDRESS
0FDC   22 50 26               SHLD   EXPRS   ;SAVE ADDRESS
0FDF   EB                     XCHG      ;H,L TO D,E
0FE0   E1                     POP   H   ;GET OLD H,L
0FE1   F1                     POP   PSW   ;GET STATUS
0FE2   C2 15 11               JNZ   LOOKO   ;BRIF NOT STRING
0FE5   EB                     XCHG      ;GET OLD H,L
0FE6   36 E7                  MVI   M,0E7H   ;MARK AS STRING ADDRESS
0FE8   EB                     XCHG      ;RESTORE H,L
0FE9   C3 15 11               JMP   LOOKO   ;GO LOOK FOR OPCODE
0FEC   CD 27 1B     LDFN:     CALL   ALPHA   ;GO SEE IF FUNCTION
0FEF   C2 BE 0F               JNZ   LDV1   ;BRIF IT'S NOT
0FF2   2B           LDFN1:    DCX   H   ;POINT BACK TO 1ST
0FF3   7E                     MOV   A,M   ;GET THAT CHAR
0FF4   FE 20                  CPI   " "   ;TEST IF SPACE
0FF6   CA F2 0F               JZ   LDFN1   ;LOOP IF TRUE
0FF9   E5                     PUSH   H   ;SAVE H,L
0FFA   11 BA 1C               LXI   D,RNDLI   ;POINT LITERAL
0FFD   D7                     RST   2   ;GO COMPARE
0FFE   CA 5B 10               JZ   LDRND   ;BRIF FND
1001   E1                     POP   H   ;GET H,L
1002   E5                     PUSH   H   ;RESAVE
1003   11 35 1F               LXI   D,FNLIT   ;POINT LITERAL
1006   D7                     RST   2   ;GO SEE IF FN X
1007   CA 36 10               JZ   FNL   ;BRIF IS
100A   E1                     POP   H   ;GET H,L
100B   E5                     PUSH   H   ;RESAVE
100C   11 AB 1D               LXI   D,PILIT   ;POINT LIT
100F   D7                     RST   2   ;GO COMPARE
1010   CA 6D 10               JZ   LDPI   ;BRIF PI
1013   E1           FUNC0:    POP   H   ;GET H,L
1014   11 9E 1C               LXI   D,FUNCT   ;POINT FUNCTION TABLE
1017   E5                     PUSH   H   ;SAVE POINTER
1018   CD B1 1F               CALL   SEEK1   ;GO SEARCH FUNCTION TABLE
101B   CA 2E 10               JZ   FUNC4   ;BRIF FUNCTION NOT FOUND
101E   1A                     LDAX   D   ;GET A BYTE LOW
101F   4F                     MOV   C,A   ;SAVE IT
1020   13                     INX   D   ;POINT NEXT
1021   1A                     LDAX   D   ;GET HI BYTE
1022   47                     MOV   B,A   ;SAVE IT (B,C = ADDR OF FUNC)
1023   CF                     RST   1   ;SKIP BLANKS
1024   FE 28                  CPI   "("   ;TEST FOR OPEN PAREN
1026   C2 15 1C               JNZ   SNERR   ;BRIF MISSING PAREN
1029   13                     INX   D   ;POINT TYPE CODE
102A   1A                     LDAX   D   ;LOAD IT
102B   C3 77 10               JMP   LDFNC   ;CONTINUE
102E   E1           FUNC4:    POP   H   ;GET H,L
102F   46                     MOV   B,M   ;GET 1ST CHAR
1030   0E 20                  MVI   C," "   ;SPACE 2ND CHAR
1032   23                     INX   H   ;POINT TO NEXT
1033   C3 BE 0F               JMP   LDV1   ;BRIF VARIABLE
1036   D1           FNL:      POP   D   ;DUMMY RESET STACK POINTER
1037   CD CF 1B               CALL   VAR   ;GO GET FN NAME
103A   42                     MOV   B,D   ;COPY TO B,C
103B   4B                     MOV   C,E   ;SAME
103C   EB                     XCHG      ;SAVE H,L
103D   2A 50 26               LHLD   EXPRS   ;POINT EXPR STACK
1040   23                     INX   H   ;POINT NEXT
1041   70                     MOV   M,B   ;MOVE THE LETTER
1042   23                     INX   H   ;POINT NEXT
1043   71                     MOV   M,C   ;MOVE DIGIT ($??)
1044   23                     INX   H   ;POINT NEXT
1045   36 AF                  MVI   M,0AFH   ;MOVE CODE
1047   79                     MOV   A,C   ;GET LO NAME
1048   B7                     ORA   A   ;TEST IT
1049   F2 4E 10               JP   FNL3   ;BRIF NOT STRING
104C   36 CF                  MVI   M,0CFH   ;MOVE CODE
104E   22 50 26     FNL3:     SHLD   EXPRS   ;SAVE POINTER
1051   EB                     XCHG      ;GET H,L
1052   CF                     RST   1   ;GET NEXT CHAR
1053   FE 28                  CPI   "("   ;TEST IF OPEN PAREN
1055   C2 15 1C               JNZ   SNERR   ;BRIF NOT
1058   C3 8D 0F               JMP   LOOKD   ;CONTINUE
105B   FE 28        LDRND:    CPI   "("   ;TEST IF RND(X)
105D   CA 13 10               JZ   FUNC0   ;BRIF IS
1060   E5                     PUSH   H   ;ELSE, SAVE H,L
1061   21 FE 1D               LXI   H,ONE   ;USE RANGE (0,1)
1064   EF                     RST   5   ;LOAD FACC
1065   CD 7C 0C               CALL   RND   ;GO GET RANDOM NUMBER
1068   E1                     POP   H   ;RESTORE H,L
1069   D1                     POP   D   ;RESTORE STACK POINTER
106A   C3 97 0F               JMP   LDF   ;ACT AS IF CONSTANT
106D   3C           LDPI:     INR   A   ;SET NON ZERO
106E   D1                     POP   D   ;DUMMY STACK POP
106F   F5                     PUSH   PSW   ;SAVE STATUS
1070   E5                     PUSH   H   ;SAVE H,L
1071   11 B6 1D               LXI   D,PI   ;GET ADDRESS OF 3.1415
1074   C3 D6 0F               JMP   LDV   ;GO ACT LIKE VARIABLE
1077   D1           LDFNC:    POP   D   ;POP THE STACK
1078   EB                     XCHG      ;FLIP/FLOP
1079   2A 50 26               LHLD   EXPRS   ;GET ADDR
107C   23                     INX   H   ;POINT NEXT
107D   70                     MOV   M,B   ;HIGH ADDR
107E   23                     INX   H   ;POINT NEXT
107F   71                     MOV   M,C   ;LOW ADDR
1080   23                     INX   H   ;POINT NEXT
1081   77                     MOV   M,A   ;CODE
1082   22 50 26               SHLD   EXPRS   ;SAVE ADDR
1085   EB                     XCHG      ;RESTORE H,L
1086   C3 8D 0F               JMP   LOOKD   ;NEXT MUST BE DATA TOO
1089   FE 2D        LDDTN:    CPI   "-"   ;TEST IF UNARY MINUS
108B   C2 9D 10               JNZ   LDDTP   ;BRIF NOT
108E   EB                     XCHG      ;SAVE H,L
108F   2A 50 26               LHLD   EXPRS   ;GET EXPR END
1092   23                     INX   H   ;POINT ONE MORE
1093   36 61                  MVI   M,61H   ;CODE FOR NEG
1095   22 50 26               SHLD   EXPRS   ;RESTORE PTR
1098   EB                     XCHG      ;RESTORE H,L
1099   23           SKPP:     INX   H   ;POINT PAST THIS BYTE
109A   C3 8D 0F               JMP   LOOKD   ;NEXT MUST BE DATA
109D   FE 2B        LDDTP:    CPI   "+"   ;TEST IF UNARY PLUS
109F   CA 99 10               JZ   SKPP   ;IGNORE IF IS
10A2   FE 28                  CPI   "("   ;ELSE, TEST IF OPEN PAREN
10A4   CA 03 11               JZ   CERCE   ;BRIF IS
10A7   FE 27                  CPI   27H   ;TEST IF LITERAL (SINGLE QUOTE)
10A9   CA B1 10               JZ   LITST   ;BRIF IS
10AC   FE 22                  CPI   0x22   ;"""     ;TEST IF LITERAL
10AE   C2 15 1C               JNZ   SNERR   ;BRIF NOT CON, FUNCTION, OR VAR
10B1   4F           LITST:    MOV   C,A   ;SAVE DELIMITER
10B2   11 20 25               LXI   D,STRIN   ;POINT BUFFER
10B5   06 FF                  MVI   B,0FFH   ;INIT CTR
10B7   23           LIT1:     INX   H   ;POINT NEXT
10B8   7E                     MOV   A,M   ;LOAD NEXT
10B9   13                     INX   D   ;POINT NEXT
10BA   12                     STAX   D   ;STORE IT
10BB   B7                     ORA   A   ;TEST IF END
10BC   CA 15 1C               JZ   SNERR   ;BRIF ERROR
10BF   04                     INR   B   ;COUNT IT
10C0   B9                     CMP   C   ;TEST IF END OF STRING
10C1   C2 B7 10               JNZ   LIT1   ;BRIF NOT
10C4   23                     INX   H   ;POINT NEXT
10C5   11 20 25               LXI   D,STRIN   ;POINT BEGIN
10C8   78                     MOV   A,B   ;GET COUNT
10C9   12                     STAX   D   ;PUT COUNT
10CA   1F                     RAR      ;DIVIDE BY TWO
10CB   3C                     INR   A   ;PLUS ONE
10CC   4F                     MOV   C,A   ;SAVE IT
10CD   06 00                  MVI   B,0   ;ZERO HIGH
10CF   E5                     PUSH   H   ;SAVE PTR
10D0   2A 69 26               LHLD   SPCTR   ;GET CTR
10D3   09                     DAD   B   ;PLUS OLD
10D4   22 69 26               SHLD   SPCTR   ;UPDATE IT
10D7   D1                     POP   D   ;GET OLD H,L
10D8   21 00 00               LXI   H,0   ;GET A ZERO
10DB   E5           LIT2:     PUSH   H   ;GET 2 WORK BYTES
10DC   0D                     DCR   C   ;SUB 1 FROM COUNT
10DD   C2 DB 10               JNZ   LIT2   ;CONTINUE
10E0   39                     DAD   SP   ;GET ADDR OF STACK
10E1   D5                     PUSH   D   ;SAVE PTR TO STMT
10E2   EB                     XCHG      ;SAVE H,L IN D,E
10E3   2A 50 26               LHLD   EXPRS   ;GET START OF EXPR
10E6   23                     INX   H   ;PLUS ONE
10E7   72                     MOV   M,D   ;HI BYTE
10E8   23                     INX   H   ;POINT NEXT
10E9   73                     MOV   M,E   ;LO BYTE
10EA   23                     INX   H   ;POINT NEXT
10EB   36 E7                  MVI   M,0E7H   ;TYPE CODE
10ED   22 50 26               SHLD   EXPRS   ;SAVE ADDR
10F0   EB                     XCHG      ;D,E BACK TO H,L
10F1   11 20 25               LXI   D,STRIN   ;POINT STRING AREA
10F4   1A                     LDAX   D   ;GET COUNT
10F5   3C                     INR   A   ;ADD ONE TO COUNT
10F6   47                     MOV   B,A   ;SAVE CTR
10F7   1A           LIT3:     LDAX   D   ;GET A BYTE
10F8   77                     MOV   M,A   ;STORE IT
10F9   23                     INX   H   ;POINT NEXT
10FA   13                     INX   D   ;DITTO
10FB   05                     DCR   B   ;DECR CTR
10FC   C2 F7 10               JNZ   LIT3   ;LOOP
10FF   E1                     POP   H   ;RESTORE H,L
1100   C3 15 11               JMP   LOOKO   ;NEXT IS OP
1103   EB           CERCE:    XCHG      ;SAVE H,L
1104   21 68 26               LXI   H,PARCT   ;POINT PAREN COUNT
1107   34                     INR   M   ;ADD 1
1108   2A 50 26               LHLD   EXPRS   ;GET ADDR
110B   23                     INX   H   ;POINT NEXT
110C   36 05                  MVI   M,5   ;PUT CODE
110E   22 50 26               SHLD   EXPRS   ;SAVE ADDR
1111   EB                     XCHG      ;RESTORE H,L
1112   C3 99 10               JMP   SKPP   ;GO SKIP CHAR
1115   CF           LOOKO:    RST   1   ;SKIP BLANKS
1116   FE 2B                  CPI   "+"   ;TEST IF PLUS
1118   06 21                  MVI   B,21H   ;CODE
111A   CA 50 11               JZ   OP1   ;BRIF IS
111D   FE 2D                  CPI   "-"   ;TEST IF MINUS
111F   06 25                  MVI   B,25H   
1121   CA 50 11               JZ   OP1   ;BRIF IS
1124   FE 2F                  CPI   "/"   ;TEST IF DIVIDE
1126   06 45                  MVI   B,45H   ;CODE
1128   CA 50 11               JZ   OP1   ;BRIF IS
112B   FE 5E                  CPI   "^"   ;TEST IF EXPON
112D   06 81                  MVI   B,81H   ;CODE
112F   CA 50 11               JZ   OP1   ;BRIF IS
1132   FE 29                  CPI   ")"   ;TEST IF CLOSE PAREN
1134   CA A4 11               JZ   OP3   ;BRIF IS
1137   FE 2C                  CPI   ","   ;TEST IF COMMA
1139   CA 8F 11               JZ   OP2   ;BRIF IS
113C   FE 2A                  CPI   "*"   ;TEST IF MULTIPLY
113E   06 41                  MVI   B,41H   ;CODE
1140   CA 50 11               JZ   OP1   ;BRIF IS
1143                             ; ELSE MUST BE END OF EXPRESSION
1143   3A 68 26     ENDXP:    LDA   PARCT   ;GET OPEN PAREN COUNT
1146   B7                     ORA   A   ;TEST IT
1147   C2 15 1C               JNZ   SNERR   ;BRIF # OF ("S NOT = # OF )"S
114A   22 56 26               SHLD   ADDR3   ;SAVE ADDR OF STMT
114D   C3 B2 11               JMP   EVAL   ;GO EVALUATE
1150   E5           OP1:      PUSH   H   ;SAVE PLACE IN ASCII EXPRESSION
1151   11 05 01               LXI   D,0105H   ;D=BYTE COUNT, E=CODE FOR "("
1154   2A 50 26               LHLD   EXPRS   ;POINT TO LAST BYTE
1157   78                     MOV   A,B   ;B&E3 -> C
1158   E6 E3                  ANI   0E3H   
115A   4F                     MOV   C,A   
115B                             ; INSERT ( AND EVALUATE IF PRECEDENCE REDUCTION,
115B                             ;   ELSE INNSERT OP CODE
115B   7E           OPLP1:    MOV   A,M   ;GET TYPE CODE FROM EXPRESSION
115C   F5                     PUSH   PSW   ;SAVE
115D   E6 03                  ANI   3   ;GET LENGTH
115F   14           OPLP2:    INR   D   ;BUMP BYTE COUNT
1160   2B                     DCX   H   ;EXPRESSION POINTER
1161   3D                     DCR   A   ;LOOP MOVES TO NEXT ELEMENT
1162   C2 5F 11               JNZ   OPLP2   
1165   F1                     POP   PSW   ;RESTORE TYPE CODE
1166   E6 E3                  ANI   0E3H   ;MASK FOR VARIABLE
1168   FE E3                  CPI   0E3H   ;WE SKIP OVER VARIABLES
116A   CA 5B 11               JZ   OPLP1   ;BR IF TYPE = E3 OR E7
116D   B9                     CMP   C   ;PRECEDENCE REDUCTION?
116E   D2 79 11               JNC   INS   ;IF NC, YES, INSERT 05
1171   2A 50 26               LHLD   EXPRS   ;NO, INSERT OPCODE BEFORE VAR AT END
1174   E7                     RST   4   ;SKIP OVER VARIABLE
1175   FD                     DB   -3   ; AND 0FFH
1176   16 04                  MVI   D,4   ;BYTE COUNT
1178   58                     MOV   E,B   ;INSERT THIS OP CODE
1179   43           INS:      MOV   B,E   ;SAVE FOR BRANCH AFTER INSERTION
117A   23           INS1:     INX   H   ;BUMP POINTER
117B   4E                     MOV   C,M   ;PICK UP BYTE
117C   70                     MOV   M,B   ;PUT DOWN REPLACEMENT
117D   41                     MOV   B,C   ;SAVE FOR NEXT LOOP
117E   15                     DCR   D   ;DONE?
117F   C2 7A 11               JNZ   INS1   ;IF NZ, NO
1182   22 50 26               SHLD   EXPRS   ;STORE POINTER
1185   E1                     POP   H   ;RESTORE ASCII EXPRESSION POINTER
1186   7B                     MOV   A,E   ;GET FLAG SAVED IN E
1187   FE 05                  CPI   5   ;STORED A "("?
1189   C2 99 10               JNZ   SKPP   ;IF NZ, NO, PROCESS NEXT ELEMENT
118C   C3 AF 11               JMP   OP4   ;YES, GO EVALUATE
118F   3A 68 26     OP2:      LDA   PARCT   ;GET OPEN PAREN COUNT
1192   B7                     ORA   A   ;TEST IT
1193   CA 43 11               JZ   ENDXP   ;BRIF END OF EXPR
1196   EB                     XCHG      ;ELSE SAVE H,L
1197   2A 50 26               LHLD   EXPRS   ;GET EXPR BEGIN
119A   23                     INX   H   ;POINT NEXT
119B   36 01                  MVI   M,1   ;MOVE A COMMA
119D   22 50 26               SHLD   EXPRS   ;UPDATE POINTER
11A0   EB                     XCHG      ;FLIP BACK
11A1   C3 99 10               JMP   SKPP   
11A4   3A 68 26     OP3:      LDA   PARCT   ;GET OPEN PAREN COUNT
11A7   3D                     DCR   A   ;SUBTRACT ONE
11A8   32 68 26               STA   PARCT   ;SAVE IT
11AB   FA 15 1C               JM   SNERR   ;BRIF TOO MANY )'S
11AE   23                     INX   H   ;POINT NEXT SOURCE
11AF   22 56 26     OP4:      SHLD   ADDR3   ;SAVE ADDR
11B2   2A 50 26     EVAL:     LHLD   EXPRS   ;GET END OF EXPR
11B5   01 00 00               LXI   B,0   ;INIT B,C TO ZERO
11B8   04           EV1:      INR   B   ;COUNT EACH BYTE
11B9   7E                     MOV   A,M   ;GET CODE IN REG A
11BA   2B                     DCX   H   ;POINT NEXT
11BB   FE E3                  CPI   0E3H   ;TEST IF DATA
11BD   C2 C8 11               JNZ   EV2   ;BRIF NOT DATA
11C0   2B           EV1A:     DCX   H   ;POINT NEXT
11C1   2B                     DCX   H   ;DITTO
11C2   04                     INR   B   ;BUMP CTR
11C3   04                     INR   B   ;BY TWO
11C4   0C                     INR   C   ;COUNT THE TERM
11C5   C3 B8 11               JMP   EV1   ;LOOP
11C8   FE AF        EV2:      CPI   0AFH   ;TEST IF NUMERIC USER FN
11CA   CA A9 0E               JZ   FN   ;BRIF IS
11CD   FE CF                  CPI   0CFH   ;TEST IF STRING USER FN
11CF   CA A9 0E               JZ   FN   ;BRIF IS
11D2   F5                     PUSH   PSW   ;ELSE, SAVE STATUS
11D3   E6 E3                  ANI   0E3H   ;MASK IT
11D5   FE A3                  CPI   0A3H   ;TEST IF NUMERIC FUNCTION
11D7   CA E8 11               JZ   EV2A   ;BRIF IS
11DA   FE C3                  CPI   0C3H   ;TEST IF STRING FUNCTION
11DC   CA E8 11               JZ   EV2A   ;BRIF IS
11DF   F1                     POP   PSW   ;RESTORE CODE
11E0   FE E7                  CPI   0E7H   ;TEST IF STRING ADDR
11E2   CA C0 11               JZ   EV1A   ;BRIF IS
11E5   C3 70 12               JMP   EV5   ;BR AROUND
11E8   23           EV2A:     INX   H   ;RESET TO TYPE CODE
11E9   22 52 26               SHLD   ADDR1   ;SAVE ADDR
11EC   D1                     POP   D   ;DUMMY POP
11ED   C5                     PUSH   B   ;SAVE CTRS
11EE   2B                     DCX   H   ;POINT TO LOW JMP ADDR
11EF   5E                     MOV   E,M   ;LOW BYTE
11F0   2B                     DCX   H   ;POINT BACK
11F1   56                     MOV   D,M   ;HIGH BACK
11F2   22 54 26               SHLD   ADDR2   ;SAVE LOCATION
11F5   21 FF 11               LXI   H,EV3   ;GET RETURN ADDRESS
11F8   E5                     PUSH   H   ;SAVE ON STACK
11F9   D5                     PUSH   D   ;SAVE ADDRESS
11FA   CD 7A 1C               CALL   ARG   ;GO GET 1ST ARG
11FD   E1                     POP   H   ;GET H,L ADDRESS
11FE   E9                     PCHL      ;GO EXECUTE THE FUNCTION
11FF                EV3:      EQU   $   ;FUNCTIONS RETURN HERE
11FF   2A 54 26               LHLD   ADDR2   ;GET ADDR FUNC
1202   23                     INX   H   ;POINT LO
1203   23                     INX   H   ;POINT TYPE
1204   7E                     MOV   A,M   ;LOAD IT
1205   E6 E0                  ANI   0E0H   ;MASK IT
1207   FE C0                  CPI   0C0H   ;TEST IF STRING
1209   CA 44 12               JZ   EV4   ;BRIF IS
120C   C1                     POP   B   ;GET CTRS
120D   2A 69 26               LHLD   SPCTR   ;GET COUNTER
1210   23                     INX   H   ;PLUS
1211   23                     INX   H   ;TWO WORDS
1212   22 69 26               SHLD   SPCTR   ;STORE IT
1215   21 00 00               LXI   H,0   ;LOAD ZERO TO H,L
1218   E5                     PUSH   H   ;GET BLOCK OF
1219   E5                     PUSH   H   ;BYTES
121A   39                     DAD   SP   ;GET STACK ADDR
121B   C5                     PUSH   B   ;SAVE CTRS
121C   E5                     PUSH   H   ;SAVE ADDR
121D   DF                     RST   3   ;GO STORE THE VARIABLE
121E   3E E3                  MVI   A,0E3H   ;TYPE=NUM
1220   D1           EV3A:     POP   D   ;GET ADDR IN STACK
1221   2A 52 26               LHLD   ADDR1   ;GET ADDR LST ARG
1224   77                     MOV   M,A   ;STORE TYPE CODE
1225   2B                     DCX   H   ;POINT ONE BACK
1226   73                     MOV   M,E   ;STORE LO ADDR
1227   2B                     DCX   H   ;POINT BACK
1228   72                     MOV   M,D   ;STORE HI ADDR
1229   2A 54 26               LHLD   ADDR2   ;GET LOCATION FUNCTION
122C   23                     INX   H   ;POINT LO
122D   23                     INX   H   ;POINT TYPE
122E   7E                     MOV   A,M   ;LOAD TYPE
122F   46                     MOV   B,M   ;GET TYPE
1230   E7                     RST   4   ;ADJUST H,L
1231   FD                     DB   -3   ; AND 0FFH
1232   78                     MOV   A,B   ;LOAD TYPE
1233   C1                     POP   B   ;RESTORE CTRS
1234   E6 18                  ANI   18H   ;ISOLATE #ARGS
1236   1F                     RAR      ;SHIFT RIGHT
1237   1F                     RAR      ;AGAIN
1238   1F                     RAR      ;ONCE MORE
1239   57                     MOV   D,A   ;SAVE IT
123A   82                     ADD   D   ;TIMES 2
123B   82                     ADD   D   ;TIMES 3
123C   04                     INR   B   ;POINT
123D   04                     INR   B   ;LST POSIT IN LOC
123E   CD E8 1A               CALL   SQUIS   ;GO COMPRESS STACK
1241   C3 B2 11               JMP   EVAL   ;START AT BEGINNING
1244   11 20 25     EV4:      LXI   D,STRIN   ;POINT STRING BUFFER
1247   1A                     LDAX   D   ;LOAD IT
1248   1F                     RAR      ;DIVIDE BY TWO
1249   3C                     INR   A   ;ADD 1
124A   2A 69 26               LHLD   SPCTR   ;GET SP COUNT
124D   4F                     MOV   C,A   ;SAVE LO
124E   06 00                  MVI   B,0   ;SET HI
1250   09                     DAD   B   ;ADD NUMBER WORDS
1251   22 69 26               SHLD   SPCTR   ;SAVE SP COUNT
1254   21 00 00               LXI   H,0   ;GET SOME ZEROS
1257   C1                     POP   B   ;GET CTRS
1258   E5           EV4A:     PUSH   H   ;GET 1 WORD
1259   3D                     DCR   A   ;DECR CTR
125A   C2 58 12               JNZ   EV4A   ;LOOP
125D   39                     DAD   SP   ;GET ADDRESS IN H,L
125E   C5                     PUSH   B   ;RE-SAVE CTRS
125F   E5                     PUSH   H   ;SAVE ADDR
1260   1A                     LDAX   D   ;GET COUNT
1261   3C                     INR   A   ;PLUS ONE
1262   47                     MOV   B,A   ;SAVE IT
1263   1A           EV4B:     LDAX   D   ;GET A BYTE
1264   77                     MOV   M,A   ;STORE IT
1265   13                     INX   D   ;POINT NEXT
1266   23                     INX   H   ;DITTO
1267   05                     DCR   B   ;DECR CTR
1268   C2 63 12               JNZ   EV4B   ;LOOP
126B   3E E7                  MVI   A,0E7H   ;TYPE CODE
126D   C3 20 12               JMP   EV3A   ;CONTINUE
1270   FE 05        EV5:      CPI   5   ;TEST IF OPEN PAREN
1272   C2 8E 12               JNZ   EV6   ;BRIF NOT
1275   3E 01                  MVI   A,1   ;DELETE 1 BYTE
1277   CD E8 1A               CALL   SQUIS   ;GO COMPRESS IT
127A   2A 56 26               LHLD   ADDR3   ;RESTORE STMT POINTER
127D   3A 72 24               LDA   DIMSW   ;GET SUBSR SWITCH
1280   B7                     ORA   A   ;TEST IT
1281   CA 15 11               JZ   LOOKO   ;BRIF NOT IN SUBS^CRIPT
1284   3A 68 26               LDA   PARCT   ;GET OPEN PAREN COUNT
1287   B7                     ORA   A   ;TEST
1288   C2 15 11               JNZ   LOOKO   ;BRIF NOT ZERO
128B   C3 B2 11               JMP   EVAL   ;ELSE EVALUATE COMPLETE SUBSCR
128E   B7           EV6:      ORA   A   ;TEST IF END OF EXPRESSION
128F   C2 BF 12               JNZ   EV9   ;BRIF NOT
1292   3A 72 24               LDA   DIMSW   ;GET DIM SW
1295   B7                     ORA   A   ;TEST IT
1296   C4 95 13               CNZ   EDM1   ;BRIF NOT OFF
1299   79                     MOV   A,C   ;GET TERM COUNT
129A   FE 01                  CPI   1   ;TEST IF ONE
129C   C2 11 1C               JNZ   STERR   ;ERROR IF NOT ONE
129F   23                     INX   H   ;POINT HIGH ADDR
12A0   23                     INX   H   ;SAME
12A1   56                     MOV   D,M   ;HIGH TO D
12A2   23                     INX   H   ;POINT LOW
12A3   5E                     MOV   E,M   ;LOW TO E
12A4   CD 7B 13               CALL   EVLD   ;GO LOAD VALUE
12A7   2A 69 26               LHLD   SPCTR   ;GET STACK CTR
12AA   7D           EV7:      MOV   A,L   ;GET LO BYTE
12AB   B4                     ORA   H   ;PLUS HI
12AC   CA B4 12               JZ   DV8   ;BRIF ZERO
12AF   D1                     POP   D   ;RETURN 2 BYTES
12B0   2B                     DCX   H   ;DECR CTR
12B1   C3 AA 12               JMP   EV7   ;LOOP
12B4   3A 72 24     DV8:      LDA   DIMSW   ;GET DIM SW
12B7   B7                     ORA   A   ;TEST IT
12B8   C4 BC 13               CNZ   EDM4   ;BRIF ON
12BB   2A 56 26               LHLD   ADDR3   ;RESTORE STMT PTR
12BE   C9                     RET      ;RETURN TO STMT PROCESSOR
12BF   FE 21        EV9:      CPI   21H   ;TEST IF PLUS
12C1   11 13 13               LXI   D,FADDJ   ;ADDR
12C4   CA F1 12               JZ   EV10   ;BRIF IS
12C7   FE 25                  CPI   25H   ;TEST IF MINUS
12C9   11 04 17               LXI   D,FSUB   ;ADDR
12CC   CA F1 12               JZ   EV10   ;BRIF IS
12CF   FE 41                  CPI   41H   ;TEST IF MUL
12D1   11 10 17               LXI   D,FMUL   ;ADDR
12D4   CA F1 12               JZ   EV10   ;BRIF IS
12D7   FE 45                  CPI   45H   ;TEST IF DIV
12D9   11 93 17               LXI   D,FDIV   ;ADDR
12DC   CA F1 12               JZ   EV10   ;BRIF IS
12DF   FE 01                  CPI   1   ;TEST IF COMMA
12E1   CA 6F 13               JZ   EVCOM   ;BRIF IS
12E4   FE 61                  CPI   61H   ;TEST IF UNARY MINUS
12E6   CA 5B 13               JZ   EVNEG   ;BRIF IS
12E9   FE 81                  CPI   81H   ;TEST IF EXPONENTIAL
12EB   11 1B 13               LXI   D,POWER   ;ADDR
12EE   C2 11 1C               JNZ   STERR   ;ERROR IF NOT
12F1   23           EV10:     INX   H   ;POINT TO
12F2   23                     INX   H   ;1ST DATA
12F3   C5                     PUSH   B   ;SAVE CTRS
12F4   D5                     PUSH   D   ;SAVE ROUTINE ADDR
12F5   56                     MOV   D,M   ;HIGH TO D
12F6   23                     INX   H   ;POINT NEXT
12F7   5E                     MOV   E,M   ;LOW TO E
12F8   E5                     PUSH   H   ;SAVE POINTER
12F9   CD 7B 13               CALL   EVLD   ;GO LOAD VALUE
12FC   E1                     POP   H   ;RESTORE H,L
12FD   23                     INX   H   ;POINT 2ND DATA
12FE   23                     INX   H   ;SAME
12FF   56                     MOV   D,M   ;HIGH TO D
1300   23                     INX   H   ;POINT NEXT
1301   5E                     MOV   E,M   ;LOW TO E
1302   23                     INX   H   ;POINT NEXT
1303   3A 8E 26               LDA   NS   ;GET PREV TYPE
1306   BE                     CMP   M   ;TEST THIS TYPE
1307   C2 15 1C               JNZ   SNERR   ;BRIF MIXED MODE
130A   2B                     DCX   H   ;POINT BACK
130B   E3                     XTHL      ;POP ADDR FROM STACK, PUSH H ONTO
130C   01 4A 13               LXI   B,EV11   ;RETURN ADDRESS
130F   C5                     PUSH   B   ;SAVE ON STACK
1310   E5                     PUSH   H   ;SAVE JUMP ADDR
1311   EB                     XCHG      ;PUT VAR ADDR TO H,L
1312   C9                     RET      ;FAKE CALL TO ROUTINE
1313   FE E7        FADDJ:    CPI   0E7H   ;TEST IF STRINGS
1315   CA 1E 0D               JZ   CONCA   ;BRIF IS
1318   C3 2F 16               JMP   FADD   ;ELSE, GO ADD
131B   E5           POWER:    PUSH   H   ;SAVE ADDR OF VAR
131C   21 2F 26               LXI   H,TEMP1   ;POINT SAVE AREA
131F   DF                     RST   3   ;SAVE X
1320   E1                     POP   H   ;RESTORE H,L
1321   EF                     RST   5   ;LOAD IT
1322   CD C6 18               CALL   FTEST   ;TEST FOR ZERO
1325   CA CE 0B               JZ   SGN1   ;GIVE RESULT = 1 IF POWER = 0
1328   21 47 26               LXI   H,TEMP7   ;POINT SAVE AREA
132B   DF                     RST   3   ;SAVE B
132C   21 2F 26               LXI   H,TEMP1   ;POINT X
132F   EF                     RST   5   ;GO LOAD IT
1330   CD C6 18               CALL   FTEST   ;TEST FOR ZERO
1333   C8                     RZ      ;0^X = 0
1334   CD 0B 0B               CALL   LN   ;GET NATURAL LNRITHM
1337   21 47 26               LXI   H,TEMP7   ;POINT B
133A   CD 10 17               CALL   FMUL   ;GO MULTIPLY
133D   C3 62 0B               JMP   EXP   ;GET EXP FUNC
1340                             ; X^B = EXP(B*LN(X))
1340   21 2F 26     XSQR:     LXI   H,TEMP1   ;POINT X
1343   EF                     RST   5   ;LOAD X
1344   21 2F 26               LXI   H,TEMP1   ;POINT X
1347   C3 10 17               JMP   FMUL   ;TIMES X
134A   E1           EV11:     POP   H   ;GET H,L
134B   C1                     POP   B   ;GET CTRS
134C   2B                     DCX   H   ;POINT BACK
134D   2B                     DCX   H   ;AND AGAIN
134E   CD 06 1B               CALL   GTEMP   ;GO SAVE FACC
1351   E7                     RST   4   ;ADJUST H,L
1352   F9                     DB   -7   ; AND 0FFH
1353   3E 04                  MVI   A,4   ;DELETE 4 BYTES
1355   CD E8 1A               CALL   SQUIS   ;GO COMPRESS
1358   C3 B2 11               JMP   EVAL   ;CONTINUE
135B   23           EVNEG:    INX   H   ;POINT BACK TO OP
135C   C5                     PUSH   B   ;SAVE CTRS
135D   E5                     PUSH   H   ;SAVE H,L
135E   23                     INX   H   ;DITTO
135F   56                     MOV   D,M   ;GET HI BYTE
1360   23                     INX   H   ;POINT NEXT
1361   5E                     MOV   E,M   ;GET LO BYTE
1362   CD 7B 13               CALL   EVLD   ;GO LOAD VAR
1365   CD 72 0C               CALL   NEG   ;GO NEGATE IT
1368   E1                     POP   H   ;GET LOCATINO
1369   C1                     POP   B   ;GET CTRS
136A   CD 06 1B               CALL   GTEMP   ;GO STORE FACC IN STACK
136D   E7                     RST   4   ;ADJUST H,L
136E   FC                     DB   -4   ; AND 0FFH
136F   3E 01        EVCOM:    MVI   A,1   ;DELETE 1 BYTE
1371   CD E8 1A               CALL   SQUIS   ;COMPRESS
1374   21 6B 26               LXI   H,CMACT   ;GET COUNT
1377   34                     INR   M   ;INCR
1378   C3 B2 11               JMP   EVAL   ;CONTINUE
137B   23           EVLD:     INX   H   ;POINT TYPE
137C   7E                     MOV   A,M   ;LOAD IT
137D   32 8E 26               STA   NS   ;SAVE IT
1380   EB                     XCHG      ;SAVE H,L IN D,E
1381   FE E7                  CPI   0E7H   ;TEST IF STRING
1383   C2 28 00               JNZ   RST5   ;LOAD FLOATING POINT
1386   11 20 25               LXI   D,STRIN   ;POINT BUFFER
1389   7E                     MOV   A,M   ;GET COUNT
138A   3C                     INR   A   ;ADD ONE
138B   47                     MOV   B,A   ;SAVE COUNT
138C   7E           EVLD1:    MOV   A,M   ;GET NEXT
138D   12                     STAX   D   ;STORE IT
138E   23                     INX   H   ;POINT NEXT
138F   13                     INX   D   ;DITTO
1390   05                     DCR   B   ;DECR COUNT
1391   C2 8C 13               JNZ   EVLD1   ;LOOP
1394   C9                     RET      ;RETURN
1395                             ; 
1395   79           EDM1:     MOV   A,C   ;GET ITEM COUNT
1396   E5                     PUSH   H   ;SAVE H,L
1397   FE 01                  CPI   1   ;TEST IF 1
1399   C2 A8 13               JNZ   EDM3   ;BRIF NOT
139C   06 04                  MVI   B,4   ;GET COUNT
139E   21 2F 26               LXI   H,TEMP1   ;POINT AREA
13A1   CD 64 1C               CALL   ZEROM   ;GO ZERO IT
13A4   E1           EDM2A:    POP   H   ;RESTORE H,L
13A5   0E 01                  MVI   C,1   ;SET COUNT
13A7   C9                     RET      ;RETURN
13A8   FE 02        EDM3:     CPI   2   ;TEST IF 2
13AA   C2 15 1C               JNZ   SNERR   ;ELSE, ERROR
13AD   E7                     RST   4   ;POINT 2ND ARG
13AE   05                     DB   5   
13AF   56                     MOV   D,M   ;GET HI ADDR
13B0   23                     INX   H   ;POINT NEXT
13B1   5E                     MOV   E,M   ;GET LO ADDR
13B2   CD 7B 13               CALL   EVLD   ;LOAD THE ARG
13B5   21 2F 26               LXI   H,TEMP1   ;POINT AREA
13B8   DF                     RST   3   ;SAVE THE ARG
13B9   C3 A4 13               JMP   EDM2A   ;CONTINUE
13BC   CD 60 1F     EDM4:     CALL   FACDE   ;CONVERT FACC TO D,E
13BF   D5                     PUSH   D   ;PUT D,E TO B,C
13C0   C1                     POP   B   
13C1   C5                     PUSH   B   ;SAVE COL
13C2   21 2F 26               LXI   H,TEMP1   ;POINT 2ND ARGUMENT
13C5   EF                     RST   5   ;LOAD IT IN FACC
13C6   CD 60 1F               CALL   FACDE   ;CONVERT TO D,E
13C9   C1                     POP   B   ;GET COL
13CA   AF                     XRA   A   ;GET A ZERO
13CB   32 72 24               STA   DIMSW   ;RESET SW
13CE   C9                     RET      ;RETURN
13CF   78           LDV2A:    MOV   A,B   ;GET HI NAME
13D0   F6 80                  ORI   80H   ;SET BIT
13D2   47                     MOV   B,A   ;RESTORE
13D3   C5                     PUSH   B   ;SAVE NAME
13D4   EB                     XCHG      ;SAVE H,L IN D,E
13D5   3A 68 26               LDA   PARCT   ;GET PAREN COUNT
13D8   F5                     PUSH   PSW   ;SAVE
13D9   AF                     XRA   A   ;CLEAR REG A
13DA   32 68 26               STA   PARCT   ;RESET COUNT
13DD   2A 69 26               LHLD   SPCTR   ;GET STACK COUNTER
13E0   E5                     PUSH   H   ;SAVE IT
13E1   21 00 00               LXI   H,0   ;GET A ZERO
13E4   22 69 26               SHLD   SPCTR   ;RESET CTR
13E7   2A 50 26               LHLD   EXPRS   ;GET EXPRST
13EA   E5                     PUSH   H   ;SAVE IT
13EB   23                     INX   H   ;POINT NEXT
13EC   36 00                  MVI   M,0   ;SET NEW START
13EE   22 50 26               SHLD   EXPRS   ;SAVE IT
13F1   3A 72 24               LDA   DIMSW   ;GET PREV SE
13F4   F5                     PUSH   PSW   ;SAVE IT
13F5   EB                     XCHG      ;RESTORE H,L
13F6   3E FF                  MVI   A,0FFH   ;GET ON VALUE
13F8   32 72 24               STA   DIMSW   ;SET SW
13FB   CD 8D 0F               CALL   LOOKD   ;RECURSIVE CALL
13FE   F1                     POP   PSW   ;GET DIM SW
13FF   32 72 24               STA   DIMSW   ;REPLACE IT
1402   22 56 26               SHLD   ADDR3   ;SAVE H,L
1405   E1                     POP   H   ;GET EXPRST
1406   22 50 26               SHLD   EXPRS   ;SAVE IT
1409   E1                     POP   H   ;GET STACK COUNTER
140A   22 69 26               SHLD   SPCTR   ;RESTORE IT
140D   F1                     POP   PSW   ;GET PAREN COUNT
140E   32 68 26               STA   PARCT   ;RESTORE IT
1411   E1                     POP   H   ;GET NAME
1412   D5                     PUSH   D   ;SAVE ROW
1413   C5                     PUSH   B   ;SAVE COL
1414   EB                     XCHG      ;PUT NAME IN D,E
1415   CD 3A 1B               CALL   SEARC   ;GO FIND ADDRESS (PUT IN D,E)
1418   D1                     POP   D   ;GET ADDR
1419   C1                     POP   B   ;RESTORE COL
141A   D1                     POP   D   ;RESTORE ROW
141B   CD 7D 18               CALL   SUBSC   ;GET SUBSCRIPT (RETURNS ADDR IN H,L)
141E   EB                     XCHG      ;SAVE IN D,E
141F   2A 56 26               LHLD   ADDR3   ;GET H,L
1422   E5                     PUSH   H   ;SAVE ON STACK
1423   C3 D6 0F               JMP   LDV   ;CONTINUE
1426                             ;       PAGE
1426                             ; 
1426                FIN:      EQU   $   
1426                             ; 
1426                             ; FLOATING POINT INPUT CONVERSION ROUTINE
1426                             ; 
1426                             ; THIS SUBROUTINE CONVERTS AN ASCII STRING OF CHARACTERS
1426                             ; TO THE FLOATING POINT ACCUMULATOR.  THE INPUT FIELD
1426                             ; MAY CONTAIN ANY VALID NUMBER, INCLUDING SCIENTIFIC
1426                             ; NOTATION (NNN.NNNNE+NN).
1426                             ; THE INPUT STRING IS TERMINATED BY ANY NON-NUMERIC CHAR
1426                             ; 
1426                             ; 
1426   EB                     XCHG      ;PUT ADDR TO D,E
1427   0E 00                  MVI   C,0   ;INITIAL VALUE EXCESS DIGIT COUNT
1429   CD 80 14               CALL   FIN8   ;GET INTEGER PORTION
142C   06 00                  MVI   B,0   ;CLEAR DIGIT COUNT
142E   FE 2E                  CPI   "."   ;TEST IF DEC-POINT
1430   C2 36 14               JNZ   FIN2   ;BRIF NOT
1433   CD 9A 14               CALL   FIN9   ;GET FRACTION
1436   F1           FIN2:     POP   PSW   ;GET SIGN
1437   F6 18                  ORI   24   ;SET UP FOR FLOAT
1439   32 58 26               STA   FACC   
143C   78                     MOV   A,B   ;GET # FRACTION DIGITS
143D   81                     ADD   C   ;+ EXCESS DIGITS
143E   F5                     PUSH   PSW   ;SAVE POWER OF TEN
143F   D5                     PUSH   D   ;SAVE PTR
1440   CD D5 16               CALL   FNORM   ;NORMALIZE NUMBER
1443   1A                     LDAX   D   ;GET NEXT CHARACTER
1444   FE 45                  CPI   "E"   ;TEST IF EXPONENT
1446   C2 64 14               JNZ   FIN4   ;BRIF NOT
1449   21 5C 26               LXI   H,FTEMP   ;POINT SAVE AREA
144C   DF                     RST   3   ;SAVE ACC
144D   D1                     POP   D   ;RESTORE PTR
144E   13                     INX   D   ;SKIP "E"
144F   CD 80 14               CALL   FIN8   ;GET NUMERIC EXP
1452   3A 5B 26               LDA   FACC+3   ;GET EXPONENT
1455   C1                     POP   B   ;EXPONENT SIGN
1456   04                     INR   B   ;TEST
1457   F2 5C 14               JP   FIN3   ;BRIF NOT NEG
145A   2F                     CMA      ;NEGATE EXPONENT
145B   3C                     INR   A   
145C   C1           FIN3:     POP   B   ;POWER OF TEN
145D   80                     ADD   B   ;ADD EXPONENT
145E   F5                     PUSH   PSW   ;SAVE COUNT
145F   21 5C 26               LXI   H,FTEMP   ;RESTORE NUMBER
1462   D5                     PUSH   D   ;SAVE PTR
1463   EF                     RST   5   ;LOAD IT
1464   E1           FIN4:     POP   H   ;RESTORE PTR
1465   F1                     POP   PSW   ;RESTORE COUNT
1466   C8           FIN5:     RZ      ;RETURN IF ZERO
1467   E5                     PUSH   H   ;SAVE H,L
1468   21 B2 1D               LXI   H,TEN   ;POINT CONSTANT: 10
146B   FA 78 14               JM   FIN7   ;BRIF DIVIDE NEEDED
146E   3D                     DCR   A   ;DECR COUNT
146F   F5                     PUSH   PSW   ;SAVE COUNT
1470   CD 10 17               CALL   FMUL   ;GO MULTIPLY BY 10
1473   F1           FIN6:     POP   PSW   ;RESTORE COUNT
1474   E1                     POP   H   ;RESTORE H,L
1475   C3 66 14               JMP   FIN5   ;CONTINUE
1478   3C           FIN7:     INR   A   ;INCR COUNT
1479   F5                     PUSH   PSW   ;SAVE COUNT
147A   CD 93 17               CALL   FDIV   ;GO DIVIDE BY 10
147D   C3 73 14               JMP   FIN6   ;LOOP
1480                             ; 
1480                             ; FIN8  CONVERT NUMBER STRING TO FACC
1480                             ; ON ENTRY, C=INIT VALUE EXCESS DIGIT COUNT
1480                             ;             DE=INPUT STRING
1480                             ; ON EXIT, SIGN IS ON STACK
1480                             ;       B=DIGIT COUNT
1480                             ;       C=EXCESS DIGIT COUNT
1480                             ; 
1480   21 58 26     FIN8:     LXI   H,FACC   ;CLEAR FACC
1483   06 04                  MVI   B,4   
1485   CD 64 1C               CALL   ZEROM   
1488   21 00 80               LXI   H,8000H   ;ASSUME MINUS
148B   1A                     LDAX   D   ;GET CHAR
148C   FE 2D                  CPI   "-"   
148E   CA 98 14               JZ   FIN8A   
1491   65                     MOV   H,L   ;NOPE, MUST BE PLUS
1492                             ;(B IS CLEARED BY ZEROM)
1492   FE 2B                  CPI   "+"   
1494   CA 98 14               JZ   FIN8A   
1497   1B                     DCX   D   ;NEITHER, BACK UP POINTER
1498   E3           FIN8A:    XTHL      ;GET RETURN, PUSH SIGN
1499   E5                     PUSH   H   ;RESTORE RETURN
149A   13           FIN9:     INX   D   ;POINT NEXT
149B   1A                     LDAX   D   ;GET CHAR
149C   FE 30                  CPI   "0"   ;TEST IF LESS ZERO
149E   D8                     RC      ;RETURN IF IS
149F   FE 3A                  CPI   "9"+1   ;TEST IF GT NINE
14A1   D0                     RNC      ;RETURN IF IS
14A2   05                     DCR   B   ;DIGIT COUNT
14A3   D5                     PUSH   D   ;SAVE PTR
14A4   C5                     PUSH   B   ;SAVE COUNTERS
14A5   CD CD 14               CALL   FMTEN   ;MULTIPLY FACC*TEN
14A8   B7                     ORA   A   ;TEST FOR OVERFLOW
14A9   CA B6 14               JZ   FINB   ;BRIF NO OVERFLOW
14AC   21 60 26               LXI   H,FTEMP+4   
14AF   EF                     RST   5   ;RESTORE OLD FACC
14B0   C1                     POP   B   ;RESTORE COUNTERS
14B1   0C                     INR   C   ;EXCESS DIGIT
14B2   D1                     POP   D   
14B3   C3 9A 14               JMP   FIN9   
14B6   C1           FINB:     POP   B   ;RSTORE COUNTERS
14B7   D1                     POP   D   ;& PTR
14B8   1A                     LDAX   D   ;GET THE DIGIT
14B9   E6 0F                  ANI   0FH   ;MASK OFF ZONE
14BB   21 5B 26               LXI   H,FACC+3   ;POINT ACC
14BE   86                     ADD   M   ;ADD
14BF   77                     MOV   M,A   ;STORE
14C0   2B                     DCX   H   ;POINT NEXT
14C1   7E                     MOV   A,M   ;LOAD
14C2   CE 00                  ACI   0   ;PLUS CARRY
14C4   77                     MOV   M,A   ;STORE
14C5   2B                     DCX   H   ;POINT NEXT
14C6   7E                     MOV   A,M   ;LOAD
14C7   CE 00                  ACI   0   ;PLUS CARRY
14C9   77                     MOV   M,A   ;STORE
14CA   C3 9A 14               JMP   FIN9   ;LOOP
14CD                             ; 
14CD                             ; MULTIPLY FACC BY TEN
14CD                             ; 
14CD   21 60 26     FMTEN:    LXI   H,FTEMP+4   
14D0   DF                     RST   3   ;SAVE FACC
14D1   CD DD 14               CALL   FIND   ;*2
14D4   CD DD 14               CALL   FIND   ;*4
14D7   21 63 26               LXI   H,FTEMP+7   
14DA   CD E0 14               CALL   FIND0   ;*5
14DD   21 5B 26     FIND:     LXI   H,FACC+3   ;DOUBLE FACC
14E0   11 5B 26     FIND0:    LXI   D,FACC+3   
14E3   06 04                  MVI   B,4   ;BYTE COUNT
14E5   C3 E8 18               JMP   FADDT   ;ADD & RETURN
14E8                             ;PAGE
14E8                             ; 
14E8                FOUT:     EQU   $   
14E8                             ; 
14E8                             ; FLOATING POINT OUTPUT FORMAT ROUTINE
14E8                             ; 
14E8                             ; THIS SUBROUTINE CONVERTS A NUMBER IN FACC TO A
14E8                             ; FORMAT SUITABLE FOR PRINTING.  THAT IS, THE
14E8                             ; NUMBER WILL BE IN SCIENTIFIC NOTATION IF EXPONENT
14E8                             ; IS > 5 OR < -2, OTHERWISE IT WILL BE ZERO SUPRESSED
14E8                             ; ON BOTH SIDES.
14E8                             ; 
14E8   11 5B 26               LXI   D,FACC+3   ;POINT LSB
14EB   1A                     LDAX   D   ;LOAD IT
14EC   F6 07                  ORI   7   ;MASK FOR OUTPUT
14EE   12                     STAX   D   ;REPLACE
14EF   CD C6 18               CALL   FTEST   ;GET SIGN OF NUMBER
14F2   36 20                  MVI   M," "   ;DEFAULT SPACE
14F4   F2 F9 14               JP   FOUT0   ;BRIF NOT MINUS
14F7   36 2D                  MVI   M,"-"   ;MOVE DASH
14F9   23           FOUT0:    INX   H   ;POINT NEXT
14FA   C2 03 15               JNZ   FOUT2   ;BRIF NOT ZERO
14FD   36 30                  MVI   M,"0"   ;MOVE THE ZERO
14FF   23                     INX   H   ;POINT NEXT
1500   36 20                  MVI   M," "   ;MOVE SPACE FOLLOWING
1502   C9                     RET      ;RETURN
1503   3A 58 26     FOUT2:    LDA   FACC   ;GET SIGN & EXP
1506   CD D4 18               CALL   FEXP   ;EXPAND EXPONENT
1509   C2 0E 15               JNZ   FOUTV   ;BRIF NOT ZERO
150C   3E 80                  MVI   A,80H   ;SET NEG
150E   E6 80        FOUTV:    ANI   80H   ;ISOLATE
1510   32 75 26               STA   DEXP   ;SAVE SIGN
1513   E5                     PUSH   H   ;SAVE H,L
1514   3A 58 26     FOUT3:    LDA   FACC   ;GET SIGN & EXP
1517   CD D4 18               CALL   FEXP   ;EXPAND EXP
151A   FE 01                  CPI   1   ;TEST RANGE
151C   F2 35 15               JP   FOUT6   ;BRIF IN RANGE
151F   21 75 26     FOUT4:    LXI   H,DEXP   ;POINT DEC.EXP
1522   34                     INR   M   ;INCR IT
1523   21 B2 1D               LXI   H,TEN   ;POINT CONST: 10
1526   F2 2F 15               JP   FOUT5   ;BRIF POS.
1529   CD 10 17               CALL   FMUL   ;MULTIPLY
152C   C3 14 15               JMP   FOUT3   ;LOOP
152F   CD 93 17     FOUT5:    CALL   FDIV   ;DIVIDE
1532   C3 14 15               JMP   FOUT3   ;LOOP
1535   FE 05        FOUT6:    CPI   5   ;TEST HIGH RANGE
1537   F2 1F 15               JP   FOUT4   ;BRIF 5 OR GREATER
153A   21 5C 26               LXI   H,FTEMP   ;POINT SAVE AREA
153D   DF                     RST   3   ;STORE IT
153E   3A 58 26               LDA   FACC   ;GET EXPONENT
1541   CD D4 18               CALL   FEXP   ;EXPAND
1544   0E 06                  MVI   C,6   ;DIGIT COUNT
1546   CD 7A 15               CALL   FOUTB   ;SHIFT LEFT
1549   FE 0A                  CPI   10   ;TEST IF DECIMAL POINT
154B   FA 55 15               JM   FOUTU   ;BRIF LT
154E   21 5C 26               LXI   H,FTEMP   ;POINT SAVE AREA
1551   EF                     RST   5   ;LOAD IT
1552   C3 1F 15               JMP   FOUT4   ;ONCE MORE
1555   CD 68 15     FOUTU:    CALL   FOUT9   ;PUT DIGIT
1558   AF           FOUT7:    XRA   A   ;CLEAR STATUS
1559   32 58 26               STA   FACC   ;AND OVERFLOW
155C   CD CD 14               CALL   FMTEN   ;MULTIPLY BY TEN
155F   CD 68 15               CALL   FOUT9   ;PUT DIGIT
1562   C2 58 15               JNZ   FOUT7   ;LOOP
1565   C3 91 15               JMP   FOUTH   ;GO AROUND
1568   F6 30        FOUT9:    ORI   30H   ;DEC. ZONE
156A   E1                     POP   H   ;GET RETURN ADDR
156B   E3                     XTHL      ;EXCH WITH TOP (PTR)
156C   77                     MOV   M,A   ;PUT DIGIT
156D   23                     INX   H   ;POINT NEXT
156E   79                     MOV   A,C   ;GET COUNT
156F   FE 06                  CPI   6   ;TEST IF 1ST
1571   C2 77 15               JNZ   FOUTA   ;BRIF NOT
1574   36 2E                  MVI   M,"."   ;MOVE DEC. PT.
1576   23                     INX   H   ;POINT NEXT
1577   E3           FOUTA:    XTHL      ;EXCH WITH RTN
1578   0D                     DCR   C   ;DECR COUNT
1579   E9                     PCHL      ;RETURN
157A   5F           FOUTB:    MOV   E,A   ;SAVE BIT COUNT
157B   AF                     XRA   A   ;CLEAR ACC FLAGS
157C   32 58 26               STA   FACC   ;AND OVERFLOW
157F   21 5B 26     FOUTC:    LXI   H,FACC+3   ;POINT LSB
1582   06 04                  MVI   B,4   ;BYTE COUNT
1584   7E           FOUTD:    MOV   A,M   ;GET A BYTE
1585   17                     RAL      ;SHIFT LEFT
1586   77                     MOV   M,A   ;STORE
1587   2B                     DCX   H   ;POINT NEXT
1588   05                     DCR   B   ;DECR CTR
1589   C2 84 15               JNZ   FOUTD   ;LOOP
158C   1D                     DCR   E   ;DECR BIT CTR
158D   C2 7F 15               JNZ   FOUTC   ;LOOP
1590   C9                     RET      ;RETURN
1591   E1           FOUTH:    POP   H   ;GET PTR
1592   36 45                  MVI   M,"E"   ;EXPONENT
1594   23                     INX   H   ;POINT NEXT
1595   3A 75 26               LDA   DEXP   ;GET EXPONENT
1598   36 2B                  MVI   M,"+"   ;DEFAULT
159A   57                     MOV   D,A   ;SAVE NUMBER
159B   B7                     ORA   A   ;TEST IT
159C   F2 A8 15               JP   FOUTI   ;BRIF POS
159F   36 2D                  MVI   M,"-"   ;ELSE, DASH
15A1   E6 7F                  ANI   7FH   ;STRIP DUMB SIGN
15A3   2F                     CMA      ;COMPLEMENT
15A4   3C                     INR   A   ;PLUS ONE (TWOS COMP)
15A5   57                     MOV   D,A   ;SAVE IT
15A6   2F                     CMA      ;RE-COMPLEMENT
15A7   3C                     INR   A   ;PLUS ONE
15A8   23           FOUTI:    INX   H   ;POINT NEXT
15A9   E5                     PUSH   H   ;SAVE PTR
15AA   1E FF                  MVI   E,-1   ; AND 0FFH   ;INIT CTR (TENS)
15AC   1C           FOUTJ:    INR   E   ;ADD ONE
15AD   D6 0A                  SUI   10   ;LESS 10
15AF   F2 AC 15               JP   FOUTJ   ;LOOP
15B2   C6 0A                  ADI   10   ;CORRECT UNITS
15B4   47                     MOV   B,A   ;SAVE UNITS
15B5   7B                     MOV   A,E   ;GET TENS
15B6   CD 68 15               CALL   FOUT9   ;OUTPUT
15B9   78                     MOV   A,B   ;GET UNITS
15BA   CD 68 15               CALL   FOUT9   ;OUTPUT
15BD   E1                     POP   H   ;GET PTR
15BE   36 20                  MVI   M," "   ;SPACE AFTER
15C0   7A                     MOV   A,D   ;GET DEC EXPON
15C1   B7                     ORA   A   ;SET FLAGS
15C2   F2 CB 15               JP   FOUTK   ;BRIF POS.
15C5   FE FE                  CPI   -2   ; AND 0FFH     ;TEST FOR MIN
15C7   D8                     RC      ;RETURN IF LESS THAN -2
15C8   C3 CE 15               JMP   FOUTL   ;GO AROUND
15CB   FE 06        FOUTK:    CPI   6   ;TEST IF TOO BIG
15CD   D0                     RNC      ;RETURN IF 6 OR GREATER
15CE   4F           FOUTL:    MOV   C,A   ;SAVE EXPONENT
15CF   06 05                  MVI   B,5   ;CTR
15D1   36 20        FOUTM:    MVI   M," "   ;SPACE OUT EXPONENT
15D3   2B                     DCX   H   ;POINT PRIOR
15D4   05                     DCR   B   ;DECR CTR
15D5   C2 D1 15               JNZ   FOUTM   ;LOOP
15D8   EB                     XCHG      ;FLIP/FLOP
15D9   7B                     MOV   A,E   ;GET LOW BYTE
15DA   D6 05                  SUI   5   ;POINT TO DOT
15DC   6F                     MOV   L,A   ;PUT DOWN
15DD   7A                     MOV   A,D   ;GET HIGH
15DE   DE 00                  SBI   0   ;IN CASE OF BORROW
15E0   67                     MOV   H,A   ;PUT DOWN
15E1   79                     MOV   A,C   ;GET EXPONENT
15E2   B7                     ORA   A   ;TEST SIGN
15E3   CA F4 15               JZ   FOUTO   ;BRIF ZERO
15E6   FA 09 16               JM   FOUTR   ;BRIF NEGATIVE
15E9   46           FOUTN:    MOV   B,M   ;GET HIGH BYTE
15EA   23                     INX   H   ;POINT NEXT
15EB   7E                     MOV   A,M   ;GET LOW BYTE
15EC   70                     MOV   M,B   ;SHIFT DOT TO RIGHT
15ED   2B                     DCX   H   ;POINT BACK
15EE   77                     MOV   M,A   ;MOVE THE DIGIT LEFT
15EF   23                     INX   H   ;POINT NEXT
15F0   0D                     DCR   C   ;DECR CTR
15F1   C2 E9 15               JNZ   FOUTN   ;LOOP
15F4   EB           FOUTO:    XCHG      ;POINT END
15F5   7E           FOUTP:    MOV   A,M   ;GET A DIGIT/DOT
15F6   FE 30                  CPI   "0"   ;TEST FOR TRAILING ZERO
15F8   C2 01 16               JNZ   FOUTQ   ;BRIF NOT
15FB   36 20                  MVI   M," "   ;SPACE FILL
15FD   2B                     DCX   H   ;POINT PRIOR
15FE   C3 F5 15               JMP   FOUTP   ;LOOP
1601   FE 2E        FOUTQ:    CPI   "."   ;TEST FOR TRAILING DOT
1603   23                     INX   H   ;JUST IN CASE NOT
1604   C0                     RNZ      ;RETURN IF NOT
1605   2B                     DCX   H   ;RESET PTR
1606   36 20                  MVI   M," "   ;SPACE IT OUT
1608   C9                     RET      ;RETURN
1609   FE FF        FOUTR:    CPI   0FFH   ;TEST IF -1
160B   C2 17 16               JNZ   FOUTS   ;ELSE -2
160E   2B                     DCX   H   ;POINT SIGNIFICANT
160F   7E                     MOV   A,M   ;GET THE CHAR
1610   36 2E                  MVI   M,"."   ;MOVE THE DOT
1612   23                     INX   H   ;POINT NEXT
1613   77                     MOV   M,A   ;SHIFT THE DIGIT
1614   C3 F4 15               JMP   FOUTO   ;GO ZERO SUPPRESS
1617   2B           FOUTS:    DCX   H   ;POINT ONE TO LEFT
1618   7E                     MOV   A,M   ;PICK UP DIGIT
1619   36 30                  MVI   M,"0"   ;REPLACE
161B   23                     INX   H   ;POINT RIGHT
161C   77                     MOV   M,A   ;PUT THE DIGIT
161D   62                     MOV   H,D   ;GET LOW ADDR
161E   6B                     MOV   L,E   ;POINT LAST DIGIT
161F   06 06                  MVI   B,6   ;CTR
1621   2B           FOUTT:    DCX   H   ;POINT PRITO
1622   7E                     MOV   A,M   ;GET A DIGIT
1623   23                     INX   H   ;POINT
1624   77                     MOV   M,A   ;PUT IT ONE TO RIGHT
1625   2B                     DCX   H   ;POINT
1626   05                     DCR   B   ;DECR CTR
1627   C2 21 16               JNZ   FOUTT   ;LOOP
162A   36 2E                  MVI   M,"."   ;MOVE THE DOT
162C   C3 F4 15               JMP   FOUTO   ;CONTINUE
162F                             ; 
162F                FADD:     EQU   $   
162F                             ; 
162F                             ; 
162F                             ; FLOATING POINT ADD THE NUMBER AT (H,L) TO THE FACC
162F                             ; 
162F                             ; 
162F   23                     INX   H   ;POINT FIRST DIGIT
1630   7E                     MOV   A,M   ;LOAD IT
1631   B7                     ORA   A   ;TEST IT
1632   CA C6 18               JZ   FTEST   ;BRIF ZERO
1635   2B                     DCX   H   ;POINT BACK
1636   CD C6 18               CALL   FTEST   ;GO TEST SIGN OF FACC
1639   CA 28 00               JZ   RST5   ;JUST LOAD IF FACC = 0
163C   CD D4 18               CALL   FEXP   ;GO GET EXPONENT
163F   47                     MOV   B,A   ;SAVE EXPONENT
1640   7E                     MOV   A,M   ;GET EXPONENT OF ADDR
1641   CD D4 18               CALL   FEXP   ;GO GET EXPONENT
1644   4F                     MOV   C,A   ;SAVE THE EXPONENT
1645   90                     SUB   B   ;GET DIFFERENCE OF TWO EXPONENTS
1646   CA 5B 16               JZ   FADD4   ;BRIF THEY'RE EQ
1649   F2 4E 16               JP   FADD3   ;BRIF DIFFERENCE IS POSITIVE
164C   2F                     CMA      ;COMPLEMENT ACC
164D   3C                     INR   A   ;PLUS ONE (TWO'S COMPLEMENT)
164E   FE 18        FADD3:    CPI   24   ;COMPARE DIFFERENCE TO MAX
1650   DA 5B 16               JC   FADD4   ;BRIF LESS
1653   78                     MOV   A,B   ;GET EXPON OF ADDUEND
1654   91                     SUB   C   ;GET TRUE DIFFERENCE AGAIN
1655   F2 C6 18               JP   FTEST   ;BRIF FACC > ADDER
1658   C3 28 00               JMP   RST5   ;ELSE, ADDER > FACC
165B   F5           FADD4:    PUSH   PSW   ;SAVE DIFFERENCE
165C   C5                     PUSH   B   ;SAVE EXPONENTS
165D   11 5C 26               LXI   D,FTEMP   ;GET ADDR OF TEMP ACC
1660   CD 5C 1C               CALL   CPY4H   
1663   C1                     POP   B   ;GET EXPONENTS
1664   F1                     POP   PSW   ;GET DIFFERENCE
1665   CA 8C 16               JZ   FADD9   ;JUST ADD IF ZERO
1668   21 5D 26               LXI   H,FTEMP+1   ;DEFAULT
166B   F5                     PUSH   PSW   ;SAVE DIFFERENCE
166C   78                     MOV   A,B   ;GET FACC EXPON
166D   91                     SUB   C   ;MINUS FTEMP EXPON
166E   F2 7E 16               JP   FADD6   ;BRIF TEMP MUST BE SHIFTED
1671   21 58 26               LXI   H,FACC   ;POINT FLOAT ACC
1674   79                     MOV   A,C   ;GET EXPONENT, SIGN
1675   E6 7F                  ANI   7FH   ;STRIP EXP SIGN
1677   4F                     MOV   C,A   ;PUT BACK
1678   7E                     MOV   A,M   ;GET THE EXP
1679   E6 80                  ANI   80H   ;STRIP OFF OLD EXPON
167B   B1                     ORA   C   ;MOVE ADDR EXPON TO IT
167C   77                     MOV   M,A   ;REPLACE
167D   23                     INX   H   ;POINT FIRST DATA BYTE
167E   F1           FADD6:    POP   PSW   ;GET DIFFER
167F   4F                     MOV   C,A   ;SAVE IT
1680   06 03        FADD7:    MVI   B,3   ;LOOP CTR (INNER)
1682   AF                     XRA   A   ;INIT CARRY TO Z
1683   E5                     PUSH   H   ;SAVE ADDR
1684   CD F3 18               CALL   FSHFT   ;GO SHIFT
1687   E1                     POP   H   ;GET ADDR
1688   0D                     DCR   C   ;DECR CTR
1689   C2 80 16               JNZ   FADD7   ;LOOP
168C                FADD9:    EQU   $   
168C   21 5C 26               LXI   H,FTEMP   
168F   3A 58 26               LDA   FACC   ;GET EXPONENT
1692   AE                     XRA   M   ;SEE IF SIGNS THE SAME
1693   11 5B 26               LXI   D,FACC+3   ;POINT LEAST SIGN BYTE
1696   21 5F 26               LXI   H,FTEMP+3   
1699   FA B4 16               JM   FADDA   ;BRIF SIGNS DIFFERENT
169C   CD E6 18               CALL   FADT3   ;ADD 3 BYTES
169F   D2 C6 18               JNC   FTEST   ;BRIF NO OVERFLOW
16A2   EB                     XCHG      ;POINT HL TO FACC
16A3   CD 81 17               CALL   SVSGN   ;SAVE SIGN, RETURN EXPONENT
16A6   3C                     INR   A   ;INCREMENT EXPONENT
16A7   CD 89 17               CALL   RSSGN   ;RESTORE SIGN TO EXPONENT
16AA   23                     INX   H   ;POINT DATA
16AB   37                     STC      ;SET CY
16AC   06 03                  MVI   B,3   ;CTR
16AE   CD F3 18               CALL   FSHFT   ;GO SHIFT IT
16B1   C3 C6 18               JMP   FTEST   ;RETURN
16B4                FADDA:    EQU   $   
16B4   06 03                  MVI   B,3   
16B6   CD DB 18               CALL   FSUBT   ;SUBTRACT
16B9   D2 D5 16               JNC   FNORM   ;BRIF NO BORROW
16BC   21 5B 26               LXI   H,FACC+3   ;MUST NEGATE
16BF   06 03                  MVI   B,3   
16C1   37                     STC      
16C2   7E           FNEG1:    MOV   A,M   ;GET BYTE
16C3   2F                     CMA      
16C4   D2 C9 16               JNC   FNEG2   
16C7   C6 01                  ADI   1   ;INCREMENT + COMPLEMENT=NEGATE
16C9   77           FNEG2:    MOV   M,A   
16CA   2B                     DCX   H   
16CB   05                     DCR   B   
16CC   C2 C2 16               JNZ   FNEG1   
16CF   CD D5 16               CALL   FNORM   
16D2   C3 72 0C               JMP   NEG   ;REVERSE SIGN
16D5                             ;PAGE
16D5                             ; 
16D5                FNORM:    EQU   $   
16D5                             ; 
16D5                             ; 
16D5                             ; NORMALIZE THE FLOATING ACCUMULATOR
16D5                             ; THAT IS, THE FIRST BIT MUST BE SIGNIFICANT
16D5                             ; 
16D5                             ; 
16D5   21 5B 26               LXI   H,FACC+3   ;POINT LSB
16D8   7E                     MOV   A,M   ;LOAD IT
16D9   2B                     DCX   H   ;POINT PRIOR
16DA   B6                     ORA   M   ;MERGE
16DB   2B                     DCX   H   ;POINT PRIOR
16DC   B6                     ORA   M   ;MERGE
16DD   2B                     DCX   H   
16DE   46                     MOV   B,M   ;SAVE EXPONENT
16DF   77                     MOV   M,A   ;CLEAR
16E0   C8                     RZ      ;RETURN ON NOTHING TO NORMALIZE
16E1   70                     MOV   M,B   ;RESTORE EXP
16E2   C5                     PUSH   B   ;SAVE C FOR CALLER
16E3   CD 81 17               CALL   SVSGN   ;SAVE SIGN
16E6   77                     MOV   M,A   ;STORE EXPANDED EXPONENT
16E7   23           FNRM1:    INX   H   ;POINT TO MOST SIGN BYTE
16E8   7E                     MOV   A,M   ;GET MSB
16E9   B7                     ORA   A   ;TEST IT
16EA   FA FD 16               JM   FNRM3   ;BRIF NORMALIZED
16ED   23                     INX   H   ;POINT LSB
16EE   23                     INX   H   
16EF   06 03                  MVI   B,3   ;SHIFT COUNT
16F1   7E           FNRM2:    MOV   A,M   ;SHIFT LEFT
16F2   17                     RAL      
16F3   77                     MOV   M,A   
16F4   2B                     DCX   H   
16F5   05                     DCR   B   
16F6   C2 F1 16               JNZ   FNRM2   
16F9   35                     DCR   M   ;ADJUST EXPONENT
16FA   C3 E7 16               JMP   FNRM1   ;LOOP
16FD   2B           FNRM3:    DCX   H   ;POINT BACK TO EXPONENT
16FE   7E                     MOV   A,M   
16FF   CD 89 17               CALL   RSSGN   ;RESTORE SIGN
1702   C1                     POP   B   ;RESTORE C
1703   C9                     RET      
1704                             ; 
1704                FSUB:     EQU   $   
1704                             ; 
1704                             ; 
1704                             ; FLOATING POINT SUBTRACT THE NUMBER AT (H,L) FROM THE FACC
1704                             ; 
1704                             ; 
1704   CD 72 0C               CALL   NEG   ;NEGATE FACC
1707   CD 2F 16               CALL   FADD   ;ADD
170A   CD 72 0C               CALL   NEG   ;NEGATE RESULT
170D   C3 C6 18               JMP   FTEST   
1710                             ;PAGE
1710                             ; 
1710                FMUL:     EQU   $   
1710                             ; 
1710                             ; 
1710                             ; FLOATING POINT MULTIPLY THE NUMBER AT (H,L) TO THE FACC
1710                             ; 
1710                             ; 
1710   CD C6 18               CALL   FTEST   ;TEST FACC
1713   C8                     RZ      ;RETURN IF ZERO
1714   23                     INX   H   ;POINT 1ST DIGIT OF MULTIPLIER
1715   7E                     MOV   A,M   ;LOAD IT
1716   2B                     DCX   H   ;RESTORE
1717   B7                     ORA   A   ;TEST IF ZERO
1718   CA 28 00               JZ   RST5   ;GO LOAD TO FACC IF IT IS
171B   E5                     PUSH   H   ;SAVE MULTIPLIER ADDRESS
171C   CD 77 17               CALL   MDSGN   ;GET SIGN PRODUCT, & BOTH EXPONENTS
171F   80                     ADD   B   ;ADD EXPONENTS
1720   CD 89 17               CALL   RSSGN   ;RESTORE SIGN
1723   E1                     POP   H   ;RESTORE
1724   11 65 26               LXI   D,FTEMP+9   ;POINT TEMP STORAGE
1727   06 03                  MVI   B,3   ;BYTE COUNT
1729   23                     INX   H   ;POINT MSD
172A   CD 5E 1C               CALL   COPYH   ;MOVE MULTIPLIER
172D   21 5C 26               LXI   H,FTEMP   ;POINT DIGIT 7 OF RESULT
1730   06 06                  MVI   B,6   ;LOOP CTR
1732   CD 64 1C               CALL   ZEROM   ;GO ZERO EIGHT BYTES
1735   11 59 26               LXI   D,FACC+1   ;POINT 1ST DIGIT OF ACC
1738   06 03                  MVI   B,3   ;LOOP CTR
173A   1A           FMUL5:    LDAX   D   ;GET AN ACC DIGIT PAIR
173B   77                     MOV   M,A   ;PUT TO TEMP STORAGE
173C   AF                     XRA   A   ;ZERO A
173D   12                     STAX   D   ;CLEAR ACC
173E   13                     INX   D   ;POINT NEXT
173F   23                     INX   H   ;DITTO
1740   05                     DCR   B   ;DECR CTR
1741   C2 3A 17               JNZ   FMUL5   ;LOOP
1744   0E 18                  MVI   C,24   ;OUTTER LOOP CTR
1746   06 03        FMUL6:    MVI   B,3   ;CTR
1748   21 65 26               LXI   H,FTEMP+9   ;POINT MULTIPLIER
174B   AF                     XRA   A   ;CLEAR CY
174C   7E           FMUL7:    MOV   A,M   ;GET BYTE
174D   1F                     RAR      ;SHIFT RIGHT
174E   77                     MOV   M,A   ;PUT DOWN
174F   23                     INX   H   ;POINT NEXT
1750   05                     DCR   B   ;DECR CTR
1751   C2 4C 17               JNZ   FMUL7   ;LOOP
1754   D2 62 17               JNC   FMUL8   ;BRIF ZERO BIT
1757   11 5E 26               LXI   D,FTEMP+2   ;POINT RESULT
175A   21 64 26               LXI   H,FTEMP+8   ;POINT MULTIPLICAND
175D   06 06                  MVI   B,6   ;SIX BYTE ADD
175F   CD E8 18               CALL   FADDT   ;GO ADD
1762   06 06        FMUL8:    MVI   B,6   ;SIZ BYTE SHIFT
1764   21 64 26               LXI   H,FTEMP+8   ;POINT MULTIPLICAND
1767   AF                     XRA   A   ;CLEAR CY
1768   7E           FMUL9:    MOV   A,M   ;GET BYTE
1769   17                     RAL      ;SHIFT LEFT
176A   77                     MOV   M,A   ;PUT BACT
176B   2B                     DCX   H   ;POINT NEXT BYTE
176C   05                     DCR   B   ;DECR CTR
176D   C2 68 17               JNZ   FMUL9   ;LOOP
1770   0D                     DCR   C   ;DEC BIT COUNT
1771   C2 46 17               JNZ   FMUL6   ;CONTINUE
1774   C3 D5 16               JMP   FNORM   ;GO NORMALIZE
1777                             ; 
1777                             ; MDSGN   GET SIGN PRODUCT AND EXPONENTS FOR MULT & DIV
1777                             ; ON ENTRY:
1777                             ;       (HL) = ONE NUMBER
1777                             ;       (FACC)=THE OTHER
1777                             ; ON RETURN:
1777                             ;       A = EXPONENT OF FACC(EXPANDED)
1777                             ;       B = OTHER EXPONENT
1777                             ;       C = SIGN PRODUCT
1777                             ;       HL DESTROYED
1777                             ; 
1777   CD 81 17     MDSGN:    CALL   SVSGN   ;GET SIGN IN C, EXP IN A
177A   47                     MOV   B,A   ;SAVE EXPONENT
177B   21 58 26               LXI   H,FACC   
177E   79                     MOV   A,C   ;GET SIGN
177F   86                     ADD   M   ;MULTIPLY SIGNS
1780   77                     MOV   M,A   ;PUT DOWN
1781                             ; 
1781                             ; SVSGN         GET SIGN AND EXP
1781                             ; ON ENTRY:
1781                             ;       (HL) = EXPONENT
1781                             ; ON RETURN:
1781                             ;       A = EXPANDED EXPONENT
1781                             ;       C = SIGN IN HI ORDER BIT
1781                             ; 
1781   7E           SVSGN:    MOV   A,M   ;GET EXPONENT
1782   E6 80                  ANI   80H   ;ISOLATE SIGN
1784   4F                     MOV   C,A   
1785   7E                     MOV   A,M   
1786   C3 D4 18               JMP   FEXP   ;EXPAND EXP AND RETURN
1789                             ; 
1789                             ; RSSGN         RESTORE SIGN TO EXPONENT
1789                             ; ON ENTRY:
1789                             ;       (HL)=EXPONENT
1789                             ;       A = EXPANDED EXPONENT
1789                             ;       C = SIGN
1789                             ; ON RETURN:
1789                             ;       A = EXPONENT
1789                             ;       (HL) = EXPONENT WITH SIGN
1789                             ;       Z,M BITS SET FOR EXPONENT
1789                             ; 
1789   CD 69 18     RSSGN:    CALL   FOVUN   ;CHECK FOR OVER/UNDERFLOW
178C   E6 7F                  ANI   7FH   ;REMOVE EXPONENT SIGN
178E   B1                     ORA   C   ;ADD SIGN
178F   77                     MOV   M,A   ;SET DOWN
1790   C3 C6 18               JMP   FTEST   ;SET Z,M BITS
1793                             ;PAGE
1793                             ; 
1793                FDIV:     EQU   $   
1793                             ; 
1793                             ; 
1793                             ; FLOATING POINT DIVIDE THE NUMBER AT (H,L) INTO THE FACC
1793                             ; 
1793                             ; 
1793   CD C6 18               CALL   FTEST   ;TEST IF FACC ZERO
1796   C8                     RZ      ;RETURN IF IT IS
1797   23                     INX   H   ;POINT 1ST DIGIT OF DIVISOR
1798   7E                     MOV   A,M   ;LOAD IT
1799   2B                     DCX   H   ;POINT BACK
179A   B7                     ORA   A   ;TEST IF ZERO
179B   CA 0D 1C               JZ   ZMERR   ;DIVISION BY ZERO = ERROR
179E   E5                     PUSH   H   ;SAVE DIVISOR PTR
179F   CD 77 17               CALL   MDSGN   ;GET SIGN ON STACK, EXPS INTO A,B
17A2   90                     SUB   B   ;SUBTRACT EXPONENTS
17A3   3C                     INR   A   ;PLUS ONE
17A4   CD 89 17               CALL   RSSGN   ;SET SIGN/EXPONENT IN FACC
17A7   11 59 26               LXI   D,FACC+1   
17AA   21 5C 26               LXI   H,FTEMP   ;POINT TEMPORARY STORAGE
17AD   36 00                  MVI   M,0   ;CLEAR MSB
17AF   23                     INX   H   ;POINT NEXT
17B0   06 03                  MVI   B,3   ;LOOP CTR
17B2   1A           FDIV3:    LDAX   D   ;GET BYTE FROM FACC
17B3   77                     MOV   M,A   ;PUT TO FTEMP
17B4   AF                     XRA   A   ;CLEAR A
17B5   12                     STAX   D   ;ZERO FACC
17B6   23                     INX   H   ;POINT NEXT
17B7   13                     INX   D   ;DITTO
17B8   05                     DCR   B   ;DECR CTR
17B9   C2 B2 17               JNZ   FDIV3   ;LOOP
17BC   D1                     POP   D   ;GET ADDR
17BD   06 03                  MVI   B,3   ;LOOP CTR
17BF   13                     INX   D   ;POINT MSD OF DIVISOR
17C0   36 00                  MVI   M,0   ;CLEAR MSB
17C2   23                     INX   H   ;POINT NEXT
17C3   CD 53 1C               CALL   COPYD   ;GO MOVE IT
17C6   0E 18                  MVI   C,24   ;OUTER LOOP CTR
17C8   11 5F 26     FDIV5:    LXI   D,FTEMP+3   ;POINT DIVIDEND
17CB   21 63 26               LXI   H,FTEMP+7   ;AND DIVISOR
17CE   06 04                  MVI   B,4   ;CTR
17D0   CD DB 18               CALL   FSUBT   ;GO SUBTRACT
17D3   D2 E2 17               JNC   FDIV6   ;BRIF NO GO
17D6   11 5F 26               LXI   D,FTEMP+3   ;POINT DIVIDEND
17D9   21 63 26               LXI   H,FTEMP+7   ;AND DIVISOR
17DC   06 04                  MVI   B,4   ;CTR
17DE   CD E8 18               CALL   FADDT   ;GO RE-ADD
17E1   37                     STC      ;TURN ON CY
17E2   3F           FDIV6:    CMC      ;REVERSE CY
17E3   06 03                  MVI   B,3   ;CTR
17E5   21 5B 26               LXI   H,FACC+3   ;POINT LSB
17E8   7E           FDIV7:    MOV   A,M   ;LOAD BYTE
17E9   17                     RAL      ;SHIFT LEFT
17EA   77                     MOV   M,A   ;REPLACE
17EB   2B                     DCX   H   ;POINT NEXT
17EC   05                     DCR   B   ;DECR CTR
17ED   C2 E8 17               JNZ   FDIV7   ;LOOP
17F0   AF                     XRA   A   ;CLEAR FLAGS
17F1   06 04                  MVI   B,4   ;CTR
17F3   21 5F 26               LXI   H,FTEMP+3   ;POINT-DIVIDEND
17F6   7E           FDIV8:    MOV   A,M   ;LOAD BYTE
17F7   17                     RAL      ;SHIFT LEFT
17F8   77                     MOV   M,A   ;REPLACE
17F9   2B                     DCX   H   ;POINT ENXT
17FA   05                     DCR   B   ;DECR CTR
17FB   C2 F6 17               JNZ   FDIV8   ;LOOP
17FE   0D                     DCR   C   ;DECR OTR CTR
17FF   C2 C8 17               JNZ   FDIV5   ;LOOP
1802   C3 D5 16               JMP   FNORM   ;WRAPUP
1805                             ; 
1805                             ; UTILITY ROUTINE TO GET A VARIABLE'S ADDRESS TO H,L
1805                             ; 
1805   11 20 25     GETST:    LXI   D,STRIN   ;POINT BUFFER
1808   06 00                  MVI   B,0   ;INIT CTR
180A   7E                     MOV   A,M   ;GET THE CHAR
180B   FE 22                  CPI   0x22   ;"""     ;TEST IF LIT TYPE
180D   CA 26 18               JZ   GETS2   ;BRIF IS
1810   FE 27                  CPI   27H   ;TEST IF QUOTED LITERAL
1812   CA 26 18               JZ   GETS2   ;BRIF IS
1815   FE 2C        GETS1:    CPI   ","   ;TEST IF COMMA
1817   CA 39 18               JZ   GETS5   ;BRIF IS
181A   B7                     ORA   A   ;TEST IF END
181B   CA 39 18               JZ   GETS5   ;BRIF IS
181E   04                     INR   B   ;COUNT IT
181F   13                     INX   D   ;POINT NEXT
1820   12                     STAX   D   ;PUT CHAR
1821   23                     INX   H   ;POINT NEXT
1822   CF                     RST   1   ;SKIP SPACES
1823   C3 15 18               JMP   GETS1   ;LOOP
1826   4F           GETS2:    MOV   C,A   ;SAVE DELIM
1827   23           GETS3:    INX   H   ;SKIP THE QUOTE
1828   7E                     MOV   A,M   ;GET NEXT CHAR
1829   B9                     CMP   C   ;TEST IF END OF LITERAL
182A   CA 37 18               JZ   GETS4   ;BRIF IS
182D   B7                     ORA   A   ;TEST IF END OF LINE
182E   CA 25 1C               JZ   CVERR   ;BRIF IS
1831   04                     INR   B   ;COUNT IT
1832   13                     INX   D   ;POINT NEXT
1833   12                     STAX   D   ;PUT CHAR
1834   C3 27 18               JMP   GETS3   ;LOOP
1837   23           GETS4:    INX   H   ;SKIP END QUOTE
1838   CF                     RST   1   ;SKIP TRAILING SPACES
1839   11 20 25     GETS5:    LXI   D,STRIN   ;POINT BEGIN BUFFER
183C   78                     MOV   A,B   ;GET COUNT
183D   12                     STAX   D   ;PUT COUNT
183E   D1                     POP   D   ;GET RETURN ADDR
183F   EB                     XCHG      ;FLIP/FLOP
1840   E3                     XTHL      ;PUT RET ON STACK, HL OF VAR IN HL
1841   D5                     PUSH   D   ;SAVE H,L OF LOC
1842   CD 29 06               CALL   LET2A   ;GO STORE STRING
1845   E1                     POP   H   ;RESTORE LOCATION
1846   C9                     RET      ;RETURN
1847   CD CF 1B     GETS8:    CALL   VAR   ;GET VAR NAME
184A   D5                     PUSH   D   ;SAVE ON STACK
184B   7A                     MOV   A,D   ;GET HI BYTE
184C   B7                     ORA   A   ;TEST IF ARRAY
184D   F2 64 18               JP   GETS9   ;BRIF NOT
1850   CD 3A 1B               CALL   SEARC   ;GO GET ARRAY PARAMS
1853   3E FF                  MVI   A,0FFH   ;TURN ON SW
1855   32 72 24               STA   DIMSW   ;SET IT
1858   E3                     XTHL      ;SWAP ADDR ON STACK
1859   CD 78 0F               CALL   EXPR   ;GO GET ROW, COL PTRS
185C   E3                     XTHL      ;SWAP ADDR ON STACK
185D   CD 7D 18               CALL   SUBSC   ;GO POINT TO ENTRY
1860   EB                     XCHG      ;EXCHANGE
1861   E1                     POP   H   ;GET ADDRESS OF STMT
1862   C1                     POP   B   ;GET NAME
1863   C9                     RET      ;RETURN
1864   CD 3A 1B     GETS9:    CALL   SEARC   ;FIND ADDR
1867   C1                     POP   B   ;RESTORE NAME
1868   C9                     RET      ;RETURN
1869                             ; 
1869                FOVUN:    EQU   $   
1869                             ; 
1869                             ; TEST EXPONENT FOR OVERFLO OR UNDERFLOW
1869                             ; 
1869   B7                     ORA   A   ;TEST IT
186A   F2 75 18               JP   FOV1   ;BRIF POS.
186D   FE C1                  CPI   0C1H   ;TEST FOR MAX NEG
186F   D0                     RNC      ;RETURN IF NO UNDER.
1870   3E C1                  MVI   A,0C1H   ;SET EXPONENT AT MINIMUM
1872   C3 32 1C               JMP   UNERR   
1875   FE 40        FOV1:     CPI   40H   ;TEST MAX POS
1877   D8                     RC      ;RETURN IF NO OVER.
1878   3E 3F                  MVI   A,3FH   ;SET EXPONENT AT MAXIMUM
187A   C3 2D 1C               JMP   OVERR   
187D                             ; 
187D                SUBSC:    EQU   $   
187D                             ; 
187D                             ; 
187D                             ; COMPUTES SUBSCR ADDR
187D                             ; INPUT: B HAS ROW NUMBER (1ST SUB)
187D                             ;        D HAS COL NUMBER (2ND SUB)
187D                             ;        H HAS ADDR NAME
187D                             ; 
187D   D5                     PUSH   D   ;SAVE COL
187E   E7                     RST   4   ;ADJUST H,L
187F   FC                     DB   -4   ; AND 0FFH     ;BY FOUR
1880   56                     MOV   D,M   ;GET HI
1881   2B                     DCX   H   ;POINT LO
1882   5E                     MOV   E,M   ;GET LO
1883   7A                     MOV   A,D   ;GET HI
1884   B8                     CMP   B   ;COMPARE
1885   DA 15 1C               JC   SNERR   ;BRIF EXCESS
1888   C2 90 18               JNZ   SUB1   ;BRIF NOT EQUAL
188B   7B                     MOV   A,E   ;GET LO
188C   B9                     CMP   C   ;COMPARE
188D   DA 15 1C               JC   SNERR   ;BRIF EXCESS
1890   2B           SUB1:     DCX   H   ;POINT HI COLS
1891   56                     MOV   D,M   ;LOAD IT
1892   2B                     DCX   H   ;POINT LO COLS
1893   5E                     MOV   E,M   ;LOAD IT
1894   E3                     XTHL      ;SAVE ADDRESS
1895   E5                     PUSH   H   ;SAVE SUB COL
1896   D5                     PUSH   D   ;SAVE DIM COLS
1897   13                     INX   D   ;MAKE COLS=MAX+1 (ACCOUNT FOR 0 B??KE
1898   21 00 00               LXI   H,0   ;GET A ZERO
189B   78           SUB2:     MOV   A,B   ;GET HI
189C   B1                     ORA   C   ;PLUS LO
189D   CA A5 18               JZ   SUB3   ;BRIF ZERO
18A0   19                     DAD   D   ;ADD ONCE
18A1   0B                     DCX   B   ;SUB ONCE
18A2   C3 9B 18               JMP   SUB2   ;LOOP
18A5   D1           SUB3:     POP   D   ;GET DIM COL
18A6   C1                     POP   B   ;GET SUB COL
18A7   7A                     MOV   A,D   ;GET HI
18A8   B8                     CMP   B   ;COMPARE
18A9   DA 15 1C               JC   SNERR   ;BRIF GT
18AC   C2 B4 18               JNZ   SUB4   ;BRIF NOT ZERO
18AF   7B                     MOV   A,E   ;GET LO
18B0   B9                     CMP   C   ;COMPARE
18B1   DA 15 1C               JC   SNERR   ;BRIF GT
18B4   09           SUB4:     DAD   B   ;ADD TO PROD
18B5   29                     DAD   H   ;TIMES TWO
18B6   29                     DAD   H   ;TIMES FOUR
18B7   7D                     MOV   A,L   ;GET LOW
18B8   2F                     CMA      ;COMPLEMENT
18B9   C6 01                  ADI   1   ;PLUS ONE
18BB   5F                     MOV   E,A   ;SAVE IT
18BC   7C                     MOV   A,H   ;GET HI
18BD   2F                     CMA      ;COMPLEMENT
18BE   CE 00                  ACI   0   ;PLUS CARRY
18C0   57                     MOV   D,A   ;SAVE
18C1   E1                     POP   H   ;GET ADDR (0,0)
18C2   19                     DAD   D   ;COMPUTE (I,J) RIGHT SIDE
18C3   E7                     RST   4   ;ADJUST H,L
18C4   FC                     DB   -4   ; AND 0FFH
18C5   C9                     RET      ;RETURN
18C6                FTEST:    EQU   $   
18C6                             ; 
18C6                             ; TEST THE SIGN OF THE NUMBER IN THE FACC
18C6                             ; RETURN WITH S & Z SET TO SIGN
18C6                             ; 
18C6   3A 59 26               LDA   FACC+1   ;GET MSD
18C9   B7                     ORA   A   ;TEST IT
18CA   C8                     RZ      ;RETURN IF ZERO
18CB   3A 58 26               LDA   FACC   ;GET SIGN&EXPON BYTE
18CE   F6 7F                  ORI   7FH   ;TEST SIGN BIT ONLY
18D0   3A 58 26               LDA   FACC   ;RE-LOAD EXPON BYTE
18D3   C9                     RET      ;THEN RETURN
18D4                FEXP:     EQU   $   
18D4                             ; 
18D4                             ; EXPAND EXPONENT INTO 8 BINARY BITS
18D4                             ; 
18D4   E6 7F                  ANI   7FH   ;MASK MANTISA SIGN
18D6   C6 40                  ADI   40H   ;PROPAGATE CHAR SIGN TO LEFTMOST BIT
18D8   EE 40                  XRI   40H   ;RESTORE ORIGINAL SIGN BIT
18DA   C9                     RET      ;RETURN
18DB                             ; 
18DB                FSUBT:    EQU   $   
18DB                             ; 
18DB                             ; SUBTRACT THE TWO MULTIPRECISION NUMBERS (D,E) & (H,L)
18DB                             ; 
18DB   AF                     XRA   A   ;TURN OF CY
18DC   1A           FSB1:     LDAX   D   ;GET A BYTE
18DD   9E                     SBB   M   ;SUB OTHER BYTE
18DE   12                     STAX   D   ;PUT DOWN
18DF   1B                     DCX   D   ;POINT NEXT
18E0   2B                     DCX   H   ;DITTO
18E1   05                     DCR   B   ;DECR CTR
18E2   C2 DC 18               JNZ   FSB1   ;LOOP
18E5   C9                     RET      ;RETURN
18E6                             ; 
18E6                             ; ADD TWO MULTI-PRECISION NUMBERS (D,E) & (H,L)
18E6                             ; 
18E6   06 03        FADT3:    MVI   B,3   
18E8   AF           FADDT:    XRA   A   ;CLEAR STATUS
18E9   1A           FAD1:     LDAX   D   ;GET BYTE
18EA   8E                     ADC   M   ;ADD OTHER BYTE
18EB   12                     STAX   D   ;PUT DOWN
18EC   1B                     DCX   D   ;POINT NEXT
18ED   2B                     DCX   H   ;DITTO
18EE   05                     DCR   B   ;DECR LOOP CTR
18EF   C2 E9 18               JNZ   FAD1   ;LOOP
18F2   C9                     RET      ;RETURN
18F3                             ; 
18F3                FSHFT:    EQU   $   
18F3                             ; 
18F3                             ; INCREMENTING SHIFT RIGHT
18F3                             ; 
18F3   7E                     MOV   A,M   ;GET A BYTE
18F4   1F                     RAR      ;SHIFT RIGHT
18F5   77                     MOV   M,A   ;PUT DOWN
18F6   23                     INX   H   ;POINT NEXT
18F7   05                     DCR   B   ;DECR CTR
18F8   C2 F3 18               JNZ   FSHFT   ;LOOP
18FB   C9                     RET      ;RETURN
18FC                             ;PAGE
18FC                             ; 
18FC                TERMI:    EQU   $   
18FC                             ; 
18FC                             ; READ A LINE FROM THE TTY
18FC                             ; FIRST PROMPT WITH THE CHAR IN THE A REG
18FC                             ; TERMINATE THE LINE WITH A X"00"
18FC                             ; IGNORE EMPTY LINES
18FC                             ; CONTROL C WILL CANCLE THE LINE
18FC                             ; CONTROL O WILL TOGGLE THE OUTPUT SWITCH
18FC                             ; RUBOUT WILL DELETE THE LAST CHAR INPUT
18FC                             ; 
18FC                             ; 
18FC   32 4F 26               STA   PROMP   ;SAVE THE PROMPT CHAR
18FF   21 CE 24     REIN:     LXI   H,IOBUF   ;POINT TO INPUT BUFFER
1902   36 00                  MVI   M,0   ;MARK BEGIN
1904   23                     INX   H   ;POINT START
1905   3A 4F 26               LDA   PROMP   ;GET THE PROMPT AGAIN
1908   CD 4A 19               CALL   TESTO   ;WRITE TO TERMINAL
190B   FE 3F                  CPI   "?"   ;TEST IF Q.M.
190D   C2 15 19               JNZ   TREAD   ;BRIF NOT
1910   3E 20                  MVI   A," "   ;GET SPACE
1912   CD 4A 19               CALL   TESTO   ;WRITE TO TERMINAL
1915                TREAD:    EQU   $   
1915   AF                     XRA   A   ; select RR0
1916   D3 19                  OUT   SIO_RX_STATUS   
1918   DB 19                  IN   SIO_RX_STATUS   ;GET TTY STATUS
191A   E6 01                  ANI   SIO_RX_FULL   ;TEST IF RXRDY
191C   CA 15 19               JZ   TREAD   ;LOOP TIL CHAR
191F   CD 45 1A               CALL   GETCH   ;GO READ THE CHAR
1922   77                     MOV   M,A   ;PUT IN BUFFER
1923   FE 0D                  CPI   0DH   ;TEST IF LINE FEED
1925   CA 15 19               JZ   TREAD   ;IGNORE IF IT IS
1928   FE 0A                  CPI   0AH   ;TEST IF CR
192A   C2 6B 19               JNZ   NOTCR   ;BRIF NOT
192D   3A 71 24               LDA   TAPES   ;GET PAPER TAPE SWITCH
1930   1F                     RAR      ;TEST IF LOAD
1931   D4 5C 19               CNC   CRLF   ;CR/LF IF NOT
1934   36 00        CR1:      MVI   M,0   ;MARK END
1936   3A 74 24               LDA   ILSW   ;GET INPUT LINE SW
1939   B7                     ORA   A   ;TEST IT
193A   C0                     RNZ      ;RETURN IF ON
193B   2B                     DCX   H   ;POINT PRIOR
193C   7E                     MOV   A,M   ;LOAD IT
193D   FE 20                  CPI   20H   ;TEST IF SPACE
193F   CA 34 19               JZ   CR1   ;BRIF SPACE
1942   B7                     ORA   A   ;TEST IF AT BEGINNING
1943   CA FF 18               JZ   REIN   ;BRIF IS (NULL LINE)
1946   21 CF 24               LXI   H,IOBUF+1   ;POINT BEGIN
1949   C9                     RET      ;ELSE, RETURN
194A   F5           TESTO:    PUSH   PSW   ;SAVE CHAR
194B   AF           TEST1:    XRA   A   ; select RR0
194C   D3 19                  OUT   SIO_TX_STATUS   
194E   DB 19                  IN   SIO_TX_STATUS   ;GET STATUS
1950   E6 04                  ANI   SIO_TX_EMPTY   
1952   CA 4B 19               JZ   TEST1   ;LOOP TILL READY
1955   F1                     POP   PSW   ;GET CHAR
1956   D3 18                  OUT   SIO_TX   ;WRITE IT
1958   00 00 00               DB   0,0,0   ;SAVE ROOM FOR CALL TO USER ROUTINE
195B   C9                     RET      ;RETURN
195C   3E 0D        CRLF:     MVI   A,0DH   ;LOAD A CR
195E   CD 4A 19               CALL   TESTO   ;WRITE IT
1961   3E 0A                  MVI   A,0AH   ;LF
1963   CD 4A 19               CALL   TESTO   ;WRITE IT
1966                             ;        MVI     A,RUBOUT   ;GET RUBOUT CHAR
1966                             ;        MVI     B,0FAH  ;LOAD 255-RUBOUT COUNT
1966                             ;PAUZ:   CALL    TESTO   ;SEND RUBOUT
1966                             ;        INR     B       ;INCREMENT COUNT
1966                             ;        CMP     B       ;COMPARE TO 255
1966                             ;        JNZ     PAUZ    ;SET ANOTHER RUBOUT
1966   AF                     XRA   A   ;GET A ZERO
1967   32 76 26               STA   COLUM   ;RESET COLUMN POINTER
196A   C9                     RET      ;RETURN
196B   FE 15        NOTCR:    CPI   15H   ;TEST IF CONTROL-U
196D   C2 79 19               JNZ   NOTCO   ;BRIF NOT
1970   CD 73 1A               CALL   PRCNT   ;GO PRINT ^U
1973   CD 5C 19               CALL   CRLF   ;GET CR/LF
1976   C3 FF 18               JMP   REIN   ;GO RE-ENTER
1979   FE 08        NOTCO:    CPI   RUBOUT   ;TEST IF RUBOUT 7fh
197B   C2 93 19               JNZ   NOTBS   ;BRIF NOT
197E   3A 71 24               LDA   TAPES   ;GET PAPER TAPE SW
1981   1F                     RAR      ;TEST IF LOAD
1982   DA 15 19               JC   TREAD   ;IGNORE IF LOAD
1985   2B                     DCX   H   ;POINT PRIOR
1986   7E                     MOV   A,M   ;LOAD PREV CHAR
1987   B7                     ORA   A   ;TEST IF BEGIN
1988   CA B4 19               JZ   ECHO   ;BRIF IS
198B   3E 08                  MVI   A,0X08   
198D                             ;        MVI     A,0x5c  ;"\"   ;BACK SLASH
198D                             ;        CALL    TESTO   ;WRITE IT
198D                             ;        MOV     A,M     ;FETCH CHARACTER TO BE DISCARDED
198D                             ;        CALL    TESTO   ;WRITE IT
198D                             ;        MVI     A,0x5c  ;"\"   ;BACK SLASH
198D   CD 4A 19               CALL   TESTO   ;WRITE IT
1990   C3 15 19               JMP   TREAD   ;GET REPLACEMENT CHARACTER
1993                NOTBS:    EQU   $   
1993   FE 08                  CPI   8   ;TEST FOR ASCII BACKSPACE
1995   C2 A9 19               JNZ   NOTCH   ;BRIF NOT CONTROL H
1998   2B                     DCX   H   ;POINT PRIOR
1999   7E                     MOV   A,M   ;FETCH CHARACTER
199A   B7                     ORA   A   ;TEST FOR BEGINNING
199B   CA B4 19               JZ   ECHO   ;BRIF IT IS
199E   E5                     PUSH   H   ;SAVE POSITION
199F   21 94 1D               LXI   H,RBOUT   ;POINT RUBOUT SEQUENCE
19A2   CD C0 19               CALL   TERMM   ;WRITE IT
19A5   E1                     POP   H   ;RESTORE H,L
19A6   C3 15 19               JMP   TREAD   ;GET REPLACEMENT CHARACTER
19A9   3A 71 24     NOTCH:    LDA   TAPES   ;GET PAPER TAPE SWITCH
19AC   1F                     RAR      ;FLAG TO CARRY
19AD   DA B4 19               JC   ECHO   ;NO ECHO IF TAPE
19B0   7E                     MOV   A,M   ;ELSE, LOAD THE CHAR
19B1   CD 4A 19               CALL   TESTO   ;ECHO THE CHARCTER
19B4   23           ECHO:     INX   H   ;POINT NEXT POSIT
19B5   C3 15 19               JMP   TREAD   ;LOOP FOR NEXT
19B8                             ; 
19B8                TERMO:    EQU   $   
19B8                             ; 
19B8                             ; TTY PRINT ROUTINE
19B8                             ; 
19B8                             ; OUTPUT STRING OF CHARS
19B8                             ; STARTING AT IOBUF +0 THRU END (FF OR FE OR 00)
19B8                             ; FOLLOWING IMBEDDED CHARACTERS ARE INTERPRETED AS CONTROLS:
19B8                             ; X"00" END OF BUFFER, TYPE CR/LF AND RETURN
19B8                             ; X"FE" END OF BUFFER, RETURN (NO CR/LF)
19B8                             ; X"FD" TYPE CR/LF, CONTINUE
19B8                             ; 
19B8                             ; RETURN WITHOUT OUTPUT IF OUTPUT SW IS OFF
19B8                             ; 
19B8   3A 73 24               LDA   OUTSW   ;GET OUTPUT SW
19BB   B7                     ORA   A   ;TEST IT
19BC   C0                     RNZ      ;RETURN IF NO PRINT
19BD   21 CE 24               LXI   H,IOBUF   ;POINT I/O BUFFER
19C0   7E           OT1:      MOV   A,M   ;LOAD A BYTE
19C1   FE FE                  CPI   0FEH   ;SEE IF END OF LINE (NO CR/LF)
19C3   C8                     RZ      ;RETURN IF EQUAL
19C4   FE FD                  CPI   0FDH   ;SEE IF IMBEDDED CR/LF
19C6   C2 CF 19               JNZ   OT2   ;BRIF NOT
19C9   CD 5C 19               CALL   CRLF   ;LINE FEED
19CC   C3 DE 19               JMP   OT4   ;CONTINUE
19CF   B7           OT2:      ORA   A   ;TEST IF END OF OUTPUT
19D0   CA 5C 19               JZ   CRLF   ;BRIF IS
19D3   7E                     MOV   A,M   ;LOAD THE BYTE
19D4   CD 4A 19               CALL   TESTO   ;TYPE IT
19D7   3A 76 26               LDA   COLUM   ;GET COLUMN POINTER
19DA   3C                     INR   A   ;ADD ONE
19DB   32 76 26               STA   COLUM   ;RESTORE IT
19DE   23           OT4:      INX   H   ;POINT NEXT
19DF   C3 C0 19               JMP   OT1   ;LOOP
19E2                TERMM:    EQU   OT1   
19E2                             ; 
19E2                TABST:    EQU   $   
19E2                             ; 
19E2                             ; 
19E2                             ; POSITION TTY AT NEXT TAB STOP
19E2                             ; 
19E2                             ; 
19E2   3A 73 24               LDA   OUTSW   ;GET OUTPUT SWITCH
19E5   B7                     ORA   A   ;TEST IT
19E6   C0                     RNZ      ;RETURN IF SUPPRESSED
19E7   3A 76 26               LDA   COLUM   ;GET COLUMN POINTER
19EA   FE 38                  CPI   56   ;COMPARE TO 56
19EC   D2 5C 19               JNC   CRLF   ;BRIF NO ROOM LEFT
19EF   47                     MOV   B,A   ;SAVE IT
19F0   AF                     XRA   A   ;INIT POSITION
19F1   B8           TBLP:     CMP   B   ;COMPARE
19F2   CA F8 19               JZ   TBLP2   
19F5   D2 FD 19               JNC   TBON   ;BRIF SHY OF TAB
19F8   C6 0E        TBLP2:    ADI   14   ;POINT NEXT STOP
19FA   C3 F1 19               JMP   TBLP   ;LOOP
19FD   32 76 26     TBON:     STA   COLUM   ;UPDATE CTR
1A00   90                     SUB   B   ;COMPUTE NUMBER OF SPACES
1A01   47                     MOV   B,A   ;SAVE IT
1A02   3E 20        TBSPA:    MVI   A," "   ;SPACE TO REG A
1A04   CD 4A 19               CALL   TESTO   ;OUTPUT IT
1A07   05                     DCR   B   ;SUB 1 FROM CTR
1A08   C8                     RZ      ;RETURN IF ZERO
1A09   C3 02 1A               JMP   TBSPA   ;ELSE, LOOP
1A0C                             ; 
1A0C                LINEO:    EQU   $   
1A0C                             ; 
1A0C                             ; UNPACK LINE NUMBER FROM (H,L) TO (D,E)
1A0C                             ; ZERO SUPPRESS LEADING ZEROS
1A0C                             ; 
1A0C                             ; 
1A0C   C5                     PUSH   B   ;PUSH B,C
1A0D   06 01                  MVI   B,1   ;SET SWITCH
1A0F   CD 17 1A               CALL   LOUT   ;GO FORMAT 2 BYTES
1A12   CD 17 1A               CALL   LOUT   ;THEN THE NEXT 2
1A15   C1                     POP   B   ;RESTORE B,C
1A16   C9                     RET      ;RETURN
1A17                             ; 
1A17                LOUT:     EQU   $   
1A17   7E                     MOV   A,M   ;GET BYTE
1A18   E6 F0                  ANI   0F0H   ;ISOLATE LEFT HALF
1A1A   1F                     RAR      ;SHIFT RIGHT 1 BIT
1A1B   1F                     RAR      ;AGAIN
1A1C   1F                     RAR      ;AGAIN
1A1D   1F                     RAR      ;LAST TIME
1A1E   C2 25 1A               JNZ   NOTZ1   ;BRIF NOT ZERO
1A21   B0                     ORA   B   ;MERGE IN B
1A22   C2 2B 1A               JNZ   Z1   ;BRIF ZERO
1A25   06 00        NOTZ1:    MVI   B,0   ;RESET SWITCH
1A27   F6 30                  ORI   30H   ;ZONE
1A29   12                     STAX   D   ;PUT TO BUFFER
1A2A   13                     INX   D   ;POINT NEXT
1A2B   7E           Z1:       MOV   A,M   ;LOAD BYTE
1A2C   E6 0F                  ANI   0FH   ;MASK
1A2E   C2 35 1A               JNZ   NOTZ2   ;BRIF NOT ZERO
1A31   B0                     ORA   B   ;MERGE SWITCH
1A32   C2 3B 1A               JNZ   Z2   ;BRIF ZERO
1A35   06 00        NOTZ2:    MVI   B,0   ;SET SWITCH OFF
1A37   F6 30                  ORI   30H   ;ZONE
1A39   12                     STAX   D   ;PUT TO BUFFER
1A3A   13                     INX   D   ;POINT TO NEXT
1A3B   23           Z2:       INX   H   ;AND NEXT LINE BYTE
1A3C   C9                     RET      ;RETURN
1A3D                             ; 
1A3D                TSTCC:    EQU   $   
1A3D                             ; 
1A3D                             ; TEST IF KEY WAS PRESSED DURING EXECUTION
1A3D                             ; CANCEL IF CONTROL-C
1A3D                             ; TOGGLE OUTPUT SUPPRESS SW IF CONTROL-O
1A3D                             ; 
1A3D   AF                     XRA   A   ; select RR0
1A3E   D3 19                  OUT   SIO_RX_STATUS   
1A40   DB 19                  IN   SIO_RX_STATUS   ;GET TTY STATUS
1A42   E6 01                  ANI   SIO_RX_FULL   ;TEST IF RXRDY
1A44   C8                     RZ      ;RETURN IF NO CHAR
1A45   DB 18        GETCH:    IN   SIO_RX   ;READ THE CHAR
1A47   E6 7F                  ANI   7FH   ;TURN OFF PARITY
1A49   FE 03                  CPI   3   ;TEST IF CONTROL C
1A4B   C2 64 1A               JNZ   TSTC1   ;BRIF NOT
1A4E   CD 73 1A               CALL   PRCNT   ;GO PRINT ^C
1A51   3A 76 24               LDA   EDSW   ;GET MODE SW
1A54   B7                     ORA   A   ;TEST IT
1A55   C2 D4 01               JNZ   KEY   ;**;BRIF COMMAND MODE
1A58   21 41 1E               LXI   H,STOPM   ;POINT MSG
1A5B   CD C0 19               CALL   TERMM   ;GO PRINT IT
1A5E   CD F7 1B               CALL   PRLIN   ;GO PRINT LINE
1A61   C3 D4 01               JMP   KEY   ;GOTO READY
1A64   FE 0F        TSTC1:    CPI   0FH   ;TEST IF CONTROL O
1A66   C0                     RNZ      ;RETURN IF NOT
1A67   CD 73 1A               CALL   PRCNT   ;GO PRINT ^O
1A6A   3A 73 24               LDA   OUTSW   ;GET OUTPUT SWTICH
1A6D   EE 01                  XRI   1   ;TOGGLE
1A6F   32 73 24               STA   OUTSW   ;PUT SW
1A72   C9                     RET      ;RETURN
1A73                             ; 
1A73                PRCNT:    EQU   $   
1A73                             ; 
1A73                             ; 
1A73                             ; PRINTS ^ AND CHAR
1A73                             ; 
1A73   F5                     PUSH   PSW   ;SAVE CHAR
1A74   3E 5E                  MVI   A,"^"   ;GET UP ARROW
1A76   CD 4A 19               CALL   TESTO   ;WRITE IT
1A79   F1                     POP   PSW   ;GET CHAR
1A7A   C6 40                  ADI   64   ;TRNSLATE
1A7C   C3 4A 19               JMP   TESTO   ;WRITE IT
1A7F                             ;PAGE
1A7F                             ; 
1A7F                COMP2:    EQU   $   
1A7F                             ; 
1A7F                             ; CONTINUATION OF COMPARE (RST 2) ROUTINE
1A7F                             ; 
1A7F   B7                     ORA   A   ;TEST IT
1A80   C2 87 1A               JNZ   COMP5   ;BRIF NOT END
1A83   AF           COMP3:    XRA   A   ;SET EQUAL STATUS
1A84   7E           COMP4:    MOV   A,M   ;GET LAST CHAR
1A85   C1                     POP   B   ;RESTORE B,C
1A86   C9                     RET      ;RETURN
1A87   BE           COMP5:    CMP   M   ;COMPARE THE TWO CHARS
1A88   CA 94 1A               JZ   COMP6   ;BRIF EQUAL
1A8B   78                     MOV   A,B   ;GET COUNT
1A8C   FE 03                  CPI   3   ;GET IF >= 3
1A8E   D2 83 1A               JNC   COMP3   ;BRIF NOT LESS THAN 3
1A91   C3 84 1A               JMP   COMP4   ;BRIF LESS THAN 3 AND NOT EQUAL
1A94   04           COMP6:    INR   B   ;COUNT IT
1A95   13                     INX   D   ;POINT NEXT LIT
1A96   23                     INX   H   ;POINT NEXT VAR
1A97   C3 13 00               JMP   COMP1   ;CONTINUE
1A9A                             ; 
1A9A                EOL:      EQU   $   
1A9A                             ; 
1A9A                             ; TESTS IF (H,L) IS END OF LINE
1A9A                             ; ERROR-DL IF NOT
1A9A                             ; 
1A9A   CF                     RST   1   ;SKIP TO NON-BLANK
1A9B   CD AE 1A               CALL   TSTEL   ;TEST IF END LINE
1A9E   C2 15 1C               JNZ   SNERR   ;ERROR IF NOT
1AA1   FE 3A                  CPI   ":"   ;TEST FOR MULTIPLE STATEMENT
1AA3   C2 A9 1A               JNZ   EOL1   ;BRIF NOT
1AA6   32 74 26               STA   MULTI   ;SET SWITCH
1AA9   23           EOL1:     INX   H   ;POINT NEXT
1AAA   22 72 26               SHLD   ENDLI   ;SAVE POINTER
1AAD   C9                     RET      ;RETURN
1AAE                             ; 
1AAE                TSTEL:    EQU   $   
1AAE                             ; 
1AAE                             ; TEST (H,L) FOR END OF STATEMENT (00H OR ":")
1AAE                             ; RETURN WITH Z SET IF IT IS
1AAE                             ; 
1AAE   B7                     ORA   A   ;TEST FOR ZERO
1AAF   C8                     RZ      ;RETURN IF IS
1AB0   FE 3A                  CPI   ":"   ;TEST FOR MULTIPLE STATEMENT
1AB2   C9                     RET      ;RETURN
1AB3                             ; 
1AB3                NOTEO:    EQU   $   
1AB3                             ; 
1AB3                             ; 
1AB3                             ; TEST IF (H,L) IS END OF LINE
1AB3                             ; RETURN IF NOT, ERROR-DL IF IS
1AB3                             ; 
1AB3   CF                     RST   1   ;SKIP TO NON-BLANK
1AB4   CD AE 1A               CALL   TSTEL   ;TEST IF END OF LINE
1AB7   CA 15 1C               JZ   SNERR   ;ERROR IF IS
1ABA   C9                     RET      ;ELSE, RETURN
1ABB                             ; 
1ABB                PACK:     EQU   $   
1ABB                             ; 
1ABB                             ; PACK LINE NUMBER FROM (H,L) TO B,C
1ABB                             ; 
1ABB                             ; 
1ABB   01 00 00               LXI   B,0   ;CLEAR B AND C
1ABE   3E 04                  MVI   A,4   ;INIT DIGIT COUNTER
1AC0   32 8D 26               STA   PRSW   ;SAVE A
1AC3   7E           PK1:      MOV   A,M   ;GET CHAR ### THIS HAPPENS AGAIN IN NUMER
1AC4   CD 30 1B               CALL   NUMER   ;TEST FOR NUMERIC
1AC7   C0                     RNZ      ;RETURN IF NOT NUMERIC
1AC8   E6 0F                  ANI   0FH   ;STRIP OFF ZONE
1ACA   57                     MOV   D,A   ;SAVE IT
1ACB   3A 8D 26               LDA   PRSW   ;GET COUNT
1ACE   3D                     DCR   A   ;SUBTRACT ONE
1ACF   FA 15 1C               JM   SNERR   ;BRIF ERROR
1AD2   32 8D 26               STA   PRSW   ;SAVE CTR
1AD5   1E 04                  MVI   E,4   ;4 BIT SHIFT LOOP
1AD7   79           PK3:      MOV   A,C   ;GET LOW BYTE
1AD8   17                     RAL      ;ROTATE LEFT 1 BIT
1AD9   4F                     MOV   C,A   ;REPLACE
1ADA   78                     MOV   A,B   ;GET HIGH BYTE
1ADB   17                     RAL      ;ROTATE LEFT 1 BIT
1ADC   47                     MOV   B,A   ;REPLACE
1ADD   1D                     DCR   E   ;DECR CTR
1ADE   C2 D7 1A               JNZ   PK3   ;LOOP
1AE1   79                     MOV   A,C   ;GET LOW
1AE2   B2                     ORA   D   ;PUT DIGIT IN RIGHT HALF OF BYTE
1AE3   4F                     MOV   C,A   ;REPLACE
1AE4   23                     INX   H   ;POINT NEXT BYTE
1AE5   C3 C3 1A               JMP   PK1   ;LOOP
1AE8                             ; 
1AE8                SQUIS:    EQU   $   
1AE8                             ; 
1AE8                             ; COMPRESS THE EXPR STACK
1AE8                             ; REG A CONTAINS # OF BYTES TO REMOVE STARTING AT (H,L+1)
1AE8                             ; CONTAINS TOTAL NUMBER OF CHARACTERS IN STACK THUS FAR
1AE8                             ; 
1AE8   E5                     PUSH   H   ;SAVE H,L
1AE9   5F                     MOV   E,A   ;COUNT TO E
1AEA   16 00                  MVI   D,0   ;ZERO HI BYTE
1AEC   19                     DAD   D   ;COMPUTE START
1AED   EB                     XCHG      ;PUT TO D,E
1AEE   E1                     POP   H   ;GET H,L
1AEF   2F                     CMA      ;COMPLEMENT COUNT
1AF0   3C                     INR   A   ;THEN 2'S COMPLEMENT
1AF1   80                     ADD   B   ;COMPUTE B-A
1AF2   47                     MOV   B,A   ;PUT TO B
1AF3   13           SQUI2:    INX   D   ;POINT NEXT SEND
1AF4   23                     INX   H   ;POINT NEXT RECEIVE
1AF5   1A                     LDAX   D   ;GET A CHAR
1AF6   77                     MOV   M,A   ;PUT IT DOWN
1AF7   05                     DCR   B   ;DECR CTR
1AF8   C2 F3 1A               JNZ   SQUI2   ;LOOP
1AFB   22 50 26               SHLD   EXPRS   ;UPDATE NEW START OF EXPR
1AFE   C9                     RET      ;RETURN
1AFF                             ; 
1AFF                SKP2Z:    EQU   $   
1AFF                             ; 
1AFF                             ; FIND END OF LITERAL IN (D,E)
1AFF                             ; 
1AFF   1A                     LDAX   D   ;GET BYTE OF LIT
1B00   B7                     ORA   A   ;TEST IT
1B01   C8                     RZ      ;RETURN IF ZERO (END)
1B02   13                     INX   D   ;ELSE, POINT NEXT
1B03   C3 FF 1A               JMP   SKP2Z   ;LOOP
1B06                             ; 
1B06                GTEMP:    EQU   $   
1B06                             ; 
1B06                             ; GETS FOUR BYTE TEMPORARY STORAGE AREA,
1B06                             ; STORES THE FACC THERE,
1B06                             ; PUTS ADDR OF AREA IN EXPR STACK (H,L)
1B06                             ; 
1B06   EB                     XCHG      ;SAVE H,L IN D,E
1B07   E3                     XTHL      ;EXCHANGE 0 AND RET ADDR
1B08   E5                     PUSH   H   ;PUT NEW RET ADDR
1B09   E5                     PUSH   H   ;DOIT IT AGAIN
1B0A   21 00 00               LXI   H,0   ;ZERO H,L
1B0D   39                     DAD   SP   ;GET SP ADDR IN H,L
1B0E   23                     INX   H   ;PLUS ONE
1B0F   23                     INX   H   ;PLUS ONE MORE (POINT TO NEW AREA)
1B10   C5                     PUSH   B   ;SAVE CTRS
1B11   D5                     PUSH   D   ;SAVE EXPR ADDR
1B12   E5                     PUSH   H   ;SAVE TEMP ADDR
1B13   DF                     RST   3   ;GO STORE FACC
1B14   D1                     POP   D   ;RESTORE TEMP ADDR
1B15   2A 69 26               LHLD   SPCTR   ;GET COUNT
1B18   23                     INX   H   ;PLUS ONE
1B19   23                     INX   H   ;ONE MORE
1B1A   22 69 26               SHLD   SPCTR   ;PUT BACK
1B1D   E1                     POP   H   ;RESTORE EXPR ADDR
1B1E   C1                     POP   B   ;RESTORE CTRS
1B1F   23           SADR:     INX   H   ;POINT NEXT BYTE
1B20   72                     MOV   M,D   ;HIGH BYTE TO EXPRSTK
1B21   23                     INX   H   ;POINT NEXT
1B22   73                     MOV   M,E   ;LOW BYTE TO EXPR STK
1B23   23                     INX   H   ;POINT NEXT
1B24   36 E3                  MVI   M,0E3H   ;CODE = NUMERIC DATA
1B26   C9                     RET      ;RETURN
1B27                             ; 
1B27                ALPHA:    EQU   $   
1B27                             ; 
1B27                             ; TESTS THE CHAR AT (H,L)
1B27                             ; RETURNS WITH Z SET IF CHAR IS ALPHA (A-Z)
1B27                             ; RETURNS WITH Z OFF IF NOT ALPHA
1B27                             ; CHAR IS LEFT IN REG A
1B27                             ; 
1B27   7E                     MOV   A,M   ;PUT CHAR TO REG A
1B28   FE 41                  CPI   "A"   ;TEST IF A OR HIGHER
1B2A   D8                     RC      ;RETURN IF NOT ALPHA (Z IS OFF)
1B2B   FE 5A                  CPI   "Z"   ;TEST IF Z OR LESS
1B2D   C3 36 1B               JMP   NUMEN   ;GO WRAPUP
1B30                             ; 
1B30                NUMER:    EQU   $   
1B30                             ; 
1B30                             ; TESTS THE CHAR AT (H,L)
1B30                             ; RETURNS WITH Z SET IF NUMERIC (0-9)
1B30                             ; ELSE Z IS OFF
1B30                             ; CHAR IS LEFT IN THE A REG
1B30                             ; 
1B30   7E                     MOV   A,M   ;GET CHAR TO REG A
1B31   FE 30                  CPI   "0"   ;TEST IF ZERO OR GREATER
1B33   D8                     RC      ;RETURN IF LESS THAN ZERO
1B34   FE 39                  CPI   "9"   ;TEST IF 9 OR LESS
1B36   C8           NUMEN:    RZ      ;RETURN IF 9
1B37   D0                     RNC      ;RETURN IF NOT NUMERIC
1B38   BF                     CMP   A   ;SET Z
1B39   C9                     RET      ;RETURN
1B3A                             ; 
1B3A                SEARC:    EQU   $   
1B3A                             ; 
1B3A                             ; SEARCHES FOR THE VARIABLE IN D,E
1B3A                             ; RETURNS WITH ADDR OF DATA AREA FOR VARIABLE
1B3A                             ; 
1B3A   E5                     PUSH   H   ;SAVE H,L
1B3B   3A 88 26               LDA   FNMOD   ;GET FUNCTION MODE
1B3E   B7                     ORA   A   ;TEST IT
1B3F   C2 95 1B               JNZ   SCH6   ;BRIF IN A FUNCTION
1B42   2A 91 26     SCH0:     LHLD   DATAB   ;GET ADDR OF DATA POOL
1B45   7E           SCH1:     MOV   A,M   ;GET THE BYTE
1B46   B7                     ORA   A   ;TEST IF END
1B47   CA 6B 1B               JZ   SCH3   ;BRIF END
1B4A   2B                     DCX   H   ;POINT NEXT
1B4B   2B                     DCX   H   ;DITTO
1B4C   46                     MOV   B,M   ;GET HI LEN
1B4D   2B                     DCX   H   ;POINT NEXT
1B4E   4E                     MOV   C,M   ;GET LO LEN
1B4F   E7                     RST   4   ;ADJUST H,L
1B50   03                     DB   3   
1B51   7E                     MOV   A,M   ;LOAD 1ST CHAR
1B52   BA                     CMP   D   ;COMPARE 1ST CHAR
1B53   C2 67 1B               JNZ   SCH2   ;BRIF NOT EQUAL
1B56   2B                     DCX   H   ;POINT NEXT
1B57   7E                     MOV   A,M   ;LOAD 2ND DIGIT
1B58   23                     INX   H   ;POINT BACK
1B59   BB                     CMP   E   ;COMPARE 2ND CHAR
1B5A   C2 67 1B               JNZ   SCH2   ;BRIF NOT EQUAL
1B5D   7A                     MOV   A,D   ;GET HI NAME
1B5E   B7                     ORA   A   ;TEST IT
1B5F   FA CA 1B               JM   SCH9   ;RETURN IF MATRIX
1B62   09                     DAD   B   ;POINT NEXT ENTRY
1B63   23                     INX   H   ;PLUS ONE
1B64   EB                     XCHG      ;FLIP/FLOP
1B65   E1                     POP   H   ;RESTORE H
1B66   C9                     RET      ;RETURN
1B67   09           SCH2:     DAD   B   ;MINUS LEN
1B68   C3 45 1B               JMP   SCH1   ;LOOP
1B6B   72           SCH3:     MOV   M,D   ;PUT 1ST CHAR
1B6C   2B                     DCX   H   ;POINT NEXT
1B6D   73                     MOV   M,E   ;PUT 2ND CHAR
1B6E   2B                     DCX   H   ;POINT NEXT
1B6F   7A                     MOV   A,D   ;GET HI NAME
1B70   B7                     ORA   A   ;TEST IT
1B71   FA A9 1B               JM   SCH7   ;BRIF ARRAY
1B74   36 FF                  MVI   M,0FFH   ;HI LEN
1B76   2B                     DCX   H   ;POINT NEXT
1B77   7B                     MOV   A,E   ;GET LO NAME
1B78   B7                     ORA   A   ;TEST TYPE
1B79   FA 83 1B               JM   SCH4   ;BRIF CHAR
1B7C   36 F8                  MVI   M,0F8H   ;LO LEN
1B7E   06 04                  MVI   B,4   ;LOOP CTR
1B80   C3 87 1B               JMP   SCH5   ;BRARND
1B83   36 FB        SCH4:     MVI   M,0FBH   ;LO LEN
1B85   06 01                  MVI   B,1   ;LOOP CTR
1B87   2B           SCH5:     DCX   H   ;POINT NEXT
1B88   36 00                  MVI   M,0   ;ZERO THE VALUE
1B8A   05                     DCR   B   ;DECR CTR
1B8B   C2 87 1B               JNZ   SCH5   ;LOOP
1B8E   2B                     DCX   H   ;POINT NEXT
1B8F   36 00                  MVI   M,0   ;MARK NEW END
1B91   23                     INX   H   ;POINT ADDR OF VARIABLE
1B92   EB                     XCHG      ;PUT LOCATION TO D,E
1B93   E1                     POP   H   ;RESTORE H,L
1B94   C9                     RET      ;RETURN
1B95   21 6C 26     SCH6:     LXI   H,FNARG   ;POINT DUMMY ARG
1B98   7E                     MOV   A,M   ;LOAD 1ST CHAR
1B99   BA                     CMP   D   ;COMPARE
1B9A   C2 42 1B               JNZ   SCH0   ;BRIF NOT EQUAL
1B9D   23                     INX   H   ;POINT NEXT
1B9E   7E                     MOV   A,M   ;LOAD 2ND CHAR
1B9F   BB                     CMP   E   ;COMPARE
1BA0   C2 42 1B               JNZ   SCH0   ;BRIF NOT EQUAL
1BA3   23                     INX   H   ;POINT NEXT
1BA4   56                     MOV   D,M   ;GET HI ADDR
1BA5   23                     INX   H   ;POINT NEXT
1BA6   5E                     MOV   E,M   ;GET LO ADDR
1BA7   E1                     POP   H   ;RESTORE H,L
1BA8   C9                     RET      ;RETURN
1BA9   E5           SCH7:     PUSH   H   ;SAVE ADDRESS
1BAA   36 FE                  MVI   M,0FEH   ;MOVE HI DISP
1BAC   2B                     DCX   H   ;POINT NEXT
1BAD   36 14                  MVI   M,14H   ;MOVE LO DISP
1BAF   2B                     DCX   H   
1BB0   36 00                  MVI   M,0   ;MOVE A ZERO
1BB2   2B                     DCX   H   ;POINT NEXT
1BB3   36 0A                  MVI   M,10   ;MOVE 10
1BB5   2B                     DCX   H   ;POINT NEXT
1BB6   36 00                  MVI   M,0   ;MOVE A ZERO
1BB8   2B                     DCX   H   ;POINT NEXT
1BB9   36 0A                  MVI   M,10   ;MOVE A 10 (DEFAULT IS 10 X 10)
1BBB   01 E5 01               LXI   B,485   ;TOTAL # OF BYTES TAKEN BY ARRAY
1BBE   2B           SCH8:     DCX   H   ;POINT NEXT
1BBF   36 00                  MVI   M,0   ;CLEAR ONE BYTE
1BC1   0B                     DCX   B   ;DCR CTR
1BC2   78                     MOV   A,B   ;GET HI
1BC3   B1                     ORA   C   ;PLUS LO
1BC4   C2 BE 1B               JNZ   SCH8   ;LOOP
1BC7   E1                     POP   H   ;RESTORE PTR TO START
1BC8   23                     INX   H   ;POINT LO NAME
1BC9   23                     INX   H   ;POINT HI NAME
1BCA   C1           SCH9:     POP   B   ;NEED TO XCHANGE LAST 2 STACK ENTRIES
1BCB   D1                     POP   D   ;SO DOIT
1BCC   C5                     PUSH   B   
1BCD   D5                     PUSH   D   
1BCE   C9                     RET      ;RETURN
1BCF                             ; 
1BCF                VAR:      EQU   $   
1BCF                             ; 
1BCF                             ; 
1BCF                             ; TEST (H,L) FOR A VARIABLE NAME
1BCF                             ; PUTS THE NAME IN D,E IF FOUND
1BCF                             ; ERROR SN IF NONE FOUND
1BCF                             ; 
1BCF   CF                     RST   1   ;SKIP TO NON-BLANK
1BD0   CD 27 1B               CALL   ALPHA   ;TEST IF ALPHA
1BD3   C2 15 1C               JNZ   SNERR   ;BRIF NOT ALPHA
1BD6   57                     MOV   D,A   ;FIRST CHAR
1BD7   1E 20                  MVI   E," "   ;DEFAULT
1BD9   23                     INX   H   ;POINT NEXT
1BDA   CF                     RST   1   ;GET 2ND CHAR
1BDB   CD 30 1B               CALL   NUMER   ;TEST IF NUMERIC
1BDE   C2 E4 1B               JNZ   VAR2   ;BRIF NOT NUMERIC
1BE1   5F                     MOV   E,A   ;SAVE 2ND CHAR
1BE2   23                     INX   H   ;POINT NEXT
1BE3   CF                     RST   1   ;GET NON-BLANK FOLLOWING
1BE4   FE 24        VAR2:     CPI   "$"   ;TEST IF STRING
1BE6   C2 EF 1B               JNZ   VAR3   ;BRIF NOT
1BE9   7B                     MOV   A,E   ;GET 2ND CHAR
1BEA   F6 80                  ORI   80H   ;SET TYPE
1BEC   5F                     MOV   E,A   ;SAVE IT
1BED   23                     INX   H   ;SKIP $
1BEE   C9                     RET      ;THEN RETURN
1BEF   FE 28        VAR3:     CPI   "("   ;TEST IF ARRAY
1BF1   C0                     RNZ      ;RETURN IF NOT
1BF2   7A                     MOV   A,D   ;GET HI NAME
1BF3   F6 80                  ORI   80H   ;TURN ON D7
1BF5   57                     MOV   D,A   ;RESTORE
1BF6   C9                     RET      ;RETURN
1BF7                             ; 
1BF7                PRLIN:    EQU   $   
1BF7                             ; 
1BF7                             ; PRINTS LINE NUMBER FOLLOWED BY CR/LF
1BF7                             ; 
1BF7   11 77 24               LXI   D,LINEN   ;POINT AREA
1BFA   2A 89 26               LHLD   LINE   ;GET ADDR OF LINE NUMBER
1BFD   CD 0C 1A               CALL   LINEO   ;GO UNPACK
1C00   EB                     XCHG      ;PUT TO H,L
1C01   36 00                  MVI   M,0   ;END OF MSG
1C03   21 77 24               LXI   H,LINEN   ;POINT AREA
1C06   C3 C0 19               JMP   TERMM   ;GO PRINT IT
1C09                             ;PAGE
1C09                             ; 
1C09                             ; ERROR MESSAGE ROUTINES
1C09                             ; FATAL ERROR MUST BE FIRST
1C09                             ; 
1C09                EM:       EQU   0FEH   
1C09                             ; 
1C09   F7           ULERR:    RST   6   
1C0A   55 4C FE F7            DB   "UL",EM,FATAL   ;NOTE FATAL = CODE FOR RST 6
1C0E                ZMERR:    EQU   $-1   ;LOG(X<=0),SQR(-X),0 DIVIDE
1C0E   4F 46 FE F7            DB   "OF",EM,FATAL   
1C12                STERR:    EQU   $-1   ;ERROR IN EXPRESSION STACK
1C12   53 54 FE F7            DB   "ST",EM,FATAL   
1C16                SNERR:    EQU   $-1   ;DELIMITER ERROR
1C16   53 4E FE F7            DB   "SN",EM,FATAL   
1C1A                RTERR:    EQU   $-1   ;RETURN & NO GOSUB
1C1A   52 54 FE F7            DB   "RT",EM,FATAL   
1C1E                DAERR:    EQU   $-1   ;OUT OF DATA
1C1E   44 41 FE F7            DB   "DA",EM,FATAL   
1C22                NXERR:    EQU   $-1   ;NEXT & NO FOR / >8 FOR'S
1C22   4E 58 FE F7            DB   "NX",EM,FATAL   
1C26                CVERR:    EQU   $-1   ;CONVERSION ERROR
1C26   43 56 FE F7            DB   "CV",EM,FATAL   
1C2A                CKERR:    EQU   $-1   ;CHECKSUM ERROR
1C2A   43 4B FE F7            DB   "CK",EM,FATAL   
1C2E                             ; 
1C2E                             ; NON-FATAL ERRORS
1C2E                             ; 
1C2E                OVERR:    EQU   $-1   ;OVERFLOW ERROR
1C2E   4F 56 FE               DB   "OV",EM   
1C31   C9                     RET      ;RETURN TO ROUTINE
1C32   F7           UNERR:    RST   6   ;CALL   ERROR ROUTINE
1C33   55 4E FE               DB   "UN",EM   
1C36   C9                     RET      
1C37                             ; 
1C37                             ; CONTINUATION OF ERROR MESSAGE ROUTINE (RST 6)
1C37                             ; 
1C37   CD C0 19     ERROR:    CALL   TERMM   ;PRINT "XX"
1C3A   E5                     PUSH   H   ;SAVE RETURN
1C3B   21 50 1E               LXI   H,ERRMS   ;PRINT "ERROR IN LINE"
1C3E   CD C0 19               CALL   TERMM   
1C41   CD F7 1B               CALL   PRLIN   ;PRINT LINE #
1C44   E1                     POP   H   
1C45   23                     INX   H   ;RETURN ADDRESS
1C46   7E                     MOV   A,M   ;GET INSTRUCTION
1C47   FE F7                  CPI   FATAL   ;IS IT AN RST 6?
1C49   CA D4 01               JZ   KEY   ;IF ZERO, YES, ABORT
1C4C   C1                     POP   B   ;RESTORE REGISTERS
1C4D   D1                     POP   D   
1C4E   F1                     POP   PSW   
1C4F   E3                     XTHL      
1C50   C9                     RET      
1C51                             ;PAGE
1C51                             ; 
1C51                             ; 
1C51                             ; MOVE THE STRING FROM (D,E) TO (H,L) COUNT IN B
1C51                             ; 
1C51                             ; 
1C51   06 04        CPY4D:    MVI   B,4   
1C53   1A           COPYD:    LDAX   D   ;GET A BYTE
1C54   77                     MOV   M,A   ;MOVE IT
1C55   23                     INX   H   ;POINT NEXT
1C56   13                     INX   D   ;DITTO
1C57   05                     DCR   B   ;DECR CTR
1C58   C2 53 1C               JNZ   COPYD   ;LOOP
1C5B   C9                     RET      ;THEN RETURN
1C5C                             ; 
1C5C                             ; 
1C5C                             ; MOVE THE STRING FROM (H,L) TO (D,E) COUNT IN B
1C5C                             ; 
1C5C                             ; 
1C5C   06 04        CPY4H:    MVI   B,4   
1C5E   EB           COPYH:    XCHG      ;FLIP/FLOP
1C5F   CD 53 1C               CALL   COPYD   ;GO COPY
1C62   EB                     XCHG      ;FLIP/FLOP BACK
1C63   C9                     RET      ;RETURN
1C64                             ; 
1C64                ZEROM:    EQU   $   
1C64                             ; 
1C64                             ; MOVES A STRING OF BINARY ZEROS, COUNT IN B
1C64                             ; 
1C64   36 00                  MVI   M,0   ;MOVE A ZERO
1C66   23                     INX   H   ;POINT NEXT
1C67   05                     DCR   B   ;DECR CTR
1C68   C2 64 1C               JNZ   ZEROM   ;LOOP
1C6B   C9                     RET      ;RETURN
1C6C                             ; 
1C6C                FBIN:     EQU   $   
1C6C                             ; 
1C6C                             ; 
1C6C                             ; CONVERT FLOAT ACC TO UNSIGNED BINARY NUMBER IN A REG
1C6C                             ; RETURNS 0 IN A REG IF FACC<0 OR FACC>255
1C6C                             ; 
1C6C                             ; 
1C6C   E5                     PUSH   H   ;SAVE H,L
1C6D   D5                     PUSH   D   ;SAVE D,E
1C6E   CD 60 1F               CALL   FACDE   ;CONVERT FACC TO D,E
1C71   AF                     XRA   A   ;ZERO A
1C72   B2                     ORA   D   ;TEST HIGH VALUE
1C73   C2 77 1C               JNZ   FBIN1   ;BRIF NOT ZERO
1C76   7B                     MOV   A,E   ;VALUE TO A
1C77   D1           FBIN1:    POP   D   ;RESTORE D,E
1C78   E1                     POP   H   ;RESTORE H,L
1C79   C9                     RET      ;RETURN
1C7A                             ; 
1C7A                ARG:      EQU   $   
1C7A                             ; 
1C7A                             ; GET NEXT ARGUMENT FROM POLISH STACK
1C7A                             ; 
1C7A   2A 52 26               LHLD   ADDR1   ;GET ADDRESS
1C7D   23                     INX   H   ;POINT NEXT
1C7E   56                     MOV   D,M   ;GET HI ADDRESS
1C7F   23                     INX   H   ;POINT NEXT
1C80   5E                     MOV   E,M   ;GET LO ADDRESS
1C81   23                     INX   H   ;POINT TYPE
1C82   22 52 26               SHLD   ADDR1   ;GET ADDRESS
1C85   2B                     DCX   H   ;POINT BACK
1C86   C3 7B 13               JMP   EVLD   ;CALL EVLOAD AND RETURN
1C89                             ; 
1C89                             ; 
1C89                ARGNU:    EQU   $   
1C89                             ; 
1C89   CD 7A 1C               CALL   ARG   ;GET ARGUMENT
1C8C   C3 6C 1C               JMP   FBIN   ;THEN CONVERT FACC TO BIN
1C8F                             ; 
1C8F                BINFL:    EQU   $   
1C8F                             ; 
1C8F                             ; CONVERT D,E TO FLOATING POINT NUMBER IN FAC
1C8F                             ; 
1C8F                             ; 
1C8F   21 58 26               LXI   H,FACC   ;POINT ACC
1C92   36 18                  MVI   M,24   ;MAX BITS
1C94   23                     INX   H   ;POINT NEXT
1C95   36 00                  MVI   M,0   ;CLEAR MSB
1C97   23                     INX   H   ;POINT NEXT
1C98   72                     MOV   M,D   ;MOVE MID
1C99   23                     INX   H   ;POINT NEXT
1C9A   73                     MOV   M,E   ;MOVE LSB
1C9B   C3 D5 16               JMP   FNORM   ;GO NORMALIZE & RETURN
1C9E                             ;PAGE
1C9E                             ; 
1C9E                             ; FUNCTION TABLE. FORMAT IS:
1C9E                             ;     DB <LITERAL>,0
1C9E                             ;     DW <ADDRESS>
1C9E                             ;     DB <FUNCTION TYPE>
1C9E                             ; 
1C9E                             ; TABLE IS TERMINATED WITH A "00"
1C9E                             ; 
1C9E                FUNCT:    EQU   $   
1C9E   41 42 53 00            DB   "ABS",0   
1CA2   BF 0B                  DW   ABS   
1CA4   AB                     DB   0ABH   
1CA5   53 51 52 00            DB   "SQR",0   
1CA9   1F 0C                  DW   SQR   
1CAB   AB                     DB   0ABH   
1CAC   49 4E 54 00            DB   "INT",0   
1CB0   DA 0B                  DW   INT   
1CB2   AB                     DB   0ABH   
1CB3   53 47 4E 00            DB   "SGN",0   
1CB7   C8 0B                  DW   SGN   
1CB9   AB                     DB   0ABH   
1CBA   52 4E 44 00  RNDLI:    DB   "RND",0   
1CBE   7C 0C                  DW   RND   
1CC0   AB                     DB   0ABH   
1CC1   53 49 4E 00            DB   "SIN",0   
1CC5   39 0A                  DW   SIN   
1CC7   AB                     DB   0ABH   
1CC8   43 4F 53 00            DB   "COS",0   
1CCC   AB 0A                  DW   COS   
1CCE   AB                     DB   0ABH   
1CCF   54 41 4E 00            DB   "TAN",0   
1CD3   B4 0A                  DW   TAN   
1CD5   AB                     DB   0ABH   
1CD6   41 54 4E 00            DB   "ATN",0   
1CDA   CC 0A                  DW   ATN   
1CDC   AB                     DB   0ABH   
1CDD   49 4E 50 00            DB   "INP",0   
1CE1   02 0D                  DW   INP   
1CE3   AB                     DB   0ABH   
1CE4   4C 4E 00               DB   "LN",0   
1CE7   0B 0B                  DW   LN   
1CE9   AB                     DB   0ABH   
1CEA   4C 4F 47 00            DB   "LOG",0   
1CEE   59 0B                  DW   LOG   
1CF0   AB                     DB   0ABH   
1CF1   45 58 50 00            DB   "EXP",0   
1CF5   62 0B                  DW   EXP   
1CF7   AB                     DB   0ABH   
1CF8   50 4F 53 00            DB   "POS",0   
1CFC   18 0D                  DW   POS   
1CFE   AB                     DB   0ABH   
1CFF   4C 45 4E 00            DB   "LEN",0   
1D03   81 0D                  DW   LENFN   
1D05   AB                     DB   0ABH   
1D06   43 48 52 24 00         DB   "CHR$",0   
1D0B   87 0D                  DW   CHRFN   
1D0D   CB                     DB   0CBH   
1D0E   41 53 43 49 49 00      DB   "ASCII",0   
1D14   92 0D                  DW   ASCII   
1D16   AB                     DB   0ABH   
1D17   4E 55 4D 24 00         DB   "NUM$",0   
1D1C   9F 0D                  DW   NUMFN   
1D1E   CB                     DB   0CBH   
1D1F   56 41 4C 00            DB   "VAL",0   
1D23   B2 0D                  DW   VAL   
1D25   AB                     DB   0ABH   
1D26   53 50 41 43 45 24 00   DB   "SPACE$",0   
1D2D   D9 0D                  DW   SPACE   
1D2F   CB                     DB   0CBH   
1D30   53 54 52 49 4E 47 24 00 DB   "STRING$",0   
1D38   E9 0D                  DW   STRFN   
1D3A   D3                     DB   0D3H   
1D3B   4C 45 46 54 24 00      DB   "LEFT$",0   
1D41   FD 0D                  DW   LEFT   
1D43   D3                     DB   0D3H   
1D44   52 49 47 48 54 24 00   DB   "RIGHT$",0   
1D4B   06 0E                  DW   RIGHT   
1D4D   D3                     DB   0D3H   
1D4E   4D 49 44 24 00         DB   "MID$",0   
1D53   0F 0E                  DW   MIDFN   
1D55   DB                     DB   0DBH   
1D56   49 4E 53 54 52 00      DB   "INSTR",0   
1D5C   49 0E                  DW   INSTR   
1D5E   BB                     DB   0BBH   
1D5F   50 45 45 4B 00         DB   "PEEK",0   
1D64   C6 21                  DW   PEEK   
1D66   AB                     DB   0ABH   
1D67   00 00 00 00            DB   0,0,0,0   ;ROOM FOR ONE MORE FUNCTION
1D6B   00 00 00 00            DB   0,0,0,0   
1D6F   00                     DB   0   ;END OF FUNCTION TABLE
1D70                             ;PAGE
1D70                             ; 
1D70                             ; PROGRAM CONSTANTS
1D70                             ; 
1D70   13 14 00     PCHOF:    DB   19,20,0   
1D73   3F FD        RNDP:     DB   3FH,0FDH   ;16381
1D75   3F EB                  DB   3FH,0EBH   ;16363
1D77   3F DD                  DB   3FH,0DDH   ;16349
1D79   1B EC        NRNDX:    DB   1BH,0ECH   
1D7B   33 D3                  DB   33H,0D3H   
1D7D   1A 85                  DB   1AH,85H   
1D7F   2B 1E                  DB   2BH,1EH   
1D81   57 48 41 54 00 WHATL:   DB   "WHAT",0   
1D86                VERS:     EQU   $   ;VERSION MESSAGE
1D86   0D 0A 39 4B 20 56 45 52 53 20 31 2E 34 00 DB   $0d,$0a,"9K VERS 1.4",0   
1D94   08 20 08 FE  RBOUT:    DB   08H,20H,08H,0FEH   ;RUBOUT SEQUENCE (9K ONLY)
1D98   4C 49 4E 45 00 LLINE:   DB   "LINE",0   
1D9D   54 41 42 00  TABLI:    DB   "TAB",0   
1DA1   53 54 45 50 00 STEPL:   DB   "STEP",0   
1DA6   54 48 45 4E 00 THENL:   DB   "THEN",0   
1DAB   50 49 00     PILIT:    DB   "PI",0   
1DAE   02 80 00 00  TWO:      DB   02H,80H,00H,00H   ;CONSTANT:  2
1DB2   04 A0 00 00  TEN:      DB   04H,0A0H,00H,00H   ;CONSTANT:  10
1DB6   02 C9 0F D7  PI:       DB   02H,0C9H,0FH,0D7H   ;CONSTANT:  3.141593
1DBA   00 C9 0F D7  QTRPI:    DB   00H,0C9H,0FH,0D7H   ;CONSTANT:  0.7853892
1DBE   80 FF FF FF  NEGON:    DB   80H,0FFH,0FFH,0FFH   ;CONSTANT: -0.9999999
1DC2   00 B1 72 16  LN2C:     DB   00H,0B1H,72H,16H   ;CONSTANT:  0.6931472
1DC6   00 97 14 EB  SQC1:     DB   00H,97H,14H,0EBH   ;CONSTANT:  0.59016206
1DCA   7F D5 A9 56  SQC2:     DB   7FH,0D5H,0A9H,56H   ;CONSTANT:  0.41730759
1DCE                             ;PAGE
1DCE                             ; 
1DCE                             ; THE FOLLOWING CONSTANTS MUST BE IN THIS ORDER ***********
1DCE                             ; 
1DCE                             ;       CONSTANT WITH EXPONENT OF 1
1DCE                             ;       COEFFICIENT OF FIRST TERM
1DCE                             ;       ...
1DCE                             ;       COEEFICIENT OF NTH TERM
1DCE                             ; 
1DCE                             ; SINCE ALL COEFFICIENTS ARE LESS THAN 1,
1DCE                             ; THE ITERATION LOOP USES THE
1DCE                             ; CONSTANT WITH EXPONENT 1 TO TERMINATE THE EVALUATION.
1DCE                             ; 
1DCE   01 B5 04 F3  SQC3:     DB   01H,0B5H,04H,0F3H   ;CONSTANT:  1.41421356
1DD2   FF AA 95 BC            DB   0FFH,0AAH,95H,0BCH   ;CONSTANT: -0.3331738
1DD6   7E CA D5 20            DB   7EH,0CAH,0D5H,20H   ;CONSTANT:  0.1980787
1DDA   FE 87 82 D6            DB   0FEH,87H,82H,0D6H   ;CONSTANT: -0.1323351
1DDE   7D A3 13 1C            DB   7DH,0A3H,13H,1CH   ;CONSTANT:  0.07962632
1DE2   FC 89 A6 B8            DB   0FCH,89H,0A6H,0B8H   ;CONSTANT: -0.03360627
1DE6   79 DF 3A 9E  ATNCO:    DB   79H,0DFH,3AH,9EH   ;CONSTANT:  0.006812411
1DEA                             ; 
1DEA   01 C9 0F D7  HALFP:    DB   01H,0C9H,0FH,0D7H   ;CONSTANT:  1.570796
1DEE   80 A5 5D DE            DB   80H,0A5H,5DH,0DEH   ;CONSTANT: -0.64596371
1DF2   7D A3 34 55            DB   7DH,0A3H,34H,55H   ;CONSTANT:  0.076589679
1DF6   F9 99 38 60            DB   0F9H,99H,38H,60H   ;CONSTANT: -0.0046737656
1DFA   74 9E D7 B6  SINCO:    DB   74H,9EH,0D7H,0B6H   ;CONSTANT:  0.00015148419
1DFE                             ; 
1DFE   01 80        ONE:      DB   001H,080H   
1E00   00 00        NULLI:    DB   00H,00H   ;CONSTANT:  1.0
1E02   00 FF FE C1            DB   00H,0FFH,0FEH,0C1H   ;CONSTANT:  0.99998103
1E06   FF FF BA B0            DB   0FFH,0FFH,0BAH,0B0H   ;CONSTANT: -0.4994712
1E0A   7F A8 0E 2B            DB   7FH,0A8H,0EH,2BH   ;CONSTANT:  0.3282331
1E0E   FE E7 4B 55            DB   0FEH,0E7H,4BH,55H   ;CONSTANT: -0.2258733
1E12   7E 89 DE E3            DB   7EH,89H,0DEH,0E3H   ;CONSTANT:  0.134693
1E16   FC E1 C5 78            DB   0FCH,0E1H,0C5H,078H   ;CONSTANT: -0.05511996
1E1A   7A B0 3F AE  LNCO:     DB   7AH,0B0H,3FH,0AEH   ;CONSTANT:  0.01075737
1E1E                             ; 
1E1E   01 B8 AA 3B  LN2E:     DB   001H,0B8H,0AAH,03BH   ;CONSTANT:  1.44269504
1E22   00 B1 6F E6            DB   000H,0B1H,06FH,0E6H   ;C=.69311397
1E26   7E F6 2F 70            DB   07EH,0F6H,02FH,070H   ;C=.24041548
1E2A   7C E1 C2 AE            DB   07CH,0E1H,0C2H,0AEH   ;C=.05511732
1E2E   7A A0 BB 7E            DB   07AH,0A0H,0BBH,07EH   ;C=.00981033
1E32   77 CA 09 CB  EXPCO:    DB   077H,0CAH,009H,0CBH   ;C=.00154143
1E36                             ; 
1E36   7F DE 5B D0  LNC:      DB   07FH,0DEH,05BH,0D0H   ;C=LOG BASE 10 OF E
1E3A                READY:    EQU   $   
1E3A   FD                     DB   0FDH   
1E3B   52 45 41 44 59 00      DB   "READY",0   
1E41                STOPM:    EQU   $   
1E41   FD                     DB   0FDH   
1E42   53 54 4F 50 20 41 54 20 4C 49 4E 45 20 FE DB   "STOP AT LINE ",254   
1E50   20 45 52 52 4F 52 20 49 4E 20 4C 49 4E 45 20 FE ERRMS:   DB   " ERROR IN LINE ",0FEH   
1E60                TTY:      EQU   2   
1E60                             ;PAGE
1E60                             ; 
1E60                             ; VERB (STATEMENT/COMMAND) TABLE
1E60                             ; FORMAT IS: DB "VERB",0
1E60                             ;            DW ADDR
1E60                             ;            DB "NEXT VERB",0
1E60                             ;            ETC
1E60                             ;  END OF TABLE IS MARKED BY DB 0
1E60                             ; 
1E60                JMPTB:    EQU   $   
1E60   4C 49 53 54 00         DB   "LIST",0   
1E65   5A 02                  DW   LIST   
1E67   52 55 4E 00            DB   "RUN",0   
1E6B   EC 01                  DW   RUNCM   
1E6D   58 45 51 00            DB   "XEQ",0   
1E71   F1 01                  DW   XEQ   
1E73   4E 45 57 00            DB   "NEW",0   
1E77   80 01                  DW   NEW   
1E79   43 4F 4E 00            DB   "CON",0   
1E7D   E6 02                  DW   CONTI   
1E7F   54 41 50 45 00         DB   "TAPE",0   
1E84   B6 01                  DW   TAPE   
1E86   53 41 56 45 00         DB   "SAVE",0   
1E8B   4D 02                  DW   SAVE   
1E8D   4B 45 59 00  KEYL:     DB   "KEY",0   
1E91   D4 01                  DW   KEY   
1E93   46 52 45 00            DB   "FRE",0   
1E97   98 01                  DW   FREE   
1E99   49 46 00               DB   "IF",0   
1E9C   E1 04                  DW   IFSTM   
1E9E   52 45 41 44 00         DB   "READ",0   
1EA3   D9 07                  DW   READ   
1EA5   52 45 53 54 4F 52 45 00 DB   "RESTORE",0   
1EAD   0E 03                  DW   RESTO   
1EAF   44 41 54 41 00 DATAL:   DB   "DATA",0   
1EB4   03 02                  DW   RUN   
1EB6   46 4F 52 00            DB   "FOR",0   
1EBA   DD 03                  DW   FOR   
1EBC   4E 45 58 54 00 NEXTL:   DB   "NEXT",0   
1EC1   8A 06                  DW   NEXT   
1EC3   47 4F 53 55 42 00 GOSBL:   DB   "GOSUB",0   
1EC9   32 03                  DW   GOSUB   
1ECB   52 45 54 55 52 4E 00   DB   "RETURN",0   
1ED2   1A 03                  DW   RETUR   
1ED4   49 4E 50 55 54 00      DB   "INPUT",0   
1EDA   19 07                  DW   INPUT   
1EDC   50 52 49 4E 54 00      DB   "PRINT",0   
1EE2   4D 03                  DW   PRINT   
1EE4   47 4F        GOTOL:    DB   "GO"   
1EE6   54 4F 00     TOLIT:    DB   "TO",0   
1EE9   EE 02                  DW   GOTO   
1EEB   4C 45 54 00            DB   "LET",0   
1EEF   E9 05                  DW   LET   
1EF1   53 54 4F 50 00         DB   "STOP",0   
1EF6   6A 08                  DW   STOP   
1EF8   45 4E 44 00            DB   "END",0   
1EFC   C3 01                  DW   ENDIT   
1EFE   52 45 4D 00            DB   "REM",0   
1F02   03 02                  DW   RUN   
1F04   21 00                  DB   "!",0   
1F06   03 02                  DW   RUN   
1F08   3F 00                  DB   "?",0   
1F0A   4D 03                  DW   PRINT   
1F0C   52 41 4E 44 4F 4D 49 5A 45 00 DB   "RANDOMIZE",0   
1F16   97 08                  DW   RANDO   
1F18   4F 4E 00               DB   "ON",0   
1F1B   AD 08                  DW   ON   
1F1D   4F 55 54 00            DB   "OUT",0   
1F21   42 08                  DW   OUTP   
1F23   44 49 4D 00            DB   "DIM",0   
1F27   A9 09                  DW   DIM   
1F29   43 48 41 4E 47 45 00   DB   "CHANGE",0   
1F30   22 09                  DW   CHANG   
1F32   44 45 46     DEFLI:    DB   "DEF"   
1F35   46 4E 00     FNLIT:    DB   "FN",0   
1F38   03 02                  DW   RUN   
1F3A   50 4F 4B 45 00         DB   "POKE",0   
1F3F   D1 21                  DW   POKE   
1F41   43 41 4C 4C 00         DB   "CALL",0   
1F46   EF 21                  DW   JUMP   
1F48   45 44 49 54 00         DB   "EDIT",0   
1F4D   D6 1F                  DW   FIX   
1F4F   43 4C 4F 41 44 00      DB   "CLOAD",0   
1F55   66 21                  DW   CLOAD   
1F57   43 53 41 56 45 00      DB   "CSAVE",0   
1F5D   EE 20                  DW   CSAVE   
1F5F   00                     DB   0   ;END OF TABLE
1F60                             ; 
1F60                             ; DDT COMMAND, CPM ONLY
1F60                             ; 
1F60                             ;PAGE
1F60                             ; 
1F60                FACDE:    EQU   $   
1F60                             ; 
1F60                             ; THIS ROUTINE CONVERTS THE FACC TO AN ADDRESS IN D,E
1F60                             ; 
1F60   CD DA 0B               CALL   INT   ;INTEGERIZE THE FACC
1F63   3A 58 26               LDA   FACC   ;GET THE EXPONENT
1F66   B7                     ORA   A   ;TEST IT
1F67   FA 2D 1C               JM   OVERR   ;BRIF NEGATIVE ADDRESS
1F6A   D6 10                  SUI   16   ;SUBTRACT MAX EXPONENT
1F6C   CA 82 1F               JZ   FDE2   ;BRIF EQUAL MAX
1F6F   F2 2D 1C               JP   OVERR   ;BRIF GREATER THAN 64K
1F72   2F                     CMA      ;2'S COMPLIMENT OF A YIELDS..
1F73   3C                     INR   A   ;16-A
1F74   4F                     MOV   C,A   ;SAVE SHIFT COUNT
1F75   AF           FDE1:     XRA   A   ;CLEAR CARRY
1F76   21 59 26               LXI   H,FACC+1   ;POINT MANTISSA
1F79   06 02                  MVI   B,2   ;WORDS TO SHIFT
1F7B   CD F3 18               CALL   FSHFT   ;GO SHIFT FACC+1 AND FACC+2
1F7E   0D                     DCR   C   ;REDUCE COUNT
1F7F   C2 75 1F               JNZ   FDE1   ;LOOP TILL COMPLETE
1F82   21 59 26     FDE2:     LXI   H,FACC+1   ;POINT HIGH BYTE
1F85   56                     MOV   D,M   ;LOAD D
1F86   23                     INX   H   ;POINT LOW BYTE
1F87   5E                     MOV   E,M   ;LOADE E
1F88   C9                     RET      ;RETURN
1F89                             ; 
1F89                             ; 
1F89                LOCAT:    EQU   $   
1F89                             ; 
1F89                             ; THIS ROUTINE SEARCHES FOR A LINE IN THE PROGRAM FILE.
1F89                             ; Z SET, C RESET==>LINE FOUND. ADDRESS IS IN H,L
1F89                             ; C SET, Z RESET==>NOT FOUND. H,L POINT TO NEXT LINE
1F89                             ; C SET, Z SET==>NOT FOUND. H,L POINT AT END OF PROGRAM
1F89                             ; 
1F89   21 96 26               LXI   H,BEGPR   ;POINT START
1F8C   7E           FIND1:    MOV   A,M   ;FETCH LENGTH OF LINE
1F8D   E5                     PUSH   H   ;SAVE POINTER
1F8E   B7                     ORA   A   ;TEST
1F8F   CA AE 1F               JZ   FIND3   ;BRIF END
1F92   23                     INX   H   ;POINT LINE #
1F93   7E                     MOV   A,M   ;FETCH HI #
1F94   B8                     CMP   B   ;COMPARE TO REQUESTED
1F95   DA A6 1F               JC   FIND2   ;BRIF LOW
1F98   C2 AE 1F               JNZ   FIND3   ;BRIF PAST AND NOT FOUND
1F9B   23                     INX   H   ;POINT LO #
1F9C   7E                     MOV   A,M   ;FETCH IT
1F9D   B9                     CMP   C   ;COMPARE TO REQUESTED
1F9E   DA A6 1F               JC   FIND2   ;BRIF LOW
1FA1   C2 AE 1F               JNZ   FIND3   ;BRIF PAST AND NOT FOUND
1FA4   E1                     POP   H   ;POINT BEGIN IF MATCH
1FA5   C9                     RET      ;RETURN
1FA6                             ; 
1FA6                             ; BUMP H,L TO NEXT LINE
1FA6                             ; 
1FA6   E1           FIND2:    POP   H   ;POINT START OF LINE
1FA7   5E                     MOV   E,M   ;LENGHT TO E
1FA8   16 00                  MVI   D,0   ;CLEAR D
1FAA   19                     DAD   D   ;BUMP H,L
1FAB   C3 8C 1F               JMP   FIND1   ;CONTINUE
1FAE                             ; 
1FAE                             ; LINE NOT FOUND
1FAE                             ; 
1FAE   37           FIND3:    STC      ;SET CARRY
1FAF   E1                     POP   H   ;POINT LINE JUST PAST REQUESTED
1FB0   C9                     RET      ;RETURN
1FB1                             ; 
1FB1                             ; 
1FB1                SEEK:     EQU   $   
1FB1                             ; 
1FB1                             ;  THIS CODE FINDS AN ENTRY IN THE TABLE POINTED TO BY D,E.
1FB1                             ;  THE SOUGHT ENTRY IS POINTED TO BY H,L.
1FB1                             ; 
1FB1   E5           SEEK1:    PUSH   H   ;SAVE ADDRESS OF STRING
1FB2   1A                     LDAX   D   ;GET BYTE FROM TABLE
1FB3   B7                     ORA   A   ;TEST IT
1FB4   CA D4 1F               JZ   SEEK3   ;BRIF END OF TABLE
1FB7   D7                     RST   2   ;COMPARE
1FB8   C2 C4 1F               JNZ   SEEK2   ;BRIF NOT FOUND
1FBB   E3                     XTHL      ;PUT CURRENT H,L ON STACK
1FBC   CD FF 1A               CALL   SKP2Z   ;FIND END TO LITERAL IN TABLE
1FBF   13                     INX   D   ;POINT LOW BYTE
1FC0   E1                     POP   H   ;RESTORE LINE POINTER
1FC1   3C                     INR   A   ;PUT 1 IN A
1FC2   B7                     ORA   A   ;RESET Z BIT
1FC3   C9                     RET      ;RETURN
1FC4   CD FF 1A     SEEK2:    CALL   SKP2Z   ;FIND END OF TABLE LITERAL
1FC7   13                     INX   D   ; 
1FC8   13                     INX   D   ;POINT NEXT LIT IN TABLE
1FC9   13                     INX   D   ; 
1FCA   E1                     POP   H   ;GET ORIGINAL STRING
1FCB   1A                     LDAX   D   ;GET BYTE
1FCC   17                     RAL      ;HIGH BIT TO CARRY
1FCD   D2 B1 1F               JNC   SEEK1   ;NOT A FUNCTION SEARCH
1FD0   13                     INX   D   ;POINT NEXT BYTE IN FUNCTION TABLE
1FD1   C3 B1 1F               JMP   SEEK1   ;CONTINUE SEARCH
1FD4   E1           SEEK3:    POP   H   ;RESTORE ORIGINAL STRING
1FD5   C9                     RET      ;RETURN
1FD6                             ; 
1FD6                             ; 
1FD6                             ; EDIT COMMAND
1FD6                             ; EDIT <LINE #><DELIMITER><OLD TEXT><DELIMITER><NEW TEXT>
1FD6                             ; 
1FD6                FIX:      EQU   $   
1FD6   CF                     RST   1   ;SKIP BLANKS
1FD7   CD BB 1A               CALL   PACK   ;GET LINE # IN B,C
1FDA   CF                     RST   1   ;SKIP BLANKS
1FDB   22 54 26               SHLD   ADDR2   ;SAVE COMMAND POINTER
1FDE   CD 89 1F               CALL   LOCAT   ;SEARCH FOR LINE # IN PROGRAM
1FE1   DA 09 1C               JC   ULERR   ;BRIF NOT FOUND
1FE4   E5                     PUSH   H   ;SAVE ADDR OF EXISTING LINE <SOURCE>
1FE5   C5                     PUSH   B   ;SAVE LINE #
1FE6   46                     MOV   B,M   ;GET LENGTH OF <SOURCE>
1FE7   EB                     XCHG      ;D,E POINT <SOURCE>
1FE8   21 20 25               LXI   H,STRIN   ;POINT STRING BUFFER
1FEB   CD 53 1C               CALL   COPYD   ;<SOURCE> TO STRING BUFFER
1FEE   3A 20 25               LDA   STRIN   ;LENGTH OF <SOURCE> TO A
1FF1   D6 02                  SUI   2   ;ADJUST
1FF3   32 20 25               STA   STRIN   ;STORE
1FF6   11 CF 24               LXI   D,IOBUF+1   ;POINT BUFFER
1FF9   2A 54 26               LHLD   ADDR2   ;FETCH COMMAND POINTER
1FFC   46                     MOV   B,M   ;FETCH <DELIMITER>
1FFD                             ; 
1FFD                             ; FIND LENGTH OF <OLD TEXT>. STORE IT IN IOBUF.
1FFD                             ; 
1FFD   0E 00                  MVI   C,0   ;INITIAL LENGTH
1FFF   23           FIX1:     INX   H   ;POINT NEXT CHARACTER
2000   7E                     MOV   A,M   ;FETCH
2001   B7                     ORA   A   ;TEST
2002   CA 15 1C               JZ   SNERR   ;MISSING 2ND <DELIMITER>.
2005   B8                     CMP   B   ;TEST
2006   CA 0F 20               JZ   FIX2   ;BRIF 2ND <DELIMITER> FOUND
2009   0C                     INR   C   ;ELSE, BUMP C
200A   12                     STAX   D   ;STORE CHARACTER IN IOBUF
200B   13                     INX   D   ;BUMP IOBUF POINTER
200C   C3 FF 1F               JMP   FIX1   ;CONTINUE
200F                             ; 
200F                             ; GET READY TO SEARCH <SOURCE> FOR <OLD TEXT>
200F                             ; 
200F   79           FIX2:     MOV   A,C   ;LENGTH OF <OT> TO A
2010   32 CE 24               STA   IOBUF   ;STORE
2013   22 54 26               SHLD   ADDR2   ;SAVE COMMAND POINTER
2016   3E 03                  MVI   A,3   ;SEARCH WILL START IN POS 3.
2018   2A 93 26               LHLD   PROGE   ;POINT END OF PROGRAM
201B   23                     INX   H   ;BUMP TWICE
201C   23                     INX   H   
201D   22 52 26               SHLD   ADDR1   ;SAVE EXPR. STACK POINTER
2020   23                     INX   H   ;POINT NEXT
2021   11 CE 24               LXI   D,IOBUF   ;POINT BUFFER AREA
2024   72                     MOV   M,D   ;STORE ADDRESS
2025   23                     INX   H   
2026   73                     MOV   M,E   
2027   21 20 25               LXI   H,STRIN   ; POINT <SOURCE>
202A                             ; 
202A                             ; USE THE INSTR ROUTINE TO SEARCH
202A                             ; 
202A   CD 58 0E               CALL   INST2   ;GO SEARCH
202D   7B                     MOV   A,E   ;RESULT TO A
202E   B7                     ORA   A   ;TEST
202F   CA 1D 1C               JZ   DAERR   ;BR IF NOT FOUND
2032   4F                     MOV   C,A   ;SAVE POSITION IN C
2033   3D                     DCR   A   ;ADJUST
2034   47                     MOV   B,A   ;COPY TO B
2035   21 21 25               LXI   H,STRIN+1   ;POINT <OLD SOURCE>
2038   11 CF 24               LXI   D,IOBUF+1   ;PIONT <NEW LINE AREA>
203B   CD 5E 1C               CALL   COPYH   ;COPY <OLD SOURCE> UP TO <OLD TEXT>
203E   D5                     PUSH   D   ;SAVE DEST POINTER
203F                             ; 
203F                             ; SKIP OVER <OLD TEXT> IN <SOURCE>
203F                             ; 
203F   16 00                  MVI   D,0   ;CLEAR D
2041   3A CE 24               LDA   IOBUF   ;GET LENGTH OF <OT>
2044   5F                     MOV   E,A   ;LENGTH TO E
2045   19                     DAD   D   ;BUMP H,L PAST <OT>
2046   D1                     POP   D   ;RESTORE <DEST> POINTER
2047   E5                     PUSH   H   ;SAVE <REMAINING SOURCE> POINTER
2048                             ; 
2048                             ; APPEND <NEW TEXT> TO <DEST>
2048                             ; 
2048   2A 54 26               LHLD   ADDR2   ;FETCH COMMAND POINTER
204B   23           FIX3:     INX   H   ;POINT NEXT
204C   7E                     MOV   A,M   ;FETCH CHARACTER
204D   B7                     ORA   A   ;TEST IT
204E   CA 57 20               JZ   FIX4   ;BRIF NO MORE <NEW TEXT>
2051   0C                     INR   C   ;BUMP LENGTH COUNT
2052   12                     STAX   D   ;STORE CHARACTER
2053   13                     INX   D   ;BUMP <DEST> POINTER
2054   C3 4B 20               JMP   FIX3   ;CONTINUE
2057                             ; 
2057                             ; APPEND <REMAINING SOURCE> TO <DEST>
2057                             ; 
2057   E1           FIX4:     POP   H   ;GET REMAINING SOURCE POINTER
2058   7E           FIX4A:    MOV   A,M   ;FETCH CHARACTER
2059   B7                     ORA   A   ;TEST
205A   CA 64 20               JZ   FIX5   ;BRIF DONE
205D   12                     STAX   D   ;STORE CHARACTER
205E   0C                     INR   C   ;BUMP CHAR COUNT
205F   13                     INX   D   ;BUMP DEST POINTER
2060   23                     INX   H   ;BUMP <SOURCE> POINTER
2061   C3 58 20               JMP   FIX4A   ;CONTINUE
2064                             ; 
2064                             ; PREPARE <DEST> FOR SUBMISSION AS NEW LINE
2064                             ; 
2064   12           FIX5:     STAX   D   ;BUFFER TERMINATOR
2065   0C                     INR   C   ;BUMP LENGTH COUNT
2066   79                     MOV   A,C   ;FETCH COUNT
2067   32 CE 24               STA   IOBUF   ;STORE IT
206A   47                     MOV   B,A   ;COPY COUNT TO B
206B   21 7C 24               LXI   H,IMMED   ;POINT NEW LINE AREA
206E   11 CE 24               LXI   D,IOBUF   ;POINT WHERE IT IS NOW
2071   CD 53 1C               CALL   COPYD   ;COPY IT
2074   C1                     POP   B   ;RESTORE LINE #
2075   E1                     POP   H   ;RESTORE PROGRAM POINTER
2076   E5                     PUSH   H   ;SAVE IT
2077   C3 F5 00               JMP   EDIT2   ;PROCESS AS NEW LINE
207A                             ;PAGE
207A                             ; 
207A                             ; TAPE CASSETTE COMMANDS
207A                             ; 
207A                             ; 
207A                             ;       TAPE CASSETTE EQUATES
207A                             ; 
207A                SWCH:     EQU   0FFH   ;SWITCH PORT
207A                CASC:     EQU   3   ;STATUS PORT FOR TARBELL
207A                CASD:     EQU   0   ;DATA PORT
207A                CFLAG:    EQU   4   ;DATA FLAG FOR TARBELL ON MIO
207A                             ; 
207A                             ; CASSETTE FILE FORMAT
207A                             ; 
207A                             ;    EACH RECORD:
207A                             ;       TYPE BYTE: 4 FOR BASIC PROGRAM,
207A                             ;                  PLUS BIT 7 ON IF DATA NOT HEADER RECORD
207A                             ;       LENGTH BYTE: # DATA BYTES (1-128)
207A                             ;       2 BYTES OF CHECKSUM
207A                             ; 
207A                             ;    EACH FILE BEGINS WITH A HEADER RECORD
207A                             ;       TYPE 4
207A                             ;       LENGTH: 7
207A                             ;           5 CHARS FILENAME, BLANK-FILLED
207A                             ;           2 BYTES TOTAL LENGTH OF DATA IN FILE
207A                             ;       2 BYTES OF CHECKSUM
207A                             ; 
207A                             ;    AND HAS N DATA RECORDS
207A                             ;       TYPE: 84
207A                             ;       LENGTH: 128 EXCEPT LAST RECORD MAY BE LESS
207A                             ;       DATA: NEXT (LENGTH) BYTES OF IMAGE OF PROGRAM AREA
207A                             ;       CHECKSUM: 2 BYTES, 2'S COMPLEMENT OF SUM OF BYTES
207A                             ; 
207A                             ;    FILES OF TYPE OTHER THAN 4 ARE IGNORED BY BASIC
207A                             ; 
207A                             ; HARDWARE USED:
207A                             ;       IMSAI MIO BOARD, CASSETTE DATA ON PORT 0,
207A                             ;       STATUS ON PORT 3,
207A                             ;       CASSETTE READY JUMPERED TO BIT 2 OF PORT 3.
207A                             ; 
207A                             ; 
207A                             ;       TAPE UTILITY ROUTINE
207A                             ; 
207A                             ; WATCH         WAIT FOR TARBELL READY OR CONTROL-C
207A                             ; 
207A   C5           WATCH:    PUSH   B   ;SAVE REGS - CPM STATUS CALL CAN CLOBBER
207B   D5                     PUSH   D   
207C   E5                     PUSH   H   
207D   CD 3D 1A               CALL   TSTCC   ;TEST FOR CNTRL-C
2080   E1                     POP   H   ;RESTORE REGS IN CPM DEBUGGING MODE
2081   D1                     POP   D   
2082   C1                     POP   B   
2083   DB 03                  IN   CASC   ;READ STATUS PORT
2085   E6 04                  ANI   CFLAG   ;TEST
2087   CA 7A 20               JZ   WATCH   ;LOOP TILL RE^AADY
208A   C9                     RET      
208B                             ; 
208B                             ; 
208B                             ; CASI          CASSETTE INPUT TO A-REGISTER
208B                             ; 
208B   CD 7A 20     CASI:     CALL   WATCH   ;WAIT TIL READY
208E   DB 00                  IN   CASD   ;READ FROM DATA PORT
2090   C9                     RET      
2091                             ; 
2091                             ; 
2091                             ; RECO          WRITE A RECORD TO THE TARBELL.
2091                             ;               D,E==>TYPE, LENGTH BYTES
2091                             ;               H,L==>START OF SOURCE
2091                             ;               RETURNS UPDATED SOURCE POINTER IN DE
2091                             ; 
2091   7A           RECO:     MOV   A,D   ;TYPE BYTE
2092   CD B2 20               CALL   CASO   ;WRITE IT
2095   7B                     MOV   A,E   ;COUNT
2096   CD B2 20               CALL   CASO   ;WRITE IT
2099   43                     MOV   B,E   ;COUNT
209A   EB                     XCHG      ;SOURCE NOW IN DE
209B   21 00 00               LXI   H,0   ;INITIAL CHECKSUM
209E   1A           NCHAR:    LDAX   D   ;FETCH NEXT CHAR
209F   CD B2 20               CALL   CASO   ;WRITE IT
20A2   13                     INX   D   ;PNT NEXT CHAR
20A3   CD BA 20               CALL   CKSUM   ;ADD TO CKSUM, PUT ADD IN LIGHTS
20A6   05                     DCR   B   ;REDUCE COUNT
20A7   C2 9E 20               JNZ   NCHAR   ;LOOP ON COUNT
20AA   2B                     DCX   H   ;ADJUST HL FOR COMPLIMENT
20AB   7C                     MOV   A,H   ;WRITE CHECKSUM
20AC   2F                     CMA      
20AD   CD B2 20               CALL   CASO   
20B0   7D                     MOV   A,L   
20B1   2F                     CMA      
20B2                             ;WRITE LAST BYTE & RETURN
20B2                             ; 
20B2                             ; 
20B2                             ; CASO          CASSETTE OUTPUT BYTE FROM A-REGISTER
20B2                             ; 
20B2   F5           CASO:     PUSH   PSW   
20B3   CD 7A 20               CALL   WATCH   ;WAIT TILL READY
20B6   F1                     POP   PSW   
20B7   D3 00                  OUT   CASD   ;WRITE TO DATA PORT
20B9   C9                     RET      
20BA                             ; 
20BA                             ; 
20BA                             ; CKSUM         CALCULATE THE CHECKSUM:
20BA                             ;               ADD A TO HL
20BA                             ;       ALSO OUTPUS HI ADDR TO SENSE LIGHTS
20BA                             ; 
20BA   85           CKSUM:    ADD   L   ;ADD PREVIOUS LO
20BB   6F                     MOV   L,A   ;SAVE NEW LO
20BC   D0                     RNC      
20BD   24                     INR   H   ;PROPAGATE CARRY
20BE                             ; 
20BE                             ; 
20BE                             ; SENSE         OUTPUT HI ADDR FROM D TO LIGHTS
20BE                             ; 
20BE   7A           SENSE:    MOV   A,D   
20BF   2F                     CMA      
20C0   D3 FF                  OUT   SWCH   
20C2   C9                     RET      
20C3                             ; 
20C3                             ; 
20C3                             ; RECI          INPUT A RECORD FROM THE TARBELL
20C3                             ;       TAKES A BUFFER POINTER IN HL
20C3                             ;       RETURNS UPDATED POINTER IN DE,
20C3                             ;               RECORD TYPE IN A, RECORD LENGTH IN C
20C3                             ;               CLOBBERS B,H,L
20C3                             ; 
20C3   CD 8B 20     RECI:     CALL   CASI   ;GET TYPE
20C6   F5                     PUSH   PSW   ;SAVE TYPE TO RETURN TO CALLER
20C7   CD 8B 20               CALL   CASI   ;GET LENGTH
20CA   4F                     MOV   C,A   ;STORE LEN
20CB   47                     MOV   B,A   ;IN B ALSO
20CC   EB                     XCHG      ;PUT DESTINATION PTR IN DE
20CD   21 00 00               LXI   H,0   ;INITIAL CHECKSUM
20D0   CD 8B 20     RECI1:    CALL   CASI   ;INPUT BYTE
20D3   12                     STAX   D   ;STORE IT
20D4   13                     INX   D   
20D5   CD BA 20               CALL   CKSUM   ;UPDATE CKSUM, PUT ADDR IN LIGHTS
20D8   05                     DCR   B   ;LOOP ON COUNT
20D9   C2 D0 20               JNZ   RECI1   
20DC   D5                     PUSH   D   ;SAVE DESTINATION PTR
20DD   CD 8B 20               CALL   CASI   ;INPUT CHECKSUM
20E0   57                     MOV   D,A   
20E1   CD 8B 20               CALL   CASI   
20E4   5F                     MOV   E,A   
20E5   19                     DAD   D   ;COMPARE
20E6   7C                     MOV   A,H   
20E7   B5                     ORA   L   
20E8   C2 29 1C               JNZ   CKERR   ;BRIF CHECKSUM ERROR
20EB   D1                     POP   D   ;RESTORE DEST PTR
20EC   F1                     POP   PSW   ;RESTORE RECORD TYPE BYTE
20ED   C9                     RET      
20EE                             ; 
20EE                             ; 
20EE                             ; CSAVE COMMAND
20EE                             ; 
20EE   CF           CSAVE:    RST   1   ;SKIP ANY SPACES
20EF   3E 10                  MVI   A,10H   ;ENABLE WRITE
20F1   D3 03                  OUT   CASC   
20F3   E5                     PUSH   H   ;SAVE PTR
20F4   06 FF                  MVI   B,255   ;WRITE INITIAL 255 NULLS
20F6   AF                     XRA   A   
20F7   CD B2 20     NULS:     CALL   CASO   
20FA   05                     DCR   B   
20FB   C2 F7 20               JNZ   NULS   
20FE   3E 3C                  MVI   A,3CH   ;START BYTE
2100   CD B2 20               CALL   CASO   
2103   06 20                  MVI   B,32   ;32 SYNC BYTES
2105   3E E6                  MVI   A,0E6H   ;SYNC BYTE VALUE
2107   CD B2 20     SYNCS:    CALL   CASO   
210A   05                     DCR   B   
210B   C2 07 21               JNZ   SYNCS   
210E   21 CE 24               LXI   H,IOBUF   ;POINT BUFFER
2111   06 05                  MVI   B,5   ;FILE NAME LENGTH
2113   D1                     POP   D   ;RESTORE CMD PTR
2114   36 20        FNAME:    MVI   M,20H   ;DEFAULT BLANK
2116   1A                     LDAX   D   ;FETCH FILE NAME
2117   B7                     ORA   A   ;TEST
2118   CA 1D 21               JZ   BLANK   
211B   77                     MOV   M,A   ;STORE CHAR
211C   13                     INX   D   ;NAME PTR
211D   23           BLANK:    INX   H   ;BUFFER PTR
211E   05                     DCR   B   ;COUNT
211F   C2 14 21               JNZ   FNAME   
2122                             ; 
2122                             ; CALCULATE LGTH OF PROGRAM FILE&WRITE IT ON THE HEADER
2122                             ; 
2122   11 96 26               LXI   D,BEGPR   ;BEGINNING OF PROGRAM
2125   2A 93 26               LHLD   PROGE   ;END
2128   7D                     MOV   A,L   
2129   93                     SUB   E   
212A   6F                     MOV   L,A   
212B   7C                     MOV   A,H   
212C   9A                     SBB   D   
212D   67                     MOV   H,A   
212E   23                     INX   H   ;PLUS 1 TO GET # OF BYTES INCLUSIVE
212F   E5                     PUSH   H   ;SAVE FOR LATER
2130   22 D3 24               SHLD   IOBUF+5   ;STUFF LENGTH
2133   11 07 04               LXI   D,407H   ;TYPE AND LEN OF HEADER RECORD
2136                             ;TYPE 4: BASIC PROG FILE, HEADER RCD
2136   21 CE 24               LXI   H,IOBUF   
2139   CD 91 20               CALL   RECO   ;WRITE RECORD
213C                             ; 
213C                             ; WRITE PROGRAM FILE
213C                             ; 
213C   21 96 26               LXI   H,BEGPR   ;POINT START OF PROGRAM
213F   E3           NXTRC:    XTHL      ;GET REMAINING LENGTH
2140   7C                     MOV   A,H   ;GET HI REMAINING
2141   B5                     ORA   L   ;TEST FOR DONE
2142   CA 5D 21               JZ   ERITE   ;BRIF DONE
2145   11 80 FF               LXI   D,0FF80H   ;-128
2148   19                     DAD   D   ;SUBTRACT RECORD LENGTH
2149   DA 53 21               JC   RITE   ;IF CARRY, NOT AT END
214C   7D                     MOV   A,L   ;GET LOW
214D   E6 7F                  ANI   7FH   ;NUMBER BYTES LEFT
214F   5F                     MOV   E,A   ;COUNT
2150   21 00 00               LXI   H,0   ;REMAINING BYTES
2153   E3           RITE:     XTHL      ;RESTORE H
2154   16 84                  MVI   D,084H   ;TYPE BYTE: 80=DATA RECORD (NOT
2156                             ;FILE HDR), 4=BASIC PROGRAM FILE.
2156   CD 91 20               CALL   RECO   ;WRITE
2159   EB                     XCHG      ;SAVE SOURCE PTR
215A   C3 3F 21               JMP   NXTRC   
215D   E1           ERITE:    POP   H   ;CLEAN STACK
215E                             ; 
215E                             ; 
215E                             ; BELL          RING USER'S CHIMES
215E                             ; 
215E   3E 07        BELL:     MVI   A,7   ;CODE FOR BELL
2160   CD 4A 19               CALL   TESTO   
2163   C3 BB 00               JMP   RDY   
2166                             ;PAGE
2166                             ; CLOAD         LOAD A PROGRAM FROM THE TARBELL
2166                             ; 
2166                CLOAD:       
2166   3E 60        NULL1:    MVI   A,60H   ;MIO CONTROL TO READ BY BITS
2168   D3 03                  OUT   CASC   ;WRITE TO STATUS PORT
216A   CD 8B 20     NULLS:    CALL   CASI   ;READ LEADING NULLS
216D   D3 FF                  OUT   SWCH   ;PUT IN LIGHTS
216F   FE E6                  CPI   0E6H   ;WAIT FOR FIRST SYNC BYTE
2171   C2 6A 21               JNZ   NULLS   
2174   3E 20                  MVI   A,20H   ;MIO CONTROL TO READ BY BYTES
2176   D3 03                  OUT   CASC   ;WRITE TO STATUS PORT
2178   06 1F                  MVI   B,31   ;NUMBER REMAINING SYNC BYTES
217A   CD 8B 20     SYNC:     CALL   CASI   ;READ PAST SYNC
217D   D3 FF                  OUT   SWCH   
217F   FE E6                  CPI   0E6H   
2181   C2 66 21               JNZ   NULL1   ;TRY FOR MORE NULLS
2184   05                     DCR   B   
2185   C2 7A 21               JNZ   SYNC   
2188   21 CE 24               LXI   H,IOBUF   ;POINT BUFFER
218B   CD C3 20               CALL   RECI   ;READ A RECORD
218E   FE 04                  CPI   4   ;TEST TYPE BYTE: IS IT BASIC PROGRAM
2190                             ;..FILE HEADER RECORD?
2190   C2 66 21               JNZ   NULL1   ;NO, START OVER, KEEP LOOKING
2193   2A D3 24               LHLD   IOBUF+5   ;LOAD LENGTH OF PROGRAM FILE
2196   E5                     PUSH   H   ;SAVE
2197   21 96 26               LXI   H,BEGPR   
219A   CD C3 20     NXTR:     CALL   RECI   ;READ RECORD
219D   FE 84                  CPI   84H   ;IS IT BASIC PROGRAM FILE DATA RECORD
219F   C2 29 1C               JNZ   CKERR   ;NO, SOMETHING'S WRONG.
21A2   E1                     POP   H   ;LENGTH
21A3                             ;SUBTRACT 0,C  FROM HL
21A3   7D                     MOV   A,L   
21A4   91                     SUB   C   
21A5   6F                     MOV   L,A   
21A6   7C                     MOV   A,H   
21A7   0E 00                  MVI   C,0   
21A9   99                     SBB   C   
21AA   67                     MOV   H,A   
21AB   B5                     ORA   L   ;TEST RESULT FOR 0
21AC   EB                     XCHG      ;BUFFER ADDR TO HL
21AD   D5                     PUSH   D   ;SAVE REMAINING LENGTH
21AE   C2 9A 21               JNZ   NXTR   ;JIF NOT DONE READING DATA
21B1   D1                     POP   D   ;CLEAR STACK
21B2                             ;LOADING DONE. SET POINTER TO END OF PROGRAM.
21B2   AF                     XRA   A   
21B3   77                     MOV   M,A   ;EXTRA 0 FOR PARANOISA
21B4   2B                     DCX   H   ;POINT LAST RECORD BYTE (SHOULD BE 0)
21B5   22 93 26               SHLD   PROGE   ;SAVE END OF PROG FOR EDIT, LIST, &C
21B8   32 D3 24               STA   IOBUF+5   ;MARK END OF FILE NAME FOR TYPEOUT
21BB                             ;TYPE FILE NAME
21BB   3A CE 24               LDA   IOBUF   
21BE   FE 20                  CPI   20H   ;TEST FOR NO NAME
21C0   C4 B8 19               CNZ   TERMO   ;PRINT NAME IF THERE
21C3   C3 5E 21               JMP   BELL   
21C6                             ; 
21C6                PEEK:     EQU   $   
21C6                             ; 
21C6                             ; STMT: A=PEEK(X). RETURNS DECIMAL VALUE OF MEMORY ADDRESS X.
21C6                             ; 
21C6   CD 60 1F               CALL   FACDE   ;GET ADDRESS IN D,E
21C9   EB                     XCHG      ;ADDRESS TO H,L
21CA   11 00 00               LXI   D,0   ;CLEAR D,E
21CD   5E                     MOV   E,M   ;PUT MEMORY BYTE IN E
21CE   C3 8F 1C               JMP   BINFL   ;CONVERT D,E TO BINARY AND RETURN
21D1                             ; 
21D1                POKE:     EQU   $   
21D1                             ; 
21D1                             ; STMT: POKE <ADDRESS>,<VALUE>.  PUTS IN MEMORY ADDRESS.
21D1                             ; 
21D1   CD 78 0F               CALL   EXPR   ;EVALUATE ADDRESS EXPRESSION
21D4   7E                     MOV   A,M   ;LOAD NEXT CHARACTER
21D5   FE 2C                  CPI   ","   ;TEST
21D7   C2 15 1C               JNZ   SNERR   ;BRIF ERROR
21DA   23                     INX   H   ;POINT NEXT
21DB   E5                     PUSH   H   ;SAVE H,L
21DC   CD 60 1F               CALL   FACDE   ;PUT ADDRESS IN D,E
21DF   E1                     POP   H   ;RESTORE H,L
21E0   D5                     PUSH   D   ;SAVE ADDRESS
21E1   CD 78 0F               CALL   EXPR   ;EVALUATE VALUE EXPRESSION
21E4   CD 9A 1A               CALL   EOL   ;TEST FOR END OF LINE
21E7   CD 6C 1C               CALL   FBIN   ;CONVERT FACC TO A REGISTER VALUE
21EA   E1                     POP   H   ;GET D,E ADDRESS IN H,L
21EB   77                     MOV   M,A   ;MOVE BYTE
21EC   C3 03 02               JMP   RUN   ;CONTINUE
21EF                             ; 
21EF                             ; 
21EF                JUMP:     EQU   $   
21EF                             ; 
21EF                             ; STMT: CALL <ADDRESS>. EXECUTES CODE AT MEMORY ADDRESS.
21EF                             ; 
21EF   CD 78 0F               CALL   EXPR   ;EVALUATE ADDRESS EXPRESSION
21F2   CD 9A 1A               CALL   EOL   ;TEST FOR END OF LINE
21F5   CD 60 1F               CALL   FACDE   ;CONVERT FACC TO ADDRESS IN D,E
21F8   21 03 02               LXI   H,RUN   ;MAKE INTO SUBROUTINE
21FB   E5                     PUSH   H   
21FC   EB                     XCHG      ;MOVE ADDRESS TO HL
21FD   E9                     PCHL      ;EXECUTE USER'S ROUTINE
21FE                             ;PAGE
21FE                ROMEN:    EQU   $-1   
21FE                             ; 
2000                          .ORG   8192+OFFSET   ;RAM STARTS OF 8K BOUNDARY
2400                          .ORG   2400H+OFFSET   ;RAM STARTS ON 9K BOUNDARY
2400                             ; 
2400                             ; ALL CODE ABOVE THIS POINT IS READ ONLY AND CAN BE PROM'ED
2400                             ; 
2400                             ; 
2400                RAM:      EQU   $   
2400                             ; 
2400                BZERO:    EQU   $   
2400                FORNE:    DS   1   ;# ENTRYS IN TABLE (MUST BE HERE)
2401                          DS   112   ;ROOM FOR 8 NESTS (MUST BE HERE)
2471                TAPES:    DS   1   ;TAPE SWITCH (MUST BE HERE)
2472                DIMSW:    DS   1   ;DIM SWITCH (MUST BE HERE)
2473                OUTSW:    DS   1   ;OUTPUT SWITCH (MUST BE HERE)
2474                ILSW:     DS   1   ;INPUT LINE SWITCH (MUST BE HERE)
2475                RUNSW:    DS   1   ;RUN SWITCH(MUST BE HERE)
2476                EDSW:     DS   1   ;MODE SWITCH(MUST BE HERE)
2477                EZERO:    EQU   $   
2477                             ; 
2477                LINEN:    DS   5   
247C                IMMED:    DS   82   ;IMMEDIATE COMMAND STORAGE AREA
24CE                IOBUF:    DS   82   ;INPUT/OUTPUT BUFFER
2520                STRIN:    DS   256   ;STRING BUFFER AREA
2620                OUTA:     DS   3   ;*** FILLED IN AT RUN TIME
2623                INDX:     DS   2   ;HOLDS VARIABLE NAME OF FOR/NEXT
2625                REL:      DS   1   ;HOLDS THE RELATION IN AN IF STMT
2626                IFTYP:    DS   1   ;HOLDS TYPE CODE OF LEFT SIDE
2627                TVAR1:    DS   4   ;TEMP STORAGE
262B                TVAR2:    DS   4   ;DITTO
262F                TEMP1:    DS   4   ;TEMP STORAGE FOR FUNCTIONS
2633                TEMP2:    DS   4   
2637                TEMP3:    DS   4   
263B                TEMP4:    DS   4   
263F                TEMP5:    DS   4   
2643                TEMP6:    DS   4   
2647                TEMP7:    DS   4   
264B                LINEL:    DS   2   ;HOLDS MIN LINE NUMBER IN LIST
264D                LINEH:    DS   2   ;HOLDS MAX LINE NUMBER IN LIST
264F                PROMP:    DS   1   ;HOLDS PROMPT CHAR
2650                EXPRS:    DS   2   ;HOLDS ADDR OF EXPRESSION
2652                ADDR1:    DS   2   ;HOLDS TEMP ADDRESS
2654                ADDR2:    DS   2   ;HOLDS TEMP ADDRESS
2656                ADDR3:    DS   2   ;HOLDS STMT ADD DURING EXPR EVAL
2658                FACC:     DS   4   
265C                FTEMP:    DS   12   
2668                PARCT:    DS   1   
2669                SPCTR:    DS   2   
266B                CMACT:    DS   1   ;COUNT OF COMMAS
266C                FNARG:    DS   4   ;SYMBOLIC ARG & ADDRESS
2670                STMT:     DS   2   ;HOLDS ADDR OF CURRENT STATEMENT
2672                ENDLI:    DS   2   ;HOLDS ADDR OF MULTI STMT PTR
2674                MULTI:    DS   1   ;SWITCH 0=NO, 1=MULTI STMT LINE
2675                DEXP:     DS   1   
2676                COLUM:    DS   1   ;CURRENT TTY COLUMN
2677                RNDX:     DS   2   ;RANDOM VARIABLE STORAGE
2679                RNDY:     DS   2   ;THE RND<X>,TRND<X>,AND RNDSW
267B                RNDZ:     DS   2   ;MUST BE KEPT IN ORDER
267D                RNDS:     DS   2   
267F                TRNDX:    DS   2   
2681                TRNDY:    DS   2   
2683                TRNDZ:    DS   2   
2685                TRNDS:    DS   2   
2687                RNDSW:    DS   1   
2688                FNMOD:    DS   1   ;SWITCH, 0=NOT, <>0 = IN DEF FN
2689                LINE:     DS   2   ;HOLD ADD OF PREV LINE NUM
268B                STACK:    DS   2   ;HOLDS ADDR OF START OF RETURN STACK
268D                PRSW:     DS   1   ;ON=PRINT ENDED WITH , OR ;
268E                NS:       DS   1   ;HOLDS LAST TYPE (NUMERIC/STRING)
268F                DATAP:    DS   2   ;ADDRESS OF CURRENT DATA STMT
2691                DATAB:    DS   2   ;ADDRESS OF DATA POOL
2693                PROGE:    DS   2   ;ADDRESS OF PROGRAM END
2695                             ; 
2695                             ; 
2695                             ; 
2695                          DS   1   ;DATA STATEMENT FLAG (MUST BE HERE)
2696                BEGPR:       
2696                             ; 
3DD0                          .ORG   $3DD0   
3DD0   49 4D 53 41 49 20 39 4B 20 42 41 53 49 43 20 76 31 2E 34 20 30 44 39 37 35 42 00 DB   "IMSAI 9K BASIC v1.4 0D975B",0   
3DF7                          .ORG   $3DF7   
3DF7   FD 21                  DW   ROMEN-BASIC   ; data length
3DF9   00 00                  DW   BASIC   ; jump to addess
3DFB   00 00                  DW   BASIC   ; load address
3DFD   0D 97 5B               DB   $0d,$97,$5b   ; checksum
3E00                          END      


SIO_RX:             0018 DEFINED AT LINE 69
                    > USED AT LINE 4454
SIO_TX:             0018 DEFINED AT LINE 70
                    > USED AT LINE 4278
SIO_RX_STATUS:      0019 DEFINED AT LINE 71
                    > USED AT LINE 4245
                    > USED AT LINE 4246
                    > USED AT LINE 4450
                    > USED AT LINE 4451
SIO_TX_STATUS:      0019 DEFINED AT LINE 72
                    > USED AT LINE 4273
                    > USED AT LINE 4274
SIO_RX_FULL:        0001 DEFINED AT LINE 73
                    > USED AT LINE 4247
                    > USED AT LINE 4452
SIO_TX_EMPTY:       0004 DEFINED AT LINE 74
                    > USED AT LINE 4275
OFFSET:             0000 DEFINED AT LINE 76
                    > USED AT LINE 85
                    > USED AT LINE 159
                    > USED AT LINE 5774
                    > USED AT LINE 5775
RUBOUT:             0008 DEFINED AT LINE 78
                    > USED AT LINE 420
                    > USED AT LINE 4302
FATAL:              00F7 DEFINED AT LINE 83
                    > USED AT LINE 4869
BASIC:              0000 DEFINED AT LINE 85
                    > USED AT LINE 5856
                    > USED AT LINE 5857
                    > USED AT LINE 5858
RST1:               0008 DEFINED AT LINE 96
                    > USED AT LINE 100
RST2:               0010 DEFINED AT LINE 110
COMP1:              0013 DEFINED AT LINE 112
                    > USED AT LINE 4506
RST3:               0018 DEFINED AT LINE 121
RST4:               0020 DEFINED AT LINE 130
RST5:               0028 DEFINED AT LINE 142
                    > USED AT LINE 3275
                    > USED AT LINE 3705
                    > USED AT LINE 3721
                    > USED AT LINE 3855
RST6:               0030 DEFINED AT LINE 153
RST4A:              003B DEFINED AT LINE 161
                    > USED AT LINE 135
RST4B:              0044 DEFINED AT LINE 166
                    > USED AT LINE 164
INIT1:              0081 DEFINED AT LINE 180
                    > USED AT LINE 88
INIT2:              0084 DEFINED AT LINE 181
                    > USED AT LINE 192
INIT3:              0097 DEFINED AT LINE 194
                    > USED AT LINE 183
                    > USED AT LINE 188
RDYM:               00B8 DEFINED AT LINE 210
                    > USED AT LINE 413
RDY:                00BB DEFINED AT LINE 212
                    > USED AT LINE 403
                    > USED AT LINE 1447
                    > USED AT LINE 1459
                    > USED AT LINE 5671
GETCM:              00C1 DEFINED AT LINE 219
                    > USED AT LINE 274
                    > USED AT LINE 304
                    > USED AT LINE 351
                    > USED AT LINE 383
                    > USED AT LINE 394
                    > USED AT LINE 459
                    > USED AT LINE 1056
EDIT1:              00E0 DEFINED AT LINE 245
                    > USED AT LINE 251
EDIT2:              00F5 DEFINED AT LINE 258
                    > USED AT LINE 5442
EDIT3:              00FB DEFINED AT LINE 263
                    > USED AT LINE 268
EDIT8:              0107 DEFINED AT LINE 269
                    > USED AT LINE 265
EDIT5:              010C DEFINED AT LINE 272
                    > USED AT LINE 257
EDIT6:              0121 DEFINED AT LINE 283
                    > USED AT LINE 290
                    > USED AT LINE 297
                    > USED AT LINE 299
EDIT7:              012D DEFINED AT LINE 291
                    > USED AT LINE 289
ED7A:               0135 DEFINED AT LINE 295
                    > USED AT LINE 293
ED7B:               013E DEFINED AT LINE 300
                    > USED AT LINE 294
IRAM:               0149 DEFINED AT LINE 311
                    > USED AT LINE 204
                    > USED AT LINE 436
EXEC:               015C DEFINED AT LINE 319
                    > USED AT LINE 236
EXEC1:              016C DEFINED AT LINE 333
                    > USED AT LINE 338
NEW:                0180 DEFINED AT LINE 344
                    > USED AT LINE 5153
NEW0:               018B DEFINED AT LINE 356
NEW1:               0190 DEFINED AT LINE 359
                    > USED AT LINE 355
FREE:               0198 DEFINED AT LINE 364
                    > USED AT LINE 5163
TAPE:               01B6 DEFINED AT LINE 385
                    > USED AT LINE 5157
ENDIT:              01C3 DEFINED AT LINE 396
                    > USED AT LINE 462
                    > USED AT LINE 531
                    > USED AT LINE 553
                    > USED AT LINE 560
                    > USED AT LINE 5192
KEY:                01D4 DEFINED AT LINE 410
                    > USED AT LINE 4461
                    > USED AT LINE 4465
                    > USED AT LINE 4870
                    > USED AT LINE 5161
HDRTL:              01DE DEFINED AT LINE 415
                    > USED AT LINE 406
                    > USED AT LINE 493
HDR1:               01E0 DEFINED AT LINE 420
                    > USED AT LINE 426
RUNCM:              01EC DEFINED AT LINE 432
                    > USED AT LINE 5149
XEQ:                01F1 DEFINED AT LINE 435
                    > USED AT LINE 5151
RUN:                0203 DEFINED AT LINE 445
                    > USED AT LINE 616
                    > USED AT LINE 631
                    > USED AT LINE 737
                    > USED AT LINE 867
                    > USED AT LINE 901
                    > USED AT LINE 996
                    > USED AT LINE 1069
                    > USED AT LINE 1073
                    > USED AT LINE 1212
                    > USED AT LINE 1236
                    > USED AT LINE 1308
                    > USED AT LINE 1347
                    > USED AT LINE 1433
                    > USED AT LINE 1474
                    > USED AT LINE 1583
                    > USED AT LINE 1631
                    > USED AT LINE 1712
                    > USED AT LINE 5171
                    > USED AT LINE 5194
                    > USED AT LINE 5196
                    > USED AT LINE 5211
                    > USED AT LINE 5757
                    > USED AT LINE 5767
RUN1:               0213 DEFINED AT LINE 452
                    > USED AT LINE 448
RUN2:               021D DEFINED AT LINE 457
                    > USED AT LINE 442
                    > USED AT LINE 608
RUN3:               022F DEFINED AT LINE 469
                    > USED AT LINE 342
                    > USED AT LINE 451
RUN4:               0230 DEFINED AT LINE 470
                    > USED AT LINE 995
RUN7:               0247 DEFINED AT LINE 483
                    > USED AT LINE 474
SAVE:               024D DEFINED AT LINE 489
                    > USED AT LINE 5159
LIST:               025A DEFINED AT LINE 495
                    > USED AT LINE 5147
LIST1:              028A DEFINED AT LINE 527
                    > USED AT LINE 510
                    > USED AT LINE 520
LIST2:              028D DEFINED AT LINE 528
                    > USED AT LINE 572
                    > USED AT LINE 578
LIST4:              02AD DEFINED AT LINE 547
                    > USED AT LINE 541
LIST5:              02BD DEFINED AT LINE 555
                    > USED AT LINE 552
LIST6:              02C7 DEFINED AT LINE 561
                    > USED AT LINE 554
                    > USED AT LINE 559
LIST7:              02CD DEFINED AT LINE 563
                    > USED AT LINE 568
LIST8:              02DD DEFINED AT LINE 573
                    > USED AT LINE 540
                    > USED AT LINE 546
CONTI:              02E6 DEFINED AT LINE 581
                    > USED AT LINE 5155
GOTO:               02EE DEFINED AT LINE 597
                    > USED AT LINE 984
                    > USED AT LINE 994
                    > USED AT LINE 5186
GOTO2:              02FE DEFINED AT LINE 603
                    > USED AT LINE 647
                    > USED AT LINE 1536
RESTO:              030E DEFINED AT LINE 613
                    > USED AT LINE 5169
RETUR:              031A DEFINED AT LINE 621
                    > USED AT LINE 5179
GOSUB:              0332 DEFINED AT LINE 636
                    > USED AT LINE 988
                    > USED AT LINE 5177
GOSU1:              033B DEFINED AT LINE 639
                    > USED AT LINE 1535
PRINT:              034D DEFINED AT LINE 650
                    > USED AT LINE 690
                    > USED AT LINE 5183
                    > USED AT LINE 5198
PRIN4:              034E DEFINED AT LINE 657
                    > USED AT LINE 708
PRIN7:              0381 DEFINED AT LINE 682
                    > USED AT LINE 695
                    > USED AT LINE 703
PRIN2:              0383 DEFINED AT LINE 685
                    > USED AT LINE 723
PRIN5:              038E DEFINED AT LINE 692
                    > USED AT LINE 679
PRIN6:              0397 DEFINED AT LINE 697
                    > USED AT LINE 702
PRIN8:              03A2 DEFINED AT LINE 705
                    > USED AT LINE 664
PRIN9:              03A5 DEFINED AT LINE 706
                    > USED AT LINE 666
PRINA:              03AB DEFINED AT LINE 709
                    > USED AT LINE 671
PRINB:              03C2 DEFINED AT LINE 723
                    > USED AT LINE 727
PRINC:              03CB DEFINED AT LINE 729
                    > USED AT LINE 662
FOR:                03DD DEFINED AT LINE 740
                    > USED AT LINE 5173
FOR1:               0422 DEFINED AT LINE 784
                    > USED AT LINE 781
FOR2:               0426 DEFINED AT LINE 786
                    > USED AT LINE 777
                    > USED AT LINE 783
FOR4:               044A DEFINED AT LINE 805
                    > USED AT LINE 799
FOR5:               0456 DEFINED AT LINE 813
                    > USED AT LINE 802
                    > USED AT LINE 803
                    > USED AT LINE 807
FOR6:               0466 DEFINED AT LINE 822
                    > USED AT LINE 834
FOR7:               0472 DEFINED AT LINE 830
                    > USED AT LINE 824
FOR8:               0479 DEFINED AT LINE 836
                    > USED AT LINE 821
                    > USED AT LINE 829
FOR9:               04AA DEFINED AT LINE 873
                    > USED AT LINE 804
                    > USED AT LINE 808
                    > USED AT LINE 886
                    > USED AT LINE 890
                    > USED AT LINE 896
                    > USED AT LINE 900
FORA:               04D8 DEFINED AT LINE 897
                    > USED AT LINE 894
IFSTM:              04E1 DEFINED AT LINE 904
                    > USED AT LINE 5165
IF1:                04FF DEFINED AT LINE 923
                    > USED AT LINE 915
IF2:                0503 DEFINED AT LINE 925
                    > USED AT LINE 922
IF3:                0507 DEFINED AT LINE 929
                    > USED AT LINE 954
IF4:                0510 DEFINED AT LINE 935
                    > USED AT LINE 932
IF5:                0518 DEFINED AT LINE 940
                    > USED AT LINE 936
IF6:                0522 DEFINED AT LINE 946
                    > USED AT LINE 941
IF8:                055A DEFINED AT LINE 970
                    > USED AT LINE 967
IF9:                0568 DEFINED AT LINE 975
                    > USED AT LINE 972
TRUE:               0579 DEFINED AT LINE 981
                    > USED AT LINE 969
                    > USED AT LINE 974
                    > USED AT LINE 1032
FALSE:              0203 DEFINED AT LINE 996
                    > USED AT LINE 977
                    > USED AT LINE 979
                    > USED AT LINE 980
                    > USED AT LINE 1031
IFF:                05A0 DEFINED AT LINE 997
                    > USED AT LINE 962
IFG:                05A9 DEFINED AT LINE 1002
                    > USED AT LINE 1027
IFH:                05B2 DEFINED AT LINE 1008
                    > USED AT LINE 1006
IFI:                05BA DEFINED AT LINE 1013
                    > USED AT LINE 1010
IFJ:                05C8 DEFINED AT LINE 1021
                    > USED AT LINE 1019
IFK:                05CE DEFINED AT LINE 1025
                    > USED AT LINE 1023
IFL:                05D5 DEFINED AT LINE 1029
                    > USED AT LINE 1034
                    > USED AT LINE 1036
IFM:                05DF DEFINED AT LINE 1033
                    > USED AT LINE 1015
IFN:                05E4 DEFINED AT LINE 1035
                    > USED AT LINE 1016
LET:                05E9 DEFINED AT LINE 1039
                    > USED AT LINE 484
                    > USED AT LINE 590
                    > USED AT LINE 5188
LET1:               0604 DEFINED AT LINE 1057
                    > USED AT LINE 1050
LET2:               061E DEFINED AT LINE 1070
                    > USED AT LINE 1065
LET2A:              0629 DEFINED AT LINE 1075
                    > USED AT LINE 1072
                    > USED AT LINE 1346
                    > USED AT LINE 1630
                    > USED AT LINE 4062
LET3:               0635 DEFINED AT LINE 1083
                    > USED AT LINE 1085
LET4:               0643 DEFINED AT LINE 1095
                    > USED AT LINE 1113
LET5:               064F DEFINED AT LINE 1105
                    > USED AT LINE 1112
LET6:               065C DEFINED AT LINE 1114
                    > USED AT LINE 1097
LET7:               0671 DEFINED AT LINE 1126
                    > USED AT LINE 1123
                    > USED AT LINE 1124
LET8:               067E DEFINED AT LINE 1138
                    > USED AT LINE 1078
LET9:               0681 DEFINED AT LINE 1141
                    > USED AT LINE 1146
NEXT:               068A DEFINED AT LINE 1156
                    > USED AT LINE 5175
NEXT1:              06A0 DEFINED AT LINE 1168
                    > USED AT LINE 1178
NEXT2:              06AB DEFINED AT LINE 1175
                    > USED AT LINE 1171
NEXT3:              06B4 DEFINED AT LINE 1180
                    > USED AT LINE 1174
NEXT7:              06E7 DEFINED AT LINE 1209
                    > USED AT LINE 1214
NEXT5:              06EF DEFINED AT LINE 1213
                    > USED AT LINE 1206
NEXT6:              06F3 DEFINED AT LINE 1215
                    > USED AT LINE 1200
                    > USED AT LINE 1208
INPUT:              0719 DEFINED AT LINE 1238
                    > USED AT LINE 5181
INPU1:              072B DEFINED AT LINE 1253
                    > USED AT LINE 1305
INPU2:              0736 DEFINED AT LINE 1258
                    > USED AT LINE 1255
INPU3:              073A DEFINED AT LINE 1260
                    > USED AT LINE 1266
INPU4:              0745 DEFINED AT LINE 1267
                    > USED AT LINE 1263
INPU5:              0758 DEFINED AT LINE 1277
                    > USED AT LINE 1274
INPU6:              0759 DEFINED AT LINE 1278
                    > USED AT LINE 1257
                    > USED AT LINE 1276
INPU7:              076D DEFINED AT LINE 1288
                    > USED AT LINE 1285
INPU8:              0780 DEFINED AT LINE 1298
                    > USED AT LINE 1295
INPU9:              0785 DEFINED AT LINE 1301
                    > USED AT LINE 1311
INPUB:              078E DEFINED AT LINE 1307
                    > USED AT LINE 1395
INPUA:              0794 DEFINED AT LINE 1309
                    > USED AT LINE 1291
INPL:               079D DEFINED AT LINE 1313
                    > USED AT LINE 1247
INPL1:              07BF DEFINED AT LINE 1334
                    > USED AT LINE 1341
INPL2:              07CB DEFINED AT LINE 1342
                    > USED AT LINE 1336
READ:               07D9 DEFINED AT LINE 1350
                    > USED AT LINE 1393
                    > USED AT LINE 5167
READ1:              07E8 DEFINED AT LINE 1363
                    > USED AT LINE 1376
READ2:              0803 DEFINED AT LINE 1377
                    > USED AT LINE 1361
                    > USED AT LINE 1371
READ3:              0813 DEFINED AT LINE 1386
                    > USED AT LINE 1397
READ4:              0818 DEFINED AT LINE 1389
                    > USED AT LINE 1408
READ5:              0824 DEFINED AT LINE 1396
                    > USED AT LINE 1384
                    > USED AT LINE 1404
READ6:              082B DEFINED AT LINE 1399
                    > USED AT LINE 1380
READ7:              083B DEFINED AT LINE 1406
                    > USED AT LINE 1402
READ8:              083C DEFINED AT LINE 1407
                    > USED AT LINE 1405
OUTP:               0842 DEFINED AT LINE 1410
                    > USED AT LINE 5204
STOP:               086A DEFINED AT LINE 1436
                    > USED AT LINE 5190
RANDO:              0897 DEFINED AT LINE 1461
                    > USED AT LINE 5200
ON:                 08AD DEFINED AT LINE 1476
                    > USED AT LINE 5202
ON3:                08D3 DEFINED AT LINE 1502
                    > USED AT LINE 1494
ON3A:               08D4 DEFINED AT LINE 1503
                    > USED AT LINE 1512
                    > USED AT LINE 1518
ON4:                08E7 DEFINED AT LINE 1513
                    > USED AT LINE 1510
                    > USED AT LINE 1516
ON5:                08F1 DEFINED AT LINE 1517
                    > USED AT LINE 1514
ON6:                08F5 DEFINED AT LINE 1519
                    > USED AT LINE 1505
                    > USED AT LINE 1523
ON7:                0901 DEFINED AT LINE 1524
                    > USED AT LINE 1521
ON8:                090A DEFINED AT LINE 1527
                    > USED AT LINE 1531
ON9:                0915 DEFINED AT LINE 1532
                    > USED AT LINE 1529
CHANG:              0922 DEFINED AT LINE 1539
                    > USED AT LINE 5208
CHA1:               094B DEFINED AT LINE 1569
                    > USED AT LINE 1582
CHA2:               0960 DEFINED AT LINE 1586
                    > USED AT LINE 1548
CHA3:               0990 DEFINED AT LINE 1615
                    > USED AT LINE 1628
DIM:                09A9 DEFINED AT LINE 1634
                    > USED AT LINE 1710
                    > USED AT LINE 5206
DIM1:               09C7 DEFINED AT LINE 1656
                    > USED AT LINE 1660
DIM2:               09F9 DEFINED AT LINE 1698
                    > USED AT LINE 1703
DIM3:               0A04 DEFINED AT LINE 1705
                    > USED AT LINE 1740
DIM4:               0A0F DEFINED AT LINE 1711
                    > USED AT LINE 1708
REDIM:              0A15 DEFINED AT LINE 1713
                    > USED AT LINE 1666
REDM1:              0A2B DEFINED AT LINE 1729
                    > USED AT LINE 1724
SIN:                0A39 DEFINED AT LINE 1743
                    > USED AT LINE 1834
                    > USED AT LINE 1852
                    > USED AT LINE 4989
SIN1:               0A41 DEFINED AT LINE 1756
                    > USED AT LINE 1761
SIN3A:              0A70 DEFINED AT LINE 1784
                    > USED AT LINE 1778
EVPS:               0A83 DEFINED AT LINE 1803
                    > USED AT LINE 1886
                    > USED AT LINE 1924
                    > USED AT LINE 1978
EVPS1:              0A8D DEFINED AT LINE 1809
                    > USED AT LINE 1818
EVPS2:              0A94 DEFINED AT LINE 1812
                    > USED AT LINE 1808
COS:                0AAB DEFINED AT LINE 1824
                    > USED AT LINE 1847
                    > USED AT LINE 4992
TAN:                0AB4 DEFINED AT LINE 1836
                    > USED AT LINE 4995
ATN:                0ACC DEFINED AT LINE 1856
                    > USED AT LINE 4998
ATN1:               0ADB DEFINED AT LINE 1867
                    > USED AT LINE 1862
                    > USED AT LINE 1864
LN:                 0B0B DEFINED AT LINE 1888
                    > USED AT LINE 1929
                    > USED AT LINE 3232
                    > USED AT LINE 5004
LN0:                0B24 DEFINED AT LINE 1903
                    > USED AT LINE 1901
LN1:                0B30 DEFINED AT LINE 1908
                    > USED AT LINE 1902
LN2:                0B35 DEFINED AT LINE 1910
                    > USED AT LINE 1907
LOG:                0B59 DEFINED AT LINE 1928
                    > USED AT LINE 5007
EXP:                0B62 DEFINED AT LINE 1933
                    > USED AT LINE 3235
                    > USED AT LINE 5010
EXP1:               0B7C DEFINED AT LINE 1951
                    > USED AT LINE 1941
                    > USED AT LINE 1943
ELOOP:              0B95 DEFINED AT LINE 1962
                    > USED AT LINE 1964
ABS:                0BBF DEFINED AT LINE 1983
                    > USED AT LINE 1755
                    > USED AT LINE 4974
SGN:                0BC8 DEFINED AT LINE 1994
                    > USED AT LINE 4983
SGN1:               0BCE DEFINED AT LINE 2006
                    > USED AT LINE 3225
INT:                0BDA DEFINED AT LINE 2014
                    > USED AT LINE 1955
                    > USED AT LINE 4980
                    > USED AT LINE 5232
INT2:               0BE8 DEFINED AT LINE 2030
                    > USED AT LINE 2027
INT3:               0BF7 DEFINED AT LINE 2037
                    > USED AT LINE 2032
INT4:               0C01 DEFINED AT LINE 2044
                    > USED AT LINE 2054
INT5:               0C07 DEFINED AT LINE 2047
                    > USED AT LINE 2052
SQR:                0C1F DEFINED AT LINE 2062
                    > USED AT LINE 4977
SQR1:               0C5C DEFINED AT LINE 2107
                    > USED AT LINE 2089
                    > USED AT LINE 2092
NEG:                0C72 DEFINED AT LINE 2117
                    > USED AT LINE 1765
                    > USED AT LINE 1770
                    > USED AT LINE 1863
                    > USED AT LINE 1865
                    > USED AT LINE 1906
                    > USED AT LINE 1942
                    > USED AT LINE 3259
                    > USED AT LINE 3786
                    > USED AT LINE 3837
                    > USED AT LINE 3839
RND:                0C7C DEFINED AT LINE 2129
                    > USED AT LINE 2832
                    > USED AT LINE 4986
RND1:               0C8E DEFINED AT LINE 2143
                    > USED AT LINE 2203
RND2:               0C94 DEFINED AT LINE 2146
                    > USED AT LINE 2151
FND3:               0CA2 DEFINED AT LINE 2155
                    > USED AT LINE 2179
RND4:               0CB1 DEFINED AT LINE 2164
                    > USED AT LINE 2159
RND5:               0CBD DEFINED AT LINE 2176
                    > USED AT LINE 2160
                    > USED AT LINE 2163
RND6:               0CC5 DEFINED AT LINE 2181
                    > USED AT LINE 2193
RND7:               0CF9 DEFINED AT LINE 2212
                    > USED AT LINE 2207
INP:                0D02 DEFINED AT LINE 2216
                    > USED AT LINE 5001
FDEC:               0D12 DEFINED AT LINE 2231
                    > USED AT LINE 1572
                    > USED AT LINE 1905
                    > USED AT LINE 1909
                    > USED AT LINE 2242
                    > USED AT LINE 2323
                    > USED AT LINE 2347
                    > USED AT LINE 2350
                    > USED AT LINE 2382
                    > USED AT LINE 2538
POS:                0D18 DEFINED AT LINE 2235
                    > USED AT LINE 5013
CONCA:              0D1E DEFINED AT LINE 2244
                    > USED AT LINE 3217
CONC2:              0D34 DEFINED AT LINE 2265
                    > USED AT LINE 2260
CONC3:              0D3C DEFINED AT LINE 2269
                    > USED AT LINE 2274
CONC4:              0D44 DEFINED AT LINE 2275
                    > USED AT LINE 2268
CONC5:              0D5A DEFINED AT LINE 2288
                    > USED AT LINE 2290
CONC6:              0D6E DEFINED AT LINE 2303
                    > USED AT LINE 2308
LENFN:              0D81 DEFINED AT LINE 2316
                    > USED AT LINE 5016
CHRFN:              0D87 DEFINED AT LINE 2325
                    > USED AT LINE 5019
ASCII:              0D92 DEFINED AT LINE 2338
                    > USED AT LINE 5022
NUMFN:              0D9F DEFINED AT LINE 2352
                    > USED AT LINE 5025
NUM1:               0DAA DEFINED AT LINE 2365
                    > USED AT LINE 2368
VAL:                0DB2 DEFINED AT LINE 2372
                    > USED AT LINE 5028
VAL1:               0DBE DEFINED AT LINE 2384
                    > USED AT LINE 2391
VAL2:               0DC7 DEFINED AT LINE 2390
                    > USED AT LINE 2387
SPACE:              0DD9 DEFINED AT LINE 2401
                    > USED AT LINE 5031
SPAC1:              0DE1 DEFINED AT LINE 2411
                    > USED AT LINE 2415
STRFN:              0DE9 DEFINED AT LINE 2417
                    > USED AT LINE 5034
STR11:              0DF6 DEFINED AT LINE 2428
                    > USED AT LINE 2431
LEFT:               0DFD DEFINED AT LINE 2434
                    > USED AT LINE 5037
RIGHT:              0E06 DEFINED AT LINE 2445
                    > USED AT LINE 5040
MIDFN:              0E0F DEFINED AT LINE 2456
                    > USED AT LINE 5043
MID0:               0E19 DEFINED AT LINE 2469
                    > USED AT LINE 2443
                    > USED AT LINE 2454
MID1:               0E27 DEFINED AT LINE 2476
                    > USED AT LINE 2472
                    > USED AT LINE 2473
MID2:               0E34 DEFINED AT LINE 2482
                    > USED AT LINE 2477
                    > USED AT LINE 2479
MID3:               0E38 DEFINED AT LINE 2486
                    > USED AT LINE 2481
MID4:               0E40 DEFINED AT LINE 2491
                    > USED AT LINE 2496
INSTR:              0E49 DEFINED AT LINE 2499
                    > USED AT LINE 5046
INST1:              0E53 DEFINED AT LINE 2512
                    > USED AT LINE 2516
INST2:              0E58 DEFINED AT LINE 2514
                    > USED AT LINE 2511
                    > USED AT LINE 5384
INST3:              0E5F DEFINED AT LINE 2517
                    > USED AT LINE 2513
                    > USED AT LINE 2515
INST5:              0E7B DEFINED AT LINE 2537
                    > USED AT LINE 2558
                    > USED AT LINE 2567
INST6:              0E7F DEFINED AT LINE 2539
                    > USED AT LINE 2535
                    > USED AT LINE 2565
INST8:              0E8A DEFINED AT LINE 2548
                    > USED AT LINE 2554
INST9:              0E9B DEFINED AT LINE 2559
                    > USED AT LINE 2551
INSTA:              0EA4 DEFINED AT LINE 2566
                    > USED AT LINE 2542
FN:                 0EA9 DEFINED AT LINE 2569
                    > USED AT LINE 3029
                    > USED AT LINE 3031
FN2:                0EEB DEFINED AT LINE 2610
                    > USED AT LINE 2632
FN3:                0F09 DEFINED AT LINE 2628
                    > USED AT LINE 2618
                    > USED AT LINE 2624
FN4:                0F11 DEFINED AT LINE 2633
                    > USED AT LINE 2627
EXPR:               0F78 DEFINED AT LINE 2695
                    > USED AT LINE 673
                    > USED AT LINE 710
                    > USED AT LINE 755
                    > USED AT LINE 768
                    > USED AT LINE 785
                    > USED AT LINE 910
                    > USED AT LINE 955
                    > USED AT LINE 1058
                    > USED AT LINE 1415
                    > USED AT LINE 1429
                    > USED AT LINE 1483
                    > USED AT LINE 1646
                    > USED AT LINE 2664
                    > USED AT LINE 4074
                    > USED AT LINE 5743
                    > USED AT LINE 5752
                    > USED AT LINE 5764
LOOKD:              0F8D DEFINED AT LINE 2714
                    > USED AT LINE 2826
                    > USED AT LINE 2853
                    > USED AT LINE 2863
                    > USED AT LINE 3343
LDNUM:              0F94 DEFINED AT LINE 2718
                    > USED AT LINE 2728
LDF:                0F97 DEFINED AT LINE 2719
                    > USED AT LINE 2835
LDALP:              0FA7 DEFINED AT LINE 2727
                    > USED AT LINE 2717
LDV1:               0FBE DEFINED AT LINE 2738
                    > USED AT LINE 2765
                    > USED AT LINE 2804
LDV2:               0FCB DEFINED AT LINE 2747
                    > USED AT LINE 2741
LDV:                0FD6 DEFINED AT LINE 2753
                    > USED AT LINE 2841
                    > USED AT LINE 3365
LDFN:               0FEC DEFINED AT LINE 2764
                    > USED AT LINE 2735
LDFN1:              0FF2 DEFINED AT LINE 2766
                    > USED AT LINE 2769
FUNC0:              1013 DEFINED AT LINE 2784
                    > USED AT LINE 2828
FUNC4:              102E DEFINED AT LINE 2800
                    > USED AT LINE 2788
FNL:                1036 DEFINED AT LINE 2805
                    > USED AT LINE 2778
FNL3:               104E DEFINED AT LINE 2821
                    > USED AT LINE 2819
LDRND:              105B DEFINED AT LINE 2827
                    > USED AT LINE 2773
LDPI:               106D DEFINED AT LINE 2836
                    > USED AT LINE 2783
LDFNC:              1077 DEFINED AT LINE 2842
                    > USED AT LINE 2799
LDDTN:              1089 DEFINED AT LINE 2854
                    > USED AT LINE 2730
SKPP:               1099 DEFINED AT LINE 2862
                    > USED AT LINE 2865
                    > USED AT LINE 2933
                    > USED AT LINE 2997
                    > USED AT LINE 3008
LDDTP:              109D DEFINED AT LINE 2864
                    > USED AT LINE 2855
LITST:              10B1 DEFINED AT LINE 2872
                    > USED AT LINE 2869
LIT1:               10B7 DEFINED AT LINE 2875
                    > USED AT LINE 2883
LIT2:               10DB DEFINED AT LINE 2898
                    > USED AT LINE 2900
LIT3:               10F7 DEFINED AT LINE 2917
                    > USED AT LINE 2922
CERCE:              1103 DEFINED AT LINE 2925
                    > USED AT LINE 2867
LOOKO:              1115 DEFINED AT LINE 2934
                    > USED AT LINE 2726
                    > USED AT LINE 2759
                    > USED AT LINE 2763
                    > USED AT LINE 2924
                    > USED AT LINE 3140
                    > USED AT LINE 3143
ENDXP:              1143 DEFINED AT LINE 2955
                    > USED AT LINE 3001
OP1:                1150 DEFINED AT LINE 2960
                    > USED AT LINE 2937
                    > USED AT LINE 2940
                    > USED AT LINE 2943
                    > USED AT LINE 2946
                    > USED AT LINE 2953
OPLP1:              115B DEFINED AT LINE 2968
                    > USED AT LINE 2978
OPLP2:              115F DEFINED AT LINE 2971
                    > USED AT LINE 2974
INS:                1179 DEFINED AT LINE 2986
                    > USED AT LINE 2980
INS1:               117A DEFINED AT LINE 2987
                    > USED AT LINE 2992
OP2:                118F DEFINED AT LINE 2999
                    > USED AT LINE 2950
OP3:                11A4 DEFINED AT LINE 3009
                    > USED AT LINE 2948
OP4:                11AF DEFINED AT LINE 3014
                    > USED AT LINE 2998
EVAL:               11B2 DEFINED AT LINE 3015
                    > USED AT LINE 2314
                    > USED AT LINE 2959
                    > USED AT LINE 3104
                    > USED AT LINE 3144
                    > USED AT LINE 3250
                    > USED AT LINE 3269
EV1:                11B8 DEFINED AT LINE 3017
                    > USED AT LINE 3027
EV1A:               11C0 DEFINED AT LINE 3022
                    > USED AT LINE 3040
EV2:                11C8 DEFINED AT LINE 3028
                    > USED AT LINE 3021
EV2A:               11E8 DEFINED AT LINE 3042
                    > USED AT LINE 3035
                    > USED AT LINE 3037
EV3:                11FF DEFINED AT LINE 3057
                    > USED AT LINE 2692
                    > USED AT LINE 3051
EV3A:               1220 DEFINED AT LINE 3078
                    > USED AT LINE 3132
EV4:                1244 DEFINED AT LINE 3105
                    > USED AT LINE 3064
EV4A:               1258 DEFINED AT LINE 3116
                    > USED AT LINE 3118
EV4B:               1263 DEFINED AT LINE 3125
                    > USED AT LINE 3130
EV5:                1270 DEFINED AT LINE 3133
                    > USED AT LINE 3041
EV6:                128E DEFINED AT LINE 3145
                    > USED AT LINE 3134
EV7:                12AA DEFINED AT LINE 3160
                    > USED AT LINE 3165
DV8:                12B4 DEFINED AT LINE 3166
                    > USED AT LINE 3162
EV9:                12BF DEFINED AT LINE 3171
                    > USED AT LINE 3146
EV10:               12F1 DEFINED AT LINE 3190
                    > USED AT LINE 3173
                    > USED AT LINE 3176
                    > USED AT LINE 3179
                    > USED AT LINE 3182
FADDJ:              1313 DEFINED AT LINE 3216
                    > USED AT LINE 3172
POWER:              131B DEFINED AT LINE 3219
                    > USED AT LINE 3188
XSQR:               1340 DEFINED AT LINE 3237
EV11:               134A DEFINED AT LINE 3241
                    > USED AT LINE 3211
EVNEG:              135B DEFINED AT LINE 3251
                    > USED AT LINE 3186
EVCOM:              136F DEFINED AT LINE 3265
                    > USED AT LINE 3184
EVLD:               137B DEFINED AT LINE 3270
                    > USED AT LINE 3158
                    > USED AT LINE 3198
                    > USED AT LINE 3258
                    > USED AT LINE 3305
                    > USED AT LINE 4941
EVLD1:              138C DEFINED AT LINE 3280
                    > USED AT LINE 3285
EDM1:               1395 DEFINED AT LINE 3288
                    > USED AT LINE 3149
EDM2A:              13A4 DEFINED AT LINE 3295
                    > USED AT LINE 3308
EDM3:               13A8 DEFINED AT LINE 3298
                    > USED AT LINE 3291
EDM4:               13BC DEFINED AT LINE 3309
                    > USED AT LINE 3168
LDV2A:              13CF DEFINED AT LINE 3320
                    > USED AT LINE 2748
FIN:                1426 DEFINED AT LINE 3368
                    > USED AT LINE 1292
                    > USED AT LINE 1381
                    > USED AT LINE 2395
                    > USED AT LINE 2718
FIN2:               1436 DEFINED AT LINE 3386
                    > USED AT LINE 3384
FIN3:               145C DEFINED AT LINE 3408
                    > USED AT LINE 3405
FIN4:               1464 DEFINED AT LINE 3414
                    > USED AT LINE 3396
FIN5:               1466 DEFINED AT LINE 3416
                    > USED AT LINE 3425
FIN6:               1473 DEFINED AT LINE 3423
                    > USED AT LINE 3429
FIN7:               1478 DEFINED AT LINE 3426
                    > USED AT LINE 3419
FIN8:               1480 DEFINED AT LINE 3438
                    > USED AT LINE 3381
                    > USED AT LINE 3401
FIN8A:              1498 DEFINED AT LINE 3450
                    > USED AT LINE 3444
                    > USED AT LINE 3448
FIN9:               149A DEFINED AT LINE 3452
                    > USED AT LINE 3385
                    > USED AT LINE 3469
                    > USED AT LINE 3485
FINB:               14B6 DEFINED AT LINE 3470
                    > USED AT LINE 3463
FMTEN:              14CD DEFINED AT LINE 3489
                    > USED AT LINE 3461
                    > USED AT LINE 3560
FIND:               14DD DEFINED AT LINE 3495
                    > USED AT LINE 3491
                    > USED AT LINE 3492
FIND0:              14E0 DEFINED AT LINE 3496
                    > USED AT LINE 3494
FOUT:               14E8 DEFINED AT LINE 3501
                    > USED AT LINE 380
                    > USED AT LINE 680
                    > USED AT LINE 2362
FOUT0:              14F9 DEFINED AT LINE 3519
                    > USED AT LINE 3517
FOUT2:              1503 DEFINED AT LINE 3525
                    > USED AT LINE 3520
FOUTV:              150E DEFINED AT LINE 3529
                    > USED AT LINE 3527
FOUT3:              1514 DEFINED AT LINE 3532
                    > USED AT LINE 3541
                    > USED AT LINE 3543
FOUT4:              151F DEFINED AT LINE 3536
                    > USED AT LINE 3545
                    > USED AT LINE 3556
FOUT5:              152F DEFINED AT LINE 3542
                    > USED AT LINE 3539
FOUT6:              1535 DEFINED AT LINE 3544
                    > USED AT LINE 3535
FOUTU:              1555 DEFINED AT LINE 3557
                    > USED AT LINE 3553
FOUT7:              1558 DEFINED AT LINE 3558
                    > USED AT LINE 3562
FOUT9:              1568 DEFINED AT LINE 3564
                    > USED AT LINE 3557
                    > USED AT LINE 3561
                    > USED AT LINE 3615
                    > USED AT LINE 3617
FOUTA:              1577 DEFINED AT LINE 3574
                    > USED AT LINE 3571
FOUTB:              157A DEFINED AT LINE 3577
                    > USED AT LINE 3551
FOUTC:              157F DEFINED AT LINE 3580
                    > USED AT LINE 3589
FOUTD:              1584 DEFINED AT LINE 3582
                    > USED AT LINE 3587
FOUTH:              1591 DEFINED AT LINE 3591
                    > USED AT LINE 3563
FOUTI:              15A8 DEFINED AT LINE 3606
                    > USED AT LINE 3598
FOUTJ:              15AC DEFINED AT LINE 3609
                    > USED AT LINE 3611
FOUTK:              15CB DEFINED AT LINE 3626
                    > USED AT LINE 3622
FOUTL:              15CE DEFINED AT LINE 3628
                    > USED AT LINE 3625
FOUTM:              15D1 DEFINED AT LINE 3630
                    > USED AT LINE 3633
FOUTN:              15E9 DEFINED AT LINE 3645
                    > USED AT LINE 3653
FOUTO:              15F4 DEFINED AT LINE 3654
                    > USED AT LINE 3643
                    > USED AT LINE 3674
                    > USED AT LINE 3691
FOUTP:              15F5 DEFINED AT LINE 3655
                    > USED AT LINE 3660
FOUTQ:              1601 DEFINED AT LINE 3661
                    > USED AT LINE 3657
FOUTR:              1609 DEFINED AT LINE 3667
                    > USED AT LINE 3644
FOUTS:              1617 DEFINED AT LINE 3675
                    > USED AT LINE 3668
FOUTT:              1621 DEFINED AT LINE 3683
                    > USED AT LINE 3689
FADD:               162F DEFINED AT LINE 3693
                    > USED AT LINE 1192
                    > USED AT LINE 1764
                    > USED AT LINE 1767
                    > USED AT LINE 1810
                    > USED AT LINE 1822
                    > USED AT LINE 1833
                    > USED AT LINE 1868
                    > USED AT LINE 1878
                    > USED AT LINE 2034
                    > USED AT LINE 2082
                    > USED AT LINE 2112
                    > USED AT LINE 3218
                    > USED AT LINE 3838
FADD3:              164E DEFINED AT LINE 3716
                    > USED AT LINE 3713
FADD4:              165B DEFINED AT LINE 3722
                    > USED AT LINE 3712
                    > USED AT LINE 3717
FADD6:              167E DEFINED AT LINE 3743
                    > USED AT LINE 3733
FADD7:              1680 DEFINED AT LINE 3745
                    > USED AT LINE 3751
FADD9:              168C DEFINED AT LINE 3752
                    > USED AT LINE 3728
FADDA:              16B4 DEFINED AT LINE 3770
                    > USED AT LINE 3758
FNEG1:              16C2 DEFINED AT LINE 3777
                    > USED AT LINE 3784
FNEG2:              16C9 DEFINED AT LINE 3781
                    > USED AT LINE 3779
FNORM:              16D5 DEFINED AT LINE 3789
                    > USED AT LINE 2060
                    > USED AT LINE 2212
                    > USED AT LINE 3393
                    > USED AT LINE 3773
                    > USED AT LINE 3785
                    > USED AT LINE 3904
                    > USED AT LINE 4021
                    > USED AT LINE 4962
FNRM1:              16E7 DEFINED AT LINE 3810
                    > USED AT LINE 3824
FNRM2:              16F1 DEFINED AT LINE 3817
                    > USED AT LINE 3822
FNRM3:              16FD DEFINED AT LINE 3825
                    > USED AT LINE 3813
FSUB:               1704 DEFINED AT LINE 3831
                    > USED AT LINE 801
                    > USED AT LINE 806
                    > USED AT LINE 964
                    > USED AT LINE 1199
                    > USED AT LINE 1760
                    > USED AT LINE 1872
                    > USED AT LINE 1919
                    > USED AT LINE 1976
                    > USED AT LINE 3175
FMUL:               1710 DEFINED AT LINE 3843
                    > USED AT LINE 1789
                    > USED AT LINE 1812
                    > USED AT LINE 1820
                    > USED AT LINE 1884
                    > USED AT LINE 1911
                    > USED AT LINE 1931
                    > USED AT LINE 1952
                    > USED AT LINE 1980
                    > USED AT LINE 2080
                    > USED AT LINE 2102
                    > USED AT LINE 2214
                    > USED AT LINE 3178
                    > USED AT LINE 3234
                    > USED AT LINE 3240
                    > USED AT LINE 3422
                    > USED AT LINE 3540
FMUL5:              173A DEFINED AT LINE 3870
                    > USED AT LINE 3877
FMUL6:              1746 DEFINED AT LINE 3879
                    > USED AT LINE 3903
FMUL7:              174C DEFINED AT LINE 3882
                    > USED AT LINE 3887
FMUL8:              1762 DEFINED AT LINE 3893
                    > USED AT LINE 3888
FMUL9:              1768 DEFINED AT LINE 3896
                    > USED AT LINE 3901
MDSGN:              1777 DEFINED AT LINE 3916
                    > USED AT LINE 3857
                    > USED AT LINE 3967
SVSGN:              1781 DEFINED AT LINE 3930
                    > USED AT LINE 3762
                    > USED AT LINE 3808
                    > USED AT LINE 3916
RSSGN:              1789 DEFINED AT LINE 3946
                    > USED AT LINE 3764
                    > USED AT LINE 3827
                    > USED AT LINE 3859
                    > USED AT LINE 3970
FDIV:               1793 DEFINED AT LINE 3953
                    > USED AT LINE 1785
                    > USED AT LINE 1854
                    > USED AT LINE 1874
                    > USED AT LINE 1949
                    > USED AT LINE 2110
                    > USED AT LINE 3181
                    > USED AT LINE 3428
                    > USED AT LINE 3542
FDIV3:              17B2 DEFINED AT LINE 3976
                    > USED AT LINE 3983
FDIV5:              17C8 DEFINED AT LINE 3991
                    > USED AT LINE 4020
FDIV6:              17E2 DEFINED AT LINE 4001
                    > USED AT LINE 3995
FDIV7:              17E8 DEFINED AT LINE 4004
                    > USED AT LINE 4009
FDIV8:              17F6 DEFINED AT LINE 4013
                    > USED AT LINE 4018
GETST:              1805 DEFINED AT LINE 4025
                    > USED AT LINE 1309
                    > USED AT LINE 1399
GETS1:              1815 DEFINED AT LINE 4032
                    > USED AT LINE 4041
GETS2:              1826 DEFINED AT LINE 4042
                    > USED AT LINE 4029
                    > USED AT LINE 4031
GETS3:              1827 DEFINED AT LINE 4043
                    > USED AT LINE 4052
GETS4:              1837 DEFINED AT LINE 4053
                    > USED AT LINE 4046
GETS5:              1839 DEFINED AT LINE 4055
                    > USED AT LINE 4033
                    > USED AT LINE 4035
GETS8:              1847 DEFINED AT LINE 4065
                    > USED AT LINE 1045
                    > USED AT LINE 1278
                    > USED AT LINE 1355
GETS9:              1864 DEFINED AT LINE 4081
                    > USED AT LINE 4069
FOVUN:              1869 DEFINED AT LINE 4085
                    > USED AT LINE 3946
FOV1:               1875 DEFINED AT LINE 4095
                    > USED AT LINE 4090
SUBSC:              187D DEFINED AT LINE 4100
                    > USED AT LINE 3361
                    > USED AT LINE 4076
SUB1:               1890 DEFINED AT LINE 4121
                    > USED AT LINE 4117
SUB2:               189B DEFINED AT LINE 4130
                    > USED AT LINE 4135
SUB3:               18A5 DEFINED AT LINE 4136
                    > USED AT LINE 4132
SUB4:               18B4 DEFINED AT LINE 4145
                    > USED AT LINE 4141
FTEST:              18C6 DEFINED AT LINE 4161
                    > USED AT LINE 794
                    > USED AT LINE 968
                    > USED AT LINE 973
                    > USED AT LINE 978
                    > USED AT LINE 1752
                    > USED AT LINE 1861
                    > USED AT LINE 1894
                    > USED AT LINE 1940
                    > USED AT LINE 2003
                    > USED AT LINE 2068
                    > USED AT LINE 2123
                    > USED AT LINE 3224
                    > USED AT LINE 3230
                    > USED AT LINE 3515
                    > USED AT LINE 3702
                    > USED AT LINE 3704
                    > USED AT LINE 3720
                    > USED AT LINE 3760
                    > USED AT LINE 3769
                    > USED AT LINE 3840
                    > USED AT LINE 3849
                    > USED AT LINE 3950
                    > USED AT LINE 3959
FEXP:               18D4 DEFINED AT LINE 4173
                    > USED AT LINE 1777
                    > USED AT LINE 1900
                    > USED AT LINE 2097
                    > USED AT LINE 3526
                    > USED AT LINE 3533
                    > USED AT LINE 3549
                    > USED AT LINE 3706
                    > USED AT LINE 3709
                    > USED AT LINE 3934
FSUBT:              18DB DEFINED AT LINE 4182
                    > USED AT LINE 3772
                    > USED AT LINE 3994
FSB1:               18DC DEFINED AT LINE 4187
                    > USED AT LINE 4193
FADT3:              18E6 DEFINED AT LINE 4198
                    > USED AT LINE 3759
FADDT:              18E8 DEFINED AT LINE 4199
                    > USED AT LINE 3498
                    > USED AT LINE 3892
                    > USED AT LINE 3999
FAD1:               18E9 DEFINED AT LINE 4200
                    > USED AT LINE 4206
FSHFT:              18F3 DEFINED AT LINE 4209
                    > USED AT LINE 3748
                    > USED AT LINE 3768
                    > USED AT LINE 4218
                    > USED AT LINE 5245
TERMI:              18FC DEFINED AT LINE 4222
                    > USED AT LINE 232
                    > USED AT LINE 1287
                    > USED AT LINE 1330
REIN:               18FF DEFINED AT LINE 4234
                    > USED AT LINE 4267
                    > USED AT LINE 4300
TREAD:              1915 DEFINED AT LINE 4243
                    > USED AT LINE 4240
                    > USED AT LINE 4248
                    > USED AT LINE 4252
                    > USED AT LINE 4306
                    > USED AT LINE 4318
                    > USED AT LINE 4331
                    > USED AT LINE 4339
CR1:                1934 DEFINED AT LINE 4258
                    > USED AT LINE 4265
TESTO:              194A DEFINED AT LINE 4271
                    > USED AT LINE 393
                    > USED AT LINE 421
                    > USED AT LINE 492
                    > USED AT LINE 4238
                    > USED AT LINE 4242
                    > USED AT LINE 4283
                    > USED AT LINE 4285
                    > USED AT LINE 4317
                    > USED AT LINE 4337
                    > USED AT LINE 4368
                    > USED AT LINE 4399
                    > USED AT LINE 4481
                    > USED AT LINE 4484
                    > USED AT LINE 5670
TEST1:              194B DEFINED AT LINE 4272
                    > USED AT LINE 4276
CRLF:               195C DEFINED AT LINE 4282
                    > USED AT LINE 716
                    > USED AT LINE 736
                    > USED AT LINE 4257
                    > USED AT LINE 4299
                    > USED AT LINE 4363
                    > USED AT LINE 4366
                    > USED AT LINE 4387
NOTCR:              196B DEFINED AT LINE 4296
                    > USED AT LINE 4254
NOTCO:              1979 DEFINED AT LINE 4302
                    > USED AT LINE 4297
NOTBS:              1993 DEFINED AT LINE 4320
                    > USED AT LINE 4303
NOTCH:              19A9 DEFINED AT LINE 4333
                    > USED AT LINE 4322
ECHO:               19B4 DEFINED AT LINE 4338
                    > USED AT LINE 4310
                    > USED AT LINE 4326
                    > USED AT LINE 4335
TERMO:              19B8 DEFINED AT LINE 4341
                    > USED AT LINE 382
                    > USED AT LINE 570
                    > USED AT LINE 688
                    > USED AT LINE 1270
                    > USED AT LINE 5725
OT1:                19C0 DEFINED AT LINE 4358
                    > USED AT LINE 4373
                    > USED AT LINE 4374
OT2:                19CF DEFINED AT LINE 4365
                    > USED AT LINE 4362
OT4:                19DE DEFINED AT LINE 4372
                    > USED AT LINE 4364
TERMM:              19C0 DEFINED AT LINE 4374
                    > USED AT LINE 210
                    > USED AT LINE 217
                    > USED AT LINE 405
                    > USED AT LINE 1055
                    > USED AT LINE 1443
                    > USED AT LINE 4329
                    > USED AT LINE 4463
                    > USED AT LINE 4823
                    > USED AT LINE 4861
                    > USED AT LINE 4864
TABST:              19E2 DEFINED AT LINE 4376
                    > USED AT LINE 705
TBLP:               19F1 DEFINED AT LINE 4390
                    > USED AT LINE 4394
TBLP2:              19F8 DEFINED AT LINE 4393
                    > USED AT LINE 4391
TBON:               19FD DEFINED AT LINE 4395
                    > USED AT LINE 4392
TBSPA:              1A02 DEFINED AT LINE 4398
                    > USED AT LINE 4402
LINEO:              1A0C DEFINED AT LINE 4404
                    > USED AT LINE 562
                    > USED AT LINE 1456
                    > USED AT LINE 4819
LOUT:               1A17 DEFINED AT LINE 4417
                    > USED AT LINE 4412
                    > USED AT LINE 4413
NOTZ1:              1A25 DEFINED AT LINE 4427
                    > USED AT LINE 4424
Z1:                 1A2B DEFINED AT LINE 4431
                    > USED AT LINE 4426
NOTZ2:              1A35 DEFINED AT LINE 4436
                    > USED AT LINE 4433
Z2:                 1A3B DEFINED AT LINE 4440
                    > USED AT LINE 4435
TSTCC:              1A3D DEFINED AT LINE 4443
                    > USED AT LINE 471
                    > USED AT LINE 528
                    > USED AT LINE 5491
GETCH:              1A45 DEFINED AT LINE 4454
                    > USED AT LINE 4249
TSTC1:              1A64 DEFINED AT LINE 4466
                    > USED AT LINE 4457
PRCNT:              1A73 DEFINED AT LINE 4474
                    > USED AT LINE 4298
                    > USED AT LINE 4458
                    > USED AT LINE 4468
COMP2:              1A7F DEFINED AT LINE 4487
                    > USED AT LINE 114
COMP3:              1A83 DEFINED AT LINE 4493
                    > USED AT LINE 4501
COMP4:              1A84 DEFINED AT LINE 4494
                    > USED AT LINE 4502
COMP5:              1A87 DEFINED AT LINE 4497
                    > USED AT LINE 4492
COMP6:              1A94 DEFINED AT LINE 4503
                    > USED AT LINE 4498
EOL:                1A9A DEFINED AT LINE 4508
                    > USED AT LINE 602
                    > USED AT LINE 613
                    > USED AT LINE 621
                    > USED AT LINE 638
                    > USED AT LINE 729
                    > USED AT LINE 790
                    > USED AT LINE 1059
                    > USED AT LINE 1157
                    > USED AT LINE 1228
                    > USED AT LINE 1307
                    > USED AT LINE 1326
                    > USED AT LINE 1430
                    > USED AT LINE 1441
                    > USED AT LINE 1467
                    > USED AT LINE 1532
                    > USED AT LINE 1563
                    > USED AT LINE 1600
                    > USED AT LINE 1711
                    > USED AT LINE 2665
                    > USED AT LINE 5753
                    > USED AT LINE 5765
EOL1:               1AA9 DEFINED AT LINE 4519
                    > USED AT LINE 4517
TSTEL:              1AAE DEFINED AT LINE 4523
                    > USED AT LINE 661
                    > USED AT LINE 1528
                    > USED AT LINE 4514
                    > USED AT LINE 4540
NOTEO:              1AB3 DEFINED AT LINE 4533
                    > USED AT LINE 600
                    > USED AT LINE 636
                    > USED AT LINE 1519
PACK:               1ABB DEFINED AT LINE 4544
                    > USED AT LINE 233
                    > USED AT LINE 511
                    > USED AT LINE 523
                    > USED AT LINE 601
                    > USED AT LINE 637
                    > USED AT LINE 1526
                    > USED AT LINE 5333
PK1:                1AC3 DEFINED AT LINE 4552
                    > USED AT LINE 4574
PK3:                1AD7 DEFINED AT LINE 4562
                    > USED AT LINE 4569
SQUIS:              1AE8 DEFINED AT LINE 4576
                    > USED AT LINE 2313
                    > USED AT LINE 3103
                    > USED AT LINE 3136
                    > USED AT LINE 3249
                    > USED AT LINE 3266
SQUI2:              1AF3 DEFINED AT LINE 4592
                    > USED AT LINE 4597
SKP2Z:              1AFF DEFINED AT LINE 4601
                    > USED AT LINE 4609
                    > USED AT LINE 5307
                    > USED AT LINE 5313
GTEMP:              1B06 DEFINED AT LINE 4611
                    > USED AT LINE 2722
                    > USED AT LINE 3245
                    > USED AT LINE 3262
SADR:               1B1F DEFINED AT LINE 4636
                    > USED AT LINE 2754
ALPHA:              1B27 DEFINED AT LINE 4644
                    > USED AT LINE 2729
                    > USED AT LINE 2764
                    > USED AT LINE 4788
NUMER:              1B30 DEFINED AT LINE 4657
                    > USED AT LINE 993
                    > USED AT LINE 1513
                    > USED AT LINE 1524
                    > USED AT LINE 2716
                    > USED AT LINE 2734
                    > USED AT LINE 4553
                    > USED AT LINE 4794
NUMEN:              1B36 DEFINED AT LINE 4668
                    > USED AT LINE 4655
SEARC:              1B3A DEFINED AT LINE 4673
                    > USED AT LINE 760
                    > USED AT LINE 1186
                    > USED AT LINE 1324
                    > USED AT LINE 1549
                    > USED AT LINE 1558
                    > USED AT LINE 1589
                    > USED AT LINE 1601
                    > USED AT LINE 1641
                    > USED AT LINE 2752
                    > USED AT LINE 3357
                    > USED AT LINE 4070
                    > USED AT LINE 4081
SCH0:               1B42 DEFINED AT LINE 4682
                    > USED AT LINE 4741
                    > USED AT LINE 4745
SCH1:               1B45 DEFINED AT LINE 4683
                    > USED AT LINE 4710
SCH2:               1B67 DEFINED AT LINE 4709
                    > USED AT LINE 4695
                    > USED AT LINE 4700
SCH3:               1B6B DEFINED AT LINE 4711
                    > USED AT LINE 4685
SCH4:               1B83 DEFINED AT LINE 4726
                    > USED AT LINE 4722
SCH5:               1B87 DEFINED AT LINE 4728
                    > USED AT LINE 4725
                    > USED AT LINE 4731
SCH6:               1B95 DEFINED AT LINE 4738
                    > USED AT LINE 4681
SCH7:               1BA9 DEFINED AT LINE 4752
                    > USED AT LINE 4717
SCH8:               1BBE DEFINED AT LINE 4765
                    > USED AT LINE 4770
SCH9:               1BCA DEFINED AT LINE 4774
                    > USED AT LINE 4703
VAR:                1BCF DEFINED AT LINE 4780
                    > USED AT LINE 748
                    > USED AT LINE 1156
                    > USED AT LINE 1320
                    > USED AT LINE 1545
                    > USED AT LINE 1554
                    > USED AT LINE 1596
                    > USED AT LINE 1639
                    > USED AT LINE 2620
                    > USED AT LINE 2638
                    > USED AT LINE 2806
                    > USED AT LINE 4065
VAR2:               1BE4 DEFINED AT LINE 4799
                    > USED AT LINE 4795
VAR3:               1BEF DEFINED AT LINE 4806
                    > USED AT LINE 4800
PRLIN:              1BF7 DEFINED AT LINE 4813
                    > USED AT LINE 1444
                    > USED AT LINE 4464
                    > USED AT LINE 4865
EM:                 00FE DEFINED AT LINE 4829
                    > USED AT LINE 4832
                    > USED AT LINE 4834
                    > USED AT LINE 4836
                    > USED AT LINE 4838
                    > USED AT LINE 4840
                    > USED AT LINE 4842
                    > USED AT LINE 4844
                    > USED AT LINE 4846
                    > USED AT LINE 4848
                    > USED AT LINE 4853
                    > USED AT LINE 4856
ULERR:              1C09 DEFINED AT LINE 4831
                    > USED AT LINE 604
                    > USED AT LINE 5337
ZMERR:              1C0D DEFINED AT LINE 4833
                    > USED AT LINE 1895
                    > USED AT LINE 1896
                    > USED AT LINE 2070
                    > USED AT LINE 3965
STERR:              1C11 DEFINED AT LINE 4835
                    > USED AT LINE 3152
                    > USED AT LINE 3189
SNERR:              1C15 DEFINED AT LINE 4837
                    > USED AT LINE 753
                    > USED AT LINE 767
                    > USED AT LINE 949
                    > USED AT LINE 960
                    > USED AT LINE 992
                    > USED AT LINE 1053
                    > USED AT LINE 1067
                    > USED AT LINE 1071
                    > USED AT LINE 1323
                    > USED AT LINE 1418
                    > USED AT LINE 1486
                    > USED AT LINE 1498
                    > USED AT LINE 1508
                    > USED AT LINE 1525
                    > USED AT LINE 1553
                    > USED AT LINE 1595
                    > USED AT LINE 1599
                    > USED AT LINE 1640
                    > USED AT LINE 1725
                    > USED AT LINE 1728
                    > USED AT LINE 2612
                    > USED AT LINE 2636
                    > USED AT LINE 2658
                    > USED AT LINE 2662
                    > USED AT LINE 2796
                    > USED AT LINE 2825
                    > USED AT LINE 2871
                    > USED AT LINE 2880
                    > USED AT LINE 2957
                    > USED AT LINE 3012
                    > USED AT LINE 3208
                    > USED AT LINE 3299
                    > USED AT LINE 4116
                    > USED AT LINE 4120
                    > USED AT LINE 4140
                    > USED AT LINE 4144
                    > USED AT LINE 4515
                    > USED AT LINE 4541
                    > USED AT LINE 4559
                    > USED AT LINE 4789
                    > USED AT LINE 5357
                    > USED AT LINE 5746
RTERR:              1C19 DEFINED AT LINE 4839
                    > USED AT LINE 624
DAERR:              1C1D DEFINED AT LINE 4841
                    > USED AT LINE 1366
                    > USED AT LINE 5387
NXERR:              1C21 DEFINED AT LINE 4843
                    > USED AT LINE 838
                    > USED AT LINE 879
                    > USED AT LINE 1165
                    > USED AT LINE 1179
CVERR:              1C25 DEFINED AT LINE 4845
                    > USED AT LINE 1297
                    > USED AT LINE 1398
                    > USED AT LINE 2398
                    > USED AT LINE 4048
CKERR:              1C29 DEFINED AT LINE 4847
                    > USED AT LINE 5589
                    > USED AT LINE 5701
OVERR:              1C2D DEFINED AT LINE 4852
                    > USED AT LINE 4098
                    > USED AT LINE 5235
                    > USED AT LINE 5238
UNERR:              1C32 DEFINED AT LINE 4855
                    > USED AT LINE 4094
ERROR:              1C37 DEFINED AT LINE 4861
                    > USED AT LINE 157
CPY4D:              1C51 DEFINED AT LINE 4882
                    > USED AT LINE 1922
COPYD:              1C53 DEFINED AT LINE 4883
                    > USED AT LINE 123
                    > USED AT LINE 207
                    > USED AT LINE 317
                    > USED AT LINE 921
                    > USED AT LINE 1473
                    > USED AT LINE 3989
                    > USED AT LINE 4888
                    > USED AT LINE 4897
                    > USED AT LINE 5343
                    > USED AT LINE 5438
CPY4H:              1C5C DEFINED AT LINE 4895
                    > USED AT LINE 3725
COPYH:              1C5E DEFINED AT LINE 4896
                    > USED AT LINE 144
                    > USED AT LINE 267
                    > USED AT LINE 303
                    > USED AT LINE 2211
                    > USED AT LINE 3864
                    > USED AT LINE 5393
ZEROM:              1C64 DEFINED AT LINE 4901
                    > USED AT LINE 313
                    > USED AT LINE 2029
                    > USED AT LINE 2139
                    > USED AT LINE 3294
                    > USED AT LINE 3440
                    > USED AT LINE 3867
                    > USED AT LINE 4908
FBIN:               1C6C DEFINED AT LINE 4911
                    > USED AT LINE 712
                    > USED AT LINE 1420
                    > USED AT LINE 1431
                    > USED AT LINE 1484
                    > USED AT LINE 1610
                    > USED AT LINE 1623
                    > USED AT LINE 2223
                    > USED AT LINE 2331
                    > USED AT LINE 2407
                    > USED AT LINE 2423
                    > USED AT LINE 4947
                    > USED AT LINE 5754
FBIN1:              1C77 DEFINED AT LINE 4925
                    > USED AT LINE 4923
ARG:                1C7A DEFINED AT LINE 4929
                    > USED AT LINE 3054
                    > USED AT LINE 4946
ARGNU:              1C89 DEFINED AT LINE 4944
                    > USED AT LINE 2425
                    > USED AT LINE 2440
                    > USED AT LINE 2451
                    > USED AT LINE 2463
                    > USED AT LINE 2466
                    > USED AT LINE 2508
BINFL:              1C8F DEFINED AT LINE 4949
                    > USED AT LINE 378
                    > USED AT LINE 2233
                    > USED AT LINE 5737
FUNCT:              1C9E DEFINED AT LINE 4972
                    > USED AT LINE 2785
RNDLI:              1CBA DEFINED AT LINE 4985
                    > USED AT LINE 2771
PCHOF:              1D70 DEFINED AT LINE 5058
                    > USED AT LINE 412
RNDP:               1D73 DEFINED AT LINE 5059
                    > USED AT LINE 2153
NRNDX:              1D79 DEFINED AT LINE 5062
                    > USED AT LINE 205
                    > USED AT LINE 314
WHATL:              1D81 DEFINED AT LINE 5066
                    > USED AT LINE 1054
VERS:               1D86 DEFINED AT LINE 5067
                    > USED AT LINE 209
RBOUT:              1D94 DEFINED AT LINE 5069
                    > USED AT LINE 4328
LLINE:              1D98 DEFINED AT LINE 5070
                    > USED AT LINE 1244
TABLI:              1D9D DEFINED AT LINE 5071
                    > USED AT LINE 669
STEPL:              1DA1 DEFINED AT LINE 5072
                    > USED AT LINE 779
THENL:              1DA6 DEFINED AT LINE 5073
                    > USED AT LINE 990
PILIT:              1DAB DEFINED AT LINE 5074
                    > USED AT LINE 2781
TWO:                1DAE DEFINED AT LINE 5075
                    > USED AT LINE 1871
TEN:                1DB2 DEFINED AT LINE 5076
                    > USED AT LINE 3418
                    > USED AT LINE 3538
PI:                 1DB6 DEFINED AT LINE 5077
                    > USED AT LINE 1759
                    > USED AT LINE 2840
QTRPI:              1DBA DEFINED AT LINE 5078
                    > USED AT LINE 1877
NEGON:              1DBE DEFINED AT LINE 5079
                    > USED AT LINE 2033
LN2C:               1DC2 DEFINED AT LINE 5080
                    > USED AT LINE 1910
SQC1:               1DC6 DEFINED AT LINE 5081
                    > USED AT LINE 2079
SQC2:               1DCA DEFINED AT LINE 5082
                    > USED AT LINE 2081
SQC3:               1DCE DEFINED AT LINE 5096
                    > USED AT LINE 2101
ATNCO:              1DE6 DEFINED AT LINE 5102
                    > USED AT LINE 1885
HALFP:              1DEA DEFINED AT LINE 5104
                    > USED AT LINE 1762
                    > USED AT LINE 1784
                    > USED AT LINE 1832
SINCO:              1DFA DEFINED AT LINE 5108
                    > USED AT LINE 1790
ONE:                1DFE DEFINED AT LINE 5110
                    > USED AT LINE 772
                    > USED AT LINE 1867
                    > USED AT LINE 1917
                    > USED AT LINE 1946
                    > USED AT LINE 1969
                    > USED AT LINE 2008
                    > USED AT LINE 2830
NULLI:              1E00 DEFINED AT LINE 5111
                    > USED AT LINE 339
LNCO:               1E1A DEFINED AT LINE 5118
                    > USED AT LINE 1923
LN2E:               1E1E DEFINED AT LINE 5120
                    > USED AT LINE 1951
EXPCO:              1E32 DEFINED AT LINE 5125
                    > USED AT LINE 1977
LNC:                1E36 DEFINED AT LINE 5127
                    > USED AT LINE 1930
READY:              1E3A DEFINED AT LINE 5128
                    > USED AT LINE 216
STOPM:              1E41 DEFINED AT LINE 5131
                    > USED AT LINE 1442
                    > USED AT LINE 4462
ERRMS:              1E50 DEFINED AT LINE 5134
                    > USED AT LINE 4863
TTY:                0002 DEFINED AT LINE 5135
JMPTB:              1E60 DEFINED AT LINE 5145
                    > USED AT LINE 472
KEYL:               1E8D DEFINED AT LINE 5160
                    > USED AT LINE 404
DATAL:              1EAF DEFINED AT LINE 5170
                    > USED AT LINE 1369
NEXTL:              1EBC DEFINED AT LINE 5174
                    > USED AT LINE 884
GOSBL:              1EC3 DEFINED AT LINE 5176
                    > USED AT LINE 986
                    > USED AT LINE 1496
GOTOL:              1EE4 DEFINED AT LINE 5184
                    > USED AT LINE 982
                    > USED AT LINE 1491
TOLIT:              1EE6 DEFINED AT LINE 5185
                    > USED AT LINE 765
                    > USED AT LINE 1551
                    > USED AT LINE 1593
DEFLI:              1F32 DEFINED AT LINE 5209
                    > USED AT LINE 2616
FNLIT:              1F35 DEFINED AT LINE 5210
                    > USED AT LINE 2776
FACDE:              1F60 DEFINED AT LINE 5228
                    > USED AT LINE 3309
                    > USED AT LINE 3315
                    > USED AT LINE 4920
                    > USED AT LINE 5733
                    > USED AT LINE 5749
                    > USED AT LINE 5766
FDE1:               1F75 DEFINED AT LINE 5242
                    > USED AT LINE 5247
FDE2:               1F82 DEFINED AT LINE 5248
                    > USED AT LINE 5237
LOCAT:              1F89 DEFINED AT LINE 5255
                    > USED AT LINE 255
                    > USED AT LINE 603
                    > USED AT LINE 5336
FIND1:              1F8C DEFINED AT LINE 5263
                    > USED AT LINE 5286
FIND2:              1FA6 DEFINED AT LINE 5282
                    > USED AT LINE 5270
                    > USED AT LINE 5275
FIND3:              1FAE DEFINED AT LINE 5290
                    > USED AT LINE 5266
                    > USED AT LINE 5271
                    > USED AT LINE 5276
SEEK:               1FB1 DEFINED AT LINE 5295
SEEK1:              1FB1 DEFINED AT LINE 5300
                    > USED AT LINE 473
                    > USED AT LINE 2787
                    > USED AT LINE 5320
                    > USED AT LINE 5322
SEEK2:              1FC4 DEFINED AT LINE 5313
                    > USED AT LINE 5305
SEEK3:              1FD4 DEFINED AT LINE 5323
                    > USED AT LINE 5303
FIX:                1FD6 DEFINED AT LINE 5331
                    > USED AT LINE 5217
FIX1:               1FFF DEFINED AT LINE 5354
                    > USED AT LINE 5363
FIX2:               200F DEFINED AT LINE 5367
                    > USED AT LINE 5359
FIX3:               204B DEFINED AT LINE 5408
                    > USED AT LINE 5415
FIX4:               2057 DEFINED AT LINE 5419
                    > USED AT LINE 5411
FIX4A:              2058 DEFINED AT LINE 5420
                    > USED AT LINE 5427
FIX5:               2064 DEFINED AT LINE 5431
                    > USED AT LINE 5422
SWCH:               00FF DEFINED AT LINE 5450
                    > USED AT LINE 5558
                    > USED AT LINE 5679
                    > USED AT LINE 5686
CASC:               0003 DEFINED AT LINE 5451
                    > USED AT LINE 5495
                    > USED AT LINE 5599
                    > USED AT LINE 5677
                    > USED AT LINE 5683
CASD:               0000 DEFINED AT LINE 5452
                    > USED AT LINE 5504
                    > USED AT LINE 5540
CFLAG:              0004 DEFINED AT LINE 5453
                    > USED AT LINE 5496
WATCH:              207A DEFINED AT LINE 5488
                    > USED AT LINE 5497
                    > USED AT LINE 5503
                    > USED AT LINE 5538
CASI:               208B DEFINED AT LINE 5503
                    > USED AT LINE 5568
                    > USED AT LINE 5570
                    > USED AT LINE 5575
                    > USED AT LINE 5582
                    > USED AT LINE 5584
                    > USED AT LINE 5678
                    > USED AT LINE 5685
RECO:               2091 DEFINED AT LINE 5513
                    > USED AT LINE 5642
                    > USED AT LINE 5661
NCHAR:              209E DEFINED AT LINE 5520
                    > USED AT LINE 5525
CASO:               20B2 DEFINED AT LINE 5537
                    > USED AT LINE 5514
                    > USED AT LINE 5516
                    > USED AT LINE 5521
                    > USED AT LINE 5529
                    > USED AT LINE 5603
                    > USED AT LINE 5607
                    > USED AT LINE 5610
CKSUM:              20BA DEFINED AT LINE 5548
                    > USED AT LINE 5523
                    > USED AT LINE 5578
SENSE:              20BE DEFINED AT LINE 5556
RECI:               20C3 DEFINED AT LINE 5568
                    > USED AT LINE 5692
                    > USED AT LINE 5699
RECI1:              20D0 DEFINED AT LINE 5575
                    > USED AT LINE 5580
CSAVE:              20EE DEFINED AT LINE 5597
                    > USED AT LINE 5221
NULS:               20F7 DEFINED AT LINE 5603
                    > USED AT LINE 5605
SYNCS:              2107 DEFINED AT LINE 5610
                    > USED AT LINE 5612
FNAME:              2114 DEFINED AT LINE 5616
                    > USED AT LINE 5624
BLANK:              211D DEFINED AT LINE 5622
                    > USED AT LINE 5619
NXTRC:              213F DEFINED AT LINE 5647
                    > USED AT LINE 5663
RITE:               2153 DEFINED AT LINE 5658
                    > USED AT LINE 5653
ERITE:              215D DEFINED AT LINE 5664
                    > USED AT LINE 5650
BELL:               215E DEFINED AT LINE 5669
                    > USED AT LINE 5726
CLOAD:              2166 DEFINED AT LINE 5675
                    > USED AT LINE 5219
NULL1:              2166 DEFINED AT LINE 5676
                    > USED AT LINE 5688
                    > USED AT LINE 5695
NULLS:              216A DEFINED AT LINE 5678
                    > USED AT LINE 5681
SYNC:               217A DEFINED AT LINE 5685
                    > USED AT LINE 5690
NXTR:               219A DEFINED AT LINE 5699
                    > USED AT LINE 5714
PEEK:               21C6 DEFINED AT LINE 5729
                    > USED AT LINE 5049
POKE:               21D1 DEFINED AT LINE 5739
                    > USED AT LINE 5213
JUMP:               21EF DEFINED AT LINE 5760
                    > USED AT LINE 5215
ROMEN:              21FD DEFINED AT LINE 5772
                    > USED AT LINE 5856
RAM:                2400 DEFINED AT LINE 5780
                    > USED AT LINE 86
BZERO:              2400 DEFINED AT LINE 5782
                    > USED AT LINE 311
                    > USED AT LINE 312
FORNE:              2400 DEFINED AT LINE 5783
                    > USED AT LINE 813
                    > USED AT LINE 839
                    > USED AT LINE 1161
                    > USED AT LINE 1180
                    > USED AT LINE 1183
                    > USED AT LINE 1209
TAPES:              2471 DEFINED AT LINE 5785
                    > USED AT LINE 391
                    > USED AT LINE 401
                    > USED AT LINE 411
                    > USED AT LINE 490
                    > USED AT LINE 4255
                    > USED AT LINE 4304
                    > USED AT LINE 4333
DIMSW:              2472 DEFINED AT LINE 5786
                    > USED AT LINE 1645
                    > USED AT LINE 2590
                    > USED AT LINE 2593
                    > USED AT LINE 2675
                    > USED AT LINE 3138
                    > USED AT LINE 3147
                    > USED AT LINE 3166
                    > USED AT LINE 3318
                    > USED AT LINE 3338
                    > USED AT LINE 3342
                    > USED AT LINE 3345
                    > USED AT LINE 4072
OUTSW:              2473 DEFINED AT LINE 5787
                    > USED AT LINE 733
                    > USED AT LINE 4354
                    > USED AT LINE 4382
                    > USED AT LINE 4469
                    > USED AT LINE 4471
ILSW:               2474 DEFINED AT LINE 5788
                    > USED AT LINE 1328
                    > USED AT LINE 1342
                    > USED AT LINE 4259
RUNSW:              2475 DEFINED AT LINE 5789
                    > USED AT LINE 330
                    > USED AT LINE 457
                    > USED AT LINE 599
                    > USED AT LINE 1445
EDSW:               2476 DEFINED AT LINE 5790
                    > USED AT LINE 229
                    > USED AT LINE 598
                    > USED AT LINE 1051
                    > USED AT LINE 4459
EZERO:              2477 DEFINED AT LINE 5791
                    > USED AT LINE 312
LINEN:              2477 DEFINED AT LINE 5793
                    > USED AT LINE 587
                    > USED AT LINE 1455
                    > USED AT LINE 4817
                    > USED AT LINE 4822
IMMED:              247C DEFINED AT LINE 5794
                    > USED AT LINE 238
                    > USED AT LINE 253
                    > USED AT LINE 272
                    > USED AT LINE 301
                    > USED AT LINE 332
                    > USED AT LINE 341
                    > USED AT LINE 5436
IOBUF:              24CE DEFINED AT LINE 5795
                    > USED AT LINE 331
                    > USED AT LINE 379
                    > USED AT LINE 561
                    > USED AT LINE 658
                    > USED AT LINE 916
                    > USED AT LINE 997
                    > USED AT LINE 1249
                    > USED AT LINE 1259
                    > USED AT LINE 1333
                    > USED AT LINE 4234
                    > USED AT LINE 4268
                    > USED AT LINE 4357
                    > USED AT LINE 5347
                    > USED AT LINE 5368
                    > USED AT LINE 5376
                    > USED AT LINE 5392
                    > USED AT LINE 5399
                    > USED AT LINE 5434
                    > USED AT LINE 5437
                    > USED AT LINE 5613
                    > USED AT LINE 5638
                    > USED AT LINE 5641
                    > USED AT LINE 5691
                    > USED AT LINE 5696
                    > USED AT LINE 5721
                    > USED AT LINE 5723
STRIN:              2520 DEFINED AT LINE 5796
                    > USED AT LINE 692
                    > USED AT LINE 917
                    > USED AT LINE 999
                    > USED AT LINE 1075
                    > USED AT LINE 1119
                    > USED AT LINE 1332
                    > USED AT LINE 1344
                    > USED AT LINE 1604
                    > USED AT LINE 2251
                    > USED AT LINE 2265
                    > USED AT LINE 2277
                    > USED AT LINE 2299
                    > USED AT LINE 2322
                    > USED AT LINE 2332
                    > USED AT LINE 2344
                    > USED AT LINE 2359
                    > USED AT LINE 2378
                    > USED AT LINE 2383
                    > USED AT LINE 2394
                    > USED AT LINE 2408
                    > USED AT LINE 2424
                    > USED AT LINE 2426
                    > USED AT LINE 2470
                    > USED AT LINE 2490
                    > USED AT LINE 2509
                    > USED AT LINE 2873
                    > USED AT LINE 2885
                    > USED AT LINE 2913
                    > USED AT LINE 3105
                    > USED AT LINE 3276
                    > USED AT LINE 4025
                    > USED AT LINE 4055
                    > USED AT LINE 5342
                    > USED AT LINE 5344
                    > USED AT LINE 5346
                    > USED AT LINE 5380
                    > USED AT LINE 5391
OUTA:               2620 DEFINED AT LINE 5797
                    > USED AT LINE 1421
                    > USED AT LINE 1432
                    > USED AT LINE 2224
                    > USED AT LINE 2230
INDX:               2623 DEFINED AT LINE 5798
                    > USED AT LINE 750
                    > USED AT LINE 757
                    > USED AT LINE 814
                    > USED AT LINE 888
                    > USED AT LINE 891
                    > USED AT LINE 1159
REL:                2625 DEFINED AT LINE 5799
                    > USED AT LINE 951
                    > USED AT LINE 965
                    > USED AT LINE 970
                    > USED AT LINE 975
                    > USED AT LINE 1029
                    > USED AT LINE 1490
                    > USED AT LINE 1500
                    > USED AT LINE 1533
IFTYP:              2626 DEFINED AT LINE 5800
                    > USED AT LINE 913
                    > USED AT LINE 958
TVAR1:              2627 DEFINED AT LINE 5801
                    > USED AT LINE 770
                    > USED AT LINE 796
                    > USED AT LINE 850
                    > USED AT LINE 923
                    > USED AT LINE 963
                    > USED AT LINE 1193
                    > USED AT LINE 1232
TVAR2:              262B DEFINED AT LINE 5802
                    > USED AT LINE 787
                    > USED AT LINE 845
TEMP1:              262F DEFINED AT LINE 5803
                    > USED AT LINE 1774
                    > USED AT LINE 1821
                    > USED AT LINE 1869
                    > USED AT LINE 1873
                    > USED AT LINE 1879
                    > USED AT LINE 1912
                    > USED AT LINE 1944
                    > USED AT LINE 1948
                    > USED AT LINE 1971
                    > USED AT LINE 2083
                    > USED AT LINE 2090
                    > USED AT LINE 2109
                    > USED AT LINE 2111
                    > USED AT LINE 3220
                    > USED AT LINE 3228
                    > USED AT LINE 3237
                    > USED AT LINE 3239
                    > USED AT LINE 3293
                    > USED AT LINE 3306
                    > USED AT LINE 3313
TEMP2:              2633 DEFINED AT LINE 5804
                    > USED AT LINE 1786
                    > USED AT LINE 1788
                    > USED AT LINE 1819
                    > USED AT LINE 1875
                    > USED AT LINE 1897
                    > USED AT LINE 1921
                    > USED AT LINE 2074
                    > USED AT LINE 2107
TEMP3:              2637 DEFINED AT LINE 5805
                    > USED AT LINE 1804
                    > USED AT LINE 1811
                    > USED AT LINE 1953
TEMP4:              263B DEFINED AT LINE 5806
                    > USED AT LINE 1845
                    > USED AT LINE 1850
                    > USED AT LINE 1956
                    > USED AT LINE 1966
                    > USED AT LINE 1968
                    > USED AT LINE 1979
TEMP5:              263F DEFINED AT LINE 5807
                    > USED AT LINE 1975
TEMP6:              2643 DEFINED AT LINE 5808
TEMP7:              2647 DEFINED AT LINE 5809
                    > USED AT LINE 1848
                    > USED AT LINE 1853
                    > USED AT LINE 2135
                    > USED AT LINE 2213
                    > USED AT LINE 3226
                    > USED AT LINE 3233
LINEL:              264B DEFINED AT LINE 5810
                    > USED AT LINE 505
                    > USED AT LINE 515
                    > USED AT LINE 536
LINEH:              264D DEFINED AT LINE 5811
                    > USED AT LINE 507
                    > USED AT LINE 516
                    > USED AT LINE 526
                    > USED AT LINE 548
PROMP:              264F DEFINED AT LINE 5812
                    > USED AT LINE 4233
                    > USED AT LINE 4237
EXPRS:              2650 DEFINED AT LINE 5813
                    > USED AT LINE 2600
                    > USED AT LINE 2667
                    > USED AT LINE 2711
                    > USED AT LINE 2721
                    > USED AT LINE 2723
                    > USED AT LINE 2753
                    > USED AT LINE 2755
                    > USED AT LINE 2810
                    > USED AT LINE 2821
                    > USED AT LINE 2844
                    > USED AT LINE 2851
                    > USED AT LINE 2857
                    > USED AT LINE 2860
                    > USED AT LINE 2904
                    > USED AT LINE 2911
                    > USED AT LINE 2928
                    > USED AT LINE 2931
                    > USED AT LINE 2962
                    > USED AT LINE 2981
                    > USED AT LINE 2993
                    > USED AT LINE 3003
                    > USED AT LINE 3006
                    > USED AT LINE 3015
                    > USED AT LINE 3333
                    > USED AT LINE 3337
                    > USED AT LINE 3348
                    > USED AT LINE 4598
ADDR1:              2652 DEFINED AT LINE 5814
                    > USED AT LINE 470
                    > USED AT LINE 483
                    > USED AT LINE 762
                    > USED AT LINE 800
                    > USED AT LINE 805
                    > USED AT LINE 956
                    > USED AT LINE 981
                    > USED AT LINE 985
                    > USED AT LINE 989
                    > USED AT LINE 1188
                    > USED AT LINE 1234
                    > USED AT LINE 1250
                    > USED AT LINE 1281
                    > USED AT LINE 1298
                    > USED AT LINE 1310
                    > USED AT LINE 2525
                    > USED AT LINE 2531
                    > USED AT LINE 2691
                    > USED AT LINE 3043
                    > USED AT LINE 3079
                    > USED AT LINE 4933
                    > USED AT LINE 4939
                    > USED AT LINE 5374
ADDR2:              2654 DEFINED AT LINE 5815
                    > USED AT LINE 2688
                    > USED AT LINE 3050
                    > USED AT LINE 3058
                    > USED AT LINE 3085
                    > USED AT LINE 5335
                    > USED AT LINE 5348
                    > USED AT LINE 5369
                    > USED AT LINE 5407
ADDR3:              2656 DEFINED AT LINE 5816
                    > USED AT LINE 2579
                    > USED AT LINE 2582
                    > USED AT LINE 2605
                    > USED AT LINE 2646
                    > USED AT LINE 2684
                    > USED AT LINE 2958
                    > USED AT LINE 3014
                    > USED AT LINE 3137
                    > USED AT LINE 3169
                    > USED AT LINE 3346
                    > USED AT LINE 3363
FACC:               2658 DEFINED AT LINE 5817
                    > USED AT LINE 121
                    > USED AT LINE 142
                    > USED AT LINE 1205
                    > USED AT LINE 1776
                    > USED AT LINE 1899
                    > USED AT LINE 1916
                    > USED AT LINE 1959
                    > USED AT LINE 1961
                    > USED AT LINE 1989
                    > USED AT LINE 1991
                    > USED AT LINE 2011
                    > USED AT LINE 2024
                    > USED AT LINE 2035
                    > USED AT LINE 2044
                    > USED AT LINE 2055
                    > USED AT LINE 2073
                    > USED AT LINE 2099
                    > USED AT LINE 2114
                    > USED AT LINE 2126
                    > USED AT LINE 2138
                    > USED AT LINE 2141
                    > USED AT LINE 3388
                    > USED AT LINE 3402
                    > USED AT LINE 3438
                    > USED AT LINE 3474
                    > USED AT LINE 3495
                    > USED AT LINE 3496
                    > USED AT LINE 3511
                    > USED AT LINE 3525
                    > USED AT LINE 3532
                    > USED AT LINE 3548
                    > USED AT LINE 3559
                    > USED AT LINE 3579
                    > USED AT LINE 3580
                    > USED AT LINE 3734
                    > USED AT LINE 3754
                    > USED AT LINE 3756
                    > USED AT LINE 3774
                    > USED AT LINE 3796
                    > USED AT LINE 3868
                    > USED AT LINE 3918
                    > USED AT LINE 3971
                    > USED AT LINE 4003
                    > USED AT LINE 4166
                    > USED AT LINE 4169
                    > USED AT LINE 4171
                    > USED AT LINE 4954
                    > USED AT LINE 5233
                    > USED AT LINE 5243
                    > USED AT LINE 5248
FTEMP:              265C DEFINED AT LINE 5818
                    > USED AT LINE 3397
                    > USED AT LINE 3411
                    > USED AT LINE 3464
                    > USED AT LINE 3489
                    > USED AT LINE 3493
                    > USED AT LINE 3546
                    > USED AT LINE 3554
                    > USED AT LINE 3724
                    > USED AT LINE 3729
                    > USED AT LINE 3753
                    > USED AT LINE 3757
                    > USED AT LINE 3861
                    > USED AT LINE 3865
                    > USED AT LINE 3880
                    > USED AT LINE 3889
                    > USED AT LINE 3890
                    > USED AT LINE 3894
                    > USED AT LINE 3972
                    > USED AT LINE 3991
                    > USED AT LINE 3992
                    > USED AT LINE 3996
                    > USED AT LINE 3997
                    > USED AT LINE 4012
PARCT:              2668 DEFINED AT LINE 5819
                    > USED AT LINE 2585
                    > USED AT LINE 2680
                    > USED AT LINE 2704
                    > USED AT LINE 2926
                    > USED AT LINE 2955
                    > USED AT LINE 2999
                    > USED AT LINE 3009
                    > USED AT LINE 3011
                    > USED AT LINE 3141
                    > USED AT LINE 3325
                    > USED AT LINE 3328
                    > USED AT LINE 3352
SPCTR:              2669 DEFINED AT LINE 5820
                    > USED AT LINE 2281
                    > USED AT LINE 2285
                    > USED AT LINE 2583
                    > USED AT LINE 2682
                    > USED AT LINE 2707
                    > USED AT LINE 2893
                    > USED AT LINE 2895
                    > USED AT LINE 3066
                    > USED AT LINE 3069
                    > USED AT LINE 3109
                    > USED AT LINE 3113
                    > USED AT LINE 3159
                    > USED AT LINE 3329
                    > USED AT LINE 3332
                    > USED AT LINE 3350
                    > USED AT LINE 4630
                    > USED AT LINE 4633
CMACT:              266B DEFINED AT LINE 5821
                    > USED AT LINE 3267
FNARG:              266C DEFINED AT LINE 5822
                    > USED AT LINE 2594
                    > USED AT LINE 2596
                    > USED AT LINE 2640
                    > USED AT LINE 2671
                    > USED AT LINE 2673
                    > USED AT LINE 4738
STMT:               2670 DEFINED AT LINE 5823
                    > USED AT LINE 441
                    > USED AT LINE 452
                    > USED AT LINE 456
                    > USED AT LINE 605
                    > USED AT LINE 626
                    > USED AT LINE 643
                    > USED AT LINE 862
                    > USED AT LINE 865
                    > USED AT LINE 873
                    > USED AT LINE 880
                    > USED AT LINE 1223
                    > USED AT LINE 1226
                    > USED AT LINE 1229
                    > USED AT LINE 1449
ENDLI:              2672 DEFINED AT LINE 5824
                    > USED AT LINE 450
                    > USED AT LINE 628
                    > USED AT LINE 641
                    > USED AT LINE 855
                    > USED AT LINE 4520
MULTI:              2674 DEFINED AT LINE 5825
                    > USED AT LINE 327
                    > USED AT LINE 445
                    > USED AT LINE 607
                    > USED AT LINE 630
                    > USED AT LINE 639
                    > USED AT LINE 1448
                    > USED AT LINE 4518
DEXP:               2675 DEFINED AT LINE 5826
                    > USED AT LINE 2071
                    > USED AT LINE 2096
                    > USED AT LINE 3530
                    > USED AT LINE 3536
                    > USED AT LINE 3594
COLUM:              2676 DEFINED AT LINE 5827
                    > USED AT LINE 714
                    > USED AT LINE 2241
                    > USED AT LINE 4293
                    > USED AT LINE 4369
                    > USED AT LINE 4371
                    > USED AT LINE 4385
                    > USED AT LINE 4395
RNDX:               2677 DEFINED AT LINE 5828
                    > USED AT LINE 315
                    > USED AT LINE 1471
                    > USED AT LINE 2209
RNDY:               2679 DEFINED AT LINE 5829
RNDZ:               267B DEFINED AT LINE 5830
                    > USED AT LINE 2143
RNDS:               267D DEFINED AT LINE 5831
                    > USED AT LINE 2181
                    > USED AT LINE 2198
TRNDX:              267F DEFINED AT LINE 5832
                    > USED AT LINE 1470
                    > USED AT LINE 2208
TRNDY:              2681 DEFINED AT LINE 5833
TRNDZ:              2683 DEFINED AT LINE 5834
TRNDS:              2685 DEFINED AT LINE 5835
RNDSW:              2687 DEFINED AT LINE 5836
                    > USED AT LINE 1469
                    > USED AT LINE 2205
FNMOD:              2688 DEFINED AT LINE 5837
                    > USED AT LINE 328
                    > USED AT LINE 2587
                    > USED AT LINE 2604
                    > USED AT LINE 2678
                    > USED AT LINE 4679
LINE:               2689 DEFINED AT LINE 5838
                    > USED AT LINE 340
                    > USED AT LINE 464
                    > USED AT LINE 1231
                    > USED AT LINE 1454
                    > USED AT LINE 4818
STACK:              268B DEFINED AT LINE 5839
                    > USED AT LINE 203
                    > USED AT LINE 230
PRSW:               268D DEFINED AT LINE 5840
                    > USED AT LINE 657
                    > USED AT LINE 731
                    > USED AT LINE 4551
                    > USED AT LINE 4557
                    > USED AT LINE 4560
NS:                 268E DEFINED AT LINE 5841
                    > USED AT LINE 677
                    > USED AT LINE 912
                    > USED AT LINE 957
                    > USED AT LINE 1064
                    > USED AT LINE 3206
                    > USED AT LINE 3272
DATAP:              268F DEFINED AT LINE 5842
                    > USED AT LINE 438
                    > USED AT LINE 615
                    > USED AT LINE 1358
                    > USED AT LINE 1364
                    > USED AT LINE 1372
                    > USED AT LINE 1386
                    > USED AT LINE 1407
DATAB:              2691 DEFINED AT LINE 5843
                    > USED AT LINE 197
                    > USED AT LINE 357
                    > USED AT LINE 369
                    > USED AT LINE 433
                    > USED AT LINE 4682
PROGE:              2693 DEFINED AT LINE 5844
                    > USED AT LINE 271
                    > USED AT LINE 277
                    > USED AT LINE 281
                    > USED AT LINE 360
                    > USED AT LINE 371
                    > USED AT LINE 2598
                    > USED AT LINE 2602
                    > USED AT LINE 2669
                    > USED AT LINE 2708
                    > USED AT LINE 5371
                    > USED AT LINE 5629
                    > USED AT LINE 5720
BEGPR:              2696 DEFINED AT LINE 5849
                    > USED AT LINE 359
                    > USED AT LINE 437
                    > USED AT LINE 527
                    > USED AT LINE 614
                    > USED AT LINE 2609
                    > USED AT LINE 5262
                    > USED AT LINE 5628
                    > USED AT LINE 5646
                    > USED AT LINE 5698